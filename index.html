<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="keep fighting！">
<meta property="og:type" content="website">
<meta property="og:title" content="JiM-W">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="JiM-W">
<meta property="og:description" content="keep fighting！">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="JiM-W">
<meta name="twitter:description" content="keep fighting！">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title> JiM-W </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">JiM-W</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">keep Moving</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/20/230fetch请求(promise的封装)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/06/20/230fetch请求(promise的封装)/" itemprop="url">
                  fetch请求(promise的封装)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-20T12:36:00+08:00">
                2017-06-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ES6/" itemprop="url" rel="index">
                    <span itemprop="name">ES6</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-一般的fetch用法"><a href="#1-一般的fetch用法" class="headerlink" title="1 一般的fetch用法"></a>1 一般的fetch用法</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">fetch(url,option).then(<span class="function"><span class="params">response</span>=&gt;</span>&#123;</div><div class="line">  <span class="comment">//handle HTTP response</span></div><div class="line">&#125;).then(<span class="function"><span class="params">error</span>=&gt;</span>&#123;</div><div class="line">  <span class="comment">//handle HTTP error</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>具体的栗子如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">fetch(url, &#123; <span class="comment">//option</span></div><div class="line">  method: <span class="string">"POST"</span>,</div><div class="line">  <span class="attr">body</span>: <span class="built_in">JSON</span>.stringify(data),</div><div class="line">  <span class="attr">headers</span>: &#123;</div><div class="line">    <span class="string">"Content-Type"</span>: <span class="string">"application/json"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">credentials</span>: <span class="string">"same-origin"</span></div><div class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</div><div class="line">  response.status     <span class="comment">//=&gt; number 100–599</span></div><div class="line">  response.statusText <span class="comment">//=&gt; String</span></div><div class="line">  response.headers    <span class="comment">//=&gt; Headers</span></div><div class="line">  response.url        <span class="comment">//=&gt; String</span></div><div class="line"></div><div class="line">  <span class="keyword">return</span> response.text()</div><div class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</div><div class="line">  error.message <span class="comment">//=&gt; String</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h2 id="2-参数解析"><a href="#2-参数解析" class="headerlink" title="2 参数解析"></a>2 参数解析</h2><h3 id="url-地址-‘-path’"><a href="#url-地址-‘-path’" class="headerlink" title="url 地址: ‘./path’"></a>url 地址: ‘./path’</h3><h3 id="option"><a href="#option" class="headerlink" title="option :"></a>option :</h3><ul>
<li><code>method</code> (String) - HTTP request method. Default: <code>&quot;GET&quot;</code></li>
<li><code>body</code> (String, <a href="https://github.github.io/fetch/#request-body" target="_blank" rel="external">body types</a>) - HTTP request body</li>
<li><code>headers</code> (Object, <a href="https://github.github.io/fetch/#Headers" target="_blank" rel="external">Headers</a>) - Default: <code>{}</code></li>
<li><code>credentials</code> (String) - Authentication credentials mode. Default: <code>&quot;omit&quot;``&quot;omit&quot;</code> - don’t include authentication credentials (e.g. cookies) in the request<code>&quot;same-origin&quot;</code> - include credentials in requests to the same site<code>&quot;include&quot;</code> - include credentials in requests to all sites</li>
</ul>
<h3 id="Response"><a href="#Response" class="headerlink" title="Response"></a>Response</h3><p>Response represents a HTTP response from the server. Typically a Response is not constructed manually, but is available as argument to the resolved promise callback.</p>
<h4 id="Properties"><a href="#Properties" class="headerlink" title="Properties"></a>Properties</h4><ul>
<li><code>status</code> (number) - HTTP response code in the 100–599 range</li>
<li><code>statusText</code> (String) - Status text as reported by the server, e.g. “Unauthorized”</li>
<li><code>ok</code> (boolean) - True if <code>status</code> is HTTP 2xx</li>
<li><code>headers</code> (<a href="https://github.github.io/fetch/#Headers" target="_blank" rel="external">Headers</a>)</li>
<li><code>url</code> (String)</li>
</ul>
<h4 id="Body-methods-注意每个方法返回的都是一个Promise对象"><a href="#Body-methods-注意每个方法返回的都是一个Promise对象" class="headerlink" title="Body methods 注意每个方法返回的都是一个Promise对象,"></a>Body methods 注意每个方法返回的都是一个Promise对象,</h4><p>Each of the methods to access the response body returns a Promise that will be resolved when the associated data type is ready.</p>
<ul>
<li><code>text()</code> - yields the response text as String</li>
<li><code>json()</code> - <strong>yields the result of <code>JSON.parse(responseText)</code></strong></li>
<li><code>blob()</code> - yields a <a href="https://developer.mozilla.org/en-US/docs/Web/API/Blob" target="_blank" rel="external">Blob</a></li>
<li><code>arrayBuffer()</code> - yields an <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer" target="_blank" rel="external">ArrayBuffer</a></li>
<li><code>formData()</code> - yields <a href="https://developer.mozilla.org/en-US/docs/Web/API/FormData" target="_blank" rel="external">FormData</a> that can be forwarded to another request</li>
</ul>
<h4 id="Other-response-methods"><a href="#Other-response-methods" class="headerlink" title="Other response methods"></a>Other response methods</h4><ul>
<li><code>clone()</code></li>
<li><code>Response.error()</code></li>
<li><code>Response.redirect()</code></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/15/229ES6-Promise源码分析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/06/15/229ES6-Promise源码分析/" itemprop="url">
                  ES6-Promise源码分析
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-15T12:36:00+08:00">
                2017-06-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ES6/" itemprop="url" rel="index">
                    <span itemprop="name">ES6</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>转载自: <strong><a href="http://mp.weixin.qq.com/s/gDCPwMnKkAgbFWo6R6PRpw" target="_blank" rel="external">http://mp.weixin.qq.com/s/gDCPwMnKkAgbFWo6R6PRpw</a></strong></p>
<p>前言**</p>
<p>前一阵子记录了promise的一些常规用法，这篇文章再深入一个层次，来分析分析promise的这种规则机制是如何实现的。ps:本文适合已经对promise的用法有所了解的人阅读,如果对其用法还不是太了解，可以移步我的上一篇博文。</p>
<p>本文的promise源码是按照Promise/A+规范来编写的（不想看英文版的移步Promise/A+规范中文翻译）</p>
<p><strong>引子</strong></p>
<p>为了让大家更容易理解，我们从一个场景开始讲解，让大家一步一步跟着思路思考，相信你一定会更容易看懂。</p>
<p>考虑下面一种获取用户id的请求处理</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//例1</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUserId</span>(<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>) </span>&#123;</div><div class="line"></div><div class="line">        <span class="comment">//异步请求</span></div><div class="line"></div><div class="line">        http.get(url, <span class="function"><span class="keyword">function</span>(<span class="params">results</span>) </span>&#123;</div><div class="line"></div><div class="line">            resolve(results.id)</div><div class="line"></div><div class="line">        &#125;)</div><div class="line"></div><div class="line">    &#125;)</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"> </div><div class="line"></div><div class="line">getUserId().then(<span class="function"><span class="keyword">function</span>(<span class="params">id</span>) </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">//一些处理</span></div><div class="line"></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>getUserId方法返回一个promise，可以通过它的then方法注册(注意注册这个词)在promise异步操作成功时执行的回调。这种执行方式，使得异步调用变得十分顺手。</p>
<p><strong>原理剖析</strong></p>
<p>那么类似这种功能的Promise怎么实现呢？其实按照上面一句话，实现一个最基础的雏形还是很easy的。</p>
<p><strong>极简promise雏形</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Promise</span>(<span class="params">fn</span>) </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> value = <span class="literal">null</span>,</div><div class="line"></div><div class="line">        callbacks = [];  <span class="comment">//callbacks为数组，因为可能同时有很多个回调</span></div><div class="line"></div><div class="line"> </div><div class="line"></div><div class="line">    <span class="keyword">this</span>.then = <span class="function"><span class="keyword">function</span> (<span class="params">onFulfilled</span>) </span>&#123;</div><div class="line"></div><div class="line">        callbacks.push(onFulfilled);</div><div class="line"></div><div class="line">    &#125;;</div><div class="line"></div><div class="line"> </div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">value</span>) </span>&#123;</div><div class="line"></div><div class="line">        callbacks.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">callback</span>) </span>&#123;</div><div class="line"></div><div class="line">            callback(value);</div><div class="line"></div><div class="line">        &#125;);</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line"> </div><div class="line"></div><div class="line">    fn(resolve);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上述代码很简单，大致的逻辑是这样的：</p>
<ol>
<li>调用then方法，将想要在Promise异步操作成功时执行的回调放入callbacks队列，其实也就是注册回调函数，可以向观察者模式方向思考；</li>
<li>创建Promise实例时传入的函数会被赋予一个函数类型的参数，即resolve，它接收一个参数value，代表异步操作返回的结果，当一步操作执行成功后，用户会调用resolve方法，这时候其实真正执行的操作是将callbacks队列中的回调一一执行；</li>
</ol>
<p>可以结合例1中的代码来看，首先new Promise时，传给promise的函数发送异步请求，接着调用promise对象的then属性，注册请求成功的回调函数，然后当异步请求发送成功时，调用resolve(results.id)方法, 该方法执行then方法注册的回调数组。</p>
<p>相信仔细的人应该可以看出来，then方法应该能够链式调用，但是上面的最基础简单的版本显然无法支持链式调用。想让then方法支持链式调用，其实也是很简单的：</p>
<blockquote>
<p>this.then = function (onFulfilled) {</p>
<p>​    callbacks.push(onFulfilled);</p>
<p>​    return this;</p>
<p>};</p>
</blockquote>
<p>see?只要简单一句话就可以实现类似下面的链式调用：</p>
<blockquote>
<p>// 例2</p>
<p>getUserId().then(function (id) {</p>
<p>​    // 一些处理</p>
<p>}).then(function (id) {</p>
<p>​    // 一些处理</p>
<p>});</p>
</blockquote>
<p><strong>加入延时机制</strong></p>
<p>细心的同学应该发现，上述代码可能还存在一个问题：如果在then方法注册回调之前，resolve函数就执行了，怎么办？比如promise内部的函数是同步函数：</p>
<blockquote>
<p>// 例3</p>
<p>function getUserId() {</p>
<p>​    return new Promise(function (resolve) {</p>
<p>​        resolve(9876);</p>
<p>​    });</p>
<p>}</p>
<p>getUserId().then(function (id) {</p>
<p>​    // 一些处理</p>
<p>});</p>
</blockquote>
<p>这显然是不允许的，Promises/A+规范明确要求回调需要通过异步方式执行，用以保证一致可靠的执行顺序。因此我们要加入一些处理，保证在resolve执行之前，then方法已经注册完所有的回调。我们可以这样改造下resolve函数:</p>
<blockquote>
<p>function resolve(value) {</p>
<p>​    setTimeout(function() {</p>
<p>​        callbacks.forEach(function (callback) {</p>
<p>​            callback(value);</p>
<p>​        });</p>
<p>​    }, 0)</p>
<p>}</p>
</blockquote>
<p>上述代码的思路也很简单，就是通过setTimeout机制，将resolve中执行回调的逻辑放置到JS任务队列末尾，以保证在resolve执行时，then方法的回调函数已经注册完成.</p>
<p>但是，这样好像还存在一个问题，可以细想一下：如果Promise异步操作已经成功，这时，在异步操作成功之前注册的回调都会执行，但是在Promise异步操作成功这之后调用的then注册的回调就再也不会执行了，这显然不是我们想要的。</p>
<p><strong>加入状态</strong></p>
<p>恩，为了解决上一节抛出的问题，我们必须加入状态机制，也就是大家熟知的pending、fulfilled、rejected。</p>
<p>Promises/A+规范中的2.1Promise States中明确规定了，pending可以转化为fulfilled或rejected并且只能转化一次，也就是说如果pending转化到fulfilled状态，那么就不能再转化到rejected。并且fulfilled和rejected状态只能由pending转化而来，两者之间不能互相转换。一图胜千言：</p>
<p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="img"></p>
<p>改进后的代码是这样的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Promise</span>(<span class="params">fn</span>) </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> state = <span class="string">'pending'</span>,</div><div class="line"></div><div class="line">        value = <span class="literal">null</span>,</div><div class="line"></div><div class="line">        callbacks = [];</div><div class="line"></div><div class="line"> </div><div class="line"></div><div class="line">    <span class="keyword">this</span>.then = <span class="function"><span class="keyword">function</span> (<span class="params">onFulfilled</span>) </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (state === <span class="string">'pending'</span>) &#123;</div><div class="line"></div><div class="line">            callbacks.push(onFulfilled);</div><div class="line"></div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        onFulfilled(value);</div><div class="line"></div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line"></div><div class="line">    &#125;;</div><div class="line"></div><div class="line"> </div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">newValue</span>) </span>&#123;</div><div class="line"></div><div class="line">        value = newValue;</div><div class="line"></div><div class="line">        state = <span class="string">'fulfilled'</span>;</div><div class="line"></div><div class="line">        setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">            callbacks.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">callback</span>) </span>&#123;</div><div class="line"></div><div class="line">                callback(value);</div><div class="line"></div><div class="line">            &#125;);</div><div class="line"></div><div class="line">        &#125;, <span class="number">0</span>);</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line"> </div><div class="line"></div><div class="line">    fn(resolve);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上述代码的思路是这样的：resolve执行时，会将状态设置为fulfilled，在此之后调用then添加的新回调，都会立即执行。</p>
<p>这里没有任何地方将state设为rejected，为了让大家聚焦在核心代码上，这个问题后面会有一小节专门加入。</p>
<p><strong>链式Promise</strong></p>
<p>那么这里问题又来了，如果用户再then函数里面注册的仍然是一个Promise，该如何解决？比如下面的例4：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 例4</span></div><div class="line"></div><div class="line">getUserId()</div><div class="line"></div><div class="line">    .then(getUserJobById)</div><div class="line"></div><div class="line">    .then(<span class="function"><span class="keyword">function</span> (<span class="params">job</span>) </span>&#123;</div><div class="line"></div><div class="line">        <span class="comment">// 对job的处理</span></div><div class="line"></div><div class="line">    &#125;);</div><div class="line"></div><div class="line"> </div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUserJobById</span>(<span class="params">id</span>) </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve</span>) </span>&#123;</div><div class="line"></div><div class="line">        http.get(baseUrl + id, <span class="function"><span class="keyword">function</span>(<span class="params">job</span>) </span>&#123;</div><div class="line"></div><div class="line">            resolve(job);</div><div class="line"></div><div class="line">        &#125;);</div><div class="line"></div><div class="line">    &#125;);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这种场景相信用过promise的人都知道会有很多，那么类似这种就是所谓的链式Promise。</p>
<p>链式Promise是指在当前promise达到fulfilled状态后，即开始进行下一个promise（后邻promise）。那么我们如何衔接当前promise和后邻promise呢？（这是这里的难点）。</p>
<p>其实也不是辣么难，只要在then方法里面return一个promise就好啦。Promises/A+规范中的2.2.7就是这么说哒(微笑脸)~</p>
<p>下面来看看这段暗藏玄机的then方法和resolve方法改造代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Promise</span>(<span class="params">fn</span>) </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> state = <span class="string">'pending'</span>,</div><div class="line"></div><div class="line">        value = <span class="literal">null</span>,</div><div class="line"></div><div class="line">        callbacks = [];</div><div class="line"></div><div class="line"> </div><div class="line"></div><div class="line">    <span class="keyword">this</span>.then = <span class="function"><span class="keyword">function</span> (<span class="params">onFulfilled</span>) </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve</span>) </span>&#123;</div><div class="line"></div><div class="line">            handle(&#123;</div><div class="line"></div><div class="line">                <span class="attr">onFulfilled</span>: onFulfilled || <span class="literal">null</span>,</div><div class="line"></div><div class="line">                <span class="attr">resolve</span>: resolve</div><div class="line"></div><div class="line">            &#125;);</div><div class="line"></div><div class="line">        &#125;);</div><div class="line"></div><div class="line">    &#125;;</div><div class="line"></div><div class="line"> </div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params">callback</span>) </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (state === <span class="string">'pending'</span>) &#123;</div><div class="line"></div><div class="line">            callbacks.push(callback);</div><div class="line"></div><div class="line">            <span class="keyword">return</span>;</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">//如果then中没有传递任何东西</span></div><div class="line"></div><div class="line">        <span class="keyword">if</span>(!callback.onResolved) &#123;</div><div class="line"></div><div class="line">            callback.resolve(value);</div><div class="line"></div><div class="line">            <span class="keyword">return</span>;</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line"> </div><div class="line"></div><div class="line">        <span class="keyword">var</span> ret = callback.onFulfilled(value);</div><div class="line"></div><div class="line">        callback.resolve(ret);</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line"> </div><div class="line"></div><div class="line">    </div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">newValue</span>) </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (newValue &amp;&amp; (<span class="keyword">typeof</span> newValue === <span class="string">'object'</span> || <span class="keyword">typeof</span> newValue === <span class="string">'function'</span>)) &#123;</div><div class="line"></div><div class="line">            <span class="keyword">var</span> then = newValue.then;</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> then === <span class="string">'function'</span>) &#123;</div><div class="line"></div><div class="line">                then.call(newValue, resolve);</div><div class="line"></div><div class="line">                <span class="keyword">return</span>;</div><div class="line"></div><div class="line">            &#125;</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        state = <span class="string">'fulfilled'</span>;</div><div class="line"></div><div class="line">        value = newValue;</div><div class="line"></div><div class="line">        setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">            callbacks.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">callback</span>) </span>&#123;</div><div class="line"></div><div class="line">                handle(callback);</div><div class="line"></div><div class="line">            &#125;);</div><div class="line"></div><div class="line">        &#125;, <span class="number">0</span>);</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line"> </div><div class="line"></div><div class="line">    fn(resolve);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们结合例4的代码，分析下上面的代码逻辑，为了方便阅读，我把例4的代码贴在这里：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 例4</span></div><div class="line"></div><div class="line">getUserId()</div><div class="line"></div><div class="line">    .then(getUserJobById)</div><div class="line"></div><div class="line">    .then(<span class="function"><span class="keyword">function</span> (<span class="params">job</span>) </span>&#123;</div><div class="line"></div><div class="line">        <span class="comment">// 对job的处理</span></div><div class="line"></div><div class="line">    &#125;);</div><div class="line"></div><div class="line"> </div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUserJobById</span>(<span class="params">id</span>) </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve</span>) </span>&#123;</div><div class="line"></div><div class="line">        http.get(baseUrl + id, <span class="function"><span class="keyword">function</span>(<span class="params">job</span>) </span>&#123;</div><div class="line"></div><div class="line">            resolve(job);</div><div class="line"></div><div class="line">        &#125;);</div><div class="line"></div><div class="line">    &#125;);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li>then方法中，创建并返回了新的Promise实例，这是串行Promise的基础，并且支持链式调用。</li>
<li>handle方法是promise内部的方法。then方法传入的形参onFulfilled以及创建新Promise实例时传入的resolve均被push到当前promise的callbacks队列中，这是衔接当前promise和后邻promise的关键所在（这里一定要好好的分析下handle的作用）。</li>
<li>getUserId生成的promise（简称getUserId promise）异步操作成功，执行其内部方法resolve，传入的参数正是异步操作的结果id</li>
<li>调用handle方法处理callbacks队列中的回调：getUserJobById方法，生成新的promise（getUserJobById promise）</li>
<li>执行之前由getUserId promise的then方法生成的新promise(称为bridge promise)的resolve方法，传入参数为getUserJobById promise。这种情况下，会将该resolve方法传入getUserJobById promise的then方法中，并直接返回。</li>
<li>在getUserJobById promise异步操作成功时，执行其callbacks中的回调：getUserId bridge promise中的resolve方法</li>
<li>最后执行getUserId bridge promise的后邻promise的callbacks中的回调。</li>
</ol>
<p>更直白的可以看下面的图，一图胜千言（都是根据自己的理解画出来的，如有不对欢迎指正）：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/zPh0erYjkib16cRRCyammqjBgWhlhkuaWXgQ7ZI5xBPRE8z1wdAbEwJFSruh0kBviavNoUzJ75MhTBrrQWzq6xYw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" alt="img"></p>
<p><strong>失败处理</strong></p>
<p>在异步操作失败时，标记其状态为rejected，并执行注册的失败回调:</p>
<blockquote>
<p>//例5</p>
<p>function getUserId() {</p>
<p>​    return new Promise(function(resolve) {</p>
<p>​        //异步请求</p>
<p>​        http.get(url, function(error, results) {</p>
<p>​            if (error) {</p>
<p>​                reject(error);</p>
<p>​            }</p>
<p>​            resolve(results.id)</p>
<p>​        })</p>
<p>​    })</p>
<p>}</p>
<p>getUserId().then(function(id) {</p>
<p>​    //一些处理</p>
<p>}, function(error) {</p>
<p>​    console.log(error)</p>
<p>})</p>
</blockquote>
<p>有了之前处理fulfilled状态的经验，支持错误处理变得很容易,只需要在注册回调、处理状态变更上都要加入新的逻辑：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Promise</span>(<span class="params">fn</span>) </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> state = <span class="string">'pending'</span>,</div><div class="line"></div><div class="line">        value = <span class="literal">null</span>,</div><div class="line"></div><div class="line">        callbacks = [];</div><div class="line"></div><div class="line"> </div><div class="line"></div><div class="line">    <span class="keyword">this</span>.then = <span class="function"><span class="keyword">function</span> (<span class="params">onFulfilled, onRejected</span>) </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</div><div class="line"></div><div class="line">            handle(&#123;</div><div class="line"></div><div class="line">                <span class="attr">onFulfilled</span>: onFulfilled || <span class="literal">null</span>,</div><div class="line"></div><div class="line">                <span class="attr">onRejected</span>: onRejected || <span class="literal">null</span>,</div><div class="line"></div><div class="line">                <span class="attr">resolve</span>: resolve,</div><div class="line"></div><div class="line">                <span class="attr">reject</span>: reject</div><div class="line"></div><div class="line">            &#125;);</div><div class="line"></div><div class="line">        &#125;);</div><div class="line"></div><div class="line">    &#125;;</div><div class="line"></div><div class="line"> </div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params">callback</span>) </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (state === <span class="string">'pending'</span>) &#123;</div><div class="line"></div><div class="line">            callbacks.push(callback);</div><div class="line"></div><div class="line">            <span class="keyword">return</span>;</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line"> </div><div class="line"></div><div class="line">        <span class="keyword">var</span> cb = state === <span class="string">'fulfilled'</span> ? callback.onFulfilled : callback.onRejected,</div><div class="line"></div><div class="line">            ret;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (cb === <span class="literal">null</span>) &#123;</div><div class="line"></div><div class="line">            cb = state === <span class="string">'fulfilled'</span> ? callback.resolve : callback.reject;</div><div class="line"></div><div class="line">            cb(value);</div><div class="line"></div><div class="line">            <span class="keyword">return</span>;</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        ret = cb(value);</div><div class="line"></div><div class="line">        callback.resolve(ret);</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line"> </div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">newValue</span>) </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (newValue &amp;&amp; (<span class="keyword">typeof</span> newValue === <span class="string">'object'</span> || <span class="keyword">typeof</span> newValue === <span class="string">'function'</span>)) &#123;</div><div class="line"></div><div class="line">            <span class="keyword">var</span> then = newValue.then;</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> then === <span class="string">'function'</span>) &#123;</div><div class="line"></div><div class="line">                then.call(newValue, resolve, reject);</div><div class="line"></div><div class="line">                <span class="keyword">return</span>;</div><div class="line"></div><div class="line">            &#125;</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        state = <span class="string">'fulfilled'</span>;</div><div class="line"></div><div class="line">        value = newValue;</div><div class="line"></div><div class="line">        execute();</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line"> </div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">reject</span>(<span class="params">reason</span>) </span>&#123;</div><div class="line"></div><div class="line">        state = <span class="string">'rejected'</span>;</div><div class="line"></div><div class="line">        value = reason;</div><div class="line"></div><div class="line">        execute();</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line"> </div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">execute</span>(<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">        setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">            callbacks.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">callback</span>) </span>&#123;</div><div class="line"></div><div class="line">                handle(callback);</div><div class="line"></div><div class="line">            &#125;);</div><div class="line"></div><div class="line">        &#125;, <span class="number">0</span>);</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line"> </div><div class="line"></div><div class="line">    fn(resolve, reject);</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上述代码增加了新的reject方法，供异步操作失败时调用，同时抽出了resolve和reject共用的部分，形成execute方法。</p>
<p>错误冒泡是上述代码已经支持，且非常实用的一个特性。在handle中发现没有指定异步操作失败的回调时，会直接将bridge promise(then函数返回的promise，后同)设为rejected状态，如此达成执行后续失败回调的效果。这有利于简化串行Promise的失败处理成本，因为一组异步操作往往会对应一个实际功能，失败处理方法通常是一致的：</p>
<blockquote>
<p>//例6</p>
<p>getUserId()</p>
<p>​    .then(getUserJobById)</p>
<p>​    .then(function (job) {</p>
<p>​        // 处理job</p>
<p>​    }, function (error) {</p>
<p>​        // getUserId或者getUerJobById时出现的错误</p>
<p>​        console.log(error);</p>
<p>​    });</p>
</blockquote>
<p><strong>异常处理</strong></p>
<p>细心的同学会想到：如果在执行成功回调、失败回调时代码出错怎么办？对于这类异常，可以使用try-catch捕获错误，并将bridge promise设为rejected状态。handle方法改造如下：</p>
<blockquote>
<p>function handle(callback) {</p>
<p>​    if (state === ‘pending’) {</p>
<p>​        callbacks.push(callback);</p>
<p>​        return;</p>
<p>​    }</p>
<p>​    var cb = state === ‘fulfilled’ ? callback.onFulfilled : callback.onRejected,</p>
<p>​        ret;</p>
<p>​    if (cb === null) {</p>
<p>​        cb = state === ‘fulfilled’ ? callback.resolve : callback.reject;</p>
<p>​        cb(value);</p>
<p>​        return;</p>
<p>​    }</p>
<p>​    try {</p>
<p>​        ret = cb(value);</p>
<p>​        callback.resolve(ret);</p>
<p>​    } catch (e) {</p>
<p>​        callback.reject(e);</p>
<p>​    }</p>
<p>}</p>
</blockquote>
<p>如果在异步操作中，多次执行resolve或者reject会重复处理后续回调，可以通过内置一个标志位解决。</p>
<p><strong>总结</strong></p>
<p>刚开始看promise源码的时候总不能很好的理解then和resolve函数的运行机理，但是如果你静下心来，反过来根据执行promise时的逻辑来推演，就不难理解了。这里一定要注意的点是：promise里面的then函数仅仅是注册了后续需要执行的代码，真正的执行是在resolve方法里面执行的，理清了这层，再来分析源码会省力的多。</p>
<p>现在回顾下Promise的实现过程，其主要使用了设计模式中的观察者模式：</p>
<ol>
<li>通过Promise.prototype.then和Promise.prototype.catch方法将观察者方法注册到被观察者Promise对象中，同时返回一个新的Promise对象，以便可以链式调用。</li>
<li>被观察者管理内部pending、fulfilled和rejected的状态转变，同时通过构造函数中传递的resolve和reject方法以主动触发状态转变和通知观察者。</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/08/227ES6-Iterator/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/06/08/227ES6-Iterator/" itemprop="url">
                  ES6 Iterator
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-08T12:36:00+08:00">
                2017-06-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ES6/" itemprop="url" rel="index">
                    <span itemprop="name">ES6</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/08/226ES6-Set-Map/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/06/08/226ES6-Set-Map/" itemprop="url">
                  ES6 Set Map
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-08T12:36:00+08:00">
                2017-06-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ES6/" itemprop="url" rel="index">
                    <span itemprop="name">ES6</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近一直在忙react项目,好久没写博客了,需要用到immutable数据,这里先预热下map和set数据</p>
<h3 id="1-Set数据结构-是ES6的新的数据结构-该数据结构类似于数组-但是和数组不同的一点就是-数组中可以有相同的成员-但是Set数据结构不允许数据成员有一样的-Set数据结构的成员都是唯一的"><a href="#1-Set数据结构-是ES6的新的数据结构-该数据结构类似于数组-但是和数组不同的一点就是-数组中可以有相同的成员-但是Set数据结构不允许数据成员有一样的-Set数据结构的成员都是唯一的" class="headerlink" title="1 Set数据结构,是ES6的新的数据结构,该数据结构类似于数组,但是和数组不同的一点就是,数组中可以有相同的成员,但是Set数据结构不允许数据成员有一样的,Set数据结构的成员都是唯一的."></a>1 Set数据结构,是ES6的新的数据结构,该数据结构类似于数组,但是和数组不同的一点就是,数组中可以有相同的成员,但是Set数据结构不允许数据成员有一样的,Set数据结构的成员都是唯一的.</h3><p>有序且不可重复的列表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Set(4) &#123;&quot;car&quot;, &quot;buble&quot;, &quot;dog&quot;, &quot;name&quot;&#125;</div></pre></td></tr></table></figure>
<p>Set是一个构造函数,可以用来生成set数据结构,生成的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">var set1 = new Set()</div><div class="line">console.log(set);</div><div class="line">var set2 = new Set([1,2,3,4,4]) //这里的4最终在Set数据结构中只存在一项</div></pre></td></tr></table></figure>
<p><strong>Set构造函数可以直接接受一个数组作为参数,然后将该数组初始化为Set数据结构,但是不能接受一个对象作为参数,会报错</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> obj = &#123;<span class="attr">name</span>:<span class="string">'Jhon'</span>,<span class="attr">age</span>:<span class="string">'13'</span>&#125;</div><div class="line"><span class="keyword">var</span> set = <span class="keyword">new</span> <span class="built_in">Set</span>(obj)</div><div class="line"><span class="built_in">console</span>.log(set) <span class="comment">//报错</span></div></pre></td></tr></table></figure>
<p>1.1 Set数据结构的属性和方法,通过输出我们在控制台可以看到Set构造函数原型链上的所有的API </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">-size          输出Set数据结构的成员个数</div><div class="line">-add(value)    向Set数据实例添加成员,返回Set数据结构,可以进行链式操作</div><div class="line">-clear()       删除Set数据结构中所有的成员,没有返回值</div><div class="line">-delete(value) 删除Set数据结构中某一个成员,返回布尔值,表示是否删除成功</div><div class="line">-has(value)    判断Set数据结构中是否包括某个成员,返回布尔值,表示是否包括某个成员</div></pre></td></tr></table></figure>
<p>对于我们常用的数组去重,这里就有了更好的实现方法</p>
<p>这里需要明确Array.from() 方法的使用,该方法接受</p>
<ul>
<li>类数组对象:拥有一个length属性和若干索引属性的任意对象</li>
<li>可遍历对象:比如Map 和Set 数据结构</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">数组去重的更加简单的方式</div><div class="line">var s = new Set([1,2,3,5,5])</div><div class="line">console.log(Array.from(s))</div></pre></td></tr></table></figure>
<p>1.2 Set数据结构的遍历方法(Set数据结构可以理解为键名和键值是相同的)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">-keys     返回遍历器对象(由于Set数据结构没有键名,只有键值,或者说键名和键值一样)所以keys和values方法行为完全一致</div><div class="line">-values          (这个是Set数据结构默认遍历器接口,for-of循环)</div><div class="line">-entries         返回遍历器对象</div><div class="line">-forEach         没有返回值,对每个成员执行操作</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> set = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="string">'car'</span>,<span class="string">'buble'</span>,<span class="string">'dog'</span>])</div><div class="line">set.add(<span class="string">'name'</span>)</div><div class="line"><span class="built_in">console</span>.log(set)</div><div class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i <span class="keyword">of</span> set)&#123;  <span class="comment">//Set结构实例默认可遍历,默认遍历器生成函数是values方法</span></div><div class="line">  <span class="built_in">console</span>.log(i);  <span class="comment">//car bubble dog name </span></div><div class="line">&#125;</div><div class="line"><span class="built_in">console</span>.log(<span class="string">'setForeach====='</span>)</div><div class="line">set.forEach(<span class="function">(<span class="params">value,key</span>)=&gt;</span><span class="built_in">console</span>.log(value,key))</div><div class="line"><span class="comment">/*</span></div><div class="line">car  car </div><div class="line">bubble bubble </div><div class="line">dog dog </div><div class="line">name name </div><div class="line">**/</div></pre></td></tr></table></figure>
<h3 id="2-Map数据结构-是ES6的新的数据结构-该数据结构类似于对象-也是键值对的集合-但是和对象不同的一点就是-对象中的中键名只能是字符串-但是Map数据结构的键名可以是任何数据类型-包括对象和数组"><a href="#2-Map数据结构-是ES6的新的数据结构-该数据结构类似于对象-也是键值对的集合-但是和对象不同的一点就是-对象中的中键名只能是字符串-但是Map数据结构的键名可以是任何数据类型-包括对象和数组" class="headerlink" title="2 Map数据结构,是ES6的新的数据结构,该数据结构类似于对象,也是键值对的集合,但是和对象不同的一点就是,对象中的中键名只能是字符串,但是Map数据结构的键名可以是任何数据类型,包括对象和数组"></a>2 Map数据结构,是ES6的新的数据结构,该数据结构类似于对象,也是键值对的集合,但是和对象不同的一点就是,对象中的中键名只能是字符串,但是Map数据结构的键名可以是任何数据类型,包括对象和数组</h3><p>键值对集合,对应于Object,Map对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Map(2) &#123;&quot;a&quot; =&gt; 1, &quot;b&quot; =&gt; 2&#125;</div></pre></td></tr></table></figure>
<p>所以这里需要注意的是Map数据结构的键名如果是复杂数据类型,那么判断键名是否一致的根本比较方式是判断的键名的内存地址,也就是说<code>{ }</code> 和 <code>{ }</code> 这两个键名代表的是不同的键名.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> obj = &#123;<span class="attr">name</span>:<span class="string">'Jhon'</span>,<span class="attr">age</span>:<span class="string">'13'</span>&#125;</div><div class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>()</div><div class="line"><span class="built_in">console</span>.log(map)</div><div class="line">map.set(obj,<span class="string">'hello Map'</span>)  <span class="comment">//对象作为键名</span></div><div class="line"><span class="built_in">console</span>.log(map.get(obj))</div></pre></td></tr></table></figure>
<p>Map是一个构造函数,用来生成一个Map结构的数据对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">var map = new Map()</div><div class="line">console.log(map)</div></pre></td></tr></table></figure>
<p>1.1 Map数据结构的属性和方法,通过输出我们在控制台可以看到Set构造函数原型链上的所有的API </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">-set(key,value)      给Map数据结构设置键值对,返回Map实例,所以可以进行链式调用,如果包含该键名,则会更新</div><div class="line">-get(key)			获取Map数据结构键名对应的键值,如果找不到则返回undefined</div><div class="line">-has(key)            判断Map数据结构是否包含某个键名,返回布尔类型值</div><div class="line">-delete(key)		删除Map数据结构某个key,如果成功删除则返回ture,删除失败返回false</div><div class="line">-clear()             方法清除所有成员,没有返回值</div></pre></td></tr></table></figure>
<p>1.2 Map数据结构的遍历</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">-keys()  -values()  返回键名的遍历器 和键值的遍历器</div><div class="line">-entries()          返回键名和键值组成的遍历器(Map数据默认遍历器接口就是这个 for-of )</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> obj = &#123;<span class="attr">name</span>:<span class="string">'Jhon'</span>,<span class="attr">age</span>:<span class="string">'13'</span>&#125;</div><div class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> ]</div><div class="line"></div><div class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>()</div><div class="line"><span class="built_in">console</span>.log(map)</div><div class="line">map.set(obj,<span class="string">'hello Map'</span>)</div><div class="line">map.set(<span class="string">'heh'</span>,<span class="string">"hahahahh"</span>)</div><div class="line"><span class="built_in">console</span>.log(map.set(obj,<span class="string">'hello Map'</span>))</div><div class="line"><span class="built_in">console</span>.log(map.get(obj))</div><div class="line"><span class="built_in">console</span>.log(map.has(obj))</div><div class="line"><span class="built_in">console</span>.log(map.get(obj))</div><div class="line"><span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">of</span> map.keys())&#123;</div><div class="line">  <span class="built_in">console</span>.log(key)</div><div class="line">&#125;</div><div class="line"><span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">of</span> map.values())&#123;</div><div class="line">  <span class="built_in">console</span>.log(key)</div><div class="line">&#125;</div><div class="line"><span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">of</span> map.entries())&#123;</div><div class="line">  <span class="built_in">console</span>.log(key)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>1.3 Map构造函数接受的参数:原生数据结构具有Iterator接口,比如数组,类数组对象,Map和Set数据</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>([</div><div class="line">  [<span class="string">'F'</span>, <span class="string">'no'</span>],</div><div class="line">  [<span class="string">'T'</span>,  <span class="string">'yes'</span>],</div><div class="line">]);</div><div class="line"></div><div class="line"><span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">of</span> map.keys()) &#123;</div><div class="line">  <span class="built_in">console</span>.log(key);</div><div class="line">&#125;</div><div class="line"><span class="comment">// "F"</span></div><div class="line"><span class="comment">// "T"</span></div><div class="line"></div><div class="line"><span class="keyword">for</span> (<span class="keyword">let</span> value <span class="keyword">of</span> map.values()) &#123;</div><div class="line">  <span class="built_in">console</span>.log(value);</div><div class="line">&#125;</div><div class="line"><span class="comment">// "no"</span></div><div class="line"><span class="comment">// "yes"</span></div><div class="line"></div><div class="line"><span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> map.entries()) &#123;</div><div class="line">  <span class="built_in">console</span>.log(item[<span class="number">0</span>], item[<span class="number">1</span>]);</div><div class="line">&#125;</div><div class="line"><span class="comment">// "F" "no"</span></div><div class="line"><span class="comment">// "T" "yes"</span></div><div class="line"></div><div class="line"><span class="comment">// 或者</span></div><div class="line"><span class="keyword">for</span> (<span class="keyword">let</span> [key, value] <span class="keyword">of</span> map.entries()) &#123;</div><div class="line">  <span class="built_in">console</span>.log(key, value);</div><div class="line">&#125;</div><div class="line"><span class="comment">// "F" "no"</span></div><div class="line"><span class="comment">// "T" "yes"</span></div><div class="line"></div><div class="line"><span class="comment">// 等同于使用map.entries()</span></div><div class="line"><span class="keyword">for</span> (<span class="keyword">let</span> [key, value] <span class="keyword">of</span> map) &#123;</div><div class="line">  <span class="built_in">console</span>.log(key, value);</div><div class="line">&#125;</div><div class="line"><span class="comment">// "F" "no"</span></div><div class="line"><span class="comment">// "T" "yes"</span></div></pre></td></tr></table></figure>
<p>1.4 Map数据结构转化为数组,通过使用 <code>...</code> 扩展运算符,数组转化为Map结构,可以作为Map构造函数参数直接传入</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>([</div><div class="line">  [<span class="number">1</span>, <span class="string">'one'</span>],</div><div class="line">  [<span class="number">2</span>, <span class="string">'two'</span>],</div><div class="line">  [<span class="number">3</span>, <span class="string">'three'</span>],</div><div class="line">]);</div><div class="line"></div><div class="line">[...map.keys()]</div><div class="line"><span class="comment">// [1, 2, 3]</span></div><div class="line"></div><div class="line">[...map.values()]</div><div class="line"><span class="comment">// ['one', 'two', 'three']</span></div><div class="line"></div><div class="line">[...map.entries()]</div><div class="line"><span class="comment">// [[1,'one'], [2, 'two'], [3, 'three']]</span></div><div class="line"></div><div class="line">[...map]</div><div class="line"><span class="comment">// [[1,'one'], [2, 'two'], [3, 'three']]</span></div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/24/225Redux-thunk源码/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/24/225Redux-thunk源码/" itemprop="url">
                  Redux thunk源码
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-24T12:36:00+08:00">
                2017-05-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/redux/" itemprop="url" rel="index">
                    <span itemprop="name">redux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-redux-thunk源码"><a href="#1-redux-thunk源码" class="headerlink" title="1 redux-thunk源码"></a>1 redux-thunk源码</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="meta">'use strict'</span>;</div><div class="line"></div><div class="line">exports.__esModule = <span class="literal">true</span>;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">createThunkMiddleware</span>(<span class="params">extraArgument</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">_ref</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> dispatch = _ref.dispatch,</div><div class="line">        getState = _ref.getState;</div><div class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">next</span>) </span>&#123;</div><div class="line">      <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">action</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> action === <span class="string">'function'</span>) &#123;</div><div class="line">          <span class="keyword">return</span> action(dispatch, getState, extraArgument);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> next(action);</div><div class="line">      &#125;;</div><div class="line">    &#125;;</div><div class="line">  &#125;;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> thunk = createThunkMiddleware();</div><div class="line">thunk.withExtraArgument = createThunkMiddleware;</div><div class="line"></div><div class="line">exports[<span class="string">'default'</span>] = thunk;</div></pre></td></tr></table></figure>
<p>什么是thunk</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">// Meet thunks.</div><div class="line">// A thunk is a function that returns a function.</div><div class="line">// This is a thunk.</div></pre></td></tr></table></figure>
<p><a href="https://github.com/gaearon/redux-thunk" target="_blank" rel="external">redux-thunk</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/23/224ImmutabaleJS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/23/224ImmutabaleJS/" itemprop="url">
                  未命名
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-23T11:47:52+08:00">
                2017-05-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/20/190ES6Promise/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/20/190ES6Promise/" itemprop="url">
                  ES6-Promise
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-20T12:36:00+08:00">
                2017-05-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ES6/" itemprop="url" rel="index">
                    <span itemprop="name">ES6</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-Promise定义"><a href="#1-Promise定义" class="headerlink" title="1 Promise定义"></a>1 Promise定义</h3><p>Promise是一种异步编程的解决方案,是一个对象(构造函数),从该对象可以获取异步操作的消息</p>
<p>Promise对象的特点</p>
<p>（1）对象的状态不受外界影响。<code>Promise</code>对象代表一个异步操作，有三种状态：<code>Pending</code>（进行中）、<code>Resolved</code>（已完成，又称 Fulfilled）和<code>Rejected</code>（已失败）。只有异步操作的结果，可以决定当前是哪一种状态，任何其他操作都无法改变这个状态。这也是<code>Promise</code>这个名字的由来，它的英语意思就是“承诺”，表示其他手段无法改变。</p>
<p>（2）一旦状态改变，就不会再变，任何时候都可以得到这个结果。<code>Promise</code>对象的状态改变，只有两种可能：从<code>Pending</code>变为<code>Resolved</code>和从<code>Pending</code>变为<code>Rejected</code>。只要这两种情况发生，状态就凝固了，不会再变了，会一直保持这个结果。如果改变已经发生了，你再对<code>Promise</code>对象添加回调函数，也会立即得到这个结果。这与事件（Event）完全不同，事件的特点是，如果你错过了它，再去监听，是得不到结果的。</p>
<p>缺点</p>
<p>(1) 首先，无法取消<code>Promise</code>，一旦新建它就会立即执行，无法中途取消。</p>
<p>(2) 当新建promise对象的时候,Promise里面必须传入回调函数,否则内部会抛出错误</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>()  <span class="comment">//报错</span></div></pre></td></tr></table></figure>
<p>(3) 当处于Pendding状态的时候,无法确切知道处于哪个阶段的状态</p>
<p>我们可以打印出来看下有什么</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">console</span>.dir(<span class="built_in">Promise</span>);</div><div class="line"><span class="comment">//我们可以看到起原型上有 then 和catch等方法</span></div><div class="line"><span class="comment">// var promise = new Promise();  Promise是一个构造函数,构造函数中必须传入一个函数作为参数,否则会报错</span></div><div class="line"><span class="keyword">var</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve,reject</span>)</span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="built_in">arguments</span>);<span class="comment">//</span></div><div class="line">  <span class="comment">// resolve();</span></div><div class="line">  reject();</div><div class="line">&#125;)</div><div class="line"><span class="built_in">console</span>.log(promise);</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//promise实例上有如下属性 </div><div class="line">Promise</div><div class="line">[[PromiseStatus]]:&quot;resolved&quot;</div><div class="line">[[PromiseValue]]:undefined</div></pre></td></tr></table></figure>
<h3 id="2-基本使用-Promise是一个构造函数-该构造函数接受一个函数作为参数-必须的"><a href="#2-基本使用-Promise是一个构造函数-该构造函数接受一个函数作为参数-必须的" class="headerlink" title="2 基本使用 Promise是一个构造函数,该构造函数接受一个函数作为参数(必须的)"></a>2 基本使用 Promise是一个构造函数,该构造函数接受一个函数作为参数(必须的)</h3><p>写在前面,promise对象创建的时候立即执行&gt;同步&gt;异步&gt;回调函数</p>
<p>接受的函数中又有两个函数作为参数,</p>
<ul>
<li>Promise构造函数中必须有一个函数作为构造函数的参数,作为参数的函数的参数有两个函数</li>
<li>一个是resolve函数,在异步操作成功的时候执行该函数,将Pendding状态改变为Resolved</li>
<li>一个是reject函数,在异步操作失败的时候执行该函数,将Pendding状态改变为Rejected</li>
<li>创建promise对象之后,根据异步操作成功与否,调用resolve或者reject函数,改变状态的结果,then方法会根据改变的状态结果调用响应的回调函数,then方法接受两个函数,<ul>
<li>第一个函数在Resolved状态的时候执行</li>
<li>第二个函数在Rejected状态的时候执行</li>
</ul>
</li>
</ul>
<p>基本的实现思路是</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</div><div class="line">  <span class="comment">// ... some code</span></div><div class="line"></div><div class="line">  <span class="keyword">if</span> (<span class="comment">/* 异步操作成功 */</span>)&#123;</div><div class="line">    resolve(value);</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    reject(error);</div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">promise.then(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</div><div class="line">  <span class="comment">// success</span></div><div class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</div><div class="line">  <span class="comment">// failure</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>如下demo所示</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve,reject</span>)</span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'promise对象创建之后立即执行'</span>);</div><div class="line">            <span class="comment">// resolve();</span></div><div class="line">            <span class="comment">// rejecte();</span></div><div class="line">            </div><div class="line">        &#125;)</div><div class="line">       <span class="built_in">console</span>.log(<span class="string">'helloWorld'</span>);</div><div class="line"></div><div class="line">        promise.then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'this is the status of Resolved'</span>);</div><div class="line">            </div><div class="line">        &#125;,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'this is the status of Rejected'</span>);</div><div class="line">            </div><div class="line">        &#125;)</div></pre></td></tr></table></figure>
<ul>
<li>当打开resolve()的注释的时候,改变了promise实例的状态,触发then函数中的第一个回调函数的执行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">promise对象创建之后立即执行</div><div class="line">helloWorld</div><div class="line">this is the status of Resolved</div></pre></td></tr></table></figure>
<ul>
<li>当打开reject()的注释的时候,改变了promise实例的状态,触发then函数中的第二个回调函数的执行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">promise对象创建之后立即执行</div><div class="line">helloWorld</div><div class="line">this is the status of Rejected</div></pre></td></tr></table></figure>
<h3 id="3-实例化一个Promise对象的时候传入Promise构造函数的参数是一个函数-该函数立即执行"><a href="#3-实例化一个Promise对象的时候传入Promise构造函数的参数是一个函数-该函数立即执行" class="headerlink" title="3 实例化一个Promise对象的时候传入Promise构造函数的参数是一个函数,该函数立即执行"></a>3 实例化一个Promise对象的时候传入Promise构造函数的参数是一个函数,该函数立即执行</h3><p>内部实现大概是这个样子的,我猜 ; 所以才会有上面的输处顺序</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">f1</span>)</span>&#123;</div><div class="line">  f1()</div><div class="line">&#125;</div><div class="line"><span class="keyword">new</span> foo(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'f1 is exected'</span>);</div><div class="line">&#125;);</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="4-如果-resolve-或者-reject-函数执行的时候有参数-那么参数会传递给then方法中相应的回调函数"><a href="#4-如果-resolve-或者-reject-函数执行的时候有参数-那么参数会传递给then方法中相应的回调函数" class="headerlink" title="4 如果 resolve 或者 reject 函数执行的时候有参数,那么参数会传递给then方法中相应的回调函数"></a>4 如果 resolve 或者 reject 函数执行的时候有参数,那么参数会传递给then方法中相应的回调函数</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">  <span class="keyword">var</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</div><div class="line">    <span class="keyword">var</span> res = <span class="string">'RES'</span>;</div><div class="line">    <span class="keyword">var</span> rej = <span class="string">'REJ'</span>;</div><div class="line">    resolve(res); </div><div class="line">    reject(rej);</div><div class="line">  &#125;)</div><div class="line"></div><div class="line">  promise.then(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'这是通过resolve函数传递过来的参数'</span>,value);</div><div class="line"></div><div class="line">     &#125;,value =&gt; &#123;<span class="built_in">console</span>.log(<span class="string">'这是通过reject函数传递过来的参数'</span>,value);</div><div class="line">  &#125;)</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p>另外,一般而言reject函数的参数一般是一个ERROR对象的实例,resolve函数的参数也可能是另外一个Promise对象的实例</p>
<p>先看下面一段代码,</p>
<ul>
<li>如果promise对象不是另外一个promise对象的resolve函数的参数,那么promise实例 p1 p2的状态互不影响</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">       <span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve,reject</span>)</span>&#123;</div><div class="line"></div><div class="line">       &#125;)</div><div class="line"></div><div class="line">       <span class="keyword">var</span> p2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve,reject</span>)</span>&#123;</div><div class="line">           resolve() ;</div><div class="line">       &#125;)</div><div class="line"></div><div class="line">       <span class="built_in">console</span>.log(<span class="string">'p1'</span>,p1); <span class="comment">//p1 Pendding</span></div><div class="line">       <span class="built_in">console</span>.log(<span class="string">'p2'</span>,p2);<span class="comment">//p2 Resolved</span></div><div class="line">       </div><div class="line">   <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li>但是如果promise实例是另外一个promise对象的resolve的参数的话,那么promise实例将会和resolve参数的promise对象的状态保持一致</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">        <span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve,reject</span>)</span>&#123;</div><div class="line">			<span class="comment">//此时p1对象的状态是Pendding</span></div><div class="line">        &#125;)</div><div class="line"></div><div class="line">        <span class="keyword">var</span> p2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve,reject</span>)</span>&#123;</div><div class="line">            resolve(p1) ; <span class="comment">//将p1对象作为resolve函数的参数</span></div><div class="line">        &#125;)</div><div class="line"></div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'p1'</span>,p1);<span class="comment">//p1 Pendding</span></div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'p2'</span>,p2);<span class="comment">//p2 Pendding</span></div><div class="line">        </div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p>改变p1对象的状态</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">        <span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve,reject</span>)</span>&#123;</div><div class="line">            resolve();<span class="comment">//此时p1对象的状态是Resolved</span></div><div class="line">        &#125;)</div><div class="line"></div><div class="line">        <span class="keyword">var</span> p2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve,reject</span>)</span>&#123;</div><div class="line">            resolve(p1) ;</div><div class="line">        &#125;)</div><div class="line"></div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'p1'</span>,p1);<span class="comment">//p1 Resolved</span></div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'p2'</span>,p2);<span class="comment">//p2 Resolved</span></div><div class="line">        </div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">       <span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve,reject</span>)</span>&#123;</div><div class="line">           <span class="comment">// resolve();</span></div><div class="line">           reject();</div><div class="line">       &#125;)</div><div class="line"></div><div class="line">       <span class="keyword">var</span> p2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve,reject</span>)</span>&#123;</div><div class="line">           resolve(p1) ;</div><div class="line">       &#125;)</div><div class="line"></div><div class="line">       <span class="built_in">console</span>.log(<span class="string">'p1'</span>,p1);</div><div class="line">       <span class="built_in">console</span>.log(<span class="string">'p2'</span>,p2);</div><div class="line">       </div><div class="line">   <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="5-Promise-prototype-then-Promise-prototype-catch"><a href="#5-Promise-prototype-then-Promise-prototype-catch" class="headerlink" title="5 Promise.prototype.then     Promise.prototype.catch"></a>5 Promise.prototype.then     Promise.prototype.catch</h3><ul>
<li>then方法是定义在Prototype构造函数原型上的一个方法</li>
<li>该方法接受两个函数作为参数<ul>
<li>第一个参数函数在promise实例状态变为Resolved的时候会执行</li>
<li>第二个参数函数在promise实例状态变为Rejected的时候会执行</li>
</ul>
</li>
<li>该方法返回值是 另外一个promise对象</li>
<li>catch方法:当一个Promise实例的状态变为Rejected的时候会调用catch方法里面的回调函数</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">        <span class="keyword">var</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve,reject</span>)</span>&#123;</div><div class="line">            resolve()</div><div class="line">        &#125;)</div><div class="line"></div><div class="line">        <span class="keyword">var</span> ret = p.then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'this is the status of Resolved'</span>);  </div><div class="line">        &#125;)</div><div class="line"></div><div class="line">        <span class="built_in">console</span>.log(ret);<span class="comment">//Promise对象</span></div><div class="line">        </div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="keyword">var</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</div><div class="line">        reject();</div><div class="line">    &#125;)</div><div class="line"></div><div class="line">    p.catch(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'REJECTED'</span>);    </div><div class="line">    &#125;)</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p>基本使用暂时到此,后期其他方法会有时间更新  ===========  2017/5/11    21:21</p>
<p>then链式调用的时候,then函数的返回值,会作为第下一个then函数中第一个参数函数的参数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve,reject</span>)</span>&#123;</div><div class="line">  resolve()</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">var</span> ret = p.then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'this is the status of Resolved'</span>);</div><div class="line">  <span class="keyword">return</span> <span class="number">2</span>  <span class="comment">// false 或者不返回值,此时val的值将是undefined</span></div><div class="line">&#125;,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'resolve'</span>)</div><div class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">val</span>)</span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'inner Resolved'</span>);</div><div class="line">  <span class="built_in">console</span>.log(val) <span class="comment">//2 false  undefined</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">var</span> test =&#123;</div><div class="line">	<span class="attr">func1</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">		<span class="keyword">var</span> data = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>)</span>&#123;</div><div class="line">			setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">				resolve(<span class="string">"ajax结果111"</span>)</div><div class="line">			&#125;,<span class="number">200</span>)</div><div class="line">		&#125;)</div><div class="line">		<span class="keyword">return</span> data;</div><div class="line">	&#125;,</div><div class="line">	<span class="attr">func2</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">		<span class="keyword">var</span> data = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>)</span>&#123;</div><div class="line">			setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">				resolve(<span class="string">"ajax结果222"</span>)</div><div class="line">			&#125;,<span class="number">100</span>)</div><div class="line">		&#125;)</div><div class="line">		<span class="keyword">return</span> data;</div><div class="line">	&#125;,</div><div class="line">	<span class="attr">func3</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">		<span class="keyword">var</span> data = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>)</span>&#123;</div><div class="line">			setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">				resolve(<span class="string">"ajax结果333"</span>)</div><div class="line">			&#125;,<span class="number">500</span>)</div><div class="line">		&#125;)</div><div class="line">		<span class="keyword">return</span> data;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//resolve函数的参数将会作为then函数中第一个函数的参数</span></div><div class="line">test.func1().then(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>)</span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(value)</div><div class="line">	<span class="comment">//do something...</span></div><div class="line">&#125;)</div><div class="line"><span class="comment">//then的链式调用前奏</span></div><div class="line">test.func1().then(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>)</span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(value) <span class="comment">//ajax结果111</span></div><div class="line">	test.func2().then(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>)</span>&#123;</div><div class="line">		<span class="built_in">console</span>.log(value) <span class="comment">//ajax结果2</span></div><div class="line">		test.func3().then(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>)</span>&#123;</div><div class="line">			<span class="built_in">console</span>.log(value) <span class="comment">//ajax结果333</span></div><div class="line">			<span class="comment">//do something...</span></div><div class="line">		&#125;)</div><div class="line">	&#125;)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>使用return可以更加方便的进行链式调用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">test.func1().then(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>)</span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(value)</div><div class="line">	<span class="comment">//do something...</span></div><div class="line">	<span class="keyword">return</span> test.func2();</div><div class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>)</span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(value)</div><div class="line">	<span class="keyword">return</span> test.func3();</div><div class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>)</span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(value)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>===2017/6/14更新</p>
<h2 id="6-fetch方法"><a href="#6-fetch方法" class="headerlink" title="6 fetch方法"></a>6 fetch方法</h2><p>6.1 目前在做react项目，用到了fetch发送异步请求，此时的fetch其实就是封装了一分Promise对象。</p>
<p>先来看下如何封装Ajax</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> getJSON = <span class="function"><span class="keyword">function</span>(<span class="params">url</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> client = <span class="keyword">new</span> XMLHttpRequest();</div><div class="line">    client.open(<span class="string">"GET"</span>, url);</div><div class="line">    client.onreadystatechange = handler;</div><div class="line">    client.responseType = <span class="string">"json"</span>;</div><div class="line">    client.setRequestHeader(<span class="string">"Accept"</span>, <span class="string">"application/json"</span>);</div><div class="line">    client.send();</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">handler</span>(<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.readyState !== <span class="number">4</span>) &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.status === <span class="number">200</span>) &#123;</div><div class="line">        resolve(<span class="keyword">this</span>.response);</div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">        reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="keyword">this</span>.statusText));</div><div class="line">      &#125;</div><div class="line">    &#125;;</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  <span class="keyword">return</span> promise;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">getJSON(<span class="string">"/posts.json"</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params">json</span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'Contents: '</span> + json);</div><div class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.error(<span class="string">'出错了'</span>, error);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">fetch(url).then(<span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;  <span class="comment">//then方法返回一个新的Promise对象，</span></div><div class="line">  <span class="keyword">return</span> response.json();</div><div class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;  <span class="comment">//这个data就是通过</span></div><div class="line">  <span class="built_in">console</span>.log(data);</div><div class="line">&#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">"Oops, error"</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/18/222React-router-Switch-Redict/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/18/222React-router-Switch-Redict/" itemprop="url">
                  React-router Switch Redict
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-18T12:36:00+08:00">
                2017-05-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/react/" itemprop="url" rel="index">
                    <span itemprop="name">react</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-Redict重定向组件"><a href="#1-Redict重定向组件" class="headerlink" title="1 Redict重定向组件"></a>1 Redict重定向组件</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;Redirect <span class="keyword">from</span>=<span class="string">"/old-match"</span> to=<span class="string">"/will-match"</span>/&gt;</div></pre></td></tr></table></figure>
<h3 id="2-Switch组件"><a href="#2-Switch组件" class="headerlink" title="2 Switch组件"></a>2 Switch组件</h3><p><strong>用来匹配子路由中第一个匹配到的path路由组件,匹配到即停止往下进行路径的匹配</strong></p>
<p>对比一个例子</p>
<p>官网原demo代码</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;Switch&gt;</div><div class="line">  &lt;Route path="/" exact component=&#123;Home&#125;/&gt;</div><div class="line">  &lt;Redirect from="/old-match" to="/will-match"/&gt;</div><div class="line">  &lt;Route path="/will-match" component=&#123;WillMatch&#125;/&gt;</div><div class="line">  &lt;Route component=&#123;NoMatch&#125;/&gt;</div><div class="line">&lt;/Switch&gt;</div></pre></td></tr></table></figure>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;Route&gt;</div><div class="line">  &lt;div&gt; </div><div class="line">    &lt;Route path="/" exact component=&#123;Home&#125;/&gt;</div><div class="line">    &lt;Redirect from="/old-match" to="/will-match"/&gt;</div><div class="line">    &lt;Route path="/will-match" component=&#123;WillMatch&#125;/&gt;</div><div class="line">    &lt;Route component=&#123;NoMatch&#125;/&gt;</div><div class="line">  &lt;/div&gt;</div><div class="line">&lt;/Route&gt;</div></pre></td></tr></table></figure>
<h3 id="3-Router组件-Route组件只能有一个根子元素-而Switch组件可以有多个并列的多子组件"><a href="#3-Router组件-Route组件只能有一个根子元素-而Switch组件可以有多个并列的多子组件" class="headerlink" title="3 Router组件 Route组件只能有一个根子元素,而Switch组件可以有多个并列的多子组件,"></a>3 Router组件 Route组件只能有一个根子元素,而Switch组件可以有多个并列的多子组件,</h3><ul>
<li>Route组件作为Router的子组件时候,如果Route的path属性如果没有,那么该组件始终会匹配</li>
<li>Route组件作为作为Switch组件的时候,如果前面有匹配到的路径,那么后面的Route的路径就不会再去匹配</li>
<li>可以总结来说Switch组件会按顺序进行子组件的path进行判断,匹配到了即进行渲染,终止后续Route组件的路径匹配 ;Router组件会按顺序进行子组件的path判断,会将所有的子Route的path路径进行匹配.</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></div><div class="line"><span class="keyword">import</span> &#123;</div><div class="line">  BrowserRouter <span class="keyword">as</span> Router,</div><div class="line">  Route,</div><div class="line">  Link,</div><div class="line">  Switch,</div><div class="line">  Redirect</div><div class="line">&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> NoMatchExample = <span class="function"><span class="params">()</span> =&gt;</span> (</div><div class="line">  &lt;Router&gt;</div><div class="line">    &lt;div&gt;</div><div class="line">      &lt;ul&gt;</div><div class="line">        &lt;li&gt;&lt;Link to="/"&gt;Home&lt;/Link&gt;&lt;/li&gt;</div><div class="line">        &lt;li&gt;&lt;Link to="/old-match"&gt;Old Match, to be redirected&lt;/Link&gt;&lt;/li&gt;</div><div class="line">        &lt;li&gt;&lt;Link to="/will-match"&gt;Will Match&lt;/Link&gt;&lt;/li&gt;</div><div class="line">        &lt;li&gt;&lt;Link to="/will-not-match"&gt;Will Not Match&lt;/Link&gt;&lt;/li&gt;</div><div class="line">        &lt;li&gt;&lt;Link to="/also/will/not/match"&gt;Also Will Not Match&lt;/Link&gt;&lt;/li&gt;</div><div class="line">      &lt;/ul&gt;</div><div class="line">      &lt;Switch&gt;</div><div class="line">        &lt;Route path="/" exact component=&#123;Home&#125;/&gt;</div><div class="line">        &lt;Redirect from="/old-match" to="/will-match"/&gt;</div><div class="line">        &lt;Route path="/will-match" component=&#123;WillMatch&#125;/&gt;</div><div class="line">        &lt;Route component=&#123;NoMatch&#125;/&gt;</div><div class="line">      &lt;/Switch&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">  &lt;/Router&gt;</div><div class="line">)</div><div class="line"></div><div class="line">const Home = () =&gt; (</div><div class="line">  &lt;p&gt;</div><div class="line">    A &lt;code&gt;&amp;lt;Switch&gt;&lt;/code&gt; renders the</div><div class="line">    first child &lt;code&gt;&amp;lt;Route&gt;&lt;/code&gt; that</div><div class="line">    matches. A &lt;code&gt;&amp;lt;Route&gt;&lt;/code&gt; with</div><div class="line">    no &lt;code&gt;path&lt;/code&gt; always matches.</div><div class="line">  &lt;/p&gt;</div><div class="line">)</div><div class="line"></div><div class="line">const WillMatch = () =&gt; &lt;h3&gt;Matched!&lt;/h3&gt;</div><div class="line"></div><div class="line">const NoMatch = (&#123; location &#125;) =&gt; (</div><div class="line">  &lt;div&gt;</div><div class="line">    &lt;h3&gt;No match for &lt;code&gt;&#123;location.pathname&#125;&lt;/code&gt;&lt;/h3&gt;</div><div class="line">  &lt;/div&gt;</div><div class="line">)</div><div class="line"></div><div class="line">export default NoMatchExample</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/17/221React-router-Prompt/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/17/221React-router-Prompt/" itemprop="url">
                  React-router Prompt
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-17T12:36:00+08:00">
                2017-05-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/react/" itemprop="url" rel="index">
                    <span itemprop="name">react</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-看下官方解释"><a href="#1-看下官方解释" class="headerlink" title="1 看下官方解释"></a>1 看下官方解释</h2><p>弹窗出来之后点击确定返回true,点击取消返回false.</p>
<p>Used to prompt the user before navigating away from a page. When your application enters a state that should prevent the user from navigating away (like a form is half-filled out), render a <code>&lt;Prompt&gt;</code>.</p>
<p>Prompt组件,当我们想往其他url地址跳转的时候,如果when的属性值是true,则会执行message</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">import &#123; Prompt &#125; from &apos;react-router&apos;</div><div class="line"></div><div class="line">&lt;Prompt</div><div class="line">  when=&#123;formIsHalfFilledOut&#125;</div><div class="line">  message=&quot;Are you sure you want to leave?&quot;</div><div class="line">/&gt;</div></pre></td></tr></table></figure>
<h3 id="when-bool"><a href="#when-bool" class="headerlink" title="when: bool"></a><a href="https://reacttraining.com/core/api/Prompt/when-bool" target="_blank" rel="external">when: bool</a></h3><p>Instead of conditionally rendering a <code>&lt;Prompt&gt;</code> behind a guard, you can always render it but pass <code>when={true}</code> or <code>when={false}</code> to prevent or allow navigation accordingly.</p>
<p>粗暴点来理解,</p>
<ul>
<li>如果我们传入一个true,那么则会渲染Prompt,接着执行message函数,渲染该函数的返回值,会询问用户是否确定跳转.</li>
<li>如果传入一个false,那么就会直接跳转到我们点击的url链接,</li>
</ul>
<h3 id="message-string"><a href="#message-string" class="headerlink" title="message: string"></a><a href="https://reacttraining.com/core/api/Prompt/message-string" target="_blank" rel="external">message: string</a></h3><p>The message to prompt the user with when they try to navigate away.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;Prompt message=&quot;Are you sure you want to leave?&quot;/&gt;</div></pre></td></tr></table></figure>
<h3 id="message-func"><a href="#message-func" class="headerlink" title="message: func"></a><a href="https://reacttraining.com/core/api/Prompt/message-func" target="_blank" rel="external">message: func</a></h3><p>Will be called with the next <code>location</code> and <code>action</code> the user is attempting to navigate to. </p>
<ul>
<li>Return a string to show a prompt to the user   此时如果用户点击确定,则返回true,允许跳转</li>
<li><strong>or <code>true</code> to allow the transition.</strong></li>
<li>传入message函数的变量是<strong>下一个location</strong>对象</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;Prompt message=&#123;location =&gt; (</div><div class="line">  `Are you sure you want to go to $&#123;location.pathname&#125;?`</div><div class="line">)&#125;/&gt;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;Prompt</div><div class="line">  when=&#123;isBlocking&#125;</div><div class="line">  message=&#123;location =&gt; (</div><div class="line">  true</div><div class="line">  )&#125;</div><div class="line">/&gt;</div></pre></td></tr></table></figure>
<h2 id="2-官方demo改动理解"><a href="#2-官方demo改动理解" class="headerlink" title="2 官方demo改动理解"></a>2 官方demo改动理解</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;Prompt</div><div class="line">         when=&#123;false&#125;</div><div class="line">         message=&#123;location =&gt; &#123;</div><div class="line"></div><div class="line">           console.log(&#123;isBlocking&#125;)</div><div class="line">           return  `Are you sure you want to go to $&#123;location.pathname&#125;`</div><div class="line">         &#125;&#125;</div><div class="line">       /&gt;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;Prompt</div><div class="line">         when=&#123;true&#125;</div><div class="line">         message=&#123;location =&gt; &#123;</div><div class="line"></div><div class="line">           console.log(&#123;isBlocking&#125;)</div><div class="line">           return  `Are you sure you want to go to $&#123;location.pathname&#125;`</div><div class="line">         &#125;&#125;</div><div class="line">       /&gt;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;Prompt</div><div class="line">        when=&#123;true&#125;</div><div class="line">        message=&apos;are you sure ? dearling&apos;</div><div class="line">      /&gt;</div></pre></td></tr></table></figure>
<h2 id="3-官方demo如下"><a href="#3-官方demo如下" class="headerlink" title="3 官方demo如下"></a>3 官方demo如下</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></div><div class="line"><span class="keyword">import</span> &#123;</div><div class="line">  BrowserRouter <span class="keyword">as</span> Router,</div><div class="line">  Route,</div><div class="line">  Link,</div><div class="line">  Prompt</div><div class="line">&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> PreventingTransitionsExample = <span class="function"><span class="params">()</span> =&gt;</span> (</div><div class="line">  &lt;Router&gt;</div><div class="line">    &lt;div&gt;</div><div class="line">      &lt;ul&gt;</div><div class="line">        &lt;li&gt;&lt;Link to="/"&gt;Form&lt;/Link&gt;&lt;/li&gt;</div><div class="line">        &lt;li&gt;&lt;Link to="/one"&gt;One&lt;/Link&gt;&lt;/li&gt;</div><div class="line">        &lt;li&gt;&lt;Link to="/two"&gt;Two&lt;/Link&gt;&lt;/li&gt;</div><div class="line">      &lt;/ul&gt;</div><div class="line">      &lt;Route path="/" exact component=&#123;Form&#125;/&gt;</div><div class="line">      &lt;Route path="/one" render=&#123;() =&gt; &lt;h3&gt;One&lt;/h3&gt;&#125;/&gt;</div><div class="line">      &lt;Route path="/two" render=&#123;() =&gt; &lt;h3&gt;Two&lt;/h3&gt;&#125;/&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">  &lt;/Router&gt;</div><div class="line">)</div><div class="line"></div><div class="line">class Form extends React.Component &#123;</div><div class="line">  state = &#123;</div><div class="line">    isBlocking: false</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  render() &#123;</div><div class="line">    const &#123; isBlocking &#125; = this.state  //对象的结构赋值</div><div class="line">//等价于 const isBlocking = this.state.isBlocking</div><div class="line">    return (</div><div class="line">      &lt;form</div><div class="line">        onSubmit=&#123;event =&gt; &#123;</div><div class="line">            console.log('button is pressed');</div><div class="line">            </div><div class="line">          event.preventDefault()</div><div class="line">          event.target.reset()</div><div class="line">          this.setState(&#123;</div><div class="line">            isBlocking: false</div><div class="line">          &#125;)</div><div class="line">        &#125;&#125;</div><div class="line">      &gt;</div><div class="line">        &lt;Prompt</div><div class="line">          when=&#123;isBlocking&#125;</div><div class="line">          message=&#123;location =&gt; (</div><div class="line">            `Are you sure you want to go to $&#123;location.pathname&#125;`</div><div class="line">          )&#125;</div><div class="line">        /&gt;</div><div class="line"></div><div class="line">        &lt;p&gt;</div><div class="line">          Blocking? &#123;isBlocking ? 'Yes, click a link or the back button' : 'Nope'&#125;</div><div class="line">        &lt;/p&gt;</div><div class="line"></div><div class="line">        &lt;p&gt;</div><div class="line">          &lt;input</div><div class="line">            size="50"</div><div class="line">            placeholder="type something to block transitions"</div><div class="line">            onChange=&#123;event =&gt; &#123;</div><div class="line">              this.setState(&#123;</div><div class="line">                isBlocking: event.target.value.length &gt; 0</div><div class="line">              &#125;)</div><div class="line">            &#125;&#125;</div><div class="line">          /&gt;</div><div class="line">        &lt;/p&gt;</div><div class="line"></div><div class="line">        &lt;p&gt;</div><div class="line">          &lt;button&gt;Submit to stop blocking&lt;/button&gt;</div><div class="line">        &lt;/p&gt;</div><div class="line">      &lt;/form&gt;</div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">export default PreventingTransitionsExample</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/16/220React-router-中的Route组件详解/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/16/220React-router-中的Route组件详解/" itemprop="url">
                  React-router 中的Route组件详解
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-16T12:36:00+08:00">
                2017-05-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/react/" itemprop="url" rel="index">
                    <span itemprop="name">react</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-Route组件"><a href="#1-Route组件" class="headerlink" title="1 Route组件"></a>1 Route组件</h3><p>The Route component is perhaps the most important component in React Router to understand and learn to use well. Its most basic responsibility is to render some UI when a <a href="https://github.com/ReactTraining/react-router/blob/master/packages/react-router/docs/api/location.md" target="_blank" rel="external">location</a> matches the route’s <code>path</code>.</p>
<p>Consider the following code:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">import &#123; BrowserRouter as Router, Route &#125; from &apos;react-router-dom&apos;</div><div class="line"></div><div class="line">&lt;Router&gt;</div><div class="line">  &lt;div&gt;</div><div class="line">    &lt;Route exact path=&quot;/&quot; component=&#123;Home&#125;/&gt;</div><div class="line">    &lt;Route path=&quot;/news&quot; component=&#123;NewsFeed&#125;/&gt;</div><div class="line">  &lt;/div&gt;</div><div class="line">&lt;/Router&gt;</div></pre></td></tr></table></figure>
<p>If the location of the app is <code>/</code> then the UI hierarchy will be something like:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;div&gt;</div><div class="line">  &lt;Home/&gt;</div><div class="line">  &lt;!-- react-empty: 2 --&gt;</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure>
<p>And if the location of the app is <code>/news</code> then the UI hierarchy will be:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;div&gt;</div><div class="line">  &lt;!-- react-empty: 1 --&gt;</div><div class="line">  &lt;NewsFeed/&gt;</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure>
<p>The “react-empty” comments are just implementation details of React’s <code>null</code> rendering. But for our purposes, it is instructive. A Route is always technically “rendered” even though its rendering <code>null</code>. As soon as the app location matches the route’s path, your component will be rendered.</p>
<p>####Route render methods</p>
<p>There are 3 ways to render something with a <code>&lt;Route&gt;</code>:</p>
<ul>
<li><code>&lt;Route component /&gt;</code></li>
<li><code>&lt;Route render /&gt;</code></li>
<li><code>&lt;Route children /&gt;</code></li>
</ul>
<p>Each is useful in different circumstances. You should use only one of these props on a given <code>&lt;Route&gt;</code>. See their explanations below to understand why you have 3 options. Most of the time you’ll use <code>component</code>.</p>
<h4 id="Route-props"><a href="#Route-props" class="headerlink" title="Route props"></a>Route props</h4><p>All three <a href="https://github.com/ReactTraining/react-router/blob/master/packages/react-router/docs/api/Route.md#route-render-methods" target="_blank" rel="external">render methods</a> will be passed the same three route props</p>
<ul>
<li><a href="https://github.com/ReactTraining/react-router/blob/master/packages/react-router/docs/api/match.md" target="_blank" rel="external">match</a></li>
<li><a href="https://github.com/ReactTraining/react-router/blob/master/packages/react-router/docs/api/location.md" target="_blank" rel="external">location</a></li>
<li><a href="https://github.com/ReactTraining/react-router/blob/master/packages/react-router/docs/api/history.md" target="_blank" rel="external">history</a></li>
</ul>
<h4 id="component"><a href="#component" class="headerlink" title="component"></a>component</h4><p>A React component to render only when the location matches. It will be rendered with <a href="https://github.com/ReactTraining/react-router/blob/master/packages/react-router/docs/api/Route.md#route-props" target="_blank" rel="external">route props</a>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;Route path=&quot;/user/:username&quot; component=&#123;User&#125;/&gt;</div><div class="line"></div><div class="line">const User = (&#123; match &#125;) =&gt; &#123;</div><div class="line">  return &lt;h1&gt;Hello &#123;match.params.username&#125;!&lt;/h1&gt;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>When you use <code>component</code> (instead of <code>render</code> or <code>children</code>, below) the router uses <a href="https://facebook.github.io/react/docs/react-api.html#createelement" target="_blank" rel="external"><code>React.createElement</code></a> to create a new <a href="https://facebook.github.io/react/docs/rendering-elements.html" target="_blank" rel="external">React element</a> from the given component. That means if you provide an inline function to the <code>component</code> attribute, you would create a new component every render. This results in the existing component unmounting and the new component mounting instead of just updating the existing component. When using an inline function for inline rendering, use the <code>render</code> or the <code>children</code> prop (below).</p>
<h4 id="render-func"><a href="#render-func" class="headerlink" title="render: func"></a>render: func</h4><p>This allows for convenient inline rendering and wrapping without the undesired remounting explained above.</p>
<p>Instead of having a new <a href="https://facebook.github.io/react/docs/rendering-elements.html" target="_blank" rel="external">React element</a> created for you using the <a href="https://github.com/ReactTraining/react-router/blob/master/packages/react-router/docs/api/Route.md#component-func" target="_blank" rel="external"><code>component</code></a> prop, you can pass in a function to be called when the location matches. The <code>render</code> prop receives all the same <a href="https://github.com/ReactTraining/react-router/blob/master/packages/react-router/docs/api/Route.md#route-props" target="_blank" rel="external">route props</a> as the <code>component</code> render prop.</p>
<p>当路径匹配到了的时候,就会执行render函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">// convenient inline rendering</div><div class="line">&lt;Route path=&quot;/home&quot; render=&#123;() =&gt; &lt;div&gt;Home&lt;/div&gt;&#125;/&gt;</div><div class="line"></div><div class="line">// wrapping/composing</div><div class="line">const FadingRoute = (&#123; component: Component, ...rest &#125;) =&gt; (</div><div class="line">  &lt;Route &#123;...rest&#125; render=&#123;props =&gt; (</div><div class="line">    &lt;FadeIn&gt;</div><div class="line">      &lt;Component &#123;...props&#125;/&gt;</div><div class="line">    &lt;/FadeIn&gt;</div><div class="line">  )&#125;/&gt;</div><div class="line">)</div><div class="line"></div><div class="line">&lt;FadingRoute path=&quot;/cool&quot; component=&#123;Something&#125;/&gt;</div></pre></td></tr></table></figure>
<p><strong>Warning:</strong> <code>&lt;Route component&gt;</code> takes precendence over <code>&lt;Route render&gt;</code> so don’t use both in the same <code>&lt;Route&gt;</code>.</p>
<h4 id="children-func"><a href="#children-func" class="headerlink" title="children: func"></a>children: func</h4><p>Sometimes you need to render whether the path matches the location or not. In these cases, you can use the function <code>children</code> prop. It works exactly like <code>render</code> except that it gets called whether there is a match or not.</p>
<p>无论path是否匹配到了路径,都会渲染children</p>
<p>The <code>children</code> render prop receives all the same <a href="https://github.com/ReactTraining/react-router/blob/master/packages/react-router/docs/api/Route.md#route-props" target="_blank" rel="external">route props</a> as the <code>component</code> and <code>render</code> methods, except when a route fails to match the URL, then <code>match</code> is <code>null</code>. This allows you to dynamically adjust your UI based on whether or not the route matches. Here we’re adding an <code>active</code> class if the route matches</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;ul&gt;</div><div class="line">  &lt;ListItemLink to=&quot;/somewhere&quot;/&gt;</div><div class="line">  &lt;ListItemLink to=&quot;/somewhere-else&quot;/&gt;</div><div class="line">&lt;/ul&gt;</div><div class="line"></div><div class="line">const ListItemLink = (&#123; to, ...rest &#125;) =&gt; (</div><div class="line">  &lt;Route path=&#123;to&#125; children=&#123;(&#123; match &#125;) =&gt; (</div><div class="line">    &lt;li className=&#123;match ? &apos;active&apos; : &apos;&apos;&#125;&gt;</div><div class="line">      &lt;Link to=&#123;to&#125; &#123;...rest&#125;/&gt;</div><div class="line">    &lt;/li&gt;</div><div class="line">  )&#125;/&gt;</div><div class="line">)</div></pre></td></tr></table></figure>
<p>This could also be useful for animations:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;Route children=&#123;(&#123; match, ...rest &#125;) =&gt; (</div><div class="line">  &#123;/* Animate will always render, so you can use lifecycles</div><div class="line">      to animate its child in and out */&#125;</div><div class="line">  &lt;Animate&gt;</div><div class="line">    &#123;match &amp;&amp; &lt;Something &#123;...rest&#125;/&gt;&#125;</div><div class="line">  &lt;/Animate&gt;</div><div class="line">)&#125;/&gt;</div></pre></td></tr></table></figure>
<p><strong>Warning:</strong> Both <code>&lt;Route component&gt;</code> and <code>&lt;Route render&gt;</code> take precendence over <code>&lt;Route children&gt;</code> so don’t use more than one in the same <code>&lt;Route&gt;</code>.</p>
<h4 id="path-string"><a href="#path-string" class="headerlink" title="path: string"></a>path: string</h4><p>Any valid URL path that <a href="https://www.npmjs.com/package/path-to-regexp" target="_blank" rel="external"><code>path-to-regexp</code></a> understands.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;Route path=&quot;/users/:id&quot; component=&#123;User&#125;/&gt;</div></pre></td></tr></table></figure>
<p><strong>Routes without a <code>path</code> <em>always</em> match.</strong></p>
<p>如果一个Route组件没有path属性,那么这个组件将总会被渲染.</p>
<p><strong>Route组件的path路径如果包含  :  变量,那么匹配到的所有的符合变量路径都会被渲染</strong>,如果想要保证唯一性,可以通过使用Switch组件进行匹配到一个则不进行往下匹配选择性渲染.</p>
<h4 id="exact-bool"><a href="#exact-bool" class="headerlink" title="exact: bool"></a>exact: bool</h4><p>When <code>true</code>, will only match if the path matches the <code>location.pathname</code> <em>exactly</em>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;Route exact path=&quot;/one&quot; component=&#123;About&#125;/&gt;</div></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>path</th>
<th>location.pathname</th>
<th>exact</th>
<th>matches?</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/one</code></td>
<td><code>/one/two</code></td>
<td><code>true</code></td>
<td>no</td>
</tr>
<tr>
<td><code>/one</code></td>
<td><code>/one/two</code></td>
<td><code>false</code></td>
<td>yes</td>
</tr>
</tbody>
</table>
<h4 id="strict-bool"><a href="#strict-bool" class="headerlink" title="strict: bool"></a>strict: bool</h4><p>When <code>true</code>, a <code>path</code> that has a trailing slash will only match a <code>location.pathname</code> with a trailing slash. This has no effect when there are additional URL segments in the <code>location.pathname</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;Route strict path=&quot;/one/&quot; component=&#123;About&#125;/&gt;</div></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>path</th>
<th>location.pathname</th>
<th>matches?</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/one/</code></td>
<td><code>/one</code></td>
<td>no</td>
</tr>
<tr>
<td><code>/one/</code></td>
<td><code>/one/</code></td>
<td>yes</td>
</tr>
<tr>
<td><code>/one/</code></td>
<td><code>/one/two</code></td>
<td>yes</td>
</tr>
</tbody>
</table>
<p><strong>Warning:</strong> <code>strict</code> can be used to enforce that a <code>location.pathname</code> has no trailing slash, but in order to do this both <code>strict</code>and <code>exact</code> must be <code>true</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;Route exact strict path=&quot;/one&quot; component=&#123;About&#125;/&gt;</div></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>path</th>
<th>location.pathname</th>
<th>matches?</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/one</code></td>
<td><code>/one</code></td>
<td>yes</td>
</tr>
<tr>
<td><code>/one</code></td>
<td><code>/one/</code></td>
<td>no</td>
</tr>
<tr>
<td><code>/one</code></td>
<td><code>/one/two</code></td>
<td>no</td>
</tr>
</tbody>
</table>
<h3 id="2-Demo案例"><a href="#2-Demo案例" class="headerlink" title="2 Demo案例"></a>2 Demo案例</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></div><div class="line"><span class="keyword">import</span> &#123;</div><div class="line">  BrowserRouter <span class="keyword">as</span> Router,</div><div class="line">  Route,</div><div class="line">  Link</div><div class="line">&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></div><div class="line"><span class="keyword">const</span> Repo = <span class="function"><span class="params">()</span>=&gt;</span>(<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>this is Repo<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</div><div class="line"><span class="keyword">const</span> Category = <span class="function">(<span class="params">props</span>)=&gt;</span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(props);</div><div class="line">  <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>this is category<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</div><div class="line">&#125;</div><div class="line"><span class="keyword">const</span> MyTest =<span class="function"><span class="params">()</span>=&gt;</span>(</div><div class="line">  <span class="xml"><span class="tag">&lt;<span class="name">Router</span>&gt;</span></span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">'/about'</span>&gt;</span>About<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">'./repo'</span>&gt;</span>Repo<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">      </div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">'./category'</span>&gt;</span>Category<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">Route</span> <span class="attr">exact</span> <span class="attr">path</span>=<span class="string">'/about'</span> <span class="attr">render</span>=<span class="string">&#123;(props)</span>=&gt;</span>&#123;console.log(props);return (<span class="tag">&lt;<span class="name">div</span>&gt;</span>this is aabout<span class="tag">&lt;/<span class="name">div</span>&gt;</span>)</div><div class="line">      &#125;&#125;&gt;<span class="tag">&lt;/<span class="name">Route</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">Route</span> <span class="attr">exact</span> <span class="attr">path</span>=<span class="string">'/repo'</span> <span class="attr">component</span>=<span class="string">&#123;Repo&#125;</span>&gt;</span> <span class="tag">&lt;/<span class="name">Route</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">Route</span> <span class="attr">exact</span> <span class="attr">path</span>=<span class="string">'/category'</span> <span class="attr">component</span>=<span class="string">&#123;Category&#125;</span>&gt;</span> <span class="tag">&lt;/<span class="name">Route</span>&gt;</span></div><div class="line">    </div><div class="line">      <span class="tag">&lt;<span class="name">Route</span> <span class="attr">children</span>=<span class="string">&#123;(props)</span>=&gt;</span>&#123;console.log(props);return (<span class="tag">&lt;<span class="name">div</span>&gt;</span>this is a component build througth children<span class="tag">&lt;/<span class="name">div</span>&gt;</span>)</div><div class="line">      &#125;&#125;&gt;<span class="tag">&lt;/<span class="name">Route</span>&gt;</span></div><div class="line">    </div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  </div><div class="line">  </div><div class="line">  <span class="tag">&lt;/<span class="name">Router</span>&gt;</span></div><div class="line">)</div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> MyTest</div></pre></td></tr></table></figure>
<p>Recursive递归 : match对象的使用,path就是Route组件的path值,params对象存放的是 :id 的key/value对应的值,value值是字符串,url是当前路径的url值.</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></div><div class="line"><span class="keyword">import</span> &#123;</div><div class="line">  BrowserRouter <span class="keyword">as</span> Router,</div><div class="line">  Route,</div><div class="line">  Link</div><div class="line">&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></div><div class="line"><span class="comment">//这个时候的UI视图就是根据数据来呈现的</span></div><div class="line"><span class="keyword">const</span> PEEPS = [</div><div class="line">  &#123; <span class="attr">id</span>: <span class="number">0</span>, <span class="attr">name</span>: <span class="string">'Michelle'</span>, <span class="attr">friends</span>: [ <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span> ] &#125;,</div><div class="line">  &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">'Sean'</span>, <span class="attr">friends</span>: [ <span class="number">0</span>, <span class="number">3</span> ] &#125;,</div><div class="line">  &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">'Kim'</span>, <span class="attr">friends</span>: [ <span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span> ], &#125;,</div><div class="line">  &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">name</span>: <span class="string">'David'</span>, <span class="attr">friends</span>: [ <span class="number">1</span>, <span class="number">2</span> ] &#125;</div><div class="line">]</div><div class="line"></div><div class="line"><span class="keyword">const</span> find = <span class="function">(<span class="params">id</span>) =&gt;</span> PEEPS.find( <span class="function"><span class="params">p</span>=&gt;</span>p.id == id )</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">const</span> RecursiveExample = <span class="function"><span class="params">()</span>=&gt;</span>(</div><div class="line"></div><div class="line">  <span class="xml"><span class="tag">&lt;<span class="name">Router</span>&gt;</span></span></div><div class="line">    <span class="tag">&lt;<span class="name">Person</span> <span class="attr">match</span>=<span class="string">&#123;&#123;params:&#123;id:0&#125;,url:</span>''&#125;&#125;&gt;</span><span class="tag">&lt;/<span class="name">Person</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">Router</span>&gt;</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="keyword">const</span> Person = <span class="function">(<span class="params">&#123;match&#125;</span>)=&gt;</span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'match'</span>,match);</div><div class="line">  </div><div class="line">  <span class="keyword">const</span> person = find(match.params.id)</div><div class="line">  <span class="built_in">console</span>.log(person);</div><div class="line">  </div><div class="line">  <span class="keyword">return</span> (</div><div class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></div><div class="line">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;person.name&#125;'s friends<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></div><div class="line">        &#123;person.friends.map(id=&gt;(</div><div class="line">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;id&#125;</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&#123;</span>`$&#123;<span class="attr">match.url</span>&#125;/$&#123;<span class="attr">id</span>&#125;`&#125;&gt;</span></div><div class="line">              &#123;find(id).name&#125;</div><div class="line">            <span class="tag">&lt;/<span class="name">Link</span>&gt;</span></div><div class="line">          <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        ))&#125;</div><div class="line">  </div><div class="line">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#123;</span>`$&#123;<span class="attr">match.url</span>&#125;/<span class="attr">:id</span>`&#125; <span class="attr">component</span>=<span class="string">&#123;Person&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  )</div><div class="line">  </div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> RecursiveExample</div></pre></td></tr></table></figure>
<h3 id="3-Route组件会将history-location-match这三个对象传递给component-render-以及children中的props"><a href="#3-Route组件会将history-location-match这三个对象传递给component-render-以及children中的props" class="headerlink" title="3 Route组件会将history  location   match这三个对象传递给component    render    以及children中的props"></a>3 Route组件会将history  location   match这三个对象传递给component    render    以及children中的props</h3><ul>
<li><code>&lt;Route component /&gt;</code></li>
<li><code>&lt;Route render /&gt;</code></li>
<li><code>&lt;Route children /&gt;</code></li>
</ul>
<p>这三种方式创建的组件的props属性中.</p>
<h3 id="4-Routee组件作为路由根组件需要注意两点"><a href="#4-Routee组件作为路由根组件需要注意两点" class="headerlink" title="4 Routee组件作为路由根组件需要注意两点"></a>4 Routee组件作为路由根组件需要注意两点</h3><ul>
<li>Router组件只允许有一个子元素,不允许有并行的子元素</li>
<li>Router组件可以通过history对象进行对url地址的记录.</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>


          
          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar.jpg"
               alt="JiM-W" />
          <p class="site-author-name" itemprop="name">JiM-W</p>
           
              <p class="site-description motion-element" itemprop="description">keep fighting！</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">195</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">52</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">90</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">JiM-W</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  



  
  

  

  

  

  


  

</body>
</html>
