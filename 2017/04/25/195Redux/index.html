<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="建议先看这篇GitHub上的基础 Redux基础              深入浅出Redux3
1   action 创建函数     仅仅是一个函数，作用是用来生成一个action，action本质是一个javascript对象这个函数会返回一个 Action 对象，这个对象里描述了“页面发生了什么”。随后这个对象会被传入到 Reducer 中。
官方定义:Actions are payloa">
<meta property="og:type" content="article">
<meta property="og:title" content="Redux">
<meta property="og:url" content="http://yoursite.com/2017/04/25/195Redux/index.html">
<meta property="og:site_name" content="JiM-W">
<meta property="og:description" content="建议先看这篇GitHub上的基础 Redux基础              深入浅出Redux3
1   action 创建函数     仅仅是一个函数，作用是用来生成一个action，action本质是一个javascript对象这个函数会返回一个 Action 对象，这个对象里描述了“页面发生了什么”。随后这个对象会被传入到 Reducer 中。
官方定义:Actions are payloa">
<meta property="og:updated_time" content="2017-04-26T12:51:45.949Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Redux">
<meta name="twitter:description" content="建议先看这篇GitHub上的基础 Redux基础              深入浅出Redux3
1   action 创建函数     仅仅是一个函数，作用是用来生成一个action，action本质是一个javascript对象这个函数会返回一个 Action 对象，这个对象里描述了“页面发生了什么”。随后这个对象会被传入到 Reducer 中。
官方定义:Actions are payloa">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2017/04/25/195Redux/"/>





  <title> Redux | JiM-W </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">JiM-W</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">keep Moving</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/25/195Redux/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Redux
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-25T12:36:00+08:00">
                2017-04-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/redux/" itemprop="url" rel="index">
                    <span itemprop="name">redux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>建议先看这篇GitHub上的基础 <a href="https://github.com/happypoulp/redux-tutorial" target="_blank" rel="external">Redux基础</a>              <a href="https://www.w3ctech.com/topic/1561" target="_blank" rel="external">深入浅出Redux3</a></p>
<h3 id="1-action-创建函数-仅仅是一个函数，作用是用来生成一个action，action本质是一个javascript对象"><a href="#1-action-创建函数-仅仅是一个函数，作用是用来生成一个action，action本质是一个javascript对象" class="headerlink" title="1   action 创建函数     仅仅是一个函数，作用是用来生成一个action，action本质是一个javascript对象"></a>1   action 创建函数     仅仅是一个函数，作用是用来生成一个action，action本质是一个javascript对象</h3><p>这个函数会返回一个 Action 对象，这个对象里描述了“页面发生了什么”。随后这个对象会被传入到 Reducer 中。</p>
<p>官方定义:Actions are payloads of information that send data from your application to your store. They are the only source of information for the store. You send them to the store using store.dispatch().</p>
<p><strong>Action</strong> 是把数据从应用（这里之所以不叫 view 是因为这些数据有可能是服务器响应，用户输入或其它非 view 的数据 ）传到 store 的有效载荷。它是 store 数据的<strong>唯一</strong>来源。一般来说你会通过 <a href="http://cn.redux.js.org/docs/api/Store.html#dispatch" target="_blank" rel="external"><code>store.dispatch()</code></a> 将 action 传到 store。</p>
<p>描述发生了什么</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> actionCreator = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// ...that creates an action (yeah, the name action creator is pretty obvious now) and returns it</span></div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        <span class="attr">type</span>: <span class="string">'AN_ACTION'</span>,</div><div class="line">        <span class="attr">name</span>:<span class="string">'Jhon'</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Redux约定Action内使用一个<strong>字符串类型</strong>的type字段来表示将要执行的动作，比如上栗的 AN_ACTION，除了type之外可以存放其他要操作的数据；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;createStore&#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</div><div class="line"><span class="keyword">var</span> userReducer = <span class="function"><span class="keyword">function</span>(<span class="params">state = &#123;&#125;,action</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'userReducer was called with '</span>,state,<span class="string">'and action'</span>,action); </div><div class="line">    <span class="keyword">switch</span>(action.type)&#123;</div><div class="line">        <span class="keyword">case</span> <span class="string">'SET_NAME'</span> :</div><div class="line">            <span class="keyword">return</span> &#123;</div><div class="line">                ...state,</div><div class="line">                <span class="attr">name</span> : action.name </div><div class="line">            &#125;</div><div class="line">        <span class="keyword">default</span> :</div><div class="line">            <span class="keyword">return</span> state ;</div><div class="line">    &#125;   </div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> store_0 = createStore(userReducer);</div></pre></td></tr></table></figure>
<p>传入store_0的可以是一个action对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">store_0.dispatch(&#123;<span class="attr">type</span>:<span class="string">'SET_NAME'</span>,<span class="attr">name</span> : <span class="string">"Jhon"</span>&#125;);</div><div class="line"><span class="comment">//userReducer was called with  &#123;&#125; and action &#123; type: 'SET_NAME', name: 'Jhon' &#125;</span></div><div class="line"><span class="built_in">console</span>.log(<span class="string">'store_0 state after action'</span>,store_0.getState());</div><div class="line"><span class="comment">////store_0 state after action  &#123; name: 'Jhon' &#125;</span></div></pre></td></tr></table></figure>
<p>同样也可以是一个action创建函数，该函数返回action对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">setNameActionCreator</span>(<span class="params">name</span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        <span class="attr">type</span> : <span class="string">'SET_NAME'</span>,</div><div class="line">        name </div><div class="line">      <span class="comment">//这里用到了ES6声明对象的简洁语法</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">store_0.dispatch(setNameActionCreator(<span class="string">'JiM'</span>));</div><div class="line"><span class="comment">//userReducer was called with  &#123; name: 'Jhon' &#125; and action &#123; type: 'SET_NAME', name: 'JiM' &#125;</span></div><div class="line"><span class="built_in">console</span>.log(<span class="string">'store_0 state after action'</span>,store_0.getState());</div><div class="line"><span class="comment">//store_0 state after action  &#123; name: 'JiM' &#125;</span></div></pre></td></tr></table></figure>
<h3 id="2-reducer"><a href="#2-reducer" class="headerlink" title="2 reducer"></a>2 reducer</h3><p>根据action更新state，reducer 就是一个纯函数，接收旧的 state 和 action，返回新的 state。</p>
<p>官方定义:Actions describe the fact that something happened, but don’t specify how the application’s state changes in response. This is the job of a reducer.</p>
<p>之所以称作 reducer 是因为它将被传递给 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce" target="_blank" rel="external"><code>Array.prototype.reduce(reducer, ?initialValue)</code></a> 方法。保持 reducer 纯净非常重要。<strong>永远不要</strong>在 reducer 里做这些操作：</p>
<ul>
<li>修改传入参数；</li>
<li>执行有副作用的操作，如 API 请求和路由跳转；</li>
<li>调用非纯函数，如 <code>Date.now()</code> 或 <code>Math.random()</code>。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">(previousState, action) =&gt; newState</div><div class="line"><span class="comment">//How do I handle data modifications?</span></div><div class="line"><span class="comment">//     Using reducers (called "stores" in traditional flux).</span></div><div class="line"><span class="comment">//     A reducer is a subscriber to actions.</span></div><div class="line"><span class="comment">//     A reducer is just a function that receives the current state of your application, the action,</span></div><div class="line"><span class="comment">//     and returns a new state modified (or reduced as they call it)</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">todoApp</span>(<span class="params">state = &#123;&#125;, action</span>) </span>&#123;</div><div class="line">  <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">    <span class="keyword">case</span> SET_VISIBILITY_FILTER:</div><div class="line">      <span class="keyword">return</span> <span class="built_in">Object</span>.assign(&#123;&#125;, state, &#123;</div><div class="line">        <span class="attr">visibilityFilter</span>: action.filter</div><div class="line">      &#125;)</div><div class="line">    <span class="keyword">default</span>:</div><div class="line">      <span class="keyword">return</span> state</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>传入state的默认值可以是null  undefined  [ ] 布尔类型 字符串等</strong> ,也就是说，reducer函数可以处理任何数据结构类型，根据需求不同可以传入不同的state默认值；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;createStore&#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">myReducer</span>(<span class="params">state = null,action</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'myReducer was called with state'</span>,state,<span class="string">'and action'</span>,action);</div><div class="line">    <span class="keyword">switch</span>(action.type)&#123;</div><div class="line">        <span class="keyword">case</span> <span class="string">'SOMETHING'</span> :</div><div class="line">            <span class="keyword">return</span> &#123;</div><div class="line">                ...state ,</div><div class="line">                <span class="attr">message</span> : <span class="string">'done'</span></div><div class="line">            &#125;</div><div class="line">        <span class="keyword">default</span> : </div><div class="line">            <span class="keyword">return</span> state</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> store_0 = createStore(myReducer)</div></pre></td></tr></table></figure>
<p>如果随着我们的业务越来越复杂，如何让不同的reducer进行合并呢？redux提供了combineReducers函数，该函数接受一个对象，会执行传入的所有的reducer；</p>
<p><code>combineReducers</code> 生成了一个类似于Reducer的函数。为什么是类似于，因为它不是真正的Reducer，它只是一个调用Reducer的函数，只不过它接收的参数与真正的Reducer一模一样~</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;createStore,combineReducers&#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</div><div class="line"><span class="keyword">var</span> userReducer = <span class="function"><span class="keyword">function</span>(<span class="params">state = &#123;&#125;,action</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'userReducer was called with the state'</span>,state,<span class="string">'and action'</span>,action);</div><div class="line">    <span class="keyword">switch</span>(action.type)&#123;</div><div class="line">        <span class="keyword">case</span> <span class="string">'SOmething'</span> : </div><div class="line">            <span class="keyword">return</span> &#123;</div><div class="line">                ...state,</div><div class="line">                <span class="attr">message</span>:action.value</div><div class="line">            &#125;</div><div class="line"></div><div class="line">        <span class="keyword">default</span> :</div><div class="line">            <span class="keyword">return</span> state ;        </div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> itemsReducer = <span class="function"><span class="keyword">function</span>(<span class="params">state = [],action</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'itemsReducer was called with the state'</span>,state,<span class="string">'and action'</span>,action);</div><div class="line">    <span class="keyword">switch</span>(action.type)&#123;</div><div class="line">        <span class="comment">//etc </span></div><div class="line"></div><div class="line">        <span class="keyword">default</span> :</div><div class="line">            <span class="keyword">return</span> state ;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> reducer = combineReducers(&#123;userReducer,itemsReducer&#125;);</div><div class="line"><span class="comment">//其实等价于 var reducer = combineReducers(&#123;userReducer:userReducer,itemsReducer:itemsReducer&#125;);</span></div><div class="line"><span class="comment">//ES6对象新的语法特性</span></div><div class="line"><span class="comment">//这行代码执行之后输出</span></div><div class="line"><span class="comment">/*</span></div><div class="line">userReducer was called with the state &#123;&#125; and action &#123; type: '@@redux/INIT' &#125;</div><div class="line">userReducer was called with the state &#123;&#125; and action &#123; type: '@@redux/PROBE_UNKNOWN_ACTION_q.y.p.r.j.q.z.6.7.x.t.b.a.6.j.b.r.z.f.r' &#125;</div><div class="line">itemsReducer was called with the state [] and action &#123; type: '@@redux/INIT' &#125;</div><div class="line">itemsReducer was called with the state [] and action &#123; type: '@@redux/PROBE_UNKNOWN_ACTION_f.y.3.u.2.q.q.w.d.h.q.c.w.p.g.2.p.g.b.9' &#125;</div><div class="line"></div><div class="line">*/</div><div class="line"><span class="built_in">console</span>.log(combineReducers);<span class="comment">//[Function: combineReducers]</span></div><div class="line"><span class="built_in">console</span>.log(reducer);<span class="comment">//[Function: combination]  可以看出combineReducers这个函数调用一系列的reducer然后返回一个新的reducer函数</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> store_0 = createStore(reducer);</div><div class="line"><span class="comment">/**</span></div><div class="line"> * userReducer was called with the state &#123;&#125; and action &#123; type: '@@redux/INIT' &#125;</div><div class="line">itemsReducer was called with the state [] and action &#123; type: '@@redux/INIT' &#125;</div><div class="line"></div><div class="line"> */</div><div class="line"><span class="built_in">console</span>.log(<span class="string">'store_0 state after initialization'</span>,store_0.getState());</div><div class="line"><span class="comment">//输出如下: store_0 state after initialization &#123; userReducer: &#123;&#125;, itemsReducer: [] &#125;</span></div></pre></td></tr></table></figure>
<p>看下combineReducers底层实现</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">combineReducers</span>(<span class="params">reducers</span>) </span>&#123;</div><div class="line"></div><div class="line">  <span class="comment">// 过滤reducers，把非function类型的过滤掉~</span></div><div class="line">  <span class="keyword">var</span> finalReducers = pick(reducers, (val) =&gt; <span class="keyword">typeof</span> val === <span class="string">'function'</span>);</div><div class="line"></div><div class="line">  <span class="comment">// 一开始我一直以为这个没啥用，后来我发现，这个函数太重要了。它在一开始，就已经把你的State改变了。变成了，Reducer的key 和 Reducer返回的initState组合。</span></div><div class="line">  <span class="keyword">var</span> defaultState = mapValues(finalReducers, () =&gt; <span class="literal">undefined</span>);</div><div class="line"></div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">combination</span>(<span class="params">state = defaultState, action</span>) </span>&#123;</div><div class="line">    <span class="comment">// finalReducers 是 reducers</span></div><div class="line">    <span class="keyword">var</span> finalState = mapValues(finalReducers, (reducer, key) =&gt; &#123;</div><div class="line"></div><div class="line">      <span class="comment">// state[key] 是当前Reducer所对应的State，可以理解为当前的State</span></div><div class="line">      <span class="keyword">var</span> previousStateForKey = state[key];</div><div class="line">      <span class="keyword">var</span> nextStateForKey = reducer(previousStateForKey, action);</div><div class="line"></div><div class="line">      <span class="keyword">return</span> nextStateForKey;      </div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="comment">// finalState 是 Reducer的key和stat的组合。。</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>从上面的源码可以看出，combineReducers 生成一个类似于Reducer的函数<code>combination</code>。</p>
<p>当使用combination的时候，combination会把所有子Reducer都执行一遍，子Reducer通过action.type 匹配操作，因为是执行所有子Reducer，所以如果两个子Reducer匹配的action.type是一样的，那么都会成功匹配。</p>
<p>注意:</p>
<ol>
<li><p><strong>不要修改 state。</strong> 使用 <a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Object/assign" target="_blank" rel="external"><code>Object.assign()</code></a> 新建了一个副本。不能这样使用 <code>Object.assign(state, {visibilityFilter: action.filter })</code>，因为它会改变第一个参数的值。你<strong>必须</strong>把第一个参数设置为空对象。你也可以开启对ES7提案<a href="http://cn.redux.js.org/docs/recipes/UsingObjectSpreadOperator.html" target="_blank" rel="external">对象展开运算符</a>的支持, 从而使用 <code>{ ...state, ...newState }</code> 达到相同的目的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">state = &#123;name:&apos;Jhon&apos;,age:18&#125;       &#123;...state,address : &apos;China&apos;&#125;  </div><div class="line">=&gt; &#123; name: &apos;Jhon&apos;, age: 18, address: &apos;China&apos; &#125;</div></pre></td></tr></table></figure>
</li>
<li><p><strong>在 default 情况下返回旧的 state。</strong>遇到未知的 action 时，一定要返回旧的 <code>state</code>。if you don’t, you’ll end up having your reducer return undefined (and lose your state).</p>
<p><strong>我们可以看下源代码为什么必须返回一个state;如下所示，如果reducer函数没有显式返回state,那么 currentReducer()函数执行之后，函数的默认返回值是undefined;这就是为什么我们会失去state的根本原因；</strong></p>
<p>在使用combineReducers方法时，它也会检测你的函数写的是否标准。如果不标准，那么会抛出一个大大的错误！！</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// currentState 是当前的State，currentReducer 是当前的Reducer</span></div><div class="line">currentState = currentReducer(currentState, action);</div></pre></td></tr></table></figure>
<p>​</p>
</li>
<li><p><strong>注意每个 reducer 只负责管理全局 state 中它负责的一部分。每个 reducer 的 state 参数都不同，分别对应它管理的那部分 state 数据</strong></p>
</li>
</ol>
<h3 id="3-store"><a href="#3-store" class="headerlink" title="3 store"></a>3 store</h3><p>store就是将action和reducers联系到一起的<strong>对象</strong>；注意也就是一个<strong>javascript对象</strong>，这个对象里面有一些方法；</p>
<ul>
<li>维持应用的 state；</li>
<li>提供 <a href="http://cn.redux.js.org/docs/api/Store.html#getState" target="_blank" rel="external"><code>getState()</code></a> 方法获取 state；</li>
<li>提供 <a href="http://cn.redux.js.org/docs/api/Store.html#dispatch" target="_blank" rel="external"><code>dispatch(action)</code></a> 唯一一个方法更新 state；action是一个对象，可以直接传入对象，也可以传入定义action</li>
<li>通过 <a href="http://cn.redux.js.org/docs/api/Store.html#subscribe" target="_blank" rel="external"><code>subscribe(listener)</code></a> 注册监听器，每当state状态改变的时候，注册的函数就会被调用</li>
<li>通过 <a href="http://cn.redux.js.org/docs/api/Store.html#subscribe" target="_blank" rel="external"><code>replaceReducer(listener)</code></a> 返回的函数注销监听器。用于替换创建store的reducer</li>
<li><strong>Redux 应用只有一个单一的 store</strong>。当需要拆分数据处理逻辑时，你应该使用 <a href="http://cn.redux.js.org/docs/basics/Reducers.html#splitting-reducers" target="_blank" rel="external">reducer 组合</a> 而不是创建多个 store。</li>
</ul>
<p>官方定义:In the previous sections, we defined the actions that represent the facts about “what happened” and the reducers that update the state according to those actions.</p>
<p>The Store is the object that brings them together. The store has the following responsibilities:</p>
<ul>
<li>Holds application state;</li>
<li>Allows access to state via getState();</li>
<li>Allows state to be updated via dispatch(action);</li>
<li>Registers listeners via subscribe(listener).</li>
</ul>
<p>如何创建一个store?</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//创建Store非常简单。createStore 有两个参数，Reducer 和 initialState。</span></div><div class="line"><span class="keyword">let</span> store = createStore(rootReducers, initialState);</div></pre></td></tr></table></figure>
<p><strong><code>...</code>是对象扩展运算符，会将对象展开</strong> , 同时也会将数组展开</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">'redux'</span></div><div class="line"><span class="keyword">var</span> reducer = <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'Reducer was called with args'</span>, args)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> store_1 = createStore(reducer) ;<span class="comment">//</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//创建的store_1打印输出如下,可以看出store_1是一个对象，该对象有如下的方法(函数);</span></div><div class="line">&#123; <span class="attr">dispatch</span>: [<span class="built_in">Function</span>: dispatch],</div><div class="line">  <span class="attr">subscribe</span>: [<span class="built_in">Function</span>: subscribe],</div><div class="line">  <span class="attr">getState</span>: [<span class="built_in">Function</span>: getState],</div><div class="line">  <span class="attr">replaceReducer</span>: [<span class="built_in">Function</span>: replaceReducer] &#125;</div></pre></td></tr></table></figure>
<p>当我们创建reduex实例的时候，需要传递一个函数，也就是说createStore( reducer ,optional) 第一个参数需要传入函数处理逻辑；reducer是一个函数，reducer接受两个参数，第一个是state 第二是 action；</p>
<p> <strong>当执行createStore的时候，传入的第一个函数会被执行</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">addItem</span>(<span class="params">text</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">type</span>: types.ADD_ITEM,</div><div class="line">    text</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 新增数据</span></div><div class="line">store.dispatch(addItem(<span class="string">'Read the docs'</span>));</div></pre></td></tr></table></figure>
<p>看下dispatch底层是如何实现的:dispatch 核心源码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">dispatch</span>(<span class="params">action</span>) </span>&#123;</div><div class="line">  <span class="comment">// currentReducer 是当前的Reducer</span></div><div class="line">  currentState = currentReducer(currentState, action);</div><div class="line"></div><div class="line">  listeners.slice().forEach(<span class="function"><span class="keyword">function</span> (<span class="params">listener</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> listener();</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">  <span class="keyword">return</span> action;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>可以看到其实就是把当前的Reducer执行了。并且传入State和Action。</p>
<p><strong>dispatch异步实现</strong></p>
<p>subscribe(listener) 可以使我们的state状态改变的时候，将数据的变化反映到视图view层</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> &#123;createStore,combineReducers&#125; <span class="keyword">from</span> <span class="string">'Redux'</span>;</div><div class="line"></div><div class="line"><span class="keyword">var</span> itemReducers = <span class="function"><span class="keyword">function</span>(<span class="params">state = [],action</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'itemsReducers was called with '</span>,state,<span class="string">'and action'</span>,action);</div><div class="line"></div><div class="line">    <span class="keyword">switch</span>(action.type)&#123;</div><div class="line">        <span class="keyword">case</span> <span class="string">'ADD_ITEM'</span> : </div><div class="line">            <span class="keyword">return</span> [</div><div class="line">                ...state,</div><div class="line">                action.item</div><div class="line">            ]</div><div class="line">        <span class="keyword">default</span> :</div><div class="line">            <span class="keyword">return</span> state ;   </div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> reducers = combineReducers(&#123;<span class="attr">items</span> : itemReducers &#125;);</div><div class="line"></div><div class="line"><span class="keyword">var</span> store_0 = createStore(reducers);</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(store_0.getState());</div><div class="line"></div><div class="line">store_0.subscribe(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="comment">//这个事件只有在state改变了才会触发，此时不会触发，因为还没有改变state,没有传入action</span></div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'store_0 has been updated,lasted store state '</span>,store_0.getState());</div><div class="line">    <span class="comment">//update your view </span></div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">var</span> addItemActionCreator = <span class="function"><span class="keyword">function</span>(<span class="params">item</span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        <span class="attr">type</span> : <span class="string">'ADD_ITEM'</span>,</div><div class="line">        item </div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">store_0.dispatch(addItemActionCreator(&#123;<span class="attr">id</span>:<span class="number">4</span>,<span class="attr">description</span>:<span class="string">'anything'</span>&#125;));</div><div class="line"></div><div class="line"><span class="comment">//这一行代码执行之后，上面的subscribe函数才会被触发</span></div></pre></td></tr></table></figure>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/04/24/189jsx-in-depth/" rel="next" title="jsx in depth">
                <i class="fa fa-chevron-left"></i> jsx in depth
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/04/25/196npm/" rel="prev" title="npm">
                npm <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>

          
          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar.jpg"
               alt="JiM-W" />
          <p class="site-author-name" itemprop="name">JiM-W</p>
           
              <p class="site-description motion-element" itemprop="description">keep fighting！</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">181</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">51</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">83</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-action-创建函数-仅仅是一个函数，作用是用来生成一个action，action本质是一个javascript对象"><span class="nav-number">1.</span> <span class="nav-text">1   action 创建函数     仅仅是一个函数，作用是用来生成一个action，action本质是一个javascript对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-reducer"><span class="nav-number">2.</span> <span class="nav-text">2 reducer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-store"><span class="nav-number">3.</span> <span class="nav-text">3 store</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">JiM-W</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  



  
  

  

  

  

  


  

</body>
</html>
