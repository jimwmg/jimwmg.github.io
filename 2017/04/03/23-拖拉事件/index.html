<!DOCTYPE html>
<html>
  <!-- Html Head Tag-->
  <head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="JiM-W">
  <!-- Open Graph Data -->
  <meta property="og:title" content="JiM-W"/>
  <meta property="og:description" content="" />
  <meta property="og:site_name" content="JiM-W"/>
  <meta property="og:type" content="website" />
  <meta property="og:image" content="http://yoursite.comundefined"/>
  
    <link rel="alternate" href="/atom.xml" title="JiM-W" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  

  <!-- Site Title -->
  <title>JiM-W</title>

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <!-- Custom CSS -->
  
  <link rel="stylesheet" href="/css/style.light.css">

  <!-- Google Analytics -->
  

</head>

  <body>
    <!-- Page Header -->


<header class="site-header header-background" style="background-image: url(/img/default-banner-dark.jpg)">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="page-title with-background-image">
          <p class="title">无标题文章</p>
          <p class="subtitle"></p>
        </div>
        <div class="site-menu with-background-image">
          <ul>
            
              <li>
                <a href="/">
                  
                  Home
                  
                </a>
              </li>
            
              <li>
                <a href="/archives">
                  
                  Archives
                  
                </a>
              </li>
            
              <li>
                <a href="https://github.com/levblanc">
                  
                  Github
                  
                </a>
              </li>
            
              <li>
                <a href="mailto:levblanc@163.com">
                  
                  Email
                  
                </a>
              </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>


<article>
  <div class="container typo">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-info text-muted">
          
            <!-- Author -->
            <span class="author info">By JiM-W</span>
          
          <!-- Date -->
          <span class="date-time info">On
            <span class="date">2017-04-03</span>
            <span class="time">22:59:01</span>
          </span>
          
        </div>
        <!-- Tags -->
        
        <!-- Post Main Content -->
        <div class="post-content">
          <h2 id="拖拉事件"><a href="#拖拉事件" class="headerlink" title="拖拉事件"></a>拖拉事件</h2><p>拖拉指的是，用户在某个对象上按下鼠标键不放，拖动它到另一个位置，然后释放鼠标键，将该对象放在那里。</p>
<p>拖拉的对象有好几种，包括Element节点、图片、链接、选中的文字等等。在HTML网页中，除了Element节点默认不可以拖拉，其他（图片、链接、选中的文字）都是可以直接拖拉的。为了让Element节点可拖拉，可以将该节点的draggable属性设为true。<strong>注意draggable 是元素的属性，并不是元素的样式属性，设置在CSS样式表或者<style>标签中是没有用的</strong>  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;div draggable=&quot;true&quot;&gt;</div><div class="line">  此区域可拖拉</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure>
<p>draggable属性可用于任何Element节点，但是图片（img元素）和链接（a元素）不加这个属性，就可以拖拉。对于它们，用到这个属性的时候，往往是将其设为false，防止拖拉。</p>
<p>注意，一旦某个Element节点的draggable属性设为true，就无法再用鼠标选中该节点内部的文字或子节点了。</p>
<h3 id="事件种类"><a href="#事件种类" class="headerlink" title="事件种类"></a>事件种类</h3><p>当Element节点或选中的文本被拖拉时，就会持续触发拖拉事件，包括以下一些事件。</p>
<ul>
<li><strong>drag事件</strong>：拖拉过程中，在被拖拉的节点上持续触发。</li>
<li><strong>dragstart事件</strong>：拖拉开始时在被拖拉的节点上触发，该事件的target属性是被拖拉的节点。通常应该在这个事件的监听函数中，指定拖拉的数据。</li>
<li><strong>dragend事件</strong>：拖拉结束时（释放鼠标键或按下escape键）在被拖拉的节点上触发，该事件的target属性是被拖拉的节点。它与dragStart事件，在同一个节点上触发。不管拖拉是否跨窗口，或者中途被取消，dragend事件总是会触发的。</li>
<li><strong>dragenter事件</strong>：拖拉进入当前节点时，在当前节点上触发，该事件的target属性是当前节点。通常应该在这个事件的监听函数中，指定是否允许在当前节点放下（drop）拖拉的数据。如果当前节点没有该事件的监听函数，或者监听函数不执行任何操作，就意味着不允许在当前节点放下数据。在视觉上显示拖拉进入当前节点，也是在这个事件的监听函数中设置。</li>
<li><strong>dragover事件</strong>：拖拉到当前节点上方时，在当前节点上<strong>持续</strong>触发，该事件的target属性是当前节点。该事件与dragenter事件基本类似，默认会重置当前的拖拉事件的效果（DataTransfer对象的dropEffect属性）为none，即不允许放下被拖拉的节点，所以如果允许在当前节点drop数据，通常会使用preventDefault方法，取消重置拖拉效果为none。</li>
<li><strong>dragleave事件</strong>：拖拉离开当前节点范围时，在当前节点上触发，该事件的target属性是当前节点。在视觉上显示拖拉离开当前节点，就在这个事件的监听函数中设置。</li>
<li><strong>drop事件</strong>：被拖拉的节点或选中的文本，释放到目标节点时，在目标节点上触发。注意，如果当前节点不允许drop，即使在该节点上方松开鼠标键，也不会触发该事件。如果用户按下Escape键，取消这个操作，也不会触发该事件。该事件的监听函数负责取出拖拉数据，并进行相关处理。</li>
</ul>
<p>关于拖拉事件，有以下几点注意事项。</p>
<ul>
<li>拖拉过程只触发以上这些拖拉事件，尽管鼠标在移动，但是鼠标事件不会触发。</li>
<li>将文件从操作系统拖拉进浏览器，不会触发dragStart和dragend事件。</li>
<li>dragenter和dragover事件的监听函数，用来指定可以放下（drop）拖拉的数据。由于网页的大部分区域不适合作为drop的目标节点，所以这两个事件的默认设置为当前节点不允许drop。如果想要在目标节点上drop拖拉的数据，首先必须阻止这两个事件的默认行为，或者取消这两个事件。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;div ondragover=&quot;return false&quot;&gt;</div><div class="line">&lt;div ondragover=&quot;event.preventDefault()&quot;&gt;</div></pre></td></tr></table></figure>
<p>上面代码中，如果不取消拖拉事件或者阻止默认行为，就不可能在div节点上drop被拖拉的节点。</p>
<p>拖拉事件用一个DragEvent对象表示，该对象继承MouseEvent对象，因此也就继承了UIEvent和Event对象。DragEvent对象只有一个独有的属性DataTransfer，其他都是继承的属性。DataTransfer属性用来读写拖拉事件中传输的数据，详见下文《DataTransfer对象》的部分。</p>
<p>下面的例子展示，如何动态改变被拖动节点的背景色。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">div.addEventListener(&quot;dragstart&quot;, function(e) &#123;</div><div class="line">  this.style.backgroundColor = &quot;red&quot;;</div><div class="line">&#125;, false);</div><div class="line">div.addEventListener(&quot;dragend&quot;, function(e) &#123;</div><div class="line">  this.style.backgroundColor = &quot;green&quot;;</div><div class="line">&#125;, false);</div></pre></td></tr></table></figure>
<p>上面代码中，div节点被拖动时，背景色会变为红色，拖动结束，又变回绿色。</p>
<p>下面是一个例子，显示如何实现将一个节点从当前父节点，拖拉到另一个父节点中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line">// HTML代码为</div><div class="line">// &lt;div class=&quot;dropzone&quot;&gt;</div><div class="line">//    &lt;div id=&quot;draggable&quot; draggable=&quot;true&quot;&gt;</div><div class="line">//       该节点可拖拉</div><div class="line">//    &lt;/div&gt;</div><div class="line">// &lt;/div&gt;</div><div class="line">// &lt;div class=&quot;dropzone&quot;&gt;&lt;/div&gt;</div><div class="line">// &lt;div class=&quot;dropzone&quot;&gt;&lt;/div&gt;</div><div class="line">// &lt;div class=&quot;dropzone&quot;&gt;&lt;/div&gt;</div><div class="line"></div><div class="line">// 被拖拉节点</div><div class="line">var dragged;</div><div class="line"></div><div class="line">document.addEventListener(&quot;dragstart&quot;, function( event ) &#123;</div><div class="line">  // 保存被拖拉节点</div><div class="line">  dragged = event.target;</div><div class="line">  // 被拖拉节点的背景色变透明</div><div class="line">  event.target.style.opacity = 0.5;</div><div class="line">  // 兼容Firefox</div><div class="line">  event.dataTransfer.setData(&apos;text/plain&apos;, &apos;anything&apos;);</div><div class="line">&#125;, false);</div><div class="line"></div><div class="line">document.addEventListener(&apos;dragend&apos;, function( event ) &#123;</div><div class="line">  // 被拖拉节点的背景色恢复正常</div><div class="line">  event.target.style.opacity = &apos;&apos;;</div><div class="line">&#125;, false);</div><div class="line"></div><div class="line">document.addEventListener(&apos;dragover&apos;, function( event ) &#123;</div><div class="line">  // 防止拖拉效果被重置，允许被拖拉的节点放入目标节点</div><div class="line">  event.preventDefault();</div><div class="line">&#125;, false);</div><div class="line"></div><div class="line">document.addEventListener(&apos;dragenter&apos;, function( event ) &#123;</div><div class="line">  // 目标节点的背景色变紫色</div><div class="line">  // 由于该事件会冒泡，所以要过滤节点</div><div class="line">  if ( event.target.className == &apos;dropzone&apos; ) &#123;</div><div class="line">    event.target.style.background = &apos;purple&apos;;</div><div class="line">  &#125;</div><div class="line">&#125;, false);</div><div class="line"></div><div class="line">document.addEventListener(&apos;dragleave&apos;, function( event ) &#123;</div><div class="line">  // 目标节点的背景色恢复原样</div><div class="line">  if ( event.target.className == &apos;dropzone&apos; ) &#123;</div><div class="line">    event.target.style.background = &quot;&quot;;</div><div class="line">  &#125;</div><div class="line">&#125;, false);</div><div class="line"></div><div class="line">document.addEventListener(&apos;drop&apos;, function( event ) &#123;</div><div class="line">  // 防止事件默认行为（比如某些Elment节点上可以打开链接）</div><div class="line">  event.preventDefault();</div><div class="line">  if ( event.target.className === &apos;dropzone&apos; ) &#123;</div><div class="line">    // 恢复目标节点背景色</div><div class="line">    event.target.style.background = &apos;&apos;;</div><div class="line">    // 将被拖拉节点插入目标节点</div><div class="line">    dragged.parentNode.removeChild( dragged );</div><div class="line">    event.target.appendChild( dragged );</div><div class="line">  &#125;</div><div class="line">&#125;, false);</div></pre></td></tr></table></figure>
<h3 id="DataTransfer对象概述"><a href="#DataTransfer对象概述" class="headerlink" title="DataTransfer对象概述"></a>DataTransfer对象概述</h3><p>所有的拖拉事件都有一个dataTransfer属性，用来保存需要传递的数据。这个属性的值是一个DataTransfer对象。</p>
<p>拖拉的数据保存两方面的数据：数据的种类（又称格式）和数据的值。数据的种类是一个MIME字符串，比如 text/plain或者image/jpeg，数据的值是一个字符串。一般来说，如果拖拉一段文本，则数据默认就是那段文本；如果拖拉一个链接，则数据默认就是链接的URL。</p>
<p>当拖拉事件开始的时候，可以提供数据类型和数据值；在拖拉过程中，通过dragenter和dragover事件的监听函数，检查数据类型，以确定是否允许放下（drop）被拖拉的对象。比如，在只允许放下链接的区域，检查拖拉的数据类型是否为text/uri-list。</p>
<p>发生drop事件时，监听函数取出拖拉的数据，对其进行处理。</p>
<h3 id="DataTransfer对象的属性"><a href="#DataTransfer对象的属性" class="headerlink" title="DataTransfer对象的属性"></a>DataTransfer对象的属性</h3><p>DataTransfer对象有以下属性。</p>
<p><strong>（1）dropEffect</strong></p>
<p>dropEffect属性设置放下（drop）被拖拉节点时的效果，可能的值包括copy（复制被拖拉的节点）、move（移动被拖拉的节点）、link（创建指向被拖拉的节点的链接）、none（无法放下被拖拉的节点）。设置除此以外的值，都是无效的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">target.addEventListener(&apos;dragover&apos;, function(e) &#123;</div><div class="line">  e.preventDefault();</div><div class="line">  e.stopPropagation();</div><div class="line">  e.dataTransfer.dropEffect = &apos;copy&apos;;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>dropEffect属性一般在dragenter和dragover事件的监听函数中设置，对于dragstart、drag、dragleave这三个事件，该属性不起作用。进入目标节点后，拖拉行为会初始化成用户设定的效果，用户可以通过按下Shift键和Control键，改变初始设置，在copy、move、link三种效果中切换。</p>
<p>鼠标箭头会根据dropEffect属性改变形状，提示目前正处于哪一种效果。这意味着，通过鼠标就能判断是否可以在当前节点drop被拖拉的节点。</p>
<p><strong>（2）effectAllowed</strong></p>
<p>effectAllowed属性设置本次拖拉中允许的效果，可能的值包括copy（复制被拖拉的节点）、move（移动被拖拉的节点）、link（创建指向被拖拉节点的链接）、copyLink（允许copy或link）、copyMove（允许copy或move）、linkMove（允许link或move）、all（允许所有效果）、none（无法放下被拖拉的节点）、uninitialized（默认值，等同于all）。如果某种效果是不允许的，用户就无法在目标节点中达成这种效果。</p>
<p>dragstart事件的监听函数，可以设置被拖拉节点允许的效果；dragenter和dragover事件的监听函数，可以设置目标节点允许的效果。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">event.dataTransfer.effectAllowed = &quot;copy&quot;;</div></pre></td></tr></table></figure>
<p>dropEffect属性和effectAllowed属性，往往配合使用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">event.dataTransfer.effectAllowed = &quot;copyMove&quot;;</div><div class="line">event.dataTransfer.dropEffect = &quot;copy&quot;;</div></pre></td></tr></table></figure>
<p>上面代码中，copy是指定的效果，但是可以通过Shift或Ctrl键（根据平台而定），将效果切换成move。</p>
<p>只要dropEffect属性和effectAllowed属性之中，有一个为none，就无法在目标节点上完成drop操作。</p>
<p><strong>（3）files</strong></p>
<p>files属性是一个FileList对象，包含一组本地文件，可以用来在拖拉操作中传送。如果本次拖拉不涉及文件，则属性为空的FileList对象。</p>
<p>下面就是一个接收拖拉文件的例子。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">// HTML代码为</div><div class="line">// &lt;div id=&quot;output&quot; style=&quot;min-height: 200px;border: 1px solid black;&quot;&gt;</div><div class="line">//   文件拖拉到这里</div><div class="line">// &lt;/div&gt;</div><div class="line"></div><div class="line">var div = document.getElementById(&apos;output&apos;);</div><div class="line"></div><div class="line">div.addEventListener(&quot;dragenter&quot;, function( event ) &#123;</div><div class="line">  div.textContent = &apos;&apos;;</div><div class="line">  event.stopPropagation();</div><div class="line">  event.preventDefault();</div><div class="line">&#125;, false);</div><div class="line"></div><div class="line">div.addEventListener(&quot;dragover&quot;, function( event ) &#123;</div><div class="line">  event.stopPropagation();</div><div class="line">  event.preventDefault();</div><div class="line">&#125;, false);</div><div class="line"></div><div class="line">div.addEventListener(&quot;drop&quot;, function( event ) &#123;</div><div class="line">  event.stopPropagation();</div><div class="line">  event.preventDefault();</div><div class="line">  var files = event.dataTransfer.files;</div><div class="line">  for (var i = 0; i &lt; files.length; i++) &#123;</div><div class="line">    div.textContent += files[i].name + &apos; &apos; + files[i].size + &apos;字节\n&apos;;</div><div class="line">  &#125;</div><div class="line">&#125;, false);</div></pre></td></tr></table></figure>
<p>上面代码中，通过files属性读取拖拉文件的信息。如果想要读取文件内容，就要使用FileReader对象。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">div.addEventListener(&apos;drop&apos;, function(e) &#123;</div><div class="line">  e.preventDefault();</div><div class="line">  e.stopPropagation();</div><div class="line"></div><div class="line">  var fileList = e.dataTransfer.files;</div><div class="line">  if (fileList.length &gt; 0) &#123;</div><div class="line">    var file = fileList[0];</div><div class="line">    var reader = new FileReader();</div><div class="line">    reader.onloadend = function(e) &#123;</div><div class="line">      if (e.target.readyState == FileReader.DONE) &#123;</div><div class="line">        var content = reader.result;</div><div class="line">        contentDiv.innerHTML = &quot;File: &quot; + file.name + &quot;\n\n&quot; + content;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    reader.readAsBinaryString(file);</div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p><strong>（4）types</strong></p>
<p>types属性是一个数组，保存每一次拖拉的数据格式，比如拖拉文件，则格式信息就为File。</p>
<p>下面是一个例子，通过检查dataTransfer属性的类型，决定是否允许在当前节点执行drop操作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">function contains(list, value)&#123;</div><div class="line">  for( var i = 0; i &lt; list.length; ++i )&#123;</div><div class="line">    if(list[i] === value) return true;</div><div class="line">  &#125;</div><div class="line">  return false;</div><div class="line">&#125;</div><div class="line"></div><div class="line">function doDragOver(event)&#123;</div><div class="line">  var isLink = contains( event.dataTransfer.types, &quot;text/uri-list&quot;);</div><div class="line">  if (isLink) event.preventDefault();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面代码中，只有当被拖拉的节点是一个链接时，才允许在当前节点放下。</p>
<h3 id="DataTransfer对象的方法"><a href="#DataTransfer对象的方法" class="headerlink" title="DataTransfer对象的方法"></a>DataTransfer对象的方法</h3><p>DataTransfer对象有以下方法。</p>
<p><strong>（1）setData()</strong></p>
<p>setData方法用来设置事件所带有的指定类型的数据。它接受两个参数，第一个是数据类型，第二个是具体数据。如果指定的类型在现有数据中不存在，则该类型将写入types属性；如果已经存在，在该类型的现有数据将被替换。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">event.dataTransfer.setData(&quot;text/plain&quot;, &quot;Text to drag&quot;);</div></pre></td></tr></table></figure>
<p>上面代码为事件加入纯文本格式的数据。</p>
<p>如果拖拉文本框或者拖拉选中的文本，会默认将文本数据添加到dataTransfer属性，不用手动指定。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;div draggable=&quot;true&quot; ondragstart=&quot;</div><div class="line">  event.dataTransfer.setData(&apos;text/plain&apos;, &apos;bbb&apos;)&quot;&gt;</div><div class="line">  aaa</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure>
<p>上面代码中，拖拉数据实际上是bbb，而不是aaa。</p>
<p>下面是添加其他类型的数据。由于text/plain是最普遍支持的格式，为了保证兼容性，建议最后总是将数据保存一份纯文本的格式。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">var dt = event.dataTransfer;</div><div class="line"></div><div class="line">// 添加链接</div><div class="line">dt.setData(&quot;text/uri-list&quot;, &quot;http://www.example.com&quot;);</div><div class="line">dt.setData(&quot;text/plain&quot;, &quot;http://www.example.com&quot;);</div><div class="line">// 添加HTML代码</div><div class="line">dt.setData(&quot;text/html&quot;, &quot;Hello there, &lt;strong&gt;stranger&lt;/strong&gt;&quot;);</div><div class="line">dt.setData(&quot;text/plain&quot;, &quot;Hello there, &lt;strong&gt;stranger&lt;/strong&gt;&quot;);</div><div class="line">// 添加图像的URL</div><div class="line">dt.setData(&quot;text/uri-list&quot;, imageurl);</div><div class="line">dt.setData(&quot;text/plain&quot;, imageurl);</div></pre></td></tr></table></figure>
<p>可以一次提供多种格式的数据。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">var dt = event.dataTransfer;</div><div class="line">dt.setData(&quot;application/x-bookmark&quot;, bookmarkString);</div><div class="line">dt.setData(&quot;text/uri-list&quot;, &quot;http://www.example.com&quot;);</div><div class="line">dt.setData(&quot;text/plain&quot;, &quot;http://www.example.com&quot;);</div></pre></td></tr></table></figure>
<p>上面代码中，通过在同一个事件上面，存放三种类型的数据，使得拖拉事件可以在不同的对象上面，drop不同的值。注意，第一种格式是一个自定义格式，浏览器默认无法读取，这意味着，只有某个部署了特定代码的节点，才可能drop（读取到）这个数据。</p>
<p><strong>（2）getData()</strong></p>
<p>getData方法接受一个字符串（表示数据类型）作为参数，返回事件所带的指定类型的数据（通常是用setData方法添加的数据）。如果指定类型的数据不存在，则返回空字符串。通常只有drop事件触发后，才能取出数据。如果取出另一个域名存放的数据，将会报错。</p>
<p>下面是一个drop事件的监听函数，用来取出指定类型的数据。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">function onDrop(event)&#123;</div><div class="line">  var data = event.dataTransfer.getData(&quot;text/plain&quot;);</div><div class="line">  event.target.textContent = data;</div><div class="line">  event.preventDefault();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面代码取出拖拉事件的文本数据，将其替换成当前节点的文本内容。注意，这时还必须取消浏览器的默认行为，因为假如用户拖拉的是一个链接，浏览器默认会在当前窗口打开这个链接。</p>
<p>getData方法返回的是一个字符串，如果其中包含多项数据，就必须手动解析。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">function doDrop(event)&#123;</div><div class="line">  var lines = event.dataTransfer.getData(&quot;text/uri-list&quot;).split(&quot;\n&quot;);</div><div class="line">  for (let line of lines) &#123;</div><div class="line">    let link = document.createElement(&quot;a&quot;);</div><div class="line">    link.href = line;</div><div class="line">    link.textContent = line;</div><div class="line">    event.target.appendChild(link);</div><div class="line">  &#125;</div><div class="line">  event.preventDefault();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面代码中，getData方法返回的是一组链接，就必须自行解析。</p>
<p>类型值指定为URL，可以取出第一个有效链接。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">var link = event.dataTransfer.getData(&quot;URL&quot;);</div></pre></td></tr></table></figure>
<p>下面是一次性取出多种类型的数据。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">function doDrop(event)&#123;</div><div class="line">  var types = event.dataTransfer.types;</div><div class="line">  var supportedTypes = [&quot;text/uri-list&quot;, &quot;text/plain&quot;];</div><div class="line">  types = supportedTypes.filter(function (value) types.includes(value));</div><div class="line">  if (types.length)</div><div class="line">    var data = event.dataTransfer.getData(types[0]);</div><div class="line">  event.preventDefault();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>（3）clearData()</strong></p>
<p>clearData方法接受一个字符串（表示数据类型）作为参数，删除事件所带的指定类型的数据。如果没有指定类型，则删除所有数据。如果指定类型不存在，则原数据不受影响。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">event.dataTransfer.clearData(&quot;text/uri-list&quot;);</div></pre></td></tr></table></figure>
<p>上面代码清除事件所带的URL数据。</p>
<p><strong>（4）setDragImage()</strong></p>
<p>拖动过程中（dragstart事件触发后），浏览器会显示一张图片跟随鼠标一起移动，表示被拖动的节点。这张图片是自动创造的，通常显示为被拖动节点的外观，不需要自己动手设置。setDragImage方法可以用来自定义这张图片，它接受三个参数，第一个是img图片元素或者canvas元素，如果省略或为null则使用被拖动的节点的外观，第二个和第三个参数为鼠标相对于该图片左上角的横坐标和右坐标。</p>
<p>下面是一个例子。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">// HTML代码为</div><div class="line">// &lt;div id=&quot;drag-with-image&quot; class=&quot;dragdemo&quot; draggable=&quot;true&quot;&gt;</div><div class="line">     drag me</div><div class="line">// &lt;/div&gt;</div><div class="line"></div><div class="line">var div = document.getElementById(&quot;drag-with-image&quot;);</div><div class="line">div.addEventListener(&quot;dragstart&quot;, function(e) &#123;</div><div class="line">  var img = document.createElement(&quot;img&quot;);</div><div class="line">  img.src = &quot;http://path/to/img&quot;;</div><div class="line">  e.dataTransfer.setDragImage(img, 0, 0);</div><div class="line">&#125;, false);</div></pre></td></tr></table></figure></style></strong></p>
        </div>
      </div>
    </div>
  </div>
</article>



    <!-- Footer -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <p class="copyright text-muted">
          Theme By <a target="_blank" href="https://github.com/levblanc">Levblanc.</a>
          Inspired By <a target="_blank" href="https://github.com/klugjo/hexo-theme-clean-blog">Clean Blog.</a>
        <p class="copyright text-muted">
          Powered By <a target="_blank" href="https://hexo.io/">Hexo.</a>
        </p>
      </div>
    </div>
  </div>
</footer>


    <!-- After Footer Scripts -->
<script src="/js/highlight.pack.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function(event) {
    var codeBlocks = Array.prototype.slice.call(document.getElementsByTagName('pre'))
    codeBlocks.forEach(function(block, index) {
      hljs.highlightBlock(block);
    });
  });
</script>

  </body>
</html>

