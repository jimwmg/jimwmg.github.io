<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="keep fighting！">
<meta property="og:type" content="website">
<meta property="og:title" content="JiM-W">
<meta property="og:url" content="http://yoursite.com/page/5/index.html">
<meta property="og:site_name" content="JiM-W">
<meta property="og:description" content="keep fighting！">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="JiM-W">
<meta name="twitter:description" content="keep fighting！">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/5/"/>





  <title> JiM-W </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">JiM-W</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">keep Moving</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/17/174Angular-Js-MVVM-双向数据绑定如何实现/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/17/174Angular-Js-MVVM-双向数据绑定如何实现/" itemprop="url">
                  Angular Js MVVM 双向数据绑定如何实现
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-17T12:36:00+08:00">
                2016-11-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javascript/" itemprop="url" rel="index">
                    <span itemprop="name">javascript</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-我们先来看一个简单的双向数据绑定的demo"><a href="#1-我们先来看一个简单的双向数据绑定的demo" class="headerlink" title="1 我们先来看一个简单的双向数据绑定的demo"></a>1 我们先来看一个简单的双向数据绑定的demo</h3><p>1.1点击按钮，数据的变化会实现在页面上显示出来</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-app</span> = <span class="string">"myApp"</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span> = <span class="string">'myCtrl'</span> &gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>  <span class="attr">ng-bind</span> = <span class="string">'count'</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">sapn</span> <span class="attr">ng-click</span> =<span class="string">' increase() '</span> &gt;</span>icrease<span class="tag">&lt;/<span class="name">sapn</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../libs/angular.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="keyword">var</span> app = angular.module(<span class="string">'myApp'</span>,[]);</div><div class="line">    app.controller(<span class="string">'myCtrl'</span>,[<span class="string">'$scope'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">$scope</span>)</span>&#123;</div><div class="line">        $scope.count = <span class="number">1</span> ;</div><div class="line">        $scope.increase = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            $scope.count++;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;])   </div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div></pre></td></tr></table></figure>
<p>1.2 angular底层是如何实现这种数据的双向绑定的呢？(参阅angular沉思录)</p>
<p>铺垫一点基础知识</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">ng-click</span> = <span class="string">'inc1'</span> <span class="attr">id</span> = <span class="string">'btn'</span>&gt;</span>increase<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="keyword">var</span> ret = <span class="built_in">document</span>.querySelector(<span class="string">'#btn'</span>).getAttribute(<span class="string">'ng-click'</span>);</div><div class="line">    <span class="built_in">console</span>.log(ret);<span class="comment">//inc1</span></div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">typeof</span> ret);<span class="comment">//string</span></div><div class="line">    <span class="built_in">console</span>.log(<span class="built_in">window</span>[ret]);<span class="comment">//function inc1()&#123;&#125;函数</span></div><div class="line">    <span class="built_in">window</span>[ret]();<span class="comment">//inc1被执行了</span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">inc1</span> (<span class="params"></span>)</span>&#123;  <span class="comment">//这个相当于给window对象添加一个属性，属性名是 inc1</span></div><div class="line">        counter++ ;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'inc1倍执行了'</span>);</div><div class="line">    &#125;</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>two-way binding<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">"init()"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">ng-click</span>=<span class="string">"inc"</span>&gt;</span></div><div class="line">    increase 1</div><div class="line"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">ng-click</span>=<span class="string">"inc2"</span>&gt;</span></div><div class="line">    increase 2</div><div class="line"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"color:red"</span> <span class="attr">ng-bind</span>=<span class="string">"counter"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"color:blue"</span> <span class="attr">ng-bind</span>=<span class="string">"counter"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"color:green"</span> <span class="attr">ng-bind</span>=<span class="string">"counter"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line"></div><div class="line">    <span class="comment">/* 数据模型区开始 */</span></div><div class="line">    <span class="keyword">var</span> counter = <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">inc</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"1"</span>);</div><div class="line">        counter++;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">inc2</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"2"</span>);</div><div class="line">        counter+=<span class="number">2</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">/* 数据模型区结束 */</span></div><div class="line"></div><div class="line">    <span class="comment">/* 绑定关系区开始 */</span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        bind();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">bind</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> list = <span class="built_in">document</span>.querySelectorAll(<span class="string">"[ng-click]"</span>);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;list.length; i++) &#123;</div><div class="line">            list[i].onclick = (<span class="function"><span class="keyword">function</span>(<span class="params">index</span>) </span>&#123;</div><div class="line">                <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                    <span class="built_in">window</span>[  list[index].getAttribute(<span class="string">"ng-click"</span>)  ]();<span class="comment">//inc函数会执行</span></div><div class="line">                    apply();</div><div class="line">                &#125;;</div><div class="line">            &#125;)(i);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">apply</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> list = <span class="built_in">document</span>.querySelectorAll(<span class="string">"[ng-bind='counter']"</span>);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;list.length; i++) &#123;</div><div class="line">            list[i].innerHTML = counter;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">/* 绑定关系区结束 */</span></div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="2-angular中的-apply-digest"><a href="#2-angular中的-apply-digest" class="headerlink" title="2 angular中的\$apply   \$digest"></a>2 angular中的\$apply   \$digest</h3><p>首先我们来看下它们的作用，当我们在angularjs之外的上下文改变了model的时候，如何让angular进行页面的刷新呢？</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-app</span>=<span class="string">"test"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">"CounterCtrl"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">myclick</span>&gt;</span>increase<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-bind</span>=<span class="string">"counter"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../libs/angular.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="keyword">var</span> app = angular.module(<span class="string">"test"</span>, []);</div><div class="line"></div><div class="line">    app.directive(<span class="string">"myclick"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">scope, element, attr</span>) </span>&#123;</div><div class="line">            element.on(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                scope.counter++;</div><div class="line">                <span class="built_in">console</span>.log(scope.counter);</div><div class="line">            &#125;);</div><div class="line">        &#125;;</div><div class="line">    &#125;);</div><div class="line">    app.controller(<span class="string">"CounterCtrl"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$scope</span>) </span>&#123;</div><div class="line">        $scope.counter = <span class="number">0</span>;</div><div class="line">    &#125;);</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p>这个时候我们是通过javascript处理函数改变了scope的counter值，此时会发现view视图上并不会跟随变化，但是控制打印出来的却是变化了的值。这是因为</p>
<ul>
<li>angularjs只负责发生在angularjs上下文中的对于models 的更改会做出自动的回应(也就是$apply方法中对于model的更改orangular内置的其他服务)</li>
<li>对于angular上下之外的其他地方修改的model,这个时候就需要手动调用$apply来触发一轮\$digest检测</li>
<li>build-in的一些 ng-event指令以及ng-model  $timeout  \$interval 等都会自动触发一次\$digest循环</li>
</ul>
<p>$timeout(fn,delay,optional,pass)  第一个参数是执行函数，第二参数是延迟时间，第三个参数是是否进行脏值检测，默认是true,如果设置为false，则model数据的更新不会在视图上同步，pass是传递到执行函数的参数</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-app</span> = <span class="string">'myApp'</span> &gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">"myController"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;clock&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../libs/angular.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line"></div><div class="line">    <span class="keyword">var</span> app = angular.module(<span class="string">'myApp'</span>,[]);</div><div class="line">    app.controller(<span class="string">'myController'</span>,[<span class="string">'$scope'</span>,<span class="string">'$timeout'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">$scope,$timeout</span>)</span>&#123;</div><div class="line">      <span class="keyword">var</span> updateClock = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        $scope.clock = <span class="keyword">new</span> <span class="built_in">Date</span>();</div><div class="line">        $timeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">          updateClock();</div><div class="line">        &#125;, <span class="number">1000</span>,<span class="literal">false</span>);<span class="comment">//如果设置为false，发现不会model数据会更新，但是不会反应在view视图上</span></div><div class="line"></div><div class="line">        <span class="built_in">console</span>.log($scope.clock);</div><div class="line">      &#125;;</div><div class="line">      updateClock();</div><div class="line">    &#125;]);</div><div class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div></pre></td></tr></table></figure>
<p>$interval(fn,delay,count,optional,pass) 第一个参数是执行函数，第二个参数是延迟时间，第三个参数是fn执行的次数，第四个参数表示是否进行脏值检测，第五个蚕食表示传递的参数</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-app</span> = <span class="string">'myApp'</span> &gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">"myController"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;clock.now&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../libs/angular.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="keyword">var</span> app = angular.module(<span class="string">'myApp'</span>,[]);</div><div class="line">    app.controller(<span class="string">'myController'</span>,[<span class="string">'$scope'</span>,<span class="string">'$interval'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">$scope,$interval</span>)</span>&#123;</div><div class="line">      $scope.clock = &#123;</div><div class="line">        <span class="attr">now</span> : <span class="keyword">new</span> <span class="built_in">Date</span>()</div><div class="line">      &#125;</div><div class="line">      $interval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        $scope.clock.now = <span class="keyword">new</span> <span class="built_in">Date</span>();</div><div class="line">      &#125;,<span class="number">1000</span>,<span class="number">5</span>);<span class="comment">//5表示fn只会循环5次，如果不设置，则会无限循环，后面还可以设置false参数，表示不会进行脏检</span></div><div class="line"></div><div class="line">    &#125;])</div><div class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div></pre></td></tr></table></figure>
<p>以上代码指令自定义可以变成以下三种方式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">app.directive(<span class="string">"myclick"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">scope, element, attr</span>) </span>&#123;</div><div class="line">            element.on(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                scope.counter++;</div><div class="line">                scope.$digest();</div><div class="line">              <span class="comment">// scope.$apply(); //不推荐这种写法</span></div><div class="line">                <span class="built_in">console</span>.log(scope.counter);</div><div class="line">            &#125;);</div><div class="line">        &#125;;</div><div class="line">    &#125;);</div></pre></td></tr></table></figure>
<p>or</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">app.directive(<span class="string">"myclick"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">scope, element, attr</span>) </span>&#123;</div><div class="line">            element.on(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                scope.counter++;</div><div class="line"></div><div class="line">               scope.$apply(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                    scope.counter++;</div><div class="line">               &#125;);</div><div class="line">                <span class="built_in">console</span>.log(scope.counter);</div><div class="line">            &#125;);</div><div class="line">        &#125;;</div><div class="line">    &#125;);</div></pre></td></tr></table></figure>
<p>此时会发现view视图会随着model的改变实时更新了</p>
<p>再来个栗子</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-app</span> = <span class="string">'myApp'</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span> = <span class="string">'myCtrl'</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">ng-modle</span> = <span class="string">'name'</span>&gt;</span>&#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">ng-model</span> = <span class="string">'name'</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;name&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;age&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../libs/angular.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line"> <span class="keyword">var</span> app = angular.module(<span class="string">'myApp'</span>,[]);</div><div class="line">app.controller(<span class="string">'myCtrl'</span>,[<span class="string">'$scope'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">$scope</span>)</span>&#123;</div><div class="line">        $scope.setInfo = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">           setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">              $scope.$apply(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                  $scope.name = <span class="string">'Jhon'</span>;</div><div class="line">                  $scope.age = <span class="number">19</span>;</div><div class="line">              &#125;)</div><div class="line">           &#125;,<span class="number">2000</span>)</div><div class="line">        &#125;</div><div class="line">        $scope.setInfo();</div><div class="line">    &#125;])</div><div class="line"><span class="comment">//两秒后，会显示修改的scope内容</span></div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">app.controller(<span class="string">'myCtrl'</span>,[<span class="string">'$scope'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">$scope</span>)</span>&#123;</div><div class="line">      $scope.setInfo = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">          setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">              $scope.name = <span class="string">'Jhon'</span>;</div><div class="line">              $scope.age = <span class="number">19</span> ;</div><div class="line">              $scope.$apply();</div><div class="line">          &#125;,<span class="number">2000</span>);</div><div class="line">      &#125;</div><div class="line">      $scope.setInfo();</div><div class="line">      <span class="built_in">console</span>.log($scope);</div><div class="line">  &#125;])</div></pre></td></tr></table></figure>
<h3 id="3-angular中的-watch"><a href="#3-angular中的-watch" class="headerlink" title="3 angular中的 $ watch"></a>3 angular中的 $ watch</h3><p>在上面的情况中，我们通过$apply \$digest函数的调用就可以将model模型上的数据变化实时反应在view层上，但是我们有没有思考为什么会model层的改变会实时显示在view层呢？这个时候就是watch的主要作用了当我们写下表达式，比如　<code></code>　的时候，angularjs在幕后为我们做了一件事情，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$scope.$watch(<span class="string">'somevalue'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="built_in">arguments</span>);<span class="comment">//oldValue newValue scope</span></div><div class="line">  <span class="comment">//这里实现更新view的逻辑，model层的数据变化实时更新到view层</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>也就是说，底层原理来讲是$watch回调函数的调用来执行的实时的数据更新，那么angularjs是怎么知道什么时候去调用这个回调函数呢？先抛出这个问题，看下这个demo，</p>
<ul>
<li>这种情况是scope模型上的数据改变了但是没有触发watch函数的情况，因为我们没有进行脏值检测$digest或者\$apply</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-app</span> = <span class="string">'myApp'</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span> = <span class="string">'myCtrl'</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;age&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../libs/angular.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="keyword">var</span> app = angular.module(<span class="string">'myApp'</span>,[]);</div><div class="line">    app.controller(<span class="string">'myCtrl'</span>,[<span class="string">'$scope'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">$scope</span>)</span>&#123;</div><div class="line">      $scope.age = <span class="number">19</span> ;</div><div class="line">      $scope.change = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">          $scope.age++;</div><div class="line">          <span class="built_in">console</span>.log(<span class="string">"1"</span>);</div><div class="line">          <span class="built_in">console</span>.log($scope.age);</div><div class="line">        &#125;,<span class="number">2000</span>)</div><div class="line">      &#125;</div><div class="line">      $scope.change(); </div><div class="line">      $scope.$watch(<span class="string">'age'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="built_in">arguments</span>);<span class="comment">//看下回调函数的参数</span></div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"age变化触发了我的出现"</span>);</div><div class="line">      &#125;)</div><div class="line">    &#125;])</div><div class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div></pre></td></tr></table></figure>
<p>控制台会循环输出　1　和　　age的递增 ；</p>
<p>这个时候我们就需要思考了？通过什么方式触发$watch呢？修改change函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$scope.change = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    $scope.$apply(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">      $scope.age++ ;</div><div class="line">    &#125;)</div><div class="line">  &#125;,<span class="number">2000</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这个时候我们会发现控制台会循环执行watch函数</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/13/136GetAndSet/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/13/136GetAndSet/" itemprop="url">
                  get and set
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-13T12:36:00+08:00">
                2016-11-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javascript/" itemprop="url" rel="index">
                    <span itemprop="name">javascript</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>1 设置对象的属性，Object.definedProperty(obj.prop,descriptor)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//第一种方式</span></div><div class="line"><span class="keyword">var</span> obj= &#123;&#125;;</div><div class="line"><span class="built_in">Object</span>.defineProperty(obj,<span class="string">"name"</span>,&#123;     </div><div class="line">  <span class="attr">configurable</span>:<span class="literal">true</span>,</div><div class="line">  <span class="attr">enumerable</span> : <span class="literal">false</span>, </div><div class="line">  <span class="attr">value</span>:<span class="string">"Jhon"</span>,</div><div class="line">  <span class="attr">writable</span>:<span class="literal">true</span>,     </div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//第二种方式</span></div><div class="line"><span class="keyword">var</span> obj= &#123;&#125;;</div><div class="line"><span class="built_in">Object</span>.defineProperty(obj,<span class="string">"name"</span>,&#123;</div><div class="line">  <span class="attr">configurable</span>:<span class="literal">true</span>,</div><div class="line">  <span class="attr">enumerable</span> : <span class="literal">false</span>,    </div><div class="line">  <span class="attr">get</span> : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">"JiM"</span>;</div><div class="line">  &#125;</div><div class="line">  set:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line"></div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>2 一个属性的descriptor可能由以下组成 value writable configurable emuerable get set  , descriptor是一个属性的详细信息描述的对象；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//通过键值对的方式直接设置对象的属性</span></div><div class="line"><span class="keyword">const</span> obj = &#123;</div><div class="line">   <span class="attr">foo</span>:<span class="string">'bar'</span>,</div><div class="line"> &#125;;</div><div class="line"><span class="keyword">var</span> descriptors = <span class="built_in">Object</span>.getOwnPropertyDescriptors(obj);</div><div class="line"><span class="built_in">console</span>.log(descriptors);<span class="comment">//foo属性的descriptor对象的详细信息</span></div><div class="line"><span class="built_in">console</span>.log(obj);</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//通过get set方法可以直接给对象设置属性以及设置属性值，大致了解下get和set的作用，以及对obj对象的属性改变</span></div><div class="line"><span class="keyword">const</span> obj = &#123;</div><div class="line">  get foo() &#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">'bar'</span>;</div><div class="line">  &#125;,</div><div class="line">  get foo1() &#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">'bar1'</span>;</div><div class="line">  &#125;,</div><div class="line">  get foo2()&#123;</div><div class="line">    <span class="keyword">return</span> <span class="string">'bar2'</span></div><div class="line">  &#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> descriptors = <span class="built_in">Object</span>.getOwnPropertyDescriptors(obj);</div><div class="line"><span class="built_in">console</span>.log(descriptors);</div><div class="line"><span class="built_in">console</span>.log(obj);</div><div class="line"><span class="built_in">console</span>.log(obj.foo);<span class="comment">//bar</span></div><div class="line"><span class="built_in">console</span>.log(obj.foo1);<span class="comment">//bar1</span></div><div class="line"><span class="built_in">console</span>.log(obj.foo2);<span class="comment">//bar2</span></div><div class="line">obj.foo = <span class="string">'bar4'</span>;<span class="comment">//不会修改foo属性的值</span></div><div class="line"><span class="built_in">console</span>.log(obj.foo);<span class="comment">//bar</span></div></pre></td></tr></table></figure>
<p>3 set方法可以用来设置属性的值，get可以用来获取属性的值，来个栗子感受下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> test = &#123;  </div><div class="line"><span class="attr">_Name</span> : <span class="string">"Lilei"</span>,  </div><div class="line"><span class="attr">_Age</span> : <span class="number">20</span>,    </div><div class="line"><span class="comment">//_Name的只读   </span></div><div class="line">get name() &#123;<span class="keyword">return</span> <span class="keyword">this</span>._Name;&#125;,  <span class="comment">//通过</span></div><div class="line"><span class="comment">//_Age的读写  </span></div><div class="line">set age(age) &#123;<span class="keyword">this</span>._Age = age;&#125;,   </div><div class="line">get age() &#123;<span class="keyword">return</span> <span class="keyword">this</span>._Age;&#125;  </div><div class="line">&#125;  </div><div class="line"><span class="built_in">console</span>.log(test);<span class="comment">//可以查看obj对象的所有属性，加深理解</span></div><div class="line"><span class="keyword">var</span> descriptors = <span class="built_in">Object</span>.getOwnPropertyDescriptors(obj);</div><div class="line"><span class="built_in">console</span>.log(descriptors);<span class="comment">//查看obj对象的所有属性的descriptor对象</span></div><div class="line"><span class="comment">//------------------------------------------------</span></div><div class="line"><span class="built_in">console</span>.log(test.name + <span class="string">" "</span> + test.age);<span class="comment">//Lilei 20  </span></div><div class="line">test.name = <span class="string">'Lily'</span>;  </div><div class="line">test.age = <span class="number">18</span>;  </div><div class="line"><span class="built_in">console</span>.log(test.name + <span class="string">" "</span> + test.age);<span class="comment">//Lilei 18   </span></div><div class="line"><span class="built_in">console</span>.log(test._Name + <span class="string">" "</span> + test._Age);<span class="comment">//Lilei 18 _Name 只读，只写了_Age属性</span></div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/12/05transition  transform body渐变色填充/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/12/05transition  transform body渐变色填充/" itemprop="url">
                  transition  transform 效果进阶1     body如何渐变色填充
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-12T12:36:00+08:00">
                2016-11-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/css/" itemprop="url" rel="index">
                    <span itemprop="name">css</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>transition  transform 效果进阶1     body如何渐变色填充</p>
<p>一  transition的拆分写</p>
<ul>
<li><p>明确其拥有的四个属性值</p>
<p>transition-property   发生渐变效果的属性</p>
</li>
</ul>
<p>transition-duration  完成过渡效果的时间</p>
<p>transition- timing-function  完成过渡效果的动画效果 linear  ease ease-in ease-out</p>
<p>step-start= step(1 ,start)</p>
<p>step-end=step(1,end)  </p>
<p>steps( n1,n2),n1代表完成的步数，n2代表start或者end ,指定每一步的值发生变化的时间点。第二个参数是可选的，默认值为end。</p>
<p>transition-deplay  开始进行过渡效果的延迟</p>
<ul>
<li>transition 属性连写</li>
</ul>
<p>transition : all  2s  ease-in 1s</p>
<p>all 代表所有的属性都会有过渡效果，只要设置了，2s代表一个过渡效果的时间，ease-in 代表过渡的方式，1s代表延迟</p>
<p>二  transform属性(2d)(x 正方向水平向右，y正方向垂直向下，z正方向在垂直于窗口向外)</p>
<ul>
<li><p>translate(x,y )  指定对象移动，基准是父盒子左上角，移动 x y z是代表距离左上角的距离translatex(length|percentage),translatey(number)指定x  y的移动距离。如果第二个参数省略，那么默认为0 ；其中百分比的基准是以元素自身的宽高为基准，然后乘以百分比，得到移动的距离值。</p>
<p>​    transform：translate(50px,40px)代表向右和向下移动50px  40px；</p>
</li>
<li><p>scale(x,y) ,代表指定对象缩放比例，x，y分别对应x y轴的缩放。scalex(number) scaley(number),如果第二个参数省略默认和第一个参数相等。</p>
</li>
<li>rotate(angle) 输入角度值，代表元素2d的旋转角度 需要有个transition-origin属性。关于旋转的方向：遵循“左手定则”大拇指指向轴的正方向，四指的方向就是旋转的方向，也是角度值为正的方向;rotate(angle),默认以z轴为基准进行旋转，rotatex(angel)，rotatey(angle),rotatez(angle) 以x和y轴为基准进行旋转(3D)。注意在3d里面才有rotatex(angel)，rotatey(angle),rotatez(angle)，在2d里面只有rotate(angle)</li>
<li>skew(x,y) 指定x  y的扭曲距离。如果第二个参数省略，那么默认为0 ;skewx(number) skewy(number).</li>
</ul>
<p>三 : 有关body的渐变色填充问题：</p>
<p>​    body默认是没有高度的，但是却可以直接给body设置背景颜色，这是为什么呢?好多人会问，不是应该元素有了宽高才能有背景色吗？</p>
<p>这里明确一点，body设置背景色是浏览器自动配置的，如果直接给body设置背景色，默认全部填充整个文档；即使body的高度是默认的高度。</p>
<p>走个小demo理解下这个问题、</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></div><div class="line">		body &#123;</div><div class="line">			background-color: blue;</div><div class="line">			/* background: linear-gradient(to bottom,rgba(0,0,255,0.1),rgba(0,0,255,0.5),rgb(0,0,255));*/</div><div class="line">		&#125;</div><div class="line">	<span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p><img src="img/1.jpg" alt="纯色填充"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">body &#123;</div><div class="line">	background: linear-gradient(to</div><div class="line">bottom,rgba(0,0,255,0.1),rgba(0,0,255,0.5),rgb(0,0,255));</div><div class="line">		&#125;</div></pre></td></tr></table></figure>
<p><img src="img/gradient.jpg" alt="渐变填充出问题了"></p>
<p>给body一个高度：</p>
<p>​    height:100px    ;</p>
<p><img src="img/h.jpg" alt="给个高度"></p>
<p>我们会发现的问题是：纯色填充body没有问题，那么如何解决渐变填充body这种情况呢？</p>
<p>很简单，</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">html,body &#123;</div><div class="line">  height :100% ;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="img/solve.jpg" alt="解决问题"></p>
<p>四  ，写个demo玩一下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span>	</div><div class="line">	<span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></div><div class="line">		html,body&#123;</div><div class="line">			height: 100%;</div><div class="line">			margin: 0;</div><div class="line">		&#125;</div><div class="line">		body&#123;</div><div class="line">			background: linear-gradient(to bottom,rgba(0,0,255,0.1),rgba(0,0,255,0.5),rgb(0,0,255));</div><div class="line">			box-sizing:border-box;</div><div class="line">		&#125;</div><div class="line">		.fish &#123;</div><div class="line">			width: 174px;</div><div class="line">			height: 126px;</div><div class="line">			background:url(img/fish.png) no-repeat;</div><div class="line">			/*border: 1px solid #000;*/</div><div class="line">			transition: all 2s linear;</div><div class="line">		&#125;</div><div class="line">		body:hover .fish&#123;</div><div class="line">			transform:translate(1000px,500px) rotate(45deg) scale(.5,.5);</div><div class="line">		&#125; </div><div class="line">		/*背景图片默认左上角平铺，然后改变背景图片的位置即可*/</div><div class="line">		.animation &#123;</div><div class="line">      		animation: autoMove 1s steps(8) infinite;</div><div class="line">    	&#125;</div><div class="line">     /*动画关键字 */</div><div class="line">    </div><div class="line">	    @keyframes autoMove &#123;</div><div class="line">	    from &#123;&#125;</div><div class="line">	      to &#123;</div><div class="line">	        background-position: 0 -1008px;</div><div class="line">	      &#125;</div><div class="line">	    &#125;</div><div class="line"></div><div class="line">	<span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"fish animation"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p><img src="img/gif.gif" alt=""></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/10/157AngularJS-Initialization/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/10/157AngularJS-Initialization/" itemprop="url">
                  AngularJsInitialization
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-10T12:36:00+08:00">
                2016-11-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javascript/" itemprop="url" rel="index">
                    <span itemprop="name">javascript</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>1 angularJs初始化应用模块有两种方式</p>
<p>1.1、绑定初始化，自动加载</p>
<p>通过绑定来进行angular的初始化，会把js代码侵入到html中。</p>
<p>ng-app是angular的一个指令，代表一个angular应用（也叫模块）。使用ng-app或ng-app=””来标记一个DOM结点，让框架会自动加载。也就是说，ng-app是可以带属性值的。如果没有ng-app指令将会报错；</p>
<p>自动初始化流程如下</p>
<p><strong>ng-app</strong> 指令定义了 AngularJS 应用程序的 <strong>根元素</strong></p>
<p>AngularJS 在 HTML DOMContentLoaded 事件后会<strong>自动引导</strong>（自动初始化）应用程序。如果找到 ng-app 指令 ， AngularJS 载入<strong>指令中的模块</strong>，然后创建应用的<strong>注入器</strong>，并将 ng-app 作为应用的根<strong>进行编译</strong>。同时，启动应用的时候，会在其子元素范围内构成一个$scope;</p>
<p>应用的根可以是整个页面，或者页面的一小部分，如果是一小部分会更快编译和执行。</p>
<p>AngularJS initializes automatically upon <code>DOMContentLoaded</code> event or when the <code>angular.js</code> script is evaluated if at that time <code>document.readyState</code> is set to <code>&#39;complete&#39;</code>. At this point AngularJS looks for the <a href="https://docs.angularjs.org/api/ng/directive/ngApp" target="_blank" rel="external"><code>ngApp</code></a> directive which designates your application root. If the <a href="https://docs.angularjs.org/api/ng/directive/ngApp" target="_blank" rel="external"><code>ngApp</code></a> directive is found then AngularJS will:</p>
<ul>
<li>load the module associated with the directive.</li>
<li>create the application injector</li>
<li>compile the DOM treating the ngApp directive as the root of the compilation. This allows you to tell it to treat only a portion of the DOM as an AngularJS application.</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">通过控制体controller进行数据绑定</div><div class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-app</span> = <span class="string">'Demo'</span>&gt;</span> </div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span> = <span class="string">'DemoCtrl'</span>&gt;</span></div><div class="line">    `&#123;&#123;a&#125;&#125;+&#123;&#123;b&#125;&#125; = &#123;&#123;a+b&#125;&#125;`</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></div><div class="line">  //如果要对angular应用添加控制器，那么必须关联Demo到module模块，如果不关联那么则会提示没有</div><div class="line">  //The controller with the name 'xxx' is not registered.</div><div class="line">    angular.module('Demo',[]).controller('DemoCtrl',['$scope',function($scope)&#123;</div><div class="line">        $scope.a = 1 ;</div><div class="line">        $scope.b = 2 ;</div><div class="line">    &#125;]);</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">通过run方法进行数据绑定，这个只能提供全局的变量</div><div class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-app</span> = <span class="string">'Demo'</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> &gt;</span></div><div class="line">    `&#123;&#123;a&#125;&#125;+&#123;&#123;b&#125;&#125; = &#123;&#123;a+b&#125;&#125;`</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></div><div class="line">    var myapp =   angular.module('Demo',[]);</div><div class="line">    console.log(myapp);</div><div class="line">    myapp.run(function($rootScope)&#123;</div><div class="line">        $rootScope.a = 1 ;</div><div class="line">        $rootScope.b = 2 ;</div><div class="line">    &#125;)</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">通过ng-init初始化数据</div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span> <span class="attr">ng-init</span>=<span class="string">'name = "Jhon"'</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-bind</span>=<span class="string">"name"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>ng-app指令作用如下</p>
<p>There are a few things to keep in mind when using <code>ngApp</code>:</p>
<ul>
<li>only one AngularJS application can be auto-bootstrapped per HTML document. The first <code>ngApp</code> found in the document will be used to define the root element to auto-bootstrap as an application. To run multiple applications in an HTML document you must manually bootstrap them using <a href="https://docs.angularjs.org/api/ng/function/angular.bootstrap" target="_blank" rel="external"><code>angular.bootstrap</code></a> instead.</li>
<li>AngularJS applications cannot be nested within each other.</li>
<li>Do not use a directive that uses <a href="https://docs.angularjs.org/api/ng/service/$compile#transclusion" target="_blank" rel="external">transclusion</a> on the same element as <code>ngApp</code>. This includes directives such as <a href="https://docs.angularjs.org/api/ng/directive/ngIf" target="_blank" rel="external"><code>ngIf</code></a>, <a href="https://docs.angularjs.org/api/ng/directive/ngInclude" target="_blank" rel="external"><code>ngInclude</code></a>and <a href="https://docs.angularjs.org/api/ngRoute/directive/ngView" target="_blank" rel="external"><code>ngView</code></a>. Doing this misplaces the app <a href="https://docs.angularjs.org/api/ng/service/$rootElement" target="_blank" rel="external"><code>$rootElement</code></a> and the app’s <a href="https://docs.angularjs.org/api/auto/service/$injector" target="_blank" rel="external">injector</a>, causing animations to stop working and making the injector inaccessible from outside the app.</li>
</ul>
<p>You can specify an <strong>AngularJS module</strong> to be used as the root module for the application. This module will be loaded into the <a href="https://docs.angularjs.org/api/auto/service/$injector" target="_blank" rel="external"><code>$injector</code></a>when the application is bootstrapped. It should contain the application code needed or have dependencies on other modules that will contain the code. See <a href="https://docs.angularjs.org/api/ng/function/angular.module" target="_blank" rel="external"><code>angular.module</code></a> for more information.</p>
<p>1.2 当同一个页面中包含多个app的时候(不能嵌套)，这个时候angular就不能自动启动应用，需要我们用bootstrp手动启动应用</p>
<p>手动初始化一个angular应用模块,可以使用angular.bootstrap()，该方法可以初始化一个angularjs应用，注意该方法不会创建模块，我们在将模块作为参数传递之前必须先创建了一个模块或者已经先加载了一个模块</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">angular.bootstrap(element, [modules], [config]);</div></pre></td></tr></table></figure>
<p>其中第一个参数element:是绑定ng-app的dom元素；<br>modules：绑定的模块名字<br>config：附加的配置</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">body</span> &gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span> = <span class="string">'DemoCtrl'</span>&gt;</span></div><div class="line">   ` &#123;&#123;a&#125;&#125;+&#123;&#123;b&#125;&#125; = &#123;&#123;a+b&#125;&#125; `</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></div><div class="line">    angular.module('Demo',[]).controller('DemoCtrl',['$scope',function($scope)&#123;</div><div class="line">        $scope.a = 1 ;</div><div class="line">        $scope.b = 2 ;</div><div class="line"></div><div class="line">    &#125;]);</div><div class="line">  //页面加载完毕之后在进行初始化模块</div><div class="line">    angular.element(document).ready(function()&#123;</div><div class="line">        angular.bootstrap(document,['Demo']);</div><div class="line">      	//angular.bootstrap(document.body,['Demo'])</div><div class="line">     //上面两行代码绑定同一个模块会报错，只能存在一个</div><div class="line">    &#125;)</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"angular.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></div><div class="line"></div><div class="line">        // 创建moudle1</div><div class="line">        var rootMoudle = angular.module('moudle1', []);</div><div class="line">        rootMoudle.controller("controller1",function($scope)&#123;$scope.name="aty"&#125;);</div><div class="line"></div><div class="line">        // 创建moudle2</div><div class="line">        var m2 = angular.module('moudle2', []);</div><div class="line">        m2.controller("controller2",function($scope)&#123;$scope.name="aty"&#125;);</div><div class="line">        // 页面加载完成后,再加载模块</div><div class="line">        angular.element(document).ready(function() &#123;</div><div class="line">            angular.bootstrap(document.getElementById("div1"),["moudle1"]);</div><div class="line">            angular.bootstrap(document.getElementById("div2"),["moudle2"]);</div><div class="line">          //绑定不同的模块是可以的</div><div class="line">        &#125;);</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"div1"</span>  <span class="attr">ng-controller</span>=<span class="string">"controller1"</span>&gt;</span>div1:`&#123;&#123;name&#125;&#125;`<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"div2"</span>  <span class="attr">ng-controller</span>=<span class="string">"controller2"</span>&gt;</span>div2:`&#123;&#123;name&#125;&#125;`<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>1.3 一个ng-app所在的标签就是一个angular应用，该标签下的所有子标签会被angular编译，不是其子标签的话不会被angular编译</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span> = <span class="string">'app'</span> <span class="attr">ng-controller</span> = <span class="string">'myCtrl'</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>`&#123;&#123;name&#125;&#125;`<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>`&#123;&#123;age&#125;&#125;`<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  </div><div class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>`&#123;&#123;age&#125;&#125;`<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="comment">&lt;!--初始化ng-app，那么ng-app标签下面的子标签就是整个应用，其他的就不是angular应用，然后angular不会编译其余的标签</span></div><div class="line">第二个age不会被angular编译，因此不会被显示19，只会显示&#123;&#123;age&#125;&#125;</div><div class="line">--&gt;</div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></div><div class="line">    var app = angular.module('app',[]);</div><div class="line">    app.controller('myCtrl',['$rootScope','$scope',function($scope,$rootScope)&#123;</div><div class="line">        $rootScope.name = "Jhon";</div><div class="line">        $scope.age = 19 ;</div><div class="line">    &#125;]);</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div></pre></td></tr></table></figure>
<p>1.4注意</p>
<ul>
<li><p>ng-app和angular.bootstrap不能同时使用</p>
</li>
<li><p>ng-app只能出现一次，所以就只能出现一个angularjs应用，但是angular.bootstrap可以出现多次，但是这种做法是不推荐的</p>
</li>
<li><p>二者初始化的一个应用的时候，所在元素的不能有ngIf   ngView  ngInclude指令</p>
</li>
<li><p>ng-app所在的标签的就是一个angular应用，该标签下面的所有的子标签都会被angular编译，不是该标签的子标签不会被angular编译</p>
</li>
<li><p>初始化angular应用之后可以进行创建模块以及控制器、服务等其他操作</p>
</li>
<li><p>初始化的angular应用里面的表达式会被编译，编译之后的表达式会按照angular的规定进行解析，如果没有ng-app指令或者bootstrap手动初始化angular应用，则表达式不会进行运算，将直接显示出来</p>
</li>
<li><p>HTML5 允许扩展的（自制的）属性，以 <strong>data-</strong> 开头。<br>AngularJS 属性以 <strong>ng-</strong> 开头，但是您可以使用 <strong>data-ng-</strong> 来让网页对 HTML5 有效。</p>
</li>
<li><p>AngularJS 表达式 与 JavaScript 表达式</p>
<p>类似于 JavaScript 表达式，AngularJS 表达式可以包含字母，操作符，变量。</p>
<p>与 JavaScript 表达式不同，AngularJS 表达式可以写在 HTML 中。</p>
<p>与 JavaScript 表达式不同，AngularJS 表达式不支持条件判断，循环及异常。</p>
<p>与 JavaScript 表达式不同，AngularJS 表达式支持过滤器。</p>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/04/87-Javscript中this详解/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/04/87-Javscript中this详解/" itemprop="url">
                  Javscript中this详解
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-04T21:08:00+08:00">
                2016-11-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javascript/" itemprop="url" rel="index">
                    <span itemprop="name">javascript</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Javscript中this详解"><a href="#Javscript中this详解" class="headerlink" title="Javscript中this详解"></a>Javscript中this详解</h2><h3 id="一-宿主环境和javascript-引擎"><a href="#一-宿主环境和javascript-引擎" class="headerlink" title="一 宿主环境和javascript 引擎"></a>一 宿主环境和javascript 引擎</h3><ul>
<li>宿主环境：一门语言在运行的时候需要一个环境，这个环境就是宿主环境，对于JavaScript来说宿主环境就是我们常说的浏览器，在这个浏览器里面提供了一些借口让javascript引擎可以和宿主环境对接；</li>
<li>jacascript引擎才是真正执行代码的地方，常见的javascript引擎包括V8，javascript core,javascript引擎主要做了以下几件事情:一套与宿主环境相互联系的规则，javascript引擎内核，规定了基本javascript语法逻辑和命令，一组内置对象和API</li>
<li>javascript不仅可以在浏览器里面运行，还可以在其他宿主环境，比如node.js</li>
</ul>
<h3 id="二-this详解"><a href="#二-this详解" class="headerlink" title="二 this详解"></a>二 this详解</h3><h2 id="1-global-this"><a href="#1-global-this" class="headerlink" title="1 global this"></a>1 global this</h2><p>1.1在浏览器里面，全局范围内，this等价于window对象(其实window对象也是Window构造函数的实例)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">console</span>.log(<span class="keyword">this</span> === <span class="built_in">window</span>);<span class="comment">//true  全等号还是返回true  </span></div><div class="line">   <span class="keyword">this</span>.name = <span class="string">"jhon"</span>;</div><div class="line">   <span class="built_in">console</span>.log(<span class="built_in">window</span>.name);<span class="comment">//jhon</span></div><div class="line">   <span class="built_in">window</span>.age = <span class="number">13</span> ;</div><div class="line">   <span class="built_in">console</span>.log(<span class="keyword">this</span>.age);<span class="comment">//13</span></div></pre></td></tr></table></figure>
<p>1.2 在浏览器中，在全局范围内，用var声明一个变量和给this  window 设置属性是等价的</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> foo = <span class="string">"bar"</span>;</div><div class="line">   <span class="built_in">console</span>.log(<span class="keyword">this</span>.foo);<span class="comment">//bar</span></div><div class="line">   <span class="built_in">console</span>.log(<span class="built_in">window</span>.foo);<span class="comment">//bar</span></div></pre></td></tr></table></figure>
<p>1.2.1 预解析对顶级对象window的属性的添加</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">console</span>.log(<span class="built_in">window</span>.exp); <span class="comment">//由于预解析  var exp ;会被提升到最上部，声明的对象未被定义的话，默认为undefined</span></div><div class="line"><span class="keyword">if</span> (exp <span class="keyword">in</span> <span class="built_in">window</span>)&#123;  <span class="comment">//  返回true;</span></div><div class="line">  <span class="comment">//in  操作符，可以用来判断某个对象是否拥有某个属性，可以追溯对象所有的属性，包括原型上的;</span></div><div class="line">        <span class="keyword">var</span> exp = <span class="string">"example"</span>;<span class="comment">//会进行预解析，声明exp属性给到window,解析到这一行代码的时候，会进行赋值</span></div><div class="line">    <span class="comment">//明确预解析:所谓预解析是浏览器的动作，它会在执行javascript代码之前，全局的检索javascript代码，将变量声明以及函数声明提升到函数的额最顶部，所以，变量声明提升的时候，相当于给window对象添加了一个属性</span></div><div class="line">       <span class="built_in">console</span>.log(<span class="built_in">window</span>.exp);<span class="comment">//example </span></div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>1.2.2 用function声明函数和在全局用var 声明变量，或者函数体不用var声明变量，都是在给全局的window添加属性值</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="keyword">var</span> amyName;			<span class="comment">// window 对象会多一个amyName 属性</span></div><div class="line">    a ;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">anewBuilder</span>(<span class="params"></span>)</span>&#123;  <span class="comment">//window对象会多一个anerBuilder属性</span></div><div class="line">        aaa = <span class="number">1</span>;  <span class="comment">//函数执行后 ，window对象又会多一个aaa属性</span></div><div class="line">    &#125;</div><div class="line">    anewBuilder()</div><div class="line">    <span class="built_in">console</span>.log(<span class="built_in">window</span>);</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p>1.2.3 如果没有用var 声明，那么则不会进行变量提升，即使该变量也是隐式全局变量</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (exp <span class="keyword">in</span> <span class="built_in">window</span>)&#123;	<span class="comment">//报错，程序停止运行</span></div><div class="line">      exp = <span class="string">"example"</span>;<span class="comment">//隐式全局变量，不会进行预解析，声明exp属性给到window</span></div><div class="line">      <span class="built_in">console</span>.log(exp);</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>1.3 在<strong>函数体内</strong> ，(即使是函数体内的函数嵌套函数),没有var或者let声明的变量或者函数，就是在给全局this  window添加属性；如果使用了var 或者 let声明变量，则不能被全局的this访问到；</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line"><span class="comment">//    var str = "全局的this";</span></div><div class="line">    <span class="comment">//在函数体，声明变量的时候，如果没有用var</span></div><div class="line">    <span class="keyword">var</span> func = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> str =<span class="string">"这个不能被全局的this访问到"</span>;</div><div class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.str);<span class="comment">//undefined  this代表全局的window，在全局范围内，并没有str赋值</span></div><div class="line">      <span class="comment">// 如果不是被new调用函数，那么函数体的this都是指代全局范围的this,代表window对象；</span></div><div class="line">        func3 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            innerV = <span class="string">"这是函数体内的变量"</span>;</div><div class="line">        &#125;;</div><div class="line"><span class="comment">//      func3();</span></div><div class="line">    &#125;</div><div class="line">    func();</div><div class="line">    <span class="keyword">this</span>.func3();<span class="comment">//和在函数体内执行效果是一样的，func3也是全局this的属性(方法)</span></div><div class="line"><span class="comment">//这两个函数必须被执行，才能正确赋值,以下innerV 才能输出；</span></div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.innerV);<span class="comment">//"这是函数体内的变量"</span></div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.str);<span class="comment">//undefined</span></div><div class="line">    <span class="comment">//在函数体内，不使用var或者let声明变量，也是在给全局的this和window对象设置属性</span></div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="2-function-this"><a href="#2-function-this" class="headerlink" title="2 function this"></a>2 function this</h2><h3 id="2-0-对于一个函数，有三种角色，普通函数，直接调用执行；构造函数，通过new调用；函数作为对象；"><a href="#2-0-对于一个函数，有三种角色，普通函数，直接调用执行；构造函数，通过new调用；函数作为对象；" class="headerlink" title="2.0 对于一个函数，有三种角色，普通函数，直接调用执行；构造函数，通过new调用；函数作为对象；"></a>2.0 对于一个函数，有三种角色，普通函数，直接调用执行；构造函数，通过new调用；函数作为对象；</h3><p>2.1  如果不是被new调用函数，</p>
<ul>
<li>普通函数:直接执行函数体，那么函数体的this都是指代全局范围的this,代表window对象；</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="keyword">var</span> foo = <span class="string">"bar"</span>;   <span class="comment">//变量的声明，相当于给window添加了一个 foo 属性，属性值是一个基础数据类型值</span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">test</span> (<span class="params"></span>)</span>&#123;  <span class="comment">//函数的声明，相当于给window添加了一个test属性，属性值是复杂数据类型值</span></div><div class="line">        <span class="keyword">this</span>.foo = <span class="string">"bar is changed"</span>;<span class="comment">//当函数不是被new操作符调用的时候，this还是指向window对象</span></div><div class="line">    &#125;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.foo);<span class="comment">//bar</span></div><div class="line">    test();<span class="comment">//直接执行函数，this代表全局的this</span></div><div class="line">  <span class="comment">//等价于window.test()</span></div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.foo);<span class="comment">//bar is changed </span></div><div class="line">  <span class="comment">//--------------------------------------------------------------------</span></div><div class="line">  	<span class="keyword">var</span> num = <span class="number">300</span>;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getNum</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> num = <span class="number">200</span> ;</div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">getInnerNum</span>(<span class="params"></span>)</span>&#123;</div><div class="line">           <span class="built_in">console</span>.log(<span class="keyword">this</span>);</div><div class="line">           <span class="built_in">console</span>.log(<span class="keyword">this</span>.num);<span class="comment">//300</span></div><div class="line">           <span class="built_in">console</span>.log(num);<span class="comment">//200</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> getInnerNum;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">var</span> res = getNum();</div><div class="line">    res();</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li>直接执行函数体的时候，如果使用了apply  call 则代表改变了函数运行时的this指向，原先this默认指向的是其执行的上下文环境；语法  fn.apply(  thisArg[, argsArray]  ) 、 fn.call( thisArg[, arg1[, arg2[, …]]] ) 执行之后，this指向传入的第一个参数</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="keyword">var</span> foo = <span class="string">"bar"</span>;</div><div class="line">    <span class="keyword">var</span> obj = &#123;<span class="string">"foo"</span>:<span class="string">"objBar"</span>&#125;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">test</span> (<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.foo);</div><div class="line">    &#125;</div><div class="line">    test();<span class="comment">//bar 函数执行的时候this指向执行的上下文环境</span></div><div class="line">  </div><div class="line">    test.apply(obj);<span class="comment">// objBar  将test函数执行的时候this的指向指向了obj</span></div><div class="line">    test.call(obj);<span class="comment">// objBar  将test函数执行的时候this的指向指向了obj</span></div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p>2.2 函数作为构造函数:如果被new操作符调用函数体,那么函数体的this就变成了一个新的值，和global的this没有任何关系</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="keyword">var</span> foo = <span class="string">"bar"</span>;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">test</span> (<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">this</span>.foo = <span class="string">"bar is changed"</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.foo);<span class="comment">//bar</span></div><div class="line">  <span class="comment">//不使用new操作符调用</span></div><div class="line">  <span class="comment">//    test();</span></div><div class="line">  <span class="comment">//    console.log(this.foo);//bar is changed</span></div><div class="line">  <span class="comment">//使用new操作调用   </span></div><div class="line">     <span class="keyword">new</span> test();<span class="comment">//通过new操作符之后，函数体里面的this不再指向全局window，而是指向其新创建的对象</span></div><div class="line">     <span class="built_in">console</span>.log(<span class="keyword">this</span>.foo);<span class="comment">//bar  </span></div><div class="line">     <span class="built_in">console</span>.log(<span class="keyword">new</span> test().foo);<span class="comment">//bar is changed</span></div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p>2.3 接下来解释下new 操作符的作用，看下面的代码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">test</span> (<span class="params"></span>)</span>&#123;</div><div class="line">         <span class="keyword">this</span>.foo = <span class="string">"bar is changed"</span>;</div><div class="line">  		 <span class="keyword">this</span>.func = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">          	<span class="built_in">console</span>.log(<span class="string">"new的解析"</span>);</div><div class="line">  		&#125;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">console</span>.log(test);</div><div class="line">	<span class="comment">//function test()&#123;</span></div><div class="line">    <span class="comment">//   this.foo = "bar is changed";</span></div><div class="line">    <span class="comment">//   this.func = function()&#123;</span></div><div class="line">    <span class="comment">//    console.log("new的解析");</span></div><div class="line">   <span class="comment">//   &#125;</span></div><div class="line">   <span class="comment">// &#125;</span></div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">typeof</span> test);</div><div class="line"><span class="comment">//function</span></div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">new</span> test);</div><div class="line"><span class="comment">//test &#123;foo: "bar is changed",func:()&#125;</span></div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">typeof</span> <span class="keyword">new</span> test());</div><div class="line"><span class="comment">//object</span></div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p>2.3.1 解释new的作用，当以 new 操作符调用构造函数的时候，<strong>函数内部</strong> 发生以下变化：</p>
<ul>
<li><p>函数内部会创建一个空的对象，将该对象的引用指向this；所以后期只能通过this给实例添加属性和方法；</p>
</li>
<li><p>属性和方法会被添加到this 引用的对象中；</p>
</li>
<li><p>新创建的对象的引用指向了this,最后返回this</p>
</li>
</ul>
<p>2.3.2 new操作符的作用如下:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span> (<span class="params"></span>)</span>&#123;</div><div class="line">      <span class="keyword">var</span> obj = <span class="keyword">new</span> <span class="built_in">Object</span>();<span class="comment">//实例化一个对象</span></div><div class="line">      obj.foo = <span class="string">"bar"</span>;</div><div class="line">      obj.func = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">          <span class="built_in">console</span>.log(<span class="string">"new的解析"</span>);</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">return</span> obj;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>2.3.3 从原型的角度理解下 new操作符的作用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">   <span class="function"><span class="keyword">function</span> <span class="title">test</span> (<span class="params"></span>)</span>&#123;</div><div class="line">         <span class="keyword">this</span>.foo = <span class="string">"bar is changed"</span>;</div><div class="line">  		<span class="keyword">this</span>.func = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">          	<span class="built_in">console</span>.log(<span class="string">"new的解析"</span>);</div><div class="line">  		&#125;</div><div class="line">    &#125;</div><div class="line"><span class="keyword">var</span> </div><div class="line"><span class="comment">//1 方法new的瞬间 得到一个空的对象</span></div><div class="line"><span class="keyword">var</span> obj = &#123; &#125; ;</div><div class="line">obj.__proto__ = test.prototype;</div><div class="line"><span class="comment">//2 方法的this指向空对象obj</span></div><div class="line"><span class="comment">//3 执行构造方法</span></div><div class="line">&#123; &#125;.foo = <span class="string">"bar is changed"</span>;</div><div class="line">&#123; &#125;.func = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  	<span class="built_in">console</span>.log(<span class="string">"new的解析"</span>);</div><div class="line">&#125;</div><div class="line"><span class="comment">// 返回该对象</span></div><div class="line">test.call(obj)</div></pre></td></tr></table></figure>
<p>2.3.4 如果使用构造函数显式的返回<strong>基本数据类型</strong>(number string boolean null undefined)不会影响输出结果 ，返回<strong>引用类型</strong> object 则不会再返回构造函数的实例对象的地址，而是返回该引用的地址；</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">anotherTest</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"this is another test"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">test</span> (<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">this</span>.foo = <span class="string">"bar"</span>;</div><div class="line">        <span class="keyword">this</span>.func = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">"new的解析"</span>);</div><div class="line">        &#125;</div><div class="line"><span class="comment">//        返回基本数据类型，不会影响最后的结果</span></div><div class="line"><span class="comment">//        return 123;</span></div><div class="line"><span class="comment">//        return "str";</span></div><div class="line"><span class="comment">//        return null;</span></div><div class="line"><span class="comment">//        如果返回的是引用类型，则会改变返回值</span></div><div class="line"><span class="comment">//        return &#123;'name':'jhon','age':12&#125;;</span></div><div class="line"><span class="comment">//        return [1,2,3]</span></div><div class="line"> <span class="comment">//       return anotherTest ;</span></div><div class="line">        <span class="comment">//如果返回this，那么还是返回的实例化对象;new操作符默认返回实例化对象</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">var</span> obj = <span class="keyword">new</span> test();</div><div class="line">    <span class="built_in">console</span>.log(obj);<span class="comment">//基本数据类型，仍会返回构造函数的实例化对象，返回引用类型的话，就是返回了引用类型的地址，原来构造函数的实例化的对象指向该引用类型</span></div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p>2.3.5 new操作符每次调用的时候，在<strong>堆</strong>  (heap)内存中开辟一块内存空间，存储<strong>实例化对象的信息</strong>;如果有变量接受该对象的地址，那么 定义变量的时候会在<strong>栈</strong>(stack) 中开辟了一块空间存储<strong>变量名和引用地址</strong> ；<strong>不同的变量</strong>指向<strong>不同的堆内存空间</strong> </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span> (<span class="params">name</span>)</span>&#123;</div><div class="line">      <span class="keyword">this</span>.name = name;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">var</span> obj1 = <span class="keyword">new</span> test(<span class="string">'Jhon'</span>);</div><div class="line">  <span class="keyword">var</span> obj2 = <span class="keyword">new</span> test(<span class="string">"Jhon"</span>);</div><div class="line">  <span class="built_in">console</span>.log(obj1.name);<span class="comment">//Jhon</span></div><div class="line">  <span class="built_in">console</span>.log(obj2.name);<span class="comment">//Jhon</span></div><div class="line"></div><div class="line">  obj1.name = <span class="string">"kobe"</span>;</div><div class="line">  <span class="built_in">console</span>.log(obj1.name);<span class="comment">//kobe</span></div><div class="line">  <span class="built_in">console</span>.log(obj2.name);<span class="comment">//Jhon</span></div></pre></td></tr></table></figure>
<p>2.4 如果函数体是对象的方法，那么此时的函数体里面的this就是指向的<strong>调用</strong> 该函数的对象；注意区分下面这两种情况</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="keyword">var</span> foo = <span class="string">"bar"</span>;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.foo);<span class="comment">//bar</span></div><div class="line">    <span class="keyword">var</span> obj = &#123;</div><div class="line">        <span class="attr">foo</span>:<span class="string">"objBar"</span>,</div><div class="line">        <span class="attr">test</span>:<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;	<span class="comment">//函数作为对象的方法，被对象调用</span></div><div class="line">            <span class="built_in">console</span>.log(<span class="keyword">this</span>.foo);<span class="comment">//objBar   此时的this指向调用函数的对象</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    obj.test();<span class="comment">//对象的方法的执行的上下文是对象，所以this指向对象</span></div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> foo = <span class="string">"bar"</span>;</div><div class="line"> <span class="built_in">console</span>.log(<span class="keyword">this</span>.foo);<span class="comment">//bar</span></div><div class="line"> <span class="keyword">var</span> obj = &#123;</div><div class="line">     <span class="attr">foo</span>:<span class="string">"objBar"</span>,</div><div class="line">     <span class="attr">test</span>:<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</div><div class="line">         <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">             <span class="built_in">console</span>.log(<span class="keyword">this</span>.foo);<span class="comment">//bar   </span></div><div class="line">         &#125;</div><div class="line">     &#125;</div><div class="line"> &#125;</div><div class="line"> obj.test()();<span class="comment">//注意区分这两种情况:test()返回的是一个函数，函数直接在Window环境下执行</span></div></pre></td></tr></table></figure>
<p>2.5 如果函数体是数组中的元素，那么函数作为数组的元素被调用的时候，指向数组,对于伪数组来书也是指向伪数组</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn1</span> (<span class="params"></span>)</span>&#123;</div><div class="line">       <span class="built_in">console</span>.log(<span class="string">"fn1"</span>);</div><div class="line">       <span class="built_in">console</span>.log(<span class="keyword">this</span>);</div><div class="line">   &#125;</div><div class="line">   <span class="function"><span class="keyword">function</span> <span class="title">fn2</span> (<span class="params"></span>)</span>&#123;</div><div class="line">       <span class="built_in">console</span>.log(<span class="string">"fn2"</span>);</div><div class="line">       <span class="built_in">console</span>.log(<span class="keyword">this</span>[<span class="number">2</span>]);</div><div class="line">   &#125;</div><div class="line">   <span class="keyword">var</span> arr = [fn1,fn2,<span class="string">'things'</span>];</div><div class="line">   arr[<span class="number">0</span>]();<span class="comment">//fn1 [function, function, "things"]</span></div><div class="line">   arr[<span class="number">1</span>]();<span class="comment">//fn2 things</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span> (<span class="params"></span>)</span>&#123;</div><div class="line">      <span class="built_in">console</span>.log(<span class="keyword">this</span>.length);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">var</span> obj = &#123;</div><div class="line">      <span class="attr">length</span> : <span class="number">10</span> ,</div><div class="line">      <span class="attr">method</span> : <span class="function"><span class="keyword">function</span>(<span class="params">f</span>)</span>&#123;</div><div class="line">          <span class="built_in">console</span>.log(<span class="keyword">this</span>.length);<span class="comment">//10</span></div><div class="line">          <span class="built_in">console</span>.log(<span class="built_in">arguments</span>);</div><div class="line">          <span class="built_in">arguments</span>[<span class="number">0</span>]();<span class="comment">//1   this.length代表传入参数的个数</span></div><div class="line">          <span class="built_in">arguments</span>[<span class="number">0</span>].call(<span class="keyword">this</span>);<span class="comment">//10</span></div><div class="line">      &#125;</div><div class="line">  &#125;</div><div class="line">  obj.method(fn);</div></pre></td></tr></table></figure>
<p>this指向被调用的<strong>直接对象</strong> ，被谁调用指向谁</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="keyword">var</span> foo = <span class="string">"winBar"</span>;</div><div class="line">    <span class="keyword">var</span> out = &#123;</div><div class="line">        <span class="attr">foo</span>:<span class="string">"outerBar"</span>,</div><div class="line">        <span class="attr">outFunc</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">          	<span class="built_in">console</span>.log(<span class="keyword">this</span>);<span class="comment">//this 代表out对象</span></div><div class="line">            <span class="built_in">console</span>.log(<span class="keyword">this</span>.foo);<span class="comment">//执行后输出  outerBar</span></div><div class="line">        &#125;,</div><div class="line"></div><div class="line">        <span class="attr">inner</span>:&#123;</div><div class="line">            <span class="attr">foo</span>:<span class="string">"innerBar"</span>,</div><div class="line">            <span class="attr">innerFunc</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                <span class="built_in">console</span>.log(<span class="keyword">this</span>);<span class="comment">//this代表 inner对象</span></div><div class="line">                <span class="built_in">console</span>.log(<span class="keyword">this</span>.foo);<span class="comment">//执行后输出 innerBar</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    out.outFunc();<span class="comment">//outFunc 函数被out这个对象调用，所以其内部的this指向out这个对象</span></div><div class="line">    out.inner.innerFunc();<span class="comment">//innerFunc函数被inner这个对象调用，所以其内部的this指向inner这个对象</span></div><div class="line"><span class="comment">//函数体被谁调用指向谁</span></div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="总结-函数直接执行相当于被window调用，所以函数中的this指向window"><a href="#总结-函数直接执行相当于被window调用，所以函数中的this指向window" class="headerlink" title="总结:函数直接执行相当于被window调用，所以函数中的this指向window"></a>总结:函数直接执行相当于被window调用，所以函数中的this指向window</h3><p>2.5 javascript 中经常用的也就是事件的绑定，对应的事件处理函数中如果出现了this,那么这个this代表的所绑定的元素</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"按钮"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="built_in">document</span>.querySelector(<span class="string">"input"</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.value);<span class="comment">//按钮     这个this指向input标签</span></div><div class="line">    &#125;</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>2.6 setInterval(fn,time)   setTimeout(fn,time)  中的this指向window;为什么呢？大家还记得 setInterval   setTimeont都是window对象的属性吗？setInterval(fn,time)  等价于  window.setInterval(fn,time)其实是window调用了setInterval方法，所以其指向window ;</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="keyword">var</span> foo = <span class="string">"bar"</span>;</div><div class="line">    <span class="keyword">var</span> setTime = setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> foo = <span class="string">"changedBar"</span>;</div><div class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.foo);<span class="comment">//bar</span></div><div class="line">    &#125;,<span class="number">1000</span>)</div><div class="line">    <span class="built_in">console</span>.log(setTime);<span class="comment">//setInterval函数返回以个ID值，代表当前定时器，用于后期可以清除该计时器用</span></div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="3-prototype-this"><a href="#3-prototype-this" class="headerlink" title="3 prototype this"></a>3 prototype this</h2><p>原型里面的this指向，包括实例化的方法中的this指向:可以这么理解，它指向实例化的那个对象，但是,在找相应的属性的时候，它会顺着原型链一级级向上找，直到找到那个属性，如果没有找到，那么返回undefined;</p>
<p><strong>这个其实也是函数独立调用还是被对象调用的情况</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Test</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">this</span>.foo= <span class="string">"bar"</span>;</div><div class="line">        <span class="keyword">this</span>.logFoo = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="keyword">this</span>.foo);<span class="comment">//this代表实例化之后的对象</span></div><div class="line">        &#125;;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">var</span> test1 = <span class="keyword">new</span> Test();</div><div class="line">    <span class="built_in">console</span>.log(test1);</div><div class="line">  <span class="comment">//Test&#123;foo: "bar" ,logFoo: (),__proto__: Objectconstructor: Test(),__proto__: Object&#125;</span></div><div class="line"><span class="comment">//关于new出来的对象可以暂时这么理解，然后该对象的地址赋值给test1;</span></div><div class="line">    <span class="built_in">console</span>.log(test1.foo);<span class="comment">//bar</span></div><div class="line">    test1.logFoo();<span class="comment">//bar</span></div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p>通过原型添加属性和方法：this会顺着对象的原型链一直往下找，直到找到该属性为止，如果找不到的话，那么返回undefined;原型里的this也是指向实例化的对象，this.foo就是顺着原型链一直找；</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Test</span>(<span class="params"></span>)</span>&#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">    Test.prototype.foo = <span class="string">"changedBar"</span>;</div><div class="line">    Test.prototype.logFoo = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.foo);</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> test1 = <span class="keyword">new</span> Test();</div><div class="line">    <span class="built_in">console</span>.log(test1);</div><div class="line"> <span class="comment">// Test&#123;__proto__: Object,constructor: Test(),foo: "changedBar",logFoo: (),__proto__: Object</span></div><div class="line">    <span class="built_in">console</span>.log(test1.foo);<span class="comment">//changedBar</span></div><div class="line">    test1.logFoo();<span class="comment">//changedBar</span></div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p>4 </p>
<h2 id="三-this总结"><a href="#三-this总结" class="headerlink" title="三 this总结"></a>三 this总结</h2><p>1 this永远指向函数运行的时候所在的对象，而不是被创建的时候所在的对象；</p>
<p>2 匿名函数或不处于任何对象中的函数指向window</p>
<p>3 如果是call apply with   指定的this是谁，就是谁，如果是普通的函数调用，函数被谁调用，this就指向谁</p>
<p>4 如果不是被new调用函数，那么函数体的this都是指代全局范围的this,代表window对象；</p>
<p>5 函数独立运行的时候，那么this指向其所在运行的环境；函数作为对象的方法被调用的时候，this指向调用该函数的对象</p>
<p>6 <strong>如果调用者函数，被某一个对象所拥有，那么该函数在调用时，内部的this指向该对象。</strong></p>
<p><strong>如果函数独立调用，那么该函数内部的this，则指向undefined</strong>;但是在非严格模式中，当this指向undefined时，它会被自动指向全局对象。</p>
<p>严格模式下this指向</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;</div><div class="line"><span class="meta">       'use strict'</span>;</div><div class="line">       <span class="built_in">console</span>.log(<span class="keyword">this</span>);</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   fn(); <span class="comment">//undefined //        fn是调用者，独立调用 </span></div><div class="line">   <span class="built_in">window</span>.fn();  <span class="comment">//window  //  fn是调用者，被window所拥有</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">'use strict'</span>;</div><div class="line">   <span class="keyword">var</span> a = <span class="number">20</span> ;</div><div class="line">   <span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>)</span>&#123;</div><div class="line">       <span class="built_in">console</span>.log(<span class="keyword">this</span>.a);</div><div class="line">   &#125;</div><div class="line">   fn();<span class="comment">//报错</span></div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/02/145CritialRenderingPath/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/02/145CritialRenderingPath/" itemprop="url">
                  Critial Rendering Path
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-02T12:36:00+08:00">
                2016-11-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/render/" itemprop="url" rel="index">
                    <span itemprop="name">render</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-理解关键渲染路径是提高页面性能的关键所在。总体来说，关键渲染路径分为六步。"><a href="#1-理解关键渲染路径是提高页面性能的关键所在。总体来说，关键渲染路径分为六步。" class="headerlink" title="1 理解关键渲染路径是提高页面性能的关键所在。总体来说，关键渲染路径分为六步。"></a>1 理解关键渲染路径是提高页面性能的关键所在。总体来说，关键渲染路径分为六步。</h3><ul>
<li>创建DOM树(Constructing the DOM Tree)</li>
<li>创建CSSOM树(Constructing the CSSOM Tree)</li>
<li>执行脚本(Running JavaScript)</li>
<li>生成渲染树(Creating the Render Tree)</li>
<li>生成布局(Generating the Layout)</li>
<li>绘制(Painting)</li>
</ul>
<p><strong>创建 DOM 树</strong></p>
<p>DOM（文档对象模型）树是HTML页面完全解析后的一种表示方式。从根元素<html>开始，页面上每个元素或者文本都会创建一个对应的节点。每个节点都包含了这个元素的所有属性，并且嵌套在元素内的元素会被解析成外层元素对应的节点的子节点。</html></p>
<p><strong>创建CSSOM 树</strong></p>
<p>CSSOM（CSS对象模型）树是对附在DOM结构上的样式的一种表示方式。它与DOM树的呈现方式相似，只是每个节点都带上样式 ，包括明确定义的和隐式继承的。</p>
<p>CSS是一种渲染阻塞资源(render blocking resource)，它需要完全被解析完毕之后才能进入生成渲染树的环节。CSS并不像HTML那样能执行部分并显示，因为CSS具有继承属性， 后面定义的样式会覆盖或者修改前面的样式。如果我们只使用样式表中部分解析好的样式，我们可能会得到错误的页面效果。所以，我们只能等待CSS完全解析之后，才能进入关键渲染路径的下一环节。</p>
<p>需要注意的是，只有CSS文件适用于当前设备的时候，才能造成渲染阻塞。标签<link rel="”stylesheet”">接受media属性，该属性规定了此处的CSS文件适用于哪种设备。如果我们有个设备属性值为orientation: landscape(横向)的样式，当我们竖着浏览页面的时候，这个CSS资源是不会起作用的，也就不会阻塞渲染的过程了。</p>
<p>因为JavaScript脚本的执行必须等到CSSOM生成之后，所以说CSS也会阻塞脚本(script blocking)。</p>
<p><strong>执行JavaScript</strong></p>
<p>JavaScript是一种解析阻塞资源(parser blocking resource)，它能阻塞HTML页面的解析。</p>
<p>当页面解析到<code>&lt;script&gt;</code>标签，不管脚本是內联的还是外联，页面解析都会暂停，转而加载JavaScript文件（外联的话）并且执行JavaScript。这也是为什么如果JavaScript文件有引用HTML文档中的元素，JavaScript文件必须放在那个元素的后面。</p>
<p>为了避免JavaScript文件阻塞页面的解析，我们可以在<code>&lt;script&gt;</code>标签上添加async属性，使得JavaScript文件异步加载。</p>
<p><strong>生成渲染树</strong></p>
<p>渲染树是DOM和CSSOM的结合，是最终能渲染到页面的元素的树形结构表示。也就是说，它包含能在页面中最终呈现的元素，而不包含那些用CSS样式隐藏的元素，比如带有display: none;属性的元素。</p>
<p><strong>生成布局</strong></p>
<p>布局决定了视口的大小，为CSS样式提供了依据，比如百分比的换算或者视口的总像素值。视口大小是由meta标签的name属性为viewport的内容设置所决定的，如果缺少这个标签，默认的视口大小为980px。</p>
<p><strong>绘制</strong></p>
<p>最后，页面上可见的内容就会转化为屏幕上的像素点。</p>
<h3 id="2-绘制过程所需要花费的时间取决于DOM的大小以及元素的CSS样式。有些样式比较耗时，比如一个复杂的渐变背景色比起简单的单色背景需要更多的时间来渲染。"><a href="#2-绘制过程所需要花费的时间取决于DOM的大小以及元素的CSS样式。有些样式比较耗时，比如一个复杂的渐变背景色比起简单的单色背景需要更多的时间来渲染。" class="headerlink" title="2 绘制过程所需要花费的时间取决于DOM的大小以及元素的CSS样式。有些样式比较耗时，比如一个复杂的渐变背景色比起简单的单色背景需要更多的时间来渲染。"></a>2 绘制过程所需要花费的时间取决于DOM的大小以及元素的CSS样式。有些样式比较耗时，比如一个复杂的渐变背景色比起简单的单色背景需要更多的时间来渲染。</h3><p>转化： 浏览器从磁盘或网络读取 HTML 的原始字节，浏览器会将这段原始文件按照相应编码规范进行解码（现在一般为 utf-8）。</p>
<p>符号化：根据 W3C 标准转化为对应的符号（一般在尖括号内）。</p>
<p>DOM 构建：HTML 解析器会解析其中的 tag 标签，生成 token ，遇到 CSS 或JS 会发送相应请求。HTML 解析时阻塞主进程的，CSS 一般也是阻塞主进程的（媒体查询时例外），也就是说它们在解析过程中是无法做出响应的。而 JS 手动添加 async 后达到异步加载，根据 token 生成相应 DOM 树。</p>
<p>CSSDOM 构建，添加 CSS 样式生成 CSSDOM 树。</p>
<p>渲染树构建，从 DOM 树的根节点开始，遍历每个可见的节点，给每个可见节点找到相应匹配的 CSSOM 规则，并应用这些规则，连带其内容及计算的样式。</p>
<p>样式计算，浏览器会将所有的相对位置转换成绝对位置等一系列的样式计算。</p>
<p>布局，浏览器将元素进行定位、布局。</p>
<p>绘制，绘制元素样式，颜色、背景、大小、边框等。</p>
<p>合成，将各层合成到一起、显示在屏幕上。</p>
<p>其他优化：</p>
<ul>
<li>使用 requestAnimationFrame，将 setTimeout 换成requestAnimationFrame，因为 setTimeout 时间控制可能造成在一帧的中间，目前各浏览器对 requestAnimationFrame 的支持已经比较好了。</li>
<li>使用 Web Workers，将复杂计算的 JS 采用 Web Workers 进行处理。</li>
<li>减少垃圾回收，垃圾回收是一个容易被忽略的问题，因为垃圾回收的时间是不受控制的，它可能在一个动画的中途，阻塞动画的执行，更理想的情况是在循环中复用对象</li>
</ul>
<h3 id="3-浏览器计算-DOM-元素的几何信息的过程：元素大小和在页面中的位置。每个元素都有一个显式或隐式的大小信息，决定于其-CSS-属性的设置、或是元素本身内容的大小、或者是其父元素的大小。在Blink-WebKit-内核的浏览器和-IE-中，这个过程称为-Layout。在基于-Gecko-的浏览器（比如-Firefox）中，这个过程称为Reflow。"><a href="#3-浏览器计算-DOM-元素的几何信息的过程：元素大小和在页面中的位置。每个元素都有一个显式或隐式的大小信息，决定于其-CSS-属性的设置、或是元素本身内容的大小、或者是其父元素的大小。在Blink-WebKit-内核的浏览器和-IE-中，这个过程称为-Layout。在基于-Gecko-的浏览器（比如-Firefox）中，这个过程称为Reflow。" class="headerlink" title="3 浏览器计算 DOM 元素的几何信息的过程：元素大小和在页面中的位置。每个元素都有一个显式或隐式的大小信息，决定于其 CSS 属性的设置、或是元素本身内容的大小、或者是其父元素的大小。在Blink/WebKit 内核的浏览器和 IE 中，这个过程称为 Layout。在基于 Gecko 的浏览器（比如 Firefox）中，这个过程称为Reflow。"></a>3 浏览器计算 DOM 元素的几何信息的过程：元素大小和在页面中的位置。每个元素都有一个显式或隐式的大小信息，决定于其 CSS 属性的设置、或是元素本身内容的大小、或者是其父元素的大小。在Blink/WebKit 内核的浏览器和 IE 中，这个过程称为 Layout。在基于 Gecko 的浏览器（比如 Firefox）中，这个过程称为Reflow。</h3><p>3.1 避免触发布局</p>
<p>目前，transform 和 opacity 只会引起合成，不会引起布局和重新绘制。整个流程中比较耗费性能的布局和绘制流程将直接跳过，性能显然是很好的。其他的 CSS 属性改变引起的流程会有所不同，有些属性也会跳过布局，具体可以查看 CSS Triggers。所以，优化的第一步就是尽可能避免触发布局</p>
<p>3.2 为什么 DOM 很慢</p>
<p>谈到这里需要对浏览器利用 HTML/CSS/JavaScript 等资源呈现出精彩的页面的过程进行简单说明。浏览器在收到 HTML 文档之后会对文档进行解析开始构建 DOM (Document Object Model) 树，进而在文档中发现样式表，开始解析 CSS 来构建 CSSOM（CSS Object Model）树，这两者都构建完成后，开始构建渲染树</p>
<p>在每次修改了 DOM 或者其样式之后都要进行 DOM树的构建，CSSOM 的重新计算，进而得到新的渲染树。浏览器会利用新的渲染树对页面进行重排和重绘，以及图层的合并。通常浏览器会批量进行重排和重绘，以提高性能。但当我们试图通过 JavaScript 获取某个节点的尺寸信息的时候，为了获得当前真实的信息，浏览器会立刻进行一次重排。</p>
<p>3.3 避免强制性同步布局</p>
<p>在 JavaScript 中读取到的布局信息都是上一帧的信息，如果在 JavaScript 中修改了页面的布局，比如给某个元素添加了一个类，然后再读取布局信息。这个时候为了获得真实的布局信息，浏览器需要强制性对页面进行布局。因此应该避免这样做。</p>
<p>3.4 批量操作 DOM</p>
<p>在必须要进行频繁的 DOM 操作时，可以使用 fastdom 这样的工具，它的思路是将对页面的读取和改写放进队列，在页面重绘的时候批量执行，先进行读取后改写。因为如果将读取与改写交织在一起可能引起多次页面的重排。而利用 fastdom 就可以避免这样的情况发生。</p>
<p>虽然有了 fastdom 这样的工具，但有的时候还是不能从根本上解决问题，比如我最近遇到的一个情况，与页面简单的一次交互（轻轻滚动页面）就执行了几千次 DOM 操作，这个时候核心要解决的是减少 DOM 操作的次数。这个时候就要从代码层面考虑，看看是否有不必要的读取。</p>
<p>3.5  使用 requestAnimationFrame 来更新页面</p>
<p>我们希望在每一帧刚开始的时候对页面进行更改，目前只有使用 requestAnimationFrame 能够保证这一点。使用setTimeout 或者 setInterval 来触发更新页面的函数，该函数可能在一帧的中间或者结束的时间点上调用，进而导致该帧后面需要进行的事情没有完成，引发丢帧。</p>
<p>3.6 优化 CSS</p>
<p>CSS 选择器在匹配的时候是由右至左进行的，因此最后一个选择器常被称为关键选择器，因为最后一个选择越特殊，需要进行匹配的次数越少。要千万避免使用 *（通用选择器）作为关键选择器。因为它能匹配到所有元素，进而倒数第二个选择器还会和所有元素进行一次匹配。这导致效率很低下。</p>
<p><strong>总结</strong></p>
<p>我们可以利用Chrome开发者工具下的Timeline去观察整个关键路径渲染的过程。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/01/112-解构赋值/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/01/112-解构赋值/" itemprop="url">
                  ES6 解构赋值
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-01T12:36:00+08:00">
                2016-11-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javascript-ES6/" itemprop="url" rel="index">
                    <span itemprop="name">javascript ES6</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="解构赋值"><a href="#解构赋值" class="headerlink" title="解构赋值"></a>解构赋值</h2><p>先记住一点，无论是数组的解构赋值还是对象的解构赋值，根本是赋值操作；</p>
<ul>
<li>数组的解构赋值根据变量的位置对应赋值</li>
<li>对象的解构赋值根据匹配的模式进行赋值</li>
<li>解构赋值必须符合语法 </li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> &#123;a,b&#125;;<span class="comment">//报错</span></div><div class="line"><span class="keyword">let</span> [a,b];<span class="comment">//报错</span></div></pre></td></tr></table></figure>
<h3 id="解构可以避免在对象赋值时产生中间变量："><a href="#解构可以避免在对象赋值时产生中间变量：" class="headerlink" title="解构可以避免在对象赋值时产生中间变量："></a>解构可以避免在对象赋值时产生中间变量：</h3><p>1 数组的解构赋值(解构赋值的时候，必须符合解构赋值的格式，数据必须是可迭代的结构)</p>
<h3 id="数组的元素是按次序排列的，变量的取值由它的位置决定"><a href="#数组的元素是按次序排列的，变量的取值由它的位置决定" class="headerlink" title="数组的元素是按次序排列的，变量的取值由它的位置决定"></a>数组的元素是按次序排列的，变量的取值由它的位置决定</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> [a,b,c] = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>] </div><div class="line"><span class="comment">//等价于</span></div><div class="line"><span class="keyword">let</span> a = <span class="number">1</span>, b = <span class="number">2</span> , c = <span class="number">3</span> ;</div></pre></td></tr></table></figure>
<p>如果左边变量多余右边值，多余的变量将被赋值为undefined </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> [a,b,c] = [<span class="number">1</span>,<span class="number">2</span>] </div><div class="line"><span class="built_in">console</span>.log(c) ;<span class="comment">//undefined</span></div></pre></td></tr></table></figure>
<p>如果左边变量少于右边值，右边多余的值将会被忽略</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> [a,b,c] = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</div></pre></td></tr></table></figure>
<p>“链式”赋值:其实核心还是  赋值运算符的运算过程:　返回　＝　右边的运算数，从右向左进行运算</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> arr,first,second ;</div><div class="line">arr = [first,second] = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>];</div><div class="line"><span class="comment">//arr // [1,2,3,4]</span></div><div class="line"><span class="comment">//first 1  second 2</span></div></pre></td></tr></table></figure>
<p>变量值的”优先级”: 右边undefined &lt;  左边默认值  &lt;  右边除了undefined之外的其他值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> [a = <span class="number">1</span> ,b=<span class="number">2</span> ,c] = [<span class="literal">undefined</span>,<span class="number">2222</span>,<span class="number">3</span>]; <span class="comment">//右侧undefined不会赋值给a,右侧2222会赋值给b </span></div><div class="line"><span class="built_in">console</span>.log(a);<span class="comment">//1</span></div><div class="line"><span class="built_in">console</span>.log(b);<span class="comment">//2222</span></div><div class="line"><span class="built_in">console</span>.log(c);<span class="comment">//3</span></div></pre></td></tr></table></figure>
<p>解构赋值的原理:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">	<span class="keyword">let</span> [a = b,b=<span class="number">5</span>,c] = [<span class="number">1</span>];</div><div class="line">    <span class="built_in">console</span>.log(a);<span class="comment">//1</span></div><div class="line">    <span class="built_in">console</span>.log(b);<span class="comment">//5</span></div><div class="line">    <span class="built_in">console</span>.log(c);<span class="comment">//undefined</span></div><div class="line"><span class="comment">//等价于  let a = 1, b = 5 , c = undefined ;</span></div><div class="line"><span class="comment">//以下情况会报错</span></div><div class="line">    <span class="keyword">let</span> [a = b,b=<span class="number">5</span>,c] = [];<span class="comment">//直接报错</span></div><div class="line">    <span class="built_in">console</span>.log(a);<span class="comment">//</span></div><div class="line">    <span class="built_in">console</span>.log(b);<span class="comment">//</span></div><div class="line">    <span class="built_in">console</span>.log(c);<span class="comment">//</span></div><div class="line"><span class="comment">//等价于 let a = b , b = 5 , c = undefined ;//let声明的变量使用之前必须先被声明</span></div><div class="line">  --------------------------------------------</div><div class="line"><span class="comment">//        let a = b ;//b is not defined</span></div><div class="line"><span class="comment">//        let b = 5 ;</span></div><div class="line"><span class="comment">//        let c ;</span></div><div class="line">    <span class="comment">//对于let声明变量，变量的使用必须在声明之前才可以使用</span></div></pre></td></tr></table></figure>
<p>看下var声明</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> [a = b,b=<span class="number">5</span>,c] = [];<span class="comment">//这个不会报错，所以需要理解数据结构赋值的原理</span></div><div class="line">    <span class="built_in">console</span>.log(a);<span class="comment">//undefined</span></div><div class="line">    <span class="built_in">console</span>.log(b);<span class="comment">//5</span></div><div class="line">    <span class="built_in">console</span>.log(c);<span class="comment">//undefined</span></div><div class="line"><span class="comment">//--------------------------------------------------</span></div><div class="line">    <span class="comment">//左边进行声明</span></div><div class="line"><span class="comment">//    var a = b ;//这个相当于对 b 进行了变量提升，但是没有运行到b=5的时候，a的值被赋予undefined;</span></div><div class="line"><span class="comment">//    var b = 5 ;</span></div><div class="line"><span class="comment">//    var c ;</span></div><div class="line"><span class="comment">//    console.log(a);//undefined</span></div><div class="line">    <span class="comment">//然后右边进行赋值,原来有默认值的不会发生变化</span></div><div class="line"><span class="comment">//    ------------------------------------------------------</span></div><div class="line"><span class="comment">//        var a = b ;//b is not defined</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//        var c ;</span></div><div class="line"><span class="comment">//        console.log(a);//</span></div><div class="line"><span class="comment">//    ----------------------------------------------------------</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//如果等号的右边不是数组或者严格地说，不是可遍历的结构，那么将会报错。如下</span></div><div class="line"><span class="keyword">let</span> [foo] = <span class="number">1</span>;</div><div class="line"><span class="keyword">let</span> [foo] = <span class="literal">false</span>;</div><div class="line"><span class="keyword">let</span> [foo] = <span class="literal">NaN</span>;</div><div class="line"><span class="keyword">let</span> [foo] = <span class="literal">undefined</span>;</div><div class="line"><span class="keyword">let</span> [foo] = <span class="literal">null</span>;</div><div class="line"><span class="keyword">let</span> [foo] = &#123;&#125;;</div></pre></td></tr></table></figure>
<p>2 对象的解构赋值</p>
<h3 id="对象的属性没有次序，变量必须与属性同名，才能取到正确的值"><a href="#对象的属性没有次序，变量必须与属性同名，才能取到正确的值" class="headerlink" title="对象的属性没有次序，变量必须与属性同名，才能取到正确的值"></a>对象的属性没有次序，变量必须与属性同名，才能取到正确的值</h3><p>对象的解构赋值的内部机制，是先找到同名属性，然后再赋给对应的变量。真正被赋值的是后者，而不是前者</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> &#123;foo,bar&#125; = &#123;<span class="attr">foo</span>:<span class="string">"aaa"</span>,<span class="attr">bar</span>:<span class="string">"bbb"</span>&#125;;</div><div class="line"><span class="keyword">let</span> &#123;bar,foo&#125; = &#123;<span class="attr">foo</span>:<span class="string">"aaa"</span>,<span class="attr">bar</span>:<span class="string">"bbb"</span>&#125;;</div><div class="line"><span class="comment">//foo aaa</span></div><div class="line"><span class="comment">//bar bbb</span></div><div class="line"><span class="comment">//这点和数组的结构赋值不同，数组的结构赋值是按照元素的位置进行解构赋值，而对象的解构赋值是根据无序的属性名进行匹配，然后在进行赋值</span></div></pre></td></tr></table></figure>
<p>如果匹配不到对应的属性名，那么将会被赋值为undefined</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> &#123;baz&#125; = &#123;<span class="attr">foo1</span>:<span class="string">'aaa'</span>,<span class="attr">foo2</span>:<span class="string">'bbb'</span>&#125;</div><div class="line"><span class="built_in">console</span>.log(baz);<span class="comment">//undefined</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> &#123;baz&#125; = &#123;&#125;</div><div class="line"><span class="built_in">console</span>.log(baz);<span class="comment">//undefined</span></div></pre></td></tr></table></figure>
<p>对象的解构赋值，根本是给属性的属性值进行的赋值 </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span>&#123;foo&#125; = &#123;<span class="attr">foo</span>:<span class="string">'aaa'</span>,<span class="attr">bar</span>:<span class="string">'bbb'</span>&#125;;</div><div class="line"><span class="built_in">console</span>.log(foo);<span class="comment">//aaa</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span>&#123;<span class="attr">foo</span>:baz&#125; = &#123;<span class="attr">foo</span>:<span class="string">'aaa'</span>,<span class="attr">bar</span>:<span class="string">'bbb'</span>&#125;;<span class="comment">//采用这种写法时，变量的声明和赋值是一体的</span></div><div class="line"><span class="built_in">console</span>.log(baz);<span class="comment">//aaa</span></div><div class="line"><span class="built_in">console</span>.log(foo);<span class="comment">//foo is not defined</span></div></pre></td></tr></table></figure>
<p>从上面两段代码可以看出来，其实对象的解构赋值，</p>
<ul>
<li>根本还是对象的属性的简洁语法表示</li>
<li>解构赋值是先进行变量的声明</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> &#123; foo,bar&#125; = &#123; <span class="attr">foo</span>: <span class="string">"aaa"</span>, <span class="attr">bar</span>: <span class="string">"bbb"</span> &#125;;</div><div class="line"><span class="keyword">let</span> &#123; <span class="attr">foo</span>: foo, <span class="attr">bar</span>: bar &#125; = &#123; <span class="attr">foo</span>: <span class="string">"aaa"</span>, <span class="attr">bar</span>: <span class="string">"bbb"</span> &#125;;</div></pre></td></tr></table></figure>
<p>如果是采用以下赋值形式{ } 必须用( ) 括起来，否则浏览器会认为那是一个代码块,会报错</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">(&#123;<span class="attr">foo</span>:baz&#125; = &#123;<span class="attr">foo</span>:<span class="string">'aaa'</span>&#125;);</div><div class="line"><span class="built_in">console</span>.log(baz);<span class="comment">//aaa</span></div></pre></td></tr></table></figure>
<p> 为了说明对象的解构赋值的匹配模式的，看下面的代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span>&#123;<span class="attr">foo</span>:baz&#125; = &#123;&#125;;</div><div class="line"><span class="built_in">console</span>.log(baz);<span class="comment">//undefined</span></div><div class="line"><span class="built_in">console</span>.log(foo);<span class="comment">//foo is not defined</span></div><div class="line"><span class="comment">//这个时候，我们应该能理解   let&#123;foo:baz&#125; 声明的变量是baz ,并不是foo,foo是匹配的模式，匹配的根据</span></div></pre></td></tr></table></figure>
<p>体会下下面的两段代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">console</span>.log(name);<span class="comment">//报错 name is not defined</span></div><div class="line"><span class="keyword">let</span> &#123;<span class="attr">heheh</span>:name&#125; = &#123;<span class="attr">heheh</span>:<span class="string">'aaa'</span>&#125;;</div><div class="line"><span class="built_in">console</span>.log(name);</div><div class="line"><span class="comment">//这个也证明了 let &#123;heheh:name&#125; 声明的是 : 后面的变量</span></div><div class="line"><span class="comment">//而let&#123;foo ,bar &#125; 其实是分为两步，第一对象的简洁写法&#123;foo,bar&#125; ==&gt; &#123;foo:foo,bar:bar&#125;</span></div><div class="line"><span class="comment">//所以let声明的变量还是 : 冒号后面的变量，然后在进行解构赋值操作</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">console</span>.log(name);<span class="comment">//aaa</span></div><div class="line">(&#123;<span class="attr">heheh</span>:name&#125; = &#123;<span class="attr">heheh</span>:<span class="string">'aaa'</span>&#125;);</div><div class="line"><span class="built_in">console</span>.log(name);<span class="comment">//aaa</span></div></pre></td></tr></table></figure>
<p>对象的解构赋值是可以嵌套的，同样对于匹配模式(属性名)还是要有深刻的认识</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">(&#123;<span class="attr">p</span>:[x,&#123;<span class="attr">y</span>:z&#125;]&#125; = &#123;<span class="attr">p</span>:[<span class="string">'hello'</span>,&#123;&#125;]&#125; );</div><div class="line"><span class="built_in">console</span>.log(x);<span class="comment">//hello</span></div><div class="line"><span class="built_in">console</span>.log(z);<span class="comment">//undefined</span></div><div class="line"><span class="built_in">console</span>.log(y);<span class="comment">//y is not defined</span></div><div class="line"><span class="comment">// p 和 y 都是匹配模式</span></div></pre></td></tr></table></figure>
<p>undefined再取属性的时候会报错</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> _temp = &#123;<span class="attr">bar</span>:<span class="string">"baz"</span>&#125;;</div><div class="line"><span class="built_in">console</span>.log(_temp.foo);<span class="comment">//undefined</span></div><div class="line"><span class="built_in">console</span>.log(_temp.foo.anything);<span class="comment">// Cannot read property 'anything' of undefined</span></div></pre></td></tr></table></figure>
<p>如果解构模式是嵌套的对象，而且子对象所在的父属性不存在，那么将会报错。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> &#123;<span class="attr">foo</span>:&#123;<span class="attr">bar</span>:baz&#125;&#125; = &#123;<span class="attr">hehe</span>:&#123;<span class="attr">bar</span>:<span class="string">'value'</span>&#125;&#125;</div><div class="line"><span class="comment">//上面代码中，等号左边对象的foo属性，对应一个子对象。该子对象的bar属性，解构时会报错。原因很简单，因为foo这时等于undefined，再取子属性就会报错，请看下面的代码</span></div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/10/27/69jseval 和 JSON parse/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/27/69jseval 和 JSON parse/" itemprop="url">
                  eval JSONparse
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-27T12:36:00+08:00">
                2016-10-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javascript-json/" itemprop="url" rel="index">
                    <span itemprop="name">javascript json</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="js-的-eval-和-JSON-parse-的用法和区别"><a href="#js-的-eval-和-JSON-parse-的用法和区别" class="headerlink" title="js 的 eval( ) 和 JSON.parse(  ) 的用法和区别:"></a>js 的 eval( ) 和 JSON.parse(  ) 的用法和区别:</h3><p>1 eval(string):这个全局函数可以用来接受一个字符串作为javascript代码去执行，也就是说，传入的参数可以作为脚本代码进行执行；比如创建变量，创建对象，执行函数等</p>
<ul>
<li>如果传入的值  是一个字符串，那么则将字符串作为代码执行，如果有返回值，则返回该值，如果没有返回值，则返回undefined</li>
<li>如果传入的值   不是一个字符串，那么则直接返回传入的值</li>
<li>需要特别注意的是对象的声明语法 { }  如果直接将{ } 声明的对象作为值传入，则直接返回该对象，如果是 ‘{  }’  作为参数传入eval( )则会直接报错;</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="built_in">eval</span>(<span class="string">"var a=1"</span>);<span class="comment">//声明一个变量a并赋值1。传入参数是一个字符串，则将该字符串作为代码执行</span></div><div class="line">    <span class="built_in">console</span>.log( <span class="built_in">eval</span>(<span class="string">"var a=1"</span>) );<span class="comment">//undefined   因为没有返回值，所以结果是undefined</span></div><div class="line">    <span class="built_in">eval</span>(<span class="string">"2+3"</span>);<span class="comment">//执行加运算，并返回运算值。</span></div><div class="line">    <span class="built_in">console</span>.log(  <span class="built_in">eval</span>(<span class="string">"2+3"</span>) );<span class="comment">//5</span></div><div class="line">    <span class="built_in">eval</span>(<span class="string">"&#123;b:2&#125;"</span>);<span class="comment">//声明一个对象。 </span></div><div class="line">	<span class="built_in">eval</span>(<span class="string">"mytest()"</span>);<span class="comment">//执行mytest()函数。</span></div><div class="line">	<span class="built_in">console</span>.log( <span class="built_in">eval</span>( &#123;<span class="attr">b</span>:<span class="number">2</span>,<span class="string">"nema"</span>:<span class="string">"jhon"</span>&#125;) );<span class="comment">//Object &#123;b: 2, nema: "jhon"&#125;，传入参数不是一个字符串，那么直接返回传入的值</span></div><div class="line">	<span class="built_in">console</span>.log( <span class="built_in">eval</span>(<span class="string">'&#123;"b":2,"nema":"jhon"&#125;'</span>) );<span class="comment">//会直接报错</span></div><div class="line"><span class="comment">//如果想要将字符串    '&#123;"b":2,"nema":"jhon"&#125;'  转化为常用的对象输出，则需要将其加上小括号，转化为表达式，才能正确输出对象，以下几种写法都是正确的</span></div><div class="line">	<span class="keyword">var</span> code2 = <span class="string">'&#123;"b":2,"nema":"jhon"&#125;'</span>;</div><div class="line"><span class="comment">//    console.log( eval('&#123;"b":2,"nema":"jhon"&#125;') );//浏览器报错</span></div><div class="line">    <span class="built_in">console</span>.log( <span class="built_in">eval</span>(<span class="string">'('</span>+code2+<span class="string">')'</span>) ); <span class="comment">//Object &#123;b: 2, nema: "jhon"&#125;</span></div><div class="line">    <span class="built_in">console</span>.log( <span class="built_in">eval</span>(<span class="string">'('</span>+<span class="string">'&#123;b:2,"nema":"jhon"&#125;'</span>+<span class="string">')'</span>) ); <span class="comment">//Object &#123;b: 2, nema: "jhon"&#125;</span></div><div class="line">    <span class="built_in">console</span>.log( <span class="built_in">eval</span>(<span class="string">'(&#123;b:2,"nema":"jhon"&#125;)'</span>) );<span class="comment">//Object &#123;b: 2, nema: "jhon"&#125;</span></div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p>2 eval(string)函数的作用域:关键记住，val()函数并不会创建一个新的作用域，并且它的作用域就是它所在的作用域。这在所有主流浏览器都是如此，但是有时候需要将eval()函数的作用域设置为全局，当然可以将eval()在全局作用域中使用，但是往往实际应用中，需要在局部作用域使用具有全局作用域的此函数，这个时候可以用window.eval()的方式实现</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">test</span> (<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">eval</span>(<span class="string">"var num = 4"</span>);</div><div class="line">        <span class="built_in">console</span>.log(num);<span class="comment">//4</span></div><div class="line">    &#125;</div><div class="line">    test();</div><div class="line"><span class="comment">//    console.log(num);//num is not defined</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">test1</span> (<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">window</span>.eval(<span class="string">"var num = 4"</span>);</div><div class="line">        <span class="built_in">console</span>.log(num);<span class="comment">//4</span></div><div class="line">    &#125;</div><div class="line">    test1();</div><div class="line">    <span class="built_in">console</span>.log(num);<span class="comment">//4</span></div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p>3 eval()可以将字符串解析为对象，同样JSON.parse()也可以将字符串解析为对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> data = <span class="string">'&#123;"b":2,"nema":"jhon"&#125;'</span>; <span class="comment">//这是一个字符串</span></div><div class="line"><span class="comment">//第一种方法，通过eval()将其解析成对象</span></div><div class="line"><span class="keyword">var</span> objData1 = <span class="built_in">eval</span>( <span class="string">"("</span>+data+<span class="string">")"</span>  ); <span class="comment">////Object &#123;b: 2, nema: "jhon"&#125;</span></div><div class="line"><span class="comment">//第二种方法</span></div><div class="line"><span class="keyword">var</span> objData2 = JSONparse(data);<span class="comment">//Object &#123;b: 2, nema: "jhon"&#125;</span></div></pre></td></tr></table></figure>
<p>它们有什么区别和不同呢?</p>
<ul>
<li><p>JSON.parse()之可以解析json格式的数据，并且会对要解析的字符串进行格式检查，如果格式不正确则不进行解析，而eval()则可以解析任何字符串，eval是不安全的。</p>
</li>
<li><p>JSON.parse(  ‘ {“name”:”Jhon”,”age”:13 } ‘ ) 解析的结果是一个对象   {“name”:”Jhon”,”age”:13 }</p>
</li>
<li><p>JSON.parse( ‘ [{“name”:”Jhon”,”age”:13 } , {“name”:”Jhon”,”age”:13 }] ‘ ) 解析的结果是一个数组，里面有两个对象</p>
<p>  [{“name”:”Jhon”,”age”:13 } , {“name”:”Jhon”,”age”:13 }]</p>
<p> 总结来说:JSON.parse()可以将字符串类型的数组，转化为数组，将字符串类型的对象，转化为对象</p>
</li>
<li><p>eval( )里面可以传入非字符串的数据类型，会直接返回该类型值，比如直接传递数组 [ {“name”:”jhon”} ]  或者对象 {“name”:”jhon”} ,或者基本数据类型和复杂数据类型，但是JSON.parse( )，只能接受字符串类型的 ; 如果传入数组 </p>
<p>[ {“name”:”jhon”} ] 或者对象 {“name”:”jhon”} 会报错；</p>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></div><div class="line">    //从后台返回的数据一般是字符串类型的，需要将其解析成javascirpt对象</div><div class="line">    var data = '[&#123;"name":"jhon"&#125;,&#123;"age":16&#125;]';</div><div class="line">//    var data = [&#123;"name":"jhon"&#125;,&#123;"age":16&#125;];</div><div class="line">    var objData1 = eval(data);</div><div class="line">    var objData2 = JSON.parse(data);</div><div class="line">    console.log("this is objData1"+objData1);</div><div class="line">    console.log(objData1);</div><div class="line">    console.log("this is objData2"+objData2);</div><div class="line">    console.log(objData2);</div><div class="line">    </div><div class="line">    var num = 3 ;</div><div class="line">    console.log(eval(num));//3</div><div class="line">    console.log(eval(true));//true</div><div class="line">    console.log(eval(null));//null</div><div class="line">    console.log(eval(undefined));//undefined</div><div class="line">    console.log(eval(&#123;"name":"jhon"&#125;));//Object &#123;name: "jhon"&#125; 对象</div><div class="line">    console.log(eval([&#123;"name":"jhon"&#125;]));//[Object] 数组</div><div class="line">    console.log(JSON.parse(num));//3</div><div class="line">    console.log(JSON.parse(true));//true</div><div class="line">    console.log(JSON.parse(null));//null</div><div class="line">//  console.log(JSON.parse(undefined));//报错</div><div class="line">// console.log(JSON.parse(&#123;"name":"jhon"&#125;));//报错</div><div class="line">  console.log(JSON.parse('&#123;"name":"jhon"&#125;''));Object &#123;name: "jhon"&#125; 对象</div><div class="line"> //console.log(JSON.parse([&#123;"name":"jhon"&#125;]));//报错</div><div class="line">  console.log(JSON.parse('[&#123;"name":"jhon"&#125;]'));//[Object] 数组</div><div class="line">  console.log(JSON.parse('[1,2,3]'));  //[1,2,3]</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/10/27/147NodeJsModuleSystem/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/27/147NodeJsModuleSystem/" itemprop="url">
                  NodeJs Module System
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-27T12:36:00+08:00">
                2016-10-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/nodejs/" itemprop="url" rel="index">
                    <span itemprop="name">nodejs</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-Node-js-模块系统"><a href="#1-Node-js-模块系统" class="headerlink" title="1 Node.js 模块系统"></a>1 Node.js 模块系统</h3><p>模块是Node.js 应用程序的基本组成部分，文件和模块是一一对应的。换言之，一个 Node.js 文件就是一个模块，这个文件可能是JavaScript 代码、JSON 或者编译过的C/C++ 扩展。</p>
<p>模块之间的通信方式 : require引入  module.exports  和 exports 暴露某个模块的对外接口</p>
<h3 id="2-创建一个模块"><a href="#2-创建一个模块" class="headerlink" title="2 创建一个模块"></a>2 创建一个模块</h3><p>2.1 首先来看下node本身模块是什么</p>
<p>2.1.1 b.js文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">console</span>.log(<span class="built_in">module</span>);</div><div class="line"><span class="built_in">console</span>.log(<span class="built_in">module</span>.exports);</div></pre></td></tr></table></figure>
<p>执行命令 node b.js  输出如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">Module &#123;</div><div class="line">  <span class="attr">id</span>: <span class="string">'.'</span>,</div><div class="line">  <span class="attr">exports</span>: &#123;&#125;,</div><div class="line">  <span class="attr">parent</span>: <span class="literal">null</span>,  <span class="comment">//</span></div><div class="line">  filename: <span class="string">'F:\\workspace\\01-node\\b.js'</span>, <span class="comment">//代表文件的路径</span></div><div class="line">  loaded: <span class="literal">false</span>,</div><div class="line">  <span class="attr">children</span>: [],</div><div class="line">  <span class="attr">paths</span>:</div><div class="line">   [ <span class="string">'F:\\workspace\\01-node\\node_modules'</span>,</div><div class="line">     <span class="string">'F:\\workspace\\node_modules'</span>,</div><div class="line">     <span class="string">'F:\\node_modules'</span> ] &#125;</div><div class="line">&#123;&#125;   <span class="comment">//这个是module.exports  本身是一个空对象</span></div></pre></td></tr></table></figure>
<p>a.js 文件            require(package)  返回值是module.exports</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> res = <span class="built_in">require</span>(<span class="string">'./b.js'</span>);</div><div class="line"><span class="built_in">console</span>.log(res);</div></pre></td></tr></table></figure>
<p>执行命令 node a.js  输出如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">Module &#123;</div><div class="line">  <span class="attr">id</span>: <span class="string">'F:\\workspace\\01-node\\b.js'</span>,</div><div class="line">  <span class="attr">exports</span>: &#123;&#125;,</div><div class="line">  <span class="attr">parent</span>:</div><div class="line">   Module &#123;</div><div class="line">     <span class="attr">id</span>: <span class="string">'.'</span>,</div><div class="line">     <span class="attr">exports</span>: &#123;&#125;,</div><div class="line">     <span class="attr">parent</span>: <span class="literal">null</span>,</div><div class="line">     <span class="attr">filename</span>: <span class="string">'F:\\workspace\\01-node\\a.js'</span>,</div><div class="line">     <span class="attr">loaded</span>: <span class="literal">false</span>,</div><div class="line">     <span class="attr">children</span>: [ [Circular] ],</div><div class="line">     <span class="attr">paths</span>:</div><div class="line">      [ <span class="string">'F:\\workspace\\01-node\\node_modules'</span>,</div><div class="line">        <span class="string">'F:\\workspace\\node_modules'</span>,</div><div class="line">        <span class="string">'F:\\node_modules'</span> ] &#125;,</div><div class="line">  <span class="attr">filename</span>: <span class="string">'F:\\workspace\\01-node\\b.js'</span>,</div><div class="line">  <span class="attr">loaded</span>: <span class="literal">false</span>,</div><div class="line">  <span class="attr">children</span>: [],        <span class="comment">//被该模块引用的模块对象。</span></div><div class="line">  paths:</div><div class="line">   [ <span class="string">'F:\\workspace\\01-node\\node_modules'</span>,</div><div class="line">     <span class="string">'F:\\workspace\\node_modules'</span>,</div><div class="line">     <span class="string">'F:\\node_modules'</span> ] &#125;</div><div class="line"></div><div class="line">&#123;&#125;   <span class="comment">//以上是b.js输出</span></div><div class="line"></div><div class="line">&#123;&#125;  <span class="comment">//这个是a.js输出</span></div></pre></td></tr></table></figure>
<p>由此可得知require返回的是所引的package的module.exports；</p>
<p><strong>所以我们可以通过改变exports的值</strong></p>
<p> 2.1.2返回一个构造函数</p>
<p>b.js </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line"></div><div class="line">&#125;</div><div class="line"><span class="built_in">console</span>.log(<span class="built_in">module</span>.exports);</div></pre></td></tr></table></figure>
<p>执行 node b.js </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[Function]</div></pre></td></tr></table></figure>
<p>执行 node a.js</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[Function]   //这个是b.js的输出 console.log(module.exports);</div><div class="line">[Function]   //这个是a.js的输出 console.log(res);</div></pre></td></tr></table></figure>
<p>2.1.3 或者直接给module.exports对象添加属性</p>
<p> b.js  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">module</span>.exports.prop = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</div><div class="line"><span class="built_in">console</span>.log(<span class="built_in">module</span>.exports);</div></pre></td></tr></table></figure>
<p>执行node b.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123; <span class="attr">prop</span>: [<span class="built_in">Function</span>] &#125;</div></pre></td></tr></table></figure>
<p>此时a.js通过require引用的时候返回的就是这个对象</p>
<p>以下实例便于理解:</p>
<p>2.2 exports.prop   形式创建模块</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//sayHello.js</span></div><div class="line">exports.sayhi = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">//exports对象可以定义sayhello.js将该模块的接口</span></div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"this is a module we made"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>引入创建的模块</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//main.js</span></div><div class="line"><span class="keyword">var</span> hello = <span class="built_in">require</span>(<span class="string">'./sayHello'</span>); </div><div class="line"><span class="built_in">console</span>.log(hello) ;<span class="comment">//&#123; sayhi: [Function] &#125;</span></div><div class="line">hello.sayhi();</div></pre></td></tr></table></figure>
<p>以上实例中，代码 require(‘./sayhello’) 引入了当前目录下的sayhello.js文件（./ 为当前目录，node.js默认后缀为js）。Node.js 提供了exports 和 require 两个对象，其中 exports 是模块公开的接口，require 用于从外部获取一个模块的接口，即所获取模块的 exports 对象。</p>
<p>2.3 module.exports = function(){   }</p>
<p>如果希望模块根导出为一个函数（比如构造函数）或一次导出一个完整的对象而不是每次都创建一个属性，可以把它赋值给 module.exports 而不是 exports。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//square.js</span></div><div class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">width</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">return</span>&#123;</div><div class="line">            <span class="attr">area</span> : <span class="function"><span class="params">()</span> =&gt;</span> width*width</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//main.js</span></div><div class="line"><span class="keyword">const</span> square = <span class="built_in">require</span>(<span class="string">'./square'</span>);  </div><div class="line"><span class="built_in">console</span>.log(square);<span class="comment">//[Function]</span></div><div class="line"><span class="keyword">var</span> res = square(<span class="number">2</span>);<span class="comment">//&#123; area: [Function: area] &#125;</span></div><div class="line"><span class="built_in">console</span>.log(res);</div><div class="line"><span class="built_in">console</span>.log(res.area());</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> square = <span class="built_in">require</span>(<span class="string">'./square'</span>);</div><div class="line"><span class="comment">//可以理解为 </span></div><div class="line"><span class="keyword">const</span> square = <span class="function">(<span class="params">width</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">return</span>&#123;</div><div class="line">            <span class="attr">area</span> : <span class="function"><span class="params">()</span> =&gt;</span> width*width</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>返回一个构造函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//myevents.js</span></div><div class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> <span class="title">myEvents</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">this</span>.on = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"通过on绑定事件"</span>);</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">this</span>.emit = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"通过emit触发事件"</span>);</div><div class="line">    &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//main.js</span></div><div class="line"><span class="keyword">const</span> Event = <span class="built_in">require</span>(<span class="string">'./myevents'</span>);</div><div class="line"><span class="built_in">console</span>.log(Event);</div><div class="line"><span class="keyword">var</span> event = <span class="keyword">new</span> Event();</div><div class="line"><span class="built_in">console</span>.log(event);</div><div class="line"><span class="built_in">console</span>.log(event.on);</div><div class="line"><span class="built_in">console</span>.log(event.emit);</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> Event = <span class="built_in">require</span>(<span class="string">'./myevents'</span>);</div><div class="line"><span class="comment">//可以理解为 </span></div><div class="line"><span class="keyword">const</span> Event = <span class="function"><span class="keyword">function</span> <span class="title">myEvents</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">this</span>.on = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"通过on绑定事件"</span>);</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">this</span>.emit = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"通过emit触发事件"</span>);</div><div class="line">    &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>2.4 require(module)   的内部实现，就是返回所引用模块的module.exports </p>
<p>module.exports 和 exports 的区别 :</p>
<p>exports 变量是在模块的文件级别作用域内有效的，<strong>它在模块  被执行  前被赋于 module.exports的值</strong>。</p>
<p>它有一个快捷方式，以便 module.exports.prop= … 可以被更简洁地写成 exports.prop= …。 注意，就像任何变量，如果一个新的值被赋值给 exports，它就不再绑定到 module.exports；</p>
<p>之所以有这个简洁的写法，根本原因的node做了一个工作  exports在模块执行前被赋值 module.exports</p>
<p>2.4.1  b.js </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">console</span>.log(<span class="built_in">module</span>);</div><div class="line">exports.name = <span class="string">"Jhon"</span>;</div><div class="line"><span class="comment">//可以被导出到引用的模块</span></div><div class="line"><span class="built_in">console</span>.log(<span class="built_in">module</span>);</div></pre></td></tr></table></figure>
<p>执行  node b.js   终端输出如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">Module &#123;</div><div class="line">  <span class="attr">id</span>: <span class="string">'.'</span>,</div><div class="line">  <span class="attr">exports</span>: &#123;&#125;,</div><div class="line">  <span class="attr">parent</span>: <span class="literal">null</span>,</div><div class="line">  <span class="attr">filename</span>: <span class="string">'F:\\workspace\\01-node\\10b.js'</span>,</div><div class="line">  <span class="attr">loaded</span>: <span class="literal">false</span>,</div><div class="line">  <span class="attr">children</span>: [],</div><div class="line">  <span class="attr">paths</span>:</div><div class="line">   [ <span class="string">'F:\\workspace\\01-node\\node_modules'</span>,</div><div class="line">     <span class="string">'F:\\workspace\\node_modules'</span>,</div><div class="line">     <span class="string">'F:\\node_modules'</span> ] &#125;</div><div class="line">Module &#123;</div><div class="line">  <span class="attr">id</span>: <span class="string">'.'</span>,</div><div class="line">  <span class="attr">exports</span>: &#123; <span class="attr">name</span>: <span class="string">'Jhon'</span> &#125;,</div><div class="line">  <span class="attr">parent</span>: <span class="literal">null</span>,</div><div class="line">  <span class="attr">filename</span>: <span class="string">'F:\\workspace\\01-node\\10b.js'</span>,</div><div class="line">  <span class="attr">loaded</span>: <span class="literal">false</span>,</div><div class="line">  <span class="attr">children</span>: [],</div><div class="line">  <span class="attr">paths</span>:</div><div class="line">   [ <span class="string">'F:\\workspace\\01-node\\node_modules'</span>,</div><div class="line">     <span class="string">'F:\\workspace\\node_modules'</span>,</div><div class="line">     <span class="string">'F:\\node_modules'</span> ] &#125;</div></pre></td></tr></table></figure>
<p>a.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> res = <span class="built_in">require</span>(<span class="string">'./b.js'</span>);<span class="comment">//可以得到 b 模块定义的数据  &#123; name: 'Jhon' &#125;</span></div></pre></td></tr></table></figure>
<p>2.4.2 b.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">console</span>.log(<span class="built_in">module</span>);</div><div class="line">exports = &#123;<span class="attr">name</span>:<span class="string">"Jhon"</span>&#125;;<span class="comment">//此时exports不再和module.exports指向同一块内存地址，最后导出的module.exports 还是未初始化的时候的一个空对象</span></div><div class="line"><span class="comment">//不会导出到引用的模块，只在模块内有效</span></div><div class="line"><span class="built_in">console</span>.log(<span class="built_in">module</span>);</div></pre></td></tr></table></figure>
<p>执行 node b.js    注意exports的内容</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">Module &#123;</div><div class="line">  <span class="attr">id</span>: <span class="string">'.'</span>,</div><div class="line">  <span class="attr">exports</span>: &#123;&#125;,</div><div class="line">  <span class="attr">parent</span>: <span class="literal">null</span>,</div><div class="line">  <span class="attr">filename</span>: <span class="string">'F:\\workspace\\01-node\\10b.js'</span>,</div><div class="line">  <span class="attr">loaded</span>: <span class="literal">false</span>,</div><div class="line">  <span class="attr">children</span>: [],</div><div class="line">  <span class="attr">paths</span>:</div><div class="line">   [ <span class="string">'F:\\workspace\\01-node\\node_modules'</span>,</div><div class="line">     <span class="string">'F:\\workspace\\node_modules'</span>,</div><div class="line">     <span class="string">'F:\\node_modules'</span> ] &#125;</div><div class="line">Module &#123;</div><div class="line">  <span class="attr">id</span>: <span class="string">'.'</span>,</div><div class="line">  <span class="attr">exports</span>: &#123;&#125;,</div><div class="line">  <span class="attr">parent</span>: <span class="literal">null</span>,</div><div class="line">  <span class="attr">filename</span>: <span class="string">'F:\\workspace\\01-node\\10b.js'</span>,</div><div class="line">  <span class="attr">loaded</span>: <span class="literal">false</span>,</div><div class="line">  <span class="attr">children</span>: [],</div><div class="line">  <span class="attr">paths</span>:</div><div class="line">   [ <span class="string">'F:\\workspace\\01-node\\node_modules'</span>,</div><div class="line">     <span class="string">'F:\\workspace\\node_modules'</span>,</div><div class="line">     <span class="string">'F:\\node_modules'</span> ] &#125;</div></pre></td></tr></table></figure>
<p>a.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> res = <span class="built_in">require</span>(<span class="string">'./b.js'</span>);<span class="comment">//此时得到 b 模块到处的内容  为 &#123; &#125;</span></div></pre></td></tr></table></figure>
<p>2.4.3  b.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">console</span>.log(<span class="built_in">module</span>);</div><div class="line"><span class="built_in">module</span>.exports = &#123;<span class="attr">name</span>:<span class="string">"Jhon"</span>&#125;;</div><div class="line"><span class="built_in">console</span>.log(<span class="built_in">module</span>);</div></pre></td></tr></table></figure>
<p>执行  node b.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">Module &#123;</div><div class="line">  <span class="attr">id</span>: <span class="string">'.'</span>,</div><div class="line">  <span class="attr">exports</span>: &#123;&#125;,</div><div class="line">  <span class="attr">parent</span>: <span class="literal">null</span>,</div><div class="line">  <span class="attr">filename</span>: <span class="string">'F:\\workspace\\01-node\\10b.js'</span>,</div><div class="line">  <span class="attr">loaded</span>: <span class="literal">false</span>,</div><div class="line">  <span class="attr">children</span>: [],</div><div class="line">  <span class="attr">paths</span>:</div><div class="line">   [ <span class="string">'F:\\workspace\\01-node\\node_modules'</span>,</div><div class="line">     <span class="string">'F:\\workspace\\node_modules'</span>,</div><div class="line">     <span class="string">'F:\\node_modules'</span> ] &#125;</div><div class="line">Module &#123;</div><div class="line">  <span class="attr">id</span>: <span class="string">'.'</span>,</div><div class="line">  <span class="attr">exports</span>: &#123; <span class="attr">name</span>: <span class="string">'Jhon'</span> &#125;,</div><div class="line">  <span class="attr">parent</span>: <span class="literal">null</span>,</div><div class="line">  <span class="attr">filename</span>: <span class="string">'F:\\workspace\\01-node\\10b.js'</span>,</div><div class="line">  <span class="attr">loaded</span>: <span class="literal">false</span>,</div><div class="line">  <span class="attr">children</span>: [],</div><div class="line">  <span class="attr">paths</span>:</div><div class="line">   [ <span class="string">'F:\\workspace\\01-node\\node_modules'</span>,</div><div class="line">     <span class="string">'F:\\workspace\\node_modules'</span>,</div><div class="line">     <span class="string">'F:\\node_modules'</span> ] &#125;</div></pre></td></tr></table></figure>
<p>a.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> res = <span class="built_in">require</span>(<span class="string">'./b.js'</span>);<span class="comment">//可以得到 b 模块定义的数据  &#123; name: 'Jhon' &#125;</span></div></pre></td></tr></table></figure>
<p>2.4.4 根据以上的实验结果，可以大概得知require函数的内部实现</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//require()实现</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">require</span>(<span class="params">...</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> <span class="built_in">module</span> = &#123; <span class="attr">exports</span>: &#123;&#125; &#125;;</div><div class="line">        <span class="function">(<span class="params">(<span class="built_in">module</span>, exports</span>) =&gt;</span> &#123;</div><div class="line">            <span class="comment">// 你的模块代码在这。在这个例子中，定义了一个函数。</span></div><div class="line">            <span class="function"><span class="keyword">function</span> <span class="title">some_func</span>(<span class="params"></span>) </span>&#123;&#125;;</div><div class="line">            exports = some_func;<span class="comment">// exports在文件执行前被赋值为 module.exports,这里在重新赋值其他数据，</span></div><div class="line">        <span class="comment">// 此时，exports 不再是一个 module.exports 的快捷方式，</span></div><div class="line">        <span class="comment">// 且这个模块依然导出一个空的默认对象。</span></div><div class="line">            <span class="built_in">module</span>.exports = some_func;</div><div class="line">        <span class="comment">// 此时，该模块导出 some_func，而不是默认对象。</span></div><div class="line">        &#125;)(<span class="built_in">module</span>, <span class="built_in">module</span>.exports);</div><div class="line">    <span class="keyword">return</span> <span class="built_in">module</span>.exports; <span class="comment">//require函数导出的是模块的 module.exports,而不是exports</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>2.5 require加载模块的查找规则</p>
<p>2.5.1 nodejs模块载入策略</p>
<p>Node.js的模块分为两类，一类为<strong>原生（核心）模块</strong>，一类为<strong>文件模块</strong>。原生模块在Node.js源代码编译的时候编译进了二进制执行文件，加载的速度最快。另一类文件模块是动态加载的，加载速度比原生模块慢。但是Node.js对原生模块和文件模块都进行了缓存，于是在第二次require时，是不会有重复开销的。其中原生模块都被定义在lib这个目录下面，文件模块则不定性</p>
<p>文件模块又分为以下三类模块，这三类文件以后缀名来区分，nodejs会根据后缀名来决定如何加载文件模块</p>
<ul>
<li>.js。通过fs模块同步读取js文件并编译执行。</li>
<li>.node。通过C/C++进行编写的Addon。通过dlopen方法进行加载。</li>
<li>.json。读取文件，调用JSON.parse解析加载。</li>
</ul>
<p>我们有没有考虑过这样一个情况，为什么一个文件没有声明require  module却可以直接使用这些变量值呢？其实nodejs做了以下工作:</p>
<p>假如有一个 circle.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> PI = <span class="built_in">Math</span>.PI;</div><div class="line">exports.area = <span class="function"><span class="keyword">function</span> (<span class="params">r</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> PI * r * r;</div><div class="line">&#125;;</div><div class="line">exports.circumference = <span class="function"><span class="keyword">function</span> (<span class="params">r</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="number">2</span> * PI * r;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>app.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> circle = <span class="built_in">require</span>(<span class="string">'./circle.js'</span>);</div><div class="line"><span class="built_in">console</span>.log( <span class="string">'The area of a circle of radius 4 is '</span> + circle.area(<span class="number">4</span>));</div></pre></td></tr></table></figure>
<p>当我们在终端执行命令  node app.js    的时候，nodejs会对app.js进行编译包装，包装之后其实就是</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">exports, require, module, __filename, __dirname</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> circle = <span class="built_in">require</span>(<span class="string">'./circle.js'</span>);</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'The area of a circle of radius 4 is '</span> + circle.area(<span class="number">4</span>));</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>这就是为什么我们直接在终端输入命令    node filename.js的时候，可以直接调用 exports require module等</p>
<p>接下来我们来看下require加载文件的查找策略:</p>
<h4 id="从文件模块缓存中加载"><a href="#从文件模块缓存中加载" class="headerlink" title="从文件模块缓存中加载"></a>从文件模块缓存中加载</h4><p>尽管原生模块与文件模块的优先级不同，但是都不会优先于从文件模块的缓存中加载已经存在的模块。</p>
<h4 id="从原生模块加载"><a href="#从原生模块加载" class="headerlink" title="从原生模块加载"></a>从原生模块加载</h4><p>原生模块的优先级仅次于文件模块缓存的优先级。require方法在解析文件名之后，优先检查模块是否在原生模块列表中。以http模块为例，尽管在目录下存在一个http/http.js/http.node/http.json文件，require(“http”)都不会从这些文件中加载，而是从原生模块中加载。</p>
<p>原生模块也有一个缓存区，同样也是优先从缓存区加载。如果缓存区没有被加载过，则调用原生模块的加载方式进行加载和执行。</p>
<h4 id="从文件加载"><a href="#从文件加载" class="headerlink" title="从文件加载"></a>从文件加载</h4><p>当文件模块缓存中不存在，而且不是原生模块的时候，Node.js会解析require方法传入的参数，并从文件系统中加载实际的文件，加载过程中的包装和编译细节在前一节中已经介绍过，这里我们将详细描述查找文件模块的过程，其中，也有一些细节值得知晓。</p>
<p>require方法接受以下几种参数的传递：</p>
<ul>
<li>http、fs、path等，原生模块。</li>
<li>./mod或../mod，相对路径的文件模块。</li>
<li>/pathtomodule/mod，绝对路径的文件模块。</li>
<li>mod，非原生模块的文件模块。</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/10/22/23-拖拉事件/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/22/23-拖拉事件/" itemprop="url">
                  drag Event
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-22T12:36:00+08:00">
                2016-10-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/html/" itemprop="url" rel="index">
                    <span itemprop="name">html</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="拖拉事件"><a href="#拖拉事件" class="headerlink" title="拖拉事件"></a>拖拉事件</h2><p>拖拉指的是，用户在某个对象上按下鼠标键不放，拖动它到另一个位置，然后释放鼠标键，将该对象放在那里。</p>
<p>拖拉的对象有好几种，包括Element节点、图片、链接、选中的文字等等。在HTML网页中，除了Element节点默认不可以拖拉，其他（图片、链接、选中的文字）都是可以直接拖拉的。为了让Element节点可拖拉，可以将该节点的draggable属性设为true。<strong>注意draggable 是元素的属性，并不是元素的样式属性，设置在CSS样式表或者<style>标签中是没有用的</strong>  </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">draggable</span>=<span class="string">"true"</span>&gt;</span></div><div class="line">  此区域可拖拉</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>draggable属性可用于任何Element节点，但是图片（img元素）和链接（a元素）不加这个属性，就可以拖拉。对于它们，用到这个属性的时候，往往是将其设为false，防止拖拉。</p>
<p>注意，一旦某个Element节点的draggable属性设为true，就无法再用鼠标选中该节点内部的文字或子节点了。</p>
<h3 id="事件种类"><a href="#事件种类" class="headerlink" title="事件种类"></a>事件种类</h3><p>当Element节点或选中的文本被拖拉时，就会持续触发拖拉事件，包括以下一些事件。</p>
<ul>
<li><strong>drag事件</strong>：拖拉过程中，在被拖拉的节点上持续触发。</li>
<li><strong>dragstart事件</strong>：拖拉开始时在被拖拉的节点上触发，该事件的target属性是被拖拉的节点。通常应该在这个事件的监听函数中，指定拖拉的数据。</li>
<li><strong>dragend事件</strong>：拖拉结束时（释放鼠标键或按下escape键）在被拖拉的节点上触发，该事件的target属性是被拖拉的节点。它与dragStart事件，在同一个节点上触发。不管拖拉是否跨窗口，或者中途被取消，dragend事件总是会触发的。</li>
<li><strong>dragenter事件</strong>：拖拉进入当前节点时，在当前节点上触发，该事件的target属性是当前节点。通常应该在这个事件的监听函数中，指定是否允许在当前节点放下（drop）拖拉的数据。如果当前节点没有该事件的监听函数，或者监听函数不执行任何操作，就意味着不允许在当前节点放下数据。在视觉上显示拖拉进入当前节点，也是在这个事件的监听函数中设置。</li>
<li><strong>dragover事件</strong>：拖拉到当前节点上方时，在当前节点上<strong>持续</strong>触发，该事件的target属性是当前节点。该事件与dragenter事件基本类似，默认会重置当前的拖拉事件的效果（DataTransfer对象的dropEffect属性）为none，即不允许放下被拖拉的节点，所以如果允许在当前节点drop数据，通常会使用preventDefault方法，取消重置拖拉效果为none。</li>
<li><strong>dragleave事件</strong>：拖拉离开当前节点范围时，在当前节点上触发，该事件的target属性是当前节点。在视觉上显示拖拉离开当前节点，就在这个事件的监听函数中设置。</li>
<li><strong>drop事件</strong>：被拖拉的节点或选中的文本，释放到目标节点时，在目标节点上触发。注意，如果当前节点不允许drop，即使在该节点上方松开鼠标键，也不会触发该事件。如果用户按下Escape键，取消这个操作，也不会触发该事件。该事件的监听函数负责取出拖拉数据，并进行相关处理。</li>
</ul>
<p>关于拖拉事件，有以下几点注意事项。</p>
<ul>
<li>拖拉过程只触发以上这些拖拉事件，尽管鼠标在移动，但是鼠标事件不会触发。</li>
<li>将文件从操作系统拖拉进浏览器，不会触发dragStart和dragend事件。</li>
<li>dragenter和dragover事件的监听函数，用来指定可以放下（drop）拖拉的数据。由于网页的大部分区域不适合作为drop的目标节点，所以这两个事件的默认设置为当前节点不允许drop。如果想要在目标节点上drop拖拉的数据，首先必须阻止这两个事件的默认行为，或者取消这两个事件。</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ondragover</span>=<span class="string">"return false"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ondragover</span>=<span class="string">"event.preventDefault()"</span>&gt;</span></div></pre></td></tr></table></figure>
<p>上面代码中，如果不取消拖拉事件或者阻止默认行为，就不可能在div节点上drop被拖拉的节点。</p>
<p>拖拉事件用一个DragEvent对象表示，该对象继承MouseEvent对象，因此也就继承了UIEvent和Event对象。DragEvent对象只有一个独有的属性DataTransfer，其他都是继承的属性。DataTransfer属性用来读写拖拉事件中传输的数据，详见下文《DataTransfer对象》的部分。</p>
<p>下面的例子展示，如何动态改变被拖动节点的背景色。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">div.addEventListener(<span class="string">"dragstart"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</div><div class="line">  <span class="keyword">this</span>.style.backgroundColor = <span class="string">"red"</span>;</div><div class="line">&#125;, <span class="literal">false</span>);</div><div class="line">div.addEventListener(<span class="string">"dragend"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</div><div class="line">  <span class="keyword">this</span>.style.backgroundColor = <span class="string">"green"</span>;</div><div class="line">&#125;, <span class="literal">false</span>);</div></pre></td></tr></table></figure>
<p>上面代码中，div节点被拖动时，背景色会变为红色，拖动结束，又变回绿色。</p>
<p>下面是一个例子，显示如何实现将一个节点从当前父节点，拖拉到另一个父节点中。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// HTML代码为</span></div><div class="line"><span class="comment">// &lt;div class="dropzone"&gt;</span></div><div class="line"><span class="comment">//    &lt;div id="draggable" draggable="true"&gt;</span></div><div class="line"><span class="comment">//       该节点可拖拉</span></div><div class="line"><span class="comment">//    &lt;/div&gt;</span></div><div class="line"><span class="comment">// &lt;/div&gt;</span></div><div class="line"><span class="comment">// &lt;div class="dropzone"&gt;&lt;/div&gt;</span></div><div class="line"><span class="comment">// &lt;div class="dropzone"&gt;&lt;/div&gt;</span></div><div class="line"><span class="comment">// &lt;div class="dropzone"&gt;&lt;/div&gt;</span></div><div class="line"></div><div class="line"><span class="comment">// 被拖拉节点</span></div><div class="line"><span class="keyword">var</span> dragged;</div><div class="line"></div><div class="line"><span class="built_in">document</span>.addEventListener(<span class="string">"dragstart"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> event </span>) </span>&#123;</div><div class="line">  <span class="comment">// 保存被拖拉节点</span></div><div class="line">  dragged = event.target;</div><div class="line">  <span class="comment">// 被拖拉节点的背景色变透明</span></div><div class="line">  event.target.style.opacity = <span class="number">0.5</span>;</div><div class="line">  <span class="comment">// 兼容Firefox</span></div><div class="line">  event.dataTransfer.setData(<span class="string">'text/plain'</span>, <span class="string">'anything'</span>);</div><div class="line">&#125;, <span class="literal">false</span>);</div><div class="line"></div><div class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'dragend'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> event </span>) </span>&#123;</div><div class="line">  <span class="comment">// 被拖拉节点的背景色恢复正常</span></div><div class="line">  event.target.style.opacity = <span class="string">''</span>;</div><div class="line">&#125;, <span class="literal">false</span>);</div><div class="line"></div><div class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'dragover'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> event </span>) </span>&#123;</div><div class="line">  <span class="comment">// 防止拖拉效果被重置，允许被拖拉的节点放入目标节点</span></div><div class="line">  event.preventDefault();</div><div class="line">&#125;, <span class="literal">false</span>);</div><div class="line"></div><div class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'dragenter'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> event </span>) </span>&#123;</div><div class="line">  <span class="comment">// 目标节点的背景色变紫色</span></div><div class="line">  <span class="comment">// 由于该事件会冒泡，所以要过滤节点</span></div><div class="line">  <span class="keyword">if</span> ( event.target.className == <span class="string">'dropzone'</span> ) &#123;</div><div class="line">    event.target.style.background = <span class="string">'purple'</span>;</div><div class="line">  &#125;</div><div class="line">&#125;, <span class="literal">false</span>);</div><div class="line"></div><div class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'dragleave'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> event </span>) </span>&#123;</div><div class="line">  <span class="comment">// 目标节点的背景色恢复原样</span></div><div class="line">  <span class="keyword">if</span> ( event.target.className == <span class="string">'dropzone'</span> ) &#123;</div><div class="line">    event.target.style.background = <span class="string">""</span>;</div><div class="line">  &#125;</div><div class="line">&#125;, <span class="literal">false</span>);</div><div class="line"></div><div class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'drop'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> event </span>) </span>&#123;</div><div class="line">  <span class="comment">// 防止事件默认行为（比如某些Elment节点上可以打开链接）</span></div><div class="line">  event.preventDefault();</div><div class="line">  <span class="keyword">if</span> ( event.target.className === <span class="string">'dropzone'</span> ) &#123;</div><div class="line">    <span class="comment">// 恢复目标节点背景色</span></div><div class="line">    event.target.style.background = <span class="string">''</span>;</div><div class="line">    <span class="comment">// 将被拖拉节点插入目标节点</span></div><div class="line">    dragged.parentNode.removeChild( dragged );</div><div class="line">    event.target.appendChild( dragged );</div><div class="line">  &#125;</div><div class="line">&#125;, <span class="literal">false</span>);</div></pre></td></tr></table></figure>
<h3 id="DataTransfer对象概述"><a href="#DataTransfer对象概述" class="headerlink" title="DataTransfer对象概述"></a>DataTransfer对象概述</h3><p>所有的拖拉事件都有一个dataTransfer属性，用来保存需要传递的数据。这个属性的值是一个DataTransfer对象。</p>
<p>拖拉的数据保存两方面的数据：数据的种类（又称格式）和数据的值。数据的种类是一个MIME字符串，比如 text/plain或者image/jpeg，数据的值是一个字符串。一般来说，如果拖拉一段文本，则数据默认就是那段文本；如果拖拉一个链接，则数据默认就是链接的URL。</p>
<p>当拖拉事件开始的时候，可以提供数据类型和数据值；在拖拉过程中，通过dragenter和dragover事件的监听函数，检查数据类型，以确定是否允许放下（drop）被拖拉的对象。比如，在只允许放下链接的区域，检查拖拉的数据类型是否为text/uri-list。</p>
<p>发生drop事件时，监听函数取出拖拉的数据，对其进行处理。</p>
<h3 id="DataTransfer对象的属性"><a href="#DataTransfer对象的属性" class="headerlink" title="DataTransfer对象的属性"></a>DataTransfer对象的属性</h3><p>DataTransfer对象有以下属性。</p>
<p><strong>（1）dropEffect</strong></p>
<p>dropEffect属性设置放下（drop）被拖拉节点时的效果，可能的值包括copy（复制被拖拉的节点）、move（移动被拖拉的节点）、link（创建指向被拖拉的节点的链接）、none（无法放下被拖拉的节点）。设置除此以外的值，都是无效的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">target.addEventListener(<span class="string">'dragover'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</div><div class="line">  e.preventDefault();</div><div class="line">  e.stopPropagation();</div><div class="line">  e.dataTransfer.dropEffect = <span class="string">'copy'</span>;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>dropEffect属性一般在dragenter和dragover事件的监听函数中设置，对于dragstart、drag、dragleave这三个事件，该属性不起作用。进入目标节点后，拖拉行为会初始化成用户设定的效果，用户可以通过按下Shift键和Control键，改变初始设置，在copy、move、link三种效果中切换。</p>
<p>鼠标箭头会根据dropEffect属性改变形状，提示目前正处于哪一种效果。这意味着，通过鼠标就能判断是否可以在当前节点drop被拖拉的节点。</p>
<p><strong>（2）effectAllowed</strong></p>
<p>effectAllowed属性设置本次拖拉中允许的效果，可能的值包括copy（复制被拖拉的节点）、move（移动被拖拉的节点）、link（创建指向被拖拉节点的链接）、copyLink（允许copy或link）、copyMove（允许copy或move）、linkMove（允许link或move）、all（允许所有效果）、none（无法放下被拖拉的节点）、uninitialized（默认值，等同于all）。如果某种效果是不允许的，用户就无法在目标节点中达成这种效果。</p>
<p>dragstart事件的监听函数，可以设置被拖拉节点允许的效果；dragenter和dragover事件的监听函数，可以设置目标节点允许的效果。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">event.dataTransfer.effectAllowed = <span class="string">"copy"</span>;</div></pre></td></tr></table></figure>
<p>dropEffect属性和effectAllowed属性，往往配合使用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">event.dataTransfer.effectAllowed = <span class="string">"copyMove"</span>;</div><div class="line">event.dataTransfer.dropEffect = <span class="string">"copy"</span>;</div></pre></td></tr></table></figure>
<p>上面代码中，copy是指定的效果，但是可以通过Shift或Ctrl键（根据平台而定），将效果切换成move。</p>
<p>只要dropEffect属性和effectAllowed属性之中，有一个为none，就无法在目标节点上完成drop操作。</p>
<p><strong>（3）files</strong></p>
<p>files属性是一个FileList对象，包含一组本地文件，可以用来在拖拉操作中传送。如果本次拖拉不涉及文件，则属性为空的FileList对象。</p>
<p>下面就是一个接收拖拉文件的例子。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// HTML代码为</span></div><div class="line"><span class="comment">// &lt;div id="output" style="min-height: 200px;border: 1px solid black;"&gt;</span></div><div class="line"><span class="comment">//   文件拖拉到这里</span></div><div class="line"><span class="comment">// &lt;/div&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> div = <span class="built_in">document</span>.getElementById(<span class="string">'output'</span>);</div><div class="line"></div><div class="line">div.addEventListener(<span class="string">"dragenter"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> event </span>) </span>&#123;</div><div class="line">  div.textContent = <span class="string">''</span>;</div><div class="line">  event.stopPropagation();</div><div class="line">  event.preventDefault();</div><div class="line">&#125;, <span class="literal">false</span>);</div><div class="line"></div><div class="line">div.addEventListener(<span class="string">"dragover"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> event </span>) </span>&#123;</div><div class="line">  event.stopPropagation();</div><div class="line">  event.preventDefault();</div><div class="line">&#125;, <span class="literal">false</span>);</div><div class="line"></div><div class="line">div.addEventListener(<span class="string">"drop"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> event </span>) </span>&#123;</div><div class="line">  event.stopPropagation();</div><div class="line">  event.preventDefault();</div><div class="line">  <span class="keyword">var</span> files = event.dataTransfer.files;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; files.length; i++) &#123;</div><div class="line">    div.textContent += files[i].name + <span class="string">' '</span> + files[i].size + <span class="string">'字节\n'</span>;</div><div class="line">  &#125;</div><div class="line">&#125;, <span class="literal">false</span>);</div></pre></td></tr></table></figure>
<p>上面代码中，通过files属性读取拖拉文件的信息。如果想要读取文件内容，就要使用FileReader对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">div.addEventListener(<span class="string">'drop'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</div><div class="line">  e.preventDefault();</div><div class="line">  e.stopPropagation();</div><div class="line"></div><div class="line">  <span class="keyword">var</span> fileList = e.dataTransfer.files;</div><div class="line">  <span class="keyword">if</span> (fileList.length &gt; <span class="number">0</span>) &#123;</div><div class="line">    <span class="keyword">var</span> file = fileList[<span class="number">0</span>];</div><div class="line">    <span class="keyword">var</span> reader = <span class="keyword">new</span> FileReader();</div><div class="line">    reader.onloadend = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</div><div class="line">      <span class="keyword">if</span> (e.target.readyState == FileReader.DONE) &#123;</div><div class="line">        <span class="keyword">var</span> content = reader.result;</div><div class="line">        contentDiv.innerHTML = <span class="string">"File: "</span> + file.name + <span class="string">"\n\n"</span> + content;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    reader.readAsBinaryString(file);</div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p><strong>（4）types</strong></p>
<p>types属性是一个数组，保存每一次拖拉的数据格式，比如拖拉文件，则格式信息就为File。</p>
<p>下面是一个例子，通过检查dataTransfer属性的类型，决定是否允许在当前节点执行drop操作。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">contains</span>(<span class="params">list, value</span>)</span>&#123;</div><div class="line">  <span class="keyword">for</span>( <span class="keyword">var</span> i = <span class="number">0</span>; i &lt; list.length; ++i )&#123;</div><div class="line">    <span class="keyword">if</span>(list[i] === value) <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">doDragOver</span>(<span class="params">event</span>)</span>&#123;</div><div class="line">  <span class="keyword">var</span> isLink = contains( event.dataTransfer.types, <span class="string">"text/uri-list"</span>);</div><div class="line">  <span class="keyword">if</span> (isLink) event.preventDefault();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面代码中，只有当被拖拉的节点是一个链接时，才允许在当前节点放下。</p>
<h3 id="DataTransfer对象的方法"><a href="#DataTransfer对象的方法" class="headerlink" title="DataTransfer对象的方法"></a>DataTransfer对象的方法</h3><p>DataTransfer对象有以下方法。</p>
<p><strong>（1）setData()</strong></p>
<p>setData方法用来设置事件所带有的指定类型的数据。它接受两个参数，第一个是数据类型，第二个是具体数据。如果指定的类型在现有数据中不存在，则该类型将写入types属性；如果已经存在，在该类型的现有数据将被替换。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">event.dataTransfer.setData(<span class="string">"text/plain"</span>, <span class="string">"Text to drag"</span>);</div></pre></td></tr></table></figure>
<p>上面代码为事件加入纯文本格式的数据。</p>
<p>如果拖拉文本框或者拖拉选中的文本，会默认将文本数据添加到dataTransfer属性，不用手动指定。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">draggable</span>=<span class="string">"true"</span> <span class="attr">ondragstart</span>=<span class="string">"</div><div class="line">  event.dataTransfer.setData('text/plain', 'bbb')"</span>&gt;</span></div><div class="line">  aaa</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>上面代码中，拖拉数据实际上是bbb，而不是aaa。</p>
<p>下面是添加其他类型的数据。由于text/plain是最普遍支持的格式，为了保证兼容性，建议最后总是将数据保存一份纯文本的格式。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> dt = event.dataTransfer;</div><div class="line"></div><div class="line"><span class="comment">// 添加链接</span></div><div class="line">dt.setData(<span class="string">"text/uri-list"</span>, <span class="string">"http://www.example.com"</span>);</div><div class="line">dt.setData(<span class="string">"text/plain"</span>, <span class="string">"http://www.example.com"</span>);</div><div class="line"><span class="comment">// 添加HTML代码</span></div><div class="line">dt.setData(<span class="string">"text/html"</span>, <span class="string">"Hello there, &lt;strong&gt;stranger&lt;/strong&gt;"</span>);</div><div class="line">dt.setData(<span class="string">"text/plain"</span>, <span class="string">"Hello there, &lt;strong&gt;stranger&lt;/strong&gt;"</span>);</div><div class="line"><span class="comment">// 添加图像的URL</span></div><div class="line">dt.setData(<span class="string">"text/uri-list"</span>, imageurl);</div><div class="line">dt.setData(<span class="string">"text/plain"</span>, imageurl);</div></pre></td></tr></table></figure>
<p>可以一次提供多种格式的数据。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> dt = event.dataTransfer;</div><div class="line">dt.setData(<span class="string">"application/x-bookmark"</span>, bookmarkString);</div><div class="line">dt.setData(<span class="string">"text/uri-list"</span>, <span class="string">"http://www.example.com"</span>);</div><div class="line">dt.setData(<span class="string">"text/plain"</span>, <span class="string">"http://www.example.com"</span>);</div></pre></td></tr></table></figure>
<p>上面代码中，通过在同一个事件上面，存放三种类型的数据，使得拖拉事件可以在不同的对象上面，drop不同的值。注意，第一种格式是一个自定义格式，浏览器默认无法读取，这意味着，只有某个部署了特定代码的节点，才可能drop（读取到）这个数据。</p>
<p><strong>（2）getData()</strong></p>
<p>getData方法接受一个字符串（表示数据类型）作为参数，返回事件所带的指定类型的数据（通常是用setData方法添加的数据）。如果指定类型的数据不存在，则返回空字符串。通常只有drop事件触发后，才能取出数据。如果取出另一个域名存放的数据，将会报错。</p>
<p>下面是一个drop事件的监听函数，用来取出指定类型的数据。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">onDrop</span>(<span class="params">event</span>)</span>&#123;</div><div class="line">  <span class="keyword">var</span> data = event.dataTransfer.getData(<span class="string">"text/plain"</span>);</div><div class="line">  event.target.textContent = data;</div><div class="line">  event.preventDefault();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面代码取出拖拉事件的文本数据，将其替换成当前节点的文本内容。注意，这时还必须取消浏览器的默认行为，因为假如用户拖拉的是一个链接，浏览器默认会在当前窗口打开这个链接。</p>
<p>getData方法返回的是一个字符串，如果其中包含多项数据，就必须手动解析。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">doDrop</span>(<span class="params">event</span>)</span>&#123;</div><div class="line">  <span class="keyword">var</span> lines = event.dataTransfer.getData(<span class="string">"text/uri-list"</span>).split(<span class="string">"\n"</span>);</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> line <span class="keyword">of</span> lines) &#123;</div><div class="line">    <span class="keyword">let</span> link = <span class="built_in">document</span>.createElement(<span class="string">"a"</span>);</div><div class="line">    link.href = line;</div><div class="line">    link.textContent = line;</div><div class="line">    event.target.appendChild(link);</div><div class="line">  &#125;</div><div class="line">  event.preventDefault();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面代码中，getData方法返回的是一组链接，就必须自行解析。</p>
<p>类型值指定为URL，可以取出第一个有效链接。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> link = event.dataTransfer.getData(<span class="string">"URL"</span>);</div></pre></td></tr></table></figure>
<p>下面是一次性取出多种类型的数据。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">doDrop</span>(<span class="params">event</span>)</span>&#123;</div><div class="line">  <span class="keyword">var</span> types = event.dataTransfer.types;</div><div class="line">  <span class="keyword">var</span> supportedTypes = [<span class="string">"text/uri-list"</span>, <span class="string">"text/plain"</span>];</div><div class="line">  types = supportedTypes.filter(<span class="function"><span class="keyword">function</span> (<span class="params">value</span>) <span class="title">types</span>.<span class="title">includes</span>(<span class="params">value</span>));</div><div class="line">  <span class="title">if</span> (<span class="params">types.length</span>)</div><div class="line">    <span class="title">var</span> <span class="title">data</span> = <span class="title">event</span>.<span class="title">dataTransfer</span>.<span class="title">getData</span>(<span class="params">types[<span class="number">0</span>]</span>);</div><div class="line">  <span class="title">event</span>.<span class="title">preventDefault</span>(<span class="params"></span>);</div><div class="line">&#125;</span></div></pre></td></tr></table></figure>
<p><strong>（3）clearData()</strong></p>
<p>clearData方法接受一个字符串（表示数据类型）作为参数，删除事件所带的指定类型的数据。如果没有指定类型，则删除所有数据。如果指定类型不存在，则原数据不受影响。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">event.dataTransfer.clearData(<span class="string">"text/uri-list"</span>);</div></pre></td></tr></table></figure>
<p>上面代码清除事件所带的URL数据。</p>
<p><strong>（4）setDragImage()</strong></p>
<p>拖动过程中（dragstart事件触发后），浏览器会显示一张图片跟随鼠标一起移动，表示被拖动的节点。这张图片是自动创造的，通常显示为被拖动节点的外观，不需要自己动手设置。setDragImage方法可以用来自定义这张图片，它接受三个参数，第一个是img图片元素或者canvas元素，如果省略或为null则使用被拖动的节点的外观，第二个和第三个参数为鼠标相对于该图片左上角的横坐标和右坐标。</p>
<p>下面是一个例子。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// HTML代码为</span></div><div class="line"><span class="comment">// &lt;div id="drag-with-image" class="dragdemo" draggable="true"&gt;</span></div><div class="line">     drag me</div><div class="line"><span class="comment">// &lt;/div&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> div = <span class="built_in">document</span>.getElementById(<span class="string">"drag-with-image"</span>);</div><div class="line">div.addEventListener(<span class="string">"dragstart"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> img = <span class="built_in">document</span>.createElement(<span class="string">"img"</span>);</div><div class="line">  img.src = <span class="string">"http://path/to/img"</span>;</div><div class="line">  e.dataTransfer.setDragImage(img, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">&#125;, <span class="literal">false</span>);</div></pre></td></tr></table></figure></style></strong></p>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/16/">16</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right"></i></a>
  </nav>


          
          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar.jpg"
               alt="JiM-W" />
          <p class="site-author-name" itemprop="name">JiM-W</p>
           
              <p class="site-description motion-element" itemprop="description">keep fighting！</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">158</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">48</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">73</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">JiM-W</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  



  
  

  

  

  

  


  

</body>
</html>
