<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="keep fighting！">
<meta property="og:type" content="website">
<meta property="og:title" content="JiM-W">
<meta property="og:url" content="http://yoursite.com/page/5/index.html">
<meta property="og:site_name" content="JiM-W">
<meta property="og:description" content="keep fighting！">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="JiM-W">
<meta name="twitter:description" content="keep fighting！">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/5/"/>





  <title> JiM-W </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">JiM-W</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">keep Moving</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/01/112-解构赋值/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/01/112-解构赋值/" itemprop="url">
                  ES6 解构赋值
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-01T12:36:00+08:00">
                2016-11-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javascript-ES6/" itemprop="url" rel="index">
                    <span itemprop="name">javascript ES6</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="解构赋值"><a href="#解构赋值" class="headerlink" title="解构赋值"></a>解构赋值</h2><p>先记住一点，无论是数组的解构赋值还是对象的解构赋值，根本是赋值操作；</p>
<ul>
<li>数组的解构赋值根据变量的位置对应赋值</li>
<li>对象的解构赋值根据匹配的模式进行赋值</li>
<li>解构赋值必须符合语法 </li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> &#123;a,b&#125;;<span class="comment">//报错</span></div><div class="line"><span class="keyword">let</span> [a,b];<span class="comment">//报错</span></div></pre></td></tr></table></figure>
<h3 id="解构可以避免在对象赋值时产生中间变量："><a href="#解构可以避免在对象赋值时产生中间变量：" class="headerlink" title="解构可以避免在对象赋值时产生中间变量："></a>解构可以避免在对象赋值时产生中间变量：</h3><p>1 数组的解构赋值(解构赋值的时候，必须符合解构赋值的格式，数据必须是可迭代的结构)</p>
<h3 id="数组的元素是按次序排列的，变量的取值由它的位置决定"><a href="#数组的元素是按次序排列的，变量的取值由它的位置决定" class="headerlink" title="数组的元素是按次序排列的，变量的取值由它的位置决定"></a>数组的元素是按次序排列的，变量的取值由它的位置决定</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> [a,b,c] = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>] </div><div class="line"><span class="comment">//等价于</span></div><div class="line"><span class="keyword">let</span> a = <span class="number">1</span>, b = <span class="number">2</span> , c = <span class="number">3</span> ;</div></pre></td></tr></table></figure>
<p>如果左边变量多余右边值，多余的变量将被赋值为undefined </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> [a,b,c] = [<span class="number">1</span>,<span class="number">2</span>] </div><div class="line"><span class="built_in">console</span>.log(c) ;<span class="comment">//undefined</span></div></pre></td></tr></table></figure>
<p>如果左边变量少于右边值，右边多余的值将会被忽略</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> [a,b,c] = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</div></pre></td></tr></table></figure>
<p>“链式”赋值:其实核心还是  赋值运算符的运算过程:　返回　＝　右边的运算数，从右向左进行运算</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> arr,first,second ;</div><div class="line">arr = [first,second] = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>];</div><div class="line"><span class="comment">//arr // [1,2,3,4]</span></div><div class="line"><span class="comment">//first 1  second 2</span></div></pre></td></tr></table></figure>
<p>变量值的”优先级”: 右边undefined &lt;  左边默认值  &lt;  右边除了undefined之外的其他值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> [a = <span class="number">1</span> ,b=<span class="number">2</span> ,c] = [<span class="literal">undefined</span>,<span class="number">2222</span>,<span class="number">3</span>]; <span class="comment">//右侧undefined不会赋值给a,右侧2222会赋值给b </span></div><div class="line"><span class="built_in">console</span>.log(a);<span class="comment">//1</span></div><div class="line"><span class="built_in">console</span>.log(b);<span class="comment">//2222</span></div><div class="line"><span class="built_in">console</span>.log(c);<span class="comment">//3</span></div></pre></td></tr></table></figure>
<p>解构赋值的原理:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">	<span class="keyword">let</span> [a = b,b=<span class="number">5</span>,c] = [<span class="number">1</span>];</div><div class="line">    <span class="built_in">console</span>.log(a);<span class="comment">//1</span></div><div class="line">    <span class="built_in">console</span>.log(b);<span class="comment">//5</span></div><div class="line">    <span class="built_in">console</span>.log(c);<span class="comment">//undefined</span></div><div class="line"><span class="comment">//等价于  let a = 1, b = 5 , c = undefined ;</span></div><div class="line"><span class="comment">//以下情况会报错</span></div><div class="line">    <span class="keyword">let</span> [a = b,b=<span class="number">5</span>,c] = [];<span class="comment">//直接报错</span></div><div class="line">    <span class="built_in">console</span>.log(a);<span class="comment">//</span></div><div class="line">    <span class="built_in">console</span>.log(b);<span class="comment">//</span></div><div class="line">    <span class="built_in">console</span>.log(c);<span class="comment">//</span></div><div class="line"><span class="comment">//等价于 let a = b , b = 5 , c = undefined ;//let声明的变量使用之前必须先被声明</span></div><div class="line">  --------------------------------------------</div><div class="line"><span class="comment">//        let a = b ;//b is not defined</span></div><div class="line"><span class="comment">//        let b = 5 ;</span></div><div class="line"><span class="comment">//        let c ;</span></div><div class="line">    <span class="comment">//对于let声明变量，变量的使用必须在声明之前才可以使用</span></div></pre></td></tr></table></figure>
<p>看下var声明</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> [a = b,b=<span class="number">5</span>,c] = [];<span class="comment">//这个不会报错，所以需要理解数据结构赋值的原理</span></div><div class="line">    <span class="built_in">console</span>.log(a);<span class="comment">//undefined</span></div><div class="line">    <span class="built_in">console</span>.log(b);<span class="comment">//5</span></div><div class="line">    <span class="built_in">console</span>.log(c);<span class="comment">//undefined</span></div><div class="line"><span class="comment">//--------------------------------------------------</span></div><div class="line">    <span class="comment">//左边进行声明</span></div><div class="line"><span class="comment">//    var a = b ;//这个相当于对 b 进行了变量提升，但是没有运行到b=5的时候，a的值被赋予undefined;</span></div><div class="line"><span class="comment">//    var b = 5 ;</span></div><div class="line"><span class="comment">//    var c ;</span></div><div class="line"><span class="comment">//    console.log(a);//undefined</span></div><div class="line">    <span class="comment">//然后右边进行赋值,原来有默认值的不会发生变化</span></div><div class="line"><span class="comment">//    ------------------------------------------------------</span></div><div class="line"><span class="comment">//        var a = b ;//b is not defined</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//        var c ;</span></div><div class="line"><span class="comment">//        console.log(a);//</span></div><div class="line"><span class="comment">//    ----------------------------------------------------------</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//如果等号的右边不是数组或者严格地说，不是可遍历的结构，那么将会报错。如下</span></div><div class="line"><span class="keyword">let</span> [foo] = <span class="number">1</span>;</div><div class="line"><span class="keyword">let</span> [foo] = <span class="literal">false</span>;</div><div class="line"><span class="keyword">let</span> [foo] = <span class="literal">NaN</span>;</div><div class="line"><span class="keyword">let</span> [foo] = <span class="literal">undefined</span>;</div><div class="line"><span class="keyword">let</span> [foo] = <span class="literal">null</span>;</div><div class="line"><span class="keyword">let</span> [foo] = &#123;&#125;;</div></pre></td></tr></table></figure>
<p>2 对象的解构赋值</p>
<h3 id="对象的属性没有次序，变量必须与属性同名，才能取到正确的值"><a href="#对象的属性没有次序，变量必须与属性同名，才能取到正确的值" class="headerlink" title="对象的属性没有次序，变量必须与属性同名，才能取到正确的值"></a>对象的属性没有次序，变量必须与属性同名，才能取到正确的值</h3><p>对象的解构赋值的内部机制，是先找到同名属性，然后再赋给对应的变量。真正被赋值的是后者，而不是前者</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> &#123;foo,bar&#125; = &#123;<span class="attr">foo</span>:<span class="string">"aaa"</span>,<span class="attr">bar</span>:<span class="string">"bbb"</span>&#125;;</div><div class="line"><span class="keyword">let</span> &#123;bar,foo&#125; = &#123;<span class="attr">foo</span>:<span class="string">"aaa"</span>,<span class="attr">bar</span>:<span class="string">"bbb"</span>&#125;;</div><div class="line"><span class="comment">//foo aaa</span></div><div class="line"><span class="comment">//bar bbb</span></div><div class="line"><span class="comment">//这点和数组的结构赋值不同，数组的结构赋值是按照元素的位置进行解构赋值，而对象的解构赋值是根据无序的属性名进行匹配，然后在进行赋值</span></div></pre></td></tr></table></figure>
<p>如果匹配不到对应的属性名，那么将会被赋值为undefined</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> &#123;baz&#125; = &#123;<span class="attr">foo1</span>:<span class="string">'aaa'</span>,<span class="attr">foo2</span>:<span class="string">'bbb'</span>&#125;</div><div class="line"><span class="built_in">console</span>.log(baz);<span class="comment">//undefined</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> &#123;baz&#125; = &#123;&#125;</div><div class="line"><span class="built_in">console</span>.log(baz);<span class="comment">//undefined</span></div></pre></td></tr></table></figure>
<p>对象的解构赋值，根本是给属性的属性值进行的赋值 </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span>&#123;foo&#125; = &#123;<span class="attr">foo</span>:<span class="string">'aaa'</span>,<span class="attr">bar</span>:<span class="string">'bbb'</span>&#125;;</div><div class="line"><span class="built_in">console</span>.log(foo);<span class="comment">//aaa</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span>&#123;<span class="attr">foo</span>:baz&#125; = &#123;<span class="attr">foo</span>:<span class="string">'aaa'</span>,<span class="attr">bar</span>:<span class="string">'bbb'</span>&#125;;<span class="comment">//采用这种写法时，变量的声明和赋值是一体的</span></div><div class="line"><span class="built_in">console</span>.log(baz);<span class="comment">//aaa</span></div><div class="line"><span class="built_in">console</span>.log(foo);<span class="comment">//foo is not defined</span></div></pre></td></tr></table></figure>
<p>从上面两段代码可以看出来，其实对象的解构赋值，</p>
<ul>
<li>根本还是对象的属性的简洁语法表示</li>
<li>解构赋值是先进行变量的声明</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> &#123; foo,bar&#125; = &#123; <span class="attr">foo</span>: <span class="string">"aaa"</span>, <span class="attr">bar</span>: <span class="string">"bbb"</span> &#125;;</div><div class="line"><span class="keyword">let</span> &#123; <span class="attr">foo</span>: foo, <span class="attr">bar</span>: bar &#125; = &#123; <span class="attr">foo</span>: <span class="string">"aaa"</span>, <span class="attr">bar</span>: <span class="string">"bbb"</span> &#125;;</div></pre></td></tr></table></figure>
<p>如果是采用以下赋值形式{ } 必须用( ) 括起来，否则浏览器会认为那是一个代码块,会报错</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">(&#123;<span class="attr">foo</span>:baz&#125; = &#123;<span class="attr">foo</span>:<span class="string">'aaa'</span>&#125;);</div><div class="line"><span class="built_in">console</span>.log(baz);<span class="comment">//aaa</span></div></pre></td></tr></table></figure>
<p> 为了说明对象的解构赋值的匹配模式的，看下面的代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span>&#123;<span class="attr">foo</span>:baz&#125; = &#123;&#125;;</div><div class="line"><span class="built_in">console</span>.log(baz);<span class="comment">//undefined</span></div><div class="line"><span class="built_in">console</span>.log(foo);<span class="comment">//foo is not defined</span></div><div class="line"><span class="comment">//这个时候，我们应该能理解   let&#123;foo:baz&#125; 声明的变量是baz ,并不是foo,foo是匹配的模式，匹配的根据</span></div></pre></td></tr></table></figure>
<p>体会下下面的两段代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">console</span>.log(name);<span class="comment">//报错 name is not defined</span></div><div class="line"><span class="keyword">let</span> &#123;<span class="attr">heheh</span>:name&#125; = &#123;<span class="attr">heheh</span>:<span class="string">'aaa'</span>&#125;;</div><div class="line"><span class="built_in">console</span>.log(name);</div><div class="line"><span class="comment">//这个也证明了 let &#123;heheh:name&#125; 声明的是 : 后面的变量</span></div><div class="line"><span class="comment">//而let&#123;foo ,bar &#125; 其实是分为两步，第一对象的简洁写法&#123;foo,bar&#125; ==&gt; &#123;foo:foo,bar:bar&#125;</span></div><div class="line"><span class="comment">//所以let声明的变量还是 : 冒号后面的变量，然后在进行解构赋值操作</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">console</span>.log(name);<span class="comment">//aaa</span></div><div class="line">(&#123;<span class="attr">heheh</span>:name&#125; = &#123;<span class="attr">heheh</span>:<span class="string">'aaa'</span>&#125;);</div><div class="line"><span class="built_in">console</span>.log(name);<span class="comment">//aaa</span></div></pre></td></tr></table></figure>
<p>对象的解构赋值是可以嵌套的，同样对于匹配模式(属性名)还是要有深刻的认识</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">(&#123;<span class="attr">p</span>:[x,&#123;<span class="attr">y</span>:z&#125;]&#125; = &#123;<span class="attr">p</span>:[<span class="string">'hello'</span>,&#123;&#125;]&#125; );</div><div class="line"><span class="built_in">console</span>.log(x);<span class="comment">//hello</span></div><div class="line"><span class="built_in">console</span>.log(z);<span class="comment">//undefined</span></div><div class="line"><span class="built_in">console</span>.log(y);<span class="comment">//y is not defined</span></div><div class="line"><span class="comment">// p 和 y 都是匹配模式</span></div></pre></td></tr></table></figure>
<p>undefined再取属性的时候会报错</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> _temp = &#123;<span class="attr">bar</span>:<span class="string">"baz"</span>&#125;;</div><div class="line"><span class="built_in">console</span>.log(_temp.foo);<span class="comment">//undefined</span></div><div class="line"><span class="built_in">console</span>.log(_temp.foo.anything);<span class="comment">// Cannot read property 'anything' of undefined</span></div></pre></td></tr></table></figure>
<p>如果解构模式是嵌套的对象，而且子对象所在的父属性不存在，那么将会报错。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> &#123;<span class="attr">foo</span>:&#123;<span class="attr">bar</span>:baz&#125;&#125; = &#123;<span class="attr">hehe</span>:&#123;<span class="attr">bar</span>:<span class="string">'value'</span>&#125;&#125;</div><div class="line"><span class="comment">//上面代码中，等号左边对象的foo属性，对应一个子对象。该子对象的bar属性，解构时会报错。原因很简单，因为foo这时等于undefined，再取子属性就会报错，请看下面的代码</span></div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/10/27/147NodeJsModuleSystem/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/27/147NodeJsModuleSystem/" itemprop="url">
                  NodeJs Module System
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-27T12:36:00+08:00">
                2016-10-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/nodejs/" itemprop="url" rel="index">
                    <span itemprop="name">nodejs</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-Node-js-模块系统"><a href="#1-Node-js-模块系统" class="headerlink" title="1 Node.js 模块系统"></a>1 Node.js 模块系统</h3><p>模块是Node.js 应用程序的基本组成部分，文件和模块是一一对应的。换言之，一个 Node.js 文件就是一个模块，这个文件可能是JavaScript 代码、JSON 或者编译过的C/C++ 扩展。</p>
<p>模块之间的通信方式 : require引入  module.exports  和 exports 暴露某个模块的对外接口</p>
<h3 id="2-创建一个模块"><a href="#2-创建一个模块" class="headerlink" title="2 创建一个模块"></a>2 创建一个模块</h3><p>2.1 首先来看下node本身模块是什么</p>
<p>2.1.1 b.js文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">console</span>.log(<span class="built_in">module</span>);</div><div class="line"><span class="built_in">console</span>.log(<span class="built_in">module</span>.exports);</div></pre></td></tr></table></figure>
<p>执行命令 node b.js  输出如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">Module &#123;</div><div class="line">  <span class="attr">id</span>: <span class="string">'.'</span>,</div><div class="line">  <span class="attr">exports</span>: &#123;&#125;,</div><div class="line">  <span class="attr">parent</span>: <span class="literal">null</span>,  <span class="comment">//</span></div><div class="line">  filename: <span class="string">'F:\\workspace\\01-node\\b.js'</span>, <span class="comment">//代表文件的路径</span></div><div class="line">  loaded: <span class="literal">false</span>,</div><div class="line">  <span class="attr">children</span>: [],</div><div class="line">  <span class="attr">paths</span>:</div><div class="line">   [ <span class="string">'F:\\workspace\\01-node\\node_modules'</span>,</div><div class="line">     <span class="string">'F:\\workspace\\node_modules'</span>,</div><div class="line">     <span class="string">'F:\\node_modules'</span> ] &#125;</div><div class="line">&#123;&#125;   <span class="comment">//这个是module.exports  本身是一个空对象</span></div></pre></td></tr></table></figure>
<p>a.js 文件            require(package)  返回值是module.exports</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> res = <span class="built_in">require</span>(<span class="string">'./b.js'</span>);</div><div class="line"><span class="built_in">console</span>.log(res);</div></pre></td></tr></table></figure>
<p>执行命令 node a.js  输出如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">Module &#123;</div><div class="line">  <span class="attr">id</span>: <span class="string">'F:\\workspace\\01-node\\b.js'</span>,</div><div class="line">  <span class="attr">exports</span>: &#123;&#125;,</div><div class="line">  <span class="attr">parent</span>:</div><div class="line">   Module &#123;</div><div class="line">     <span class="attr">id</span>: <span class="string">'.'</span>,</div><div class="line">     <span class="attr">exports</span>: &#123;&#125;,</div><div class="line">     <span class="attr">parent</span>: <span class="literal">null</span>,</div><div class="line">     <span class="attr">filename</span>: <span class="string">'F:\\workspace\\01-node\\a.js'</span>,</div><div class="line">     <span class="attr">loaded</span>: <span class="literal">false</span>,</div><div class="line">     <span class="attr">children</span>: [ [Circular] ],</div><div class="line">     <span class="attr">paths</span>:</div><div class="line">      [ <span class="string">'F:\\workspace\\01-node\\node_modules'</span>,</div><div class="line">        <span class="string">'F:\\workspace\\node_modules'</span>,</div><div class="line">        <span class="string">'F:\\node_modules'</span> ] &#125;,</div><div class="line">  <span class="attr">filename</span>: <span class="string">'F:\\workspace\\01-node\\b.js'</span>,</div><div class="line">  <span class="attr">loaded</span>: <span class="literal">false</span>,</div><div class="line">  <span class="attr">children</span>: [],        <span class="comment">//被该模块引用的模块对象。</span></div><div class="line">  paths:</div><div class="line">   [ <span class="string">'F:\\workspace\\01-node\\node_modules'</span>,</div><div class="line">     <span class="string">'F:\\workspace\\node_modules'</span>,</div><div class="line">     <span class="string">'F:\\node_modules'</span> ] &#125;</div><div class="line"></div><div class="line">&#123;&#125;   <span class="comment">//以上是b.js输出</span></div><div class="line"></div><div class="line">&#123;&#125;  <span class="comment">//这个是a.js输出</span></div></pre></td></tr></table></figure>
<p>由此可得知require返回的是所引的package的module.exports；</p>
<p><strong>所以我们可以通过改变exports的值</strong></p>
<p> 2.1.2返回一个构造函数</p>
<p>b.js </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line"></div><div class="line">&#125;</div><div class="line"><span class="built_in">console</span>.log(<span class="built_in">module</span>.exports);</div></pre></td></tr></table></figure>
<p>执行 node b.js </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[Function]</div></pre></td></tr></table></figure>
<p>执行 node a.js</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[Function]   //这个是b.js的输出 console.log(module.exports);</div><div class="line">[Function]   //这个是a.js的输出 console.log(res);</div></pre></td></tr></table></figure>
<p>2.1.3 或者直接给module.exports对象添加属性</p>
<p> b.js  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">module</span>.exports.prop = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</div><div class="line"><span class="built_in">console</span>.log(<span class="built_in">module</span>.exports);</div></pre></td></tr></table></figure>
<p>执行node b.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123; <span class="attr">prop</span>: [<span class="built_in">Function</span>] &#125;</div></pre></td></tr></table></figure>
<p>此时a.js通过require引用的时候返回的就是这个对象</p>
<p>以下实例便于理解:</p>
<p>2.2 exports.prop   形式创建模块</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//sayHello.js</span></div><div class="line">exports.sayhi = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">//exports对象可以定义sayhello.js将该模块的接口</span></div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"this is a module we made"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>引入创建的模块</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//main.js</span></div><div class="line"><span class="keyword">var</span> hello = <span class="built_in">require</span>(<span class="string">'./sayHello'</span>); </div><div class="line"><span class="built_in">console</span>.log(hello) ;<span class="comment">//&#123; sayhi: [Function] &#125;</span></div><div class="line">hello.sayhi();</div></pre></td></tr></table></figure>
<p>以上实例中，代码 require(‘./sayhello’) 引入了当前目录下的sayhello.js文件（./ 为当前目录，node.js默认后缀为js）。Node.js 提供了exports 和 require 两个对象，其中 exports 是模块公开的接口，require 用于从外部获取一个模块的接口，即所获取模块的 exports 对象。</p>
<p>2.3 module.exports = function(){   }</p>
<p>如果希望模块根导出为一个函数（比如构造函数）或一次导出一个完整的对象而不是每次都创建一个属性，可以把它赋值给 module.exports 而不是 exports。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//square.js</span></div><div class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">width</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">return</span>&#123;</div><div class="line">            <span class="attr">area</span> : <span class="function"><span class="params">()</span> =&gt;</span> width*width</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//main.js</span></div><div class="line"><span class="keyword">const</span> square = <span class="built_in">require</span>(<span class="string">'./square'</span>);  </div><div class="line"><span class="built_in">console</span>.log(square);<span class="comment">//[Function]</span></div><div class="line"><span class="keyword">var</span> res = square(<span class="number">2</span>);<span class="comment">//&#123; area: [Function: area] &#125;</span></div><div class="line"><span class="built_in">console</span>.log(res);</div><div class="line"><span class="built_in">console</span>.log(res.area());</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> square = <span class="built_in">require</span>(<span class="string">'./square'</span>);</div><div class="line"><span class="comment">//可以理解为 </span></div><div class="line"><span class="keyword">const</span> square = <span class="function">(<span class="params">width</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">return</span>&#123;</div><div class="line">            <span class="attr">area</span> : <span class="function"><span class="params">()</span> =&gt;</span> width*width</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>返回一个构造函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//myevents.js</span></div><div class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> <span class="title">myEvents</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">this</span>.on = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"通过on绑定事件"</span>);</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">this</span>.emit = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"通过emit触发事件"</span>);</div><div class="line">    &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//main.js</span></div><div class="line"><span class="keyword">const</span> Event = <span class="built_in">require</span>(<span class="string">'./myevents'</span>);</div><div class="line"><span class="built_in">console</span>.log(Event);</div><div class="line"><span class="keyword">var</span> event = <span class="keyword">new</span> Event();</div><div class="line"><span class="built_in">console</span>.log(event);</div><div class="line"><span class="built_in">console</span>.log(event.on);</div><div class="line"><span class="built_in">console</span>.log(event.emit);</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> Event = <span class="built_in">require</span>(<span class="string">'./myevents'</span>);</div><div class="line"><span class="comment">//可以理解为 </span></div><div class="line"><span class="keyword">const</span> Event = <span class="function"><span class="keyword">function</span> <span class="title">myEvents</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">this</span>.on = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"通过on绑定事件"</span>);</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">this</span>.emit = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"通过emit触发事件"</span>);</div><div class="line">    &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>2.4 require(module)   的内部实现，就是返回所引用模块的module.exports </p>
<p>module.exports 和 exports 的区别 :</p>
<p>exports 变量是在模块的文件级别作用域内有效的，<strong>它在模块  被执行  前被赋于 module.exports的值</strong>。</p>
<p>它有一个快捷方式，以便 module.exports.prop= … 可以被更简洁地写成 exports.prop= …。 注意，就像任何变量，如果一个新的值被赋值给 exports，它就不再绑定到 module.exports；</p>
<p>之所以有这个简洁的写法，根本原因的node做了一个工作  exports在模块执行前被赋值 module.exports</p>
<p>2.4.1  b.js </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">console</span>.log(<span class="built_in">module</span>);</div><div class="line">exports.name = <span class="string">"Jhon"</span>;</div><div class="line"><span class="comment">//可以被导出到引用的模块</span></div><div class="line"><span class="built_in">console</span>.log(<span class="built_in">module</span>);</div></pre></td></tr></table></figure>
<p>执行  node b.js   终端输出如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">Module &#123;</div><div class="line">  <span class="attr">id</span>: <span class="string">'.'</span>,</div><div class="line">  <span class="attr">exports</span>: &#123;&#125;,</div><div class="line">  <span class="attr">parent</span>: <span class="literal">null</span>,</div><div class="line">  <span class="attr">filename</span>: <span class="string">'F:\\workspace\\01-node\\10b.js'</span>,</div><div class="line">  <span class="attr">loaded</span>: <span class="literal">false</span>,</div><div class="line">  <span class="attr">children</span>: [],</div><div class="line">  <span class="attr">paths</span>:</div><div class="line">   [ <span class="string">'F:\\workspace\\01-node\\node_modules'</span>,</div><div class="line">     <span class="string">'F:\\workspace\\node_modules'</span>,</div><div class="line">     <span class="string">'F:\\node_modules'</span> ] &#125;</div><div class="line">Module &#123;</div><div class="line">  <span class="attr">id</span>: <span class="string">'.'</span>,</div><div class="line">  <span class="attr">exports</span>: &#123; <span class="attr">name</span>: <span class="string">'Jhon'</span> &#125;,</div><div class="line">  <span class="attr">parent</span>: <span class="literal">null</span>,</div><div class="line">  <span class="attr">filename</span>: <span class="string">'F:\\workspace\\01-node\\10b.js'</span>,</div><div class="line">  <span class="attr">loaded</span>: <span class="literal">false</span>,</div><div class="line">  <span class="attr">children</span>: [],</div><div class="line">  <span class="attr">paths</span>:</div><div class="line">   [ <span class="string">'F:\\workspace\\01-node\\node_modules'</span>,</div><div class="line">     <span class="string">'F:\\workspace\\node_modules'</span>,</div><div class="line">     <span class="string">'F:\\node_modules'</span> ] &#125;</div></pre></td></tr></table></figure>
<p>a.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> res = <span class="built_in">require</span>(<span class="string">'./b.js'</span>);<span class="comment">//可以得到 b 模块定义的数据  &#123; name: 'Jhon' &#125;</span></div></pre></td></tr></table></figure>
<p>2.4.2 b.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">console</span>.log(<span class="built_in">module</span>);</div><div class="line">exports = &#123;<span class="attr">name</span>:<span class="string">"Jhon"</span>&#125;;<span class="comment">//此时exports不再和module.exports指向同一块内存地址，最后导出的module.exports 还是未初始化的时候的一个空对象</span></div><div class="line"><span class="comment">//不会导出到引用的模块，只在模块内有效</span></div><div class="line"><span class="built_in">console</span>.log(<span class="built_in">module</span>);</div></pre></td></tr></table></figure>
<p>执行 node b.js    注意exports的内容</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">Module &#123;</div><div class="line">  <span class="attr">id</span>: <span class="string">'.'</span>,</div><div class="line">  <span class="attr">exports</span>: &#123;&#125;,</div><div class="line">  <span class="attr">parent</span>: <span class="literal">null</span>,</div><div class="line">  <span class="attr">filename</span>: <span class="string">'F:\\workspace\\01-node\\10b.js'</span>,</div><div class="line">  <span class="attr">loaded</span>: <span class="literal">false</span>,</div><div class="line">  <span class="attr">children</span>: [],</div><div class="line">  <span class="attr">paths</span>:</div><div class="line">   [ <span class="string">'F:\\workspace\\01-node\\node_modules'</span>,</div><div class="line">     <span class="string">'F:\\workspace\\node_modules'</span>,</div><div class="line">     <span class="string">'F:\\node_modules'</span> ] &#125;</div><div class="line">Module &#123;</div><div class="line">  <span class="attr">id</span>: <span class="string">'.'</span>,</div><div class="line">  <span class="attr">exports</span>: &#123;&#125;,</div><div class="line">  <span class="attr">parent</span>: <span class="literal">null</span>,</div><div class="line">  <span class="attr">filename</span>: <span class="string">'F:\\workspace\\01-node\\10b.js'</span>,</div><div class="line">  <span class="attr">loaded</span>: <span class="literal">false</span>,</div><div class="line">  <span class="attr">children</span>: [],</div><div class="line">  <span class="attr">paths</span>:</div><div class="line">   [ <span class="string">'F:\\workspace\\01-node\\node_modules'</span>,</div><div class="line">     <span class="string">'F:\\workspace\\node_modules'</span>,</div><div class="line">     <span class="string">'F:\\node_modules'</span> ] &#125;</div></pre></td></tr></table></figure>
<p>a.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> res = <span class="built_in">require</span>(<span class="string">'./b.js'</span>);<span class="comment">//此时得到 b 模块到处的内容  为 &#123; &#125;</span></div></pre></td></tr></table></figure>
<p>2.4.3  b.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">console</span>.log(<span class="built_in">module</span>);</div><div class="line"><span class="built_in">module</span>.exports = &#123;<span class="attr">name</span>:<span class="string">"Jhon"</span>&#125;;</div><div class="line"><span class="built_in">console</span>.log(<span class="built_in">module</span>);</div></pre></td></tr></table></figure>
<p>执行  node b.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">Module &#123;</div><div class="line">  <span class="attr">id</span>: <span class="string">'.'</span>,</div><div class="line">  <span class="attr">exports</span>: &#123;&#125;,</div><div class="line">  <span class="attr">parent</span>: <span class="literal">null</span>,</div><div class="line">  <span class="attr">filename</span>: <span class="string">'F:\\workspace\\01-node\\10b.js'</span>,</div><div class="line">  <span class="attr">loaded</span>: <span class="literal">false</span>,</div><div class="line">  <span class="attr">children</span>: [],</div><div class="line">  <span class="attr">paths</span>:</div><div class="line">   [ <span class="string">'F:\\workspace\\01-node\\node_modules'</span>,</div><div class="line">     <span class="string">'F:\\workspace\\node_modules'</span>,</div><div class="line">     <span class="string">'F:\\node_modules'</span> ] &#125;</div><div class="line">Module &#123;</div><div class="line">  <span class="attr">id</span>: <span class="string">'.'</span>,</div><div class="line">  <span class="attr">exports</span>: &#123; <span class="attr">name</span>: <span class="string">'Jhon'</span> &#125;,</div><div class="line">  <span class="attr">parent</span>: <span class="literal">null</span>,</div><div class="line">  <span class="attr">filename</span>: <span class="string">'F:\\workspace\\01-node\\10b.js'</span>,</div><div class="line">  <span class="attr">loaded</span>: <span class="literal">false</span>,</div><div class="line">  <span class="attr">children</span>: [],</div><div class="line">  <span class="attr">paths</span>:</div><div class="line">   [ <span class="string">'F:\\workspace\\01-node\\node_modules'</span>,</div><div class="line">     <span class="string">'F:\\workspace\\node_modules'</span>,</div><div class="line">     <span class="string">'F:\\node_modules'</span> ] &#125;</div></pre></td></tr></table></figure>
<p>a.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> res = <span class="built_in">require</span>(<span class="string">'./b.js'</span>);<span class="comment">//可以得到 b 模块定义的数据  &#123; name: 'Jhon' &#125;</span></div></pre></td></tr></table></figure>
<p>2.4.4 根据以上的实验结果，可以大概得知require函数的内部实现</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//require()实现</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">require</span>(<span class="params">...</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> <span class="built_in">module</span> = &#123; <span class="attr">exports</span>: &#123;&#125; &#125;;</div><div class="line">        <span class="function">(<span class="params">(<span class="built_in">module</span>, exports</span>) =&gt;</span> &#123;</div><div class="line">            <span class="comment">// 你的模块代码在这。在这个例子中，定义了一个函数。</span></div><div class="line">            <span class="function"><span class="keyword">function</span> <span class="title">some_func</span>(<span class="params"></span>) </span>&#123;&#125;;</div><div class="line">            exports = some_func;<span class="comment">// exports在文件执行前被赋值为 module.exports,这里在重新赋值其他数据，</span></div><div class="line">        <span class="comment">// 此时，exports 不再是一个 module.exports 的快捷方式，</span></div><div class="line">        <span class="comment">// 且这个模块依然导出一个空的默认对象。</span></div><div class="line">            <span class="built_in">module</span>.exports = some_func;</div><div class="line">        <span class="comment">// 此时，该模块导出 some_func，而不是默认对象。</span></div><div class="line">        &#125;)(<span class="built_in">module</span>, <span class="built_in">module</span>.exports);</div><div class="line">    <span class="keyword">return</span> <span class="built_in">module</span>.exports; <span class="comment">//require函数导出的是模块的 module.exports,而不是exports</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>2.5 require加载模块的查找规则</p>
<p>2.5.1 nodejs模块载入策略</p>
<p>Node.js的模块分为两类，一类为<strong>原生（核心）模块</strong>，一类为<strong>文件模块</strong>。原生模块在Node.js源代码编译的时候编译进了二进制执行文件，加载的速度最快。另一类文件模块是动态加载的，加载速度比原生模块慢。但是Node.js对原生模块和文件模块都进行了缓存，于是在第二次require时，是不会有重复开销的。其中原生模块都被定义在lib这个目录下面，文件模块则不定性</p>
<p>文件模块又分为以下三类模块，这三类文件以后缀名来区分，nodejs会根据后缀名来决定如何加载文件模块</p>
<ul>
<li>.js。通过fs模块同步读取js文件并编译执行。</li>
<li>.node。通过C/C++进行编写的Addon。通过dlopen方法进行加载。</li>
<li>.json。读取文件，调用JSON.parse解析加载。</li>
</ul>
<p>我们有没有考虑过这样一个情况，为什么一个文件没有声明require  module却可以直接使用这些变量值呢？其实nodejs做了以下工作:</p>
<p>假如有一个 circle.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> PI = <span class="built_in">Math</span>.PI;</div><div class="line">exports.area = <span class="function"><span class="keyword">function</span> (<span class="params">r</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> PI * r * r;</div><div class="line">&#125;;</div><div class="line">exports.circumference = <span class="function"><span class="keyword">function</span> (<span class="params">r</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="number">2</span> * PI * r;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>app.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> circle = <span class="built_in">require</span>(<span class="string">'./circle.js'</span>);</div><div class="line"><span class="built_in">console</span>.log( <span class="string">'The area of a circle of radius 4 is '</span> + circle.area(<span class="number">4</span>));</div></pre></td></tr></table></figure>
<p>当我们在终端执行命令  node app.js    的时候，nodejs会对app.js进行编译包装，包装之后其实就是</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">exports, require, module, __filename, __dirname</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> circle = <span class="built_in">require</span>(<span class="string">'./circle.js'</span>);</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'The area of a circle of radius 4 is '</span> + circle.area(<span class="number">4</span>));</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>这就是为什么我们直接在终端输入命令    node filename.js的时候，可以直接调用 exports require module等</p>
<p>接下来我们来看下require加载文件的查找策略:</p>
<h4 id="从文件模块缓存中加载"><a href="#从文件模块缓存中加载" class="headerlink" title="从文件模块缓存中加载"></a>从文件模块缓存中加载</h4><p>尽管原生模块与文件模块的优先级不同，但是都不会优先于从文件模块的缓存中加载已经存在的模块。</p>
<h4 id="从原生模块加载"><a href="#从原生模块加载" class="headerlink" title="从原生模块加载"></a>从原生模块加载</h4><p>原生模块的优先级仅次于文件模块缓存的优先级。require方法在解析文件名之后，优先检查模块是否在原生模块列表中。以http模块为例，尽管在目录下存在一个http/http.js/http.node/http.json文件，require(“http”)都不会从这些文件中加载，而是从原生模块中加载。</p>
<p>原生模块也有一个缓存区，同样也是优先从缓存区加载。如果缓存区没有被加载过，则调用原生模块的加载方式进行加载和执行。</p>
<h4 id="从文件加载"><a href="#从文件加载" class="headerlink" title="从文件加载"></a>从文件加载</h4><p>当文件模块缓存中不存在，而且不是原生模块的时候，Node.js会解析require方法传入的参数，并从文件系统中加载实际的文件，加载过程中的包装和编译细节在前一节中已经介绍过，这里我们将详细描述查找文件模块的过程，其中，也有一些细节值得知晓。</p>
<p>require方法接受以下几种参数的传递：</p>
<ul>
<li>http、fs、path等，原生模块。</li>
<li>./mod或../mod，相对路径的文件模块。</li>
<li>/pathtomodule/mod，绝对路径的文件模块。</li>
<li>mod，非原生模块的文件模块。</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/10/27/69jseval 和 JSON parse/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/27/69jseval 和 JSON parse/" itemprop="url">
                  eval JSONparse
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-27T12:36:00+08:00">
                2016-10-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javascript-json/" itemprop="url" rel="index">
                    <span itemprop="name">javascript json</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="js-的-eval-和-JSON-parse-的用法和区别"><a href="#js-的-eval-和-JSON-parse-的用法和区别" class="headerlink" title="js 的 eval( ) 和 JSON.parse(  ) 的用法和区别:"></a>js 的 eval( ) 和 JSON.parse(  ) 的用法和区别:</h3><p>1 eval(string):这个全局函数可以用来接受一个字符串作为javascript代码去执行，也就是说，传入的参数可以作为脚本代码进行执行；比如创建变量，创建对象，执行函数等</p>
<ul>
<li>如果传入的值  是一个字符串，那么则将字符串作为代码执行，如果有返回值，则返回该值，如果没有返回值，则返回undefined</li>
<li>如果传入的值   不是一个字符串，那么则直接返回传入的值</li>
<li>需要特别注意的是对象的声明语法 { }  如果直接将{ } 声明的对象作为值传入，则直接返回该对象，如果是 ‘{  }’  作为参数传入eval( )则会直接报错;</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="built_in">eval</span>(<span class="string">"var a=1"</span>);<span class="comment">//声明一个变量a并赋值1。传入参数是一个字符串，则将该字符串作为代码执行</span></div><div class="line">    <span class="built_in">console</span>.log( <span class="built_in">eval</span>(<span class="string">"var a=1"</span>) );<span class="comment">//undefined   因为没有返回值，所以结果是undefined</span></div><div class="line">    <span class="built_in">eval</span>(<span class="string">"2+3"</span>);<span class="comment">//执行加运算，并返回运算值。</span></div><div class="line">    <span class="built_in">console</span>.log(  <span class="built_in">eval</span>(<span class="string">"2+3"</span>) );<span class="comment">//5</span></div><div class="line">    <span class="built_in">eval</span>(<span class="string">"&#123;b:2&#125;"</span>);<span class="comment">//声明一个对象。 </span></div><div class="line">	<span class="built_in">eval</span>(<span class="string">"mytest()"</span>);<span class="comment">//执行mytest()函数。</span></div><div class="line">	<span class="built_in">console</span>.log( <span class="built_in">eval</span>( &#123;<span class="attr">b</span>:<span class="number">2</span>,<span class="string">"nema"</span>:<span class="string">"jhon"</span>&#125;) );<span class="comment">//Object &#123;b: 2, nema: "jhon"&#125;，传入参数不是一个字符串，那么直接返回传入的值</span></div><div class="line">	<span class="built_in">console</span>.log( <span class="built_in">eval</span>(<span class="string">'&#123;"b":2,"nema":"jhon"&#125;'</span>) );<span class="comment">//会直接报错</span></div><div class="line"><span class="comment">//如果想要将字符串    '&#123;"b":2,"nema":"jhon"&#125;'  转化为常用的对象输出，则需要将其加上小括号，转化为表达式，才能正确输出对象，以下几种写法都是正确的</span></div><div class="line">	<span class="keyword">var</span> code2 = <span class="string">'&#123;"b":2,"nema":"jhon"&#125;'</span>;</div><div class="line"><span class="comment">//    console.log( eval('&#123;"b":2,"nema":"jhon"&#125;') );//浏览器报错</span></div><div class="line">    <span class="built_in">console</span>.log( <span class="built_in">eval</span>(<span class="string">'('</span>+code2+<span class="string">')'</span>) ); <span class="comment">//Object &#123;b: 2, nema: "jhon"&#125;</span></div><div class="line">    <span class="built_in">console</span>.log( <span class="built_in">eval</span>(<span class="string">'('</span>+<span class="string">'&#123;b:2,"nema":"jhon"&#125;'</span>+<span class="string">')'</span>) ); <span class="comment">//Object &#123;b: 2, nema: "jhon"&#125;</span></div><div class="line">    <span class="built_in">console</span>.log( <span class="built_in">eval</span>(<span class="string">'(&#123;b:2,"nema":"jhon"&#125;)'</span>) );<span class="comment">//Object &#123;b: 2, nema: "jhon"&#125;</span></div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p>2 eval(string)函数的作用域:关键记住，val()函数并不会创建一个新的作用域，并且它的作用域就是它所在的作用域。这在所有主流浏览器都是如此，但是有时候需要将eval()函数的作用域设置为全局，当然可以将eval()在全局作用域中使用，但是往往实际应用中，需要在局部作用域使用具有全局作用域的此函数，这个时候可以用window.eval()的方式实现</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">test</span> (<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">eval</span>(<span class="string">"var num = 4"</span>);</div><div class="line">        <span class="built_in">console</span>.log(num);<span class="comment">//4</span></div><div class="line">    &#125;</div><div class="line">    test();</div><div class="line"><span class="comment">//    console.log(num);//num is not defined</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">test1</span> (<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">window</span>.eval(<span class="string">"var num = 4"</span>);</div><div class="line">        <span class="built_in">console</span>.log(num);<span class="comment">//4</span></div><div class="line">    &#125;</div><div class="line">    test1();</div><div class="line">    <span class="built_in">console</span>.log(num);<span class="comment">//4</span></div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p>3 eval()可以将字符串解析为对象，同样JSON.parse()也可以将字符串解析为对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> data = <span class="string">'&#123;"b":2,"nema":"jhon"&#125;'</span>; <span class="comment">//这是一个字符串</span></div><div class="line"><span class="comment">//第一种方法，通过eval()将其解析成对象</span></div><div class="line"><span class="keyword">var</span> objData1 = <span class="built_in">eval</span>( <span class="string">"("</span>+data+<span class="string">")"</span>  ); <span class="comment">////Object &#123;b: 2, nema: "jhon"&#125;</span></div><div class="line"><span class="comment">//第二种方法</span></div><div class="line"><span class="keyword">var</span> objData2 = JSONparse(data);<span class="comment">//Object &#123;b: 2, nema: "jhon"&#125;</span></div></pre></td></tr></table></figure>
<p>它们有什么区别和不同呢?</p>
<ul>
<li><p>JSON.parse()之可以解析json格式的数据，并且会对要解析的字符串进行格式检查，如果格式不正确则不进行解析，而eval()则可以解析任何字符串，eval是不安全的。</p>
</li>
<li><p>JSON.parse(  ‘ {“name”:”Jhon”,”age”:13 } ‘ ) 解析的结果是一个对象   {“name”:”Jhon”,”age”:13 }</p>
</li>
<li><p>JSON.parse( ‘ [{“name”:”Jhon”,”age”:13 } , {“name”:”Jhon”,”age”:13 }] ‘ ) 解析的结果是一个数组，里面有两个对象</p>
<p>  [{“name”:”Jhon”,”age”:13 } , {“name”:”Jhon”,”age”:13 }]</p>
<p> 总结来说:JSON.parse()可以将字符串类型的数组，转化为数组，将字符串类型的对象，转化为对象</p>
</li>
<li><p>eval( )里面可以传入非字符串的数据类型，会直接返回该类型值，比如直接传递数组 [ {“name”:”jhon”} ]  或者对象 {“name”:”jhon”} ,或者基本数据类型和复杂数据类型，但是JSON.parse( )，只能接受字符串类型的 ; 如果传入数组 </p>
<p>[ {“name”:”jhon”} ] 或者对象 {“name”:”jhon”} 会报错；</p>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></div><div class="line">    //从后台返回的数据一般是字符串类型的，需要将其解析成javascirpt对象</div><div class="line">    var data = '[&#123;"name":"jhon"&#125;,&#123;"age":16&#125;]';</div><div class="line">//    var data = [&#123;"name":"jhon"&#125;,&#123;"age":16&#125;];</div><div class="line">    var objData1 = eval(data);</div><div class="line">    var objData2 = JSON.parse(data);</div><div class="line">    console.log("this is objData1"+objData1);</div><div class="line">    console.log(objData1);</div><div class="line">    console.log("this is objData2"+objData2);</div><div class="line">    console.log(objData2);</div><div class="line">    </div><div class="line">    var num = 3 ;</div><div class="line">    console.log(eval(num));//3</div><div class="line">    console.log(eval(true));//true</div><div class="line">    console.log(eval(null));//null</div><div class="line">    console.log(eval(undefined));//undefined</div><div class="line">    console.log(eval(&#123;"name":"jhon"&#125;));//Object &#123;name: "jhon"&#125; 对象</div><div class="line">    console.log(eval([&#123;"name":"jhon"&#125;]));//[Object] 数组</div><div class="line">    console.log(JSON.parse(num));//3</div><div class="line">    console.log(JSON.parse(true));//true</div><div class="line">    console.log(JSON.parse(null));//null</div><div class="line">//  console.log(JSON.parse(undefined));//报错</div><div class="line">// console.log(JSON.parse(&#123;"name":"jhon"&#125;));//报错</div><div class="line">  console.log(JSON.parse('&#123;"name":"jhon"&#125;''));Object &#123;name: "jhon"&#125; 对象</div><div class="line"> //console.log(JSON.parse([&#123;"name":"jhon"&#125;]));//报错</div><div class="line">  console.log(JSON.parse('[&#123;"name":"jhon"&#125;]'));//[Object] 数组</div><div class="line">  console.log(JSON.parse('[1,2,3]'));  //[1,2,3]</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/10/22/149URLoperation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/22/149URLoperation/" itemprop="url">
                  URL operation
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-22T12:36:00+08:00">
                2016-10-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javascript-URL/" itemprop="url" rel="index">
                    <span itemprop="name">javascript URL</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>如何操作查询字符串，返回一个查询字符串包含信息的对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> url =<span class="string">'http://www.myvirtual.com?username=Jhon&amp;age=12'</span>;<span class="comment">//将查询字符串转换为js对象</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">queryParam</span>(<span class="params">url</span>)</span>&#123;</div><div class="line">  <span class="keyword">var</span> newUrl = url.slice(url.indexOf(<span class="string">'?'</span>)+<span class="number">1</span>);</div><div class="line">  <span class="keyword">var</span> urlArr = newUrl.split(<span class="string">'&amp;'</span>);</div><div class="line">  <span class="keyword">var</span> ret = &#123;&#125;</div><div class="line">  <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span> ; i &lt; urlArr.length ; i++)&#123;</div><div class="line">    <span class="keyword">var</span> arr = urlArr[i].split(<span class="string">'='</span>);</div><div class="line">    ret[arr[<span class="number">0</span>]] = arr[<span class="number">1</span>];</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> ret ;</div><div class="line">&#125;</div><div class="line"></div><div class="line">queryParam(url);</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/10/22/127RegExpReview/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/22/127RegExpReview/" itemprop="url">
                  RegExp Review
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-22T12:36:00+08:00">
                2016-10-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javascript/" itemprop="url" rel="index">
                    <span itemprop="name">javascript</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>先来看下正则中的特殊字符</p>
<table>
<thead>
<tr>
<th><strong>特别字符</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>$</td>
<td>匹配输入字符串的结尾位置。如果设置了 RegExp 对象的 Multiline 属性，则 $ 也匹配 ‘\n’ 或 ‘\r’。要匹配 $ 字符本身，请使用 \$。</td>
</tr>
<tr>
<td>( )</td>
<td>标记一个子表达式的开始和结束位置。子表达式可以获取供以后使用。要匹配这些字符，请使用 \( 和 \)。</td>
</tr>
<tr>
<td>*</td>
<td>匹配前面的子表达式零次或多次。要匹配 <em> 字符，请使用 \</em>。</td>
</tr>
<tr>
<td>+</td>
<td>匹配前面的子表达式一次或多次。要匹配 + 字符，请使用 +。</td>
</tr>
<tr>
<td>.</td>
<td>匹配除换行符 \n之外的任何单字符。要匹配 .，请使用 \。</td>
</tr>
<tr>
<td>[ ]</td>
<td>标记一个中括号表达式的开始。要匹配 [，请使用 [。</td>
</tr>
<tr>
<td>?</td>
<td>匹配前面的子表达式零次或一次，或指明一个非贪婪限定符。要匹配 ? 字符，请使用 \?。</td>
</tr>
<tr>
<td>\</td>
<td>将下一个字符标记为或特殊字符、或原义字符、或向后引用、或八进制转义符。例如， ‘n’ 匹配字符‘n’。’\n’ 匹配换行符。序列 ‘\‘ 匹配 “\”，而 ‘(‘ 则匹配 “(”。</td>
</tr>
<tr>
<td>^</td>
<td>匹配输入字符串的开始位置，除非在方括号表达式中使用，此时它表示不接受该字符集合。要匹配 ^ 字符本身，请使用 \^。</td>
</tr>
<tr>
<td>{ }</td>
<td>标记限定符表达式的开始。要匹配 {，请使用 {。</td>
</tr>
<tr>
<td>\</td>
<td></td>
<td>指明两项之间的一个选择。要匹配 \</td>
<td>，请使用 \</td>
<td>。</td>
</tr>
</tbody>
</table>
<p>正则中的限定符</p>
<table>
<thead>
<tr>
<th>字符</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>*</td>
<td>匹配前面的子表达式零次或多次。例如，zo<em> 能匹配 “z” 以及 “zoo”。</em> 等价于{0,}。</td>
</tr>
<tr>
<td>+</td>
<td>匹配前面的子表达式一次或多次。例如，’zo+’ 能匹配 “zo” 以及 “zoo”，但不能匹配 “z”。+ 等价于 {1,}。</td>
</tr>
<tr>
<td>?</td>
<td>匹配前面的子表达式零次或一次。例如，”do(es)?” 可以匹配 “do” 或 “does” 中的”do” 。? 等价于 {0,1}。</td>
</tr>
<tr>
<td>{n}</td>
<td>n 是一个非负整数。匹配确定的 n 次。例如，’o{2}’ 不能匹配 “Bob” 中的 ‘o’，但是能匹配 “food” 中的两个 o。</td>
</tr>
<tr>
<td>{n,}</td>
<td>n 是一个非负整数。至少匹配n 次。例如，’o{2,}’ 不能匹配 “Bob” 中的 ‘o’，但能匹配 “foooood” 中的所有 o。’o{1,}’ 等价于 ‘o+’。’o{0,}’ 则等价于 ‘o*’。</td>
</tr>
<tr>
<td>{n,m}</td>
<td>m 和 n 均为非负整数，其中n &lt;= m。最少匹配 n 次且最多匹配 m 次。例如，”o{1,3}” 将匹配 “fooooood” 中的前三个 o。’o{0,1}’ 等价于 ‘o?’。请注意在逗号和两个数之间不能有空格。</td>
</tr>
</tbody>
</table>
<p>正则中的操作符优先级</p>
<table>
<thead>
<tr>
<th>操作符</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>\</td>
<td>转义符</td>
</tr>
<tr>
<td>(), (?:), (?=), [ ]</td>
<td>圆括号和方括号</td>
</tr>
<tr>
<td>*, +, ?, {n}, {n,}, {n,m}</td>
<td>限定符</td>
</tr>
<tr>
<td>^, $, \anymetacharacter</td>
<td>位置和顺序</td>
</tr>
<tr>
<td>\</td>
<td></td>
<td>“或”操作</td>
</tr>
</tbody>
</table>
<p>1  单词字符包括 0-9 a-z A-Z  _   下划线</p>
<p>元字符 \w 查找单词字符   \W 查找非单词字符</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> reg = <span class="regexp">/\byou/g</span>; <span class="comment">//  \b可以匹配单词的边界,单词中以you开头的you将会被匹配到</span></div><div class="line"><span class="keyword">var</span> result ;</div><div class="line"><span class="keyword">while</span>((result = reg.exec(str)) != <span class="literal">null</span>)&#123;</div><div class="line">  <span class="built_in">console</span>.log(result);</div><div class="line">  <span class="built_in">console</span>.log(reg.lastIndex);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>2 \b  元字符匹配单词边界  在单词边界匹配的位置，单词字符后面或前面不与另一个单词字符直接相邻</p>
<p>\B 元字符匹配非单词边界  通常用于查找不处在单词的开头或结尾的匹配</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> str = <span class="string">'hello youthereyou yourighthere '</span>;</div><div class="line"><span class="keyword">var</span> reg2 = <span class="regexp">/\Bthere/g</span>  ;<span class="comment">//用来匹配 不在单词开头的there</span></div><div class="line"><span class="keyword">var</span> result ;</div><div class="line"><span class="keyword">while</span>((result = reg2.exec(str)) != <span class="literal">null</span>)&#123;</div><div class="line">  <span class="built_in">console</span>.log(result);</div><div class="line">  <span class="built_in">console</span>.log(reg2.lastIndex);</div><div class="line">&#125;</div><div class="line"><span class="comment">//---------------------------------------------</span></div><div class="line"><span class="keyword">var</span> reg2 = <span class="regexp">/there\B/g</span> ;<span class="comment">//匹配不在单词结尾的there</span></div></pre></td></tr></table></figure>
<p>3       .  元字符用于查找单个字符，除了换行和行结束符。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//exec() 方法用于检索字符串中的正则表达式的匹配。如果找不到，则返回null</span></div><div class="line"><span class="keyword">var</span> str = <span class="string">'that is hot'</span>;</div><div class="line"><span class="keyword">var</span> reg = <span class="regexp">/h.t/g</span>;</div><div class="line"><span class="keyword">var</span> ret ;</div><div class="line"><span class="keyword">while</span>( (ret = reg.exec(str) ) != <span class="literal">null</span>)&#123;</div><div class="line">  <span class="built_in">console</span>.log(ret);<span class="comment">// Array[1][0:"hat"index:1,input:"that is hot",length:1]</span></div><div class="line">  <span class="comment">//Array[1][0:"hot"index:8,input:"that is hot",length:1]</span></div><div class="line"></div><div class="line">  <span class="built_in">console</span>.log(reg.lastIndex);<span class="comment">// 4 11  exec()方法 RegExpObject 的 lastIndex 属性设置为匹配文本的最后一个字符的下一个位置</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//match() 方法可在字符串内检索指定的值，或找到一个或多个正则表达式的匹配。返回匹配结果的数组，如果找不到返回null</span></div><div class="line"><span class="keyword">var</span> str = <span class="string">'that is hot'</span>;</div><div class="line"><span class="keyword">var</span> reg = <span class="regexp">/h.t/g</span>;</div><div class="line"><span class="keyword">var</span> ret = str.match(reg);</div><div class="line"><span class="built_in">console</span>.log(ret1);<span class="comment">//["hat", "hot"]</span></div></pre></td></tr></table></figure>
<p>4 \s</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/10/22/55-js  jQuery绑定与移除事件的比较/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/22/55-js  jQuery绑定与移除事件的比较/" itemprop="url">
                  js event compare with jQuery event
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-22T12:36:00+08:00">
                2016-10-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javascript-event/" itemprop="url" rel="index">
                    <span itemprop="name">javascript event</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="js-jQuery绑定事件的比较"><a href="#js-jQuery绑定事件的比较" class="headerlink" title="js  jQuery绑定事件的比较:"></a>js  jQuery绑定事件的比较:</h2><h3 id="一-事件分类"><a href="#一-事件分类" class="headerlink" title="一 事件分类"></a>一 事件分类</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="number">1</span> <span class="built_in">window</span> 事件:onload  onunload onafterprint onbeforeprint onerror  onresize </div><div class="line"><span class="number">2</span> From表单 事件(仅在表单元素中有效):onblur  onfocus onreset onsubmit onselect onchange  oninput</div><div class="line"><span class="number">3</span> 键盘事件 : onkeydown  onkeyup onkeyup</div><div class="line"><span class="number">4</span> 鼠标事件: onclick onmouseout onmouseleave onmouseenter onmousedown onmouseup onscroll(当元素滚动条被滚动的时候) ondrag ondragstart ondragend ondragenter ondragover ondragleave ondrop </div><div class="line"><span class="comment">//键盘事件和鼠标事件在base, bdo, br, frame, frameset, head, html, iframe, meta, param, script, style, title 元素无效；</span></div><div class="line"><span class="number">5</span> 触摸事件 :touchstart touchend touchmove </div><div class="line"><span class="number">6</span> 媒介事件 : </div><div class="line"><span class="number">7</span> 自定义事件:</div><div class="line"><span class="number">8</span> 所有的事件都是成元素的一个属性，原始值为<span class="literal">null</span>;输出一个DOM元素可以查看其所有的属性;</div></pre></td></tr></table></figure>
<h3 id="二-绑定事件"><a href="#二-绑定事件" class="headerlink" title="二 绑定事件"></a>二 绑定事件</h3><ul>
<li>JS绑定事件:(onclick之类的本身就是一属性，通过给属性设置函数，可以使其具有功能，而addEventListener是一个函数，通过函数体的内容给元素绑定事件)</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">ele.on+事件类型 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;  &#125;;     ele.addEventListener(<span class="string">"事件类型"</span>，<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; &#125; );</div><div class="line">ele.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; &#125;;		ele.addEventListener(<span class="string">"click"</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; &#125; );</div><div class="line">ele.onmouseout = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; &#125;;      ele.attachEvent(<span class="string">"onclick"</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; &#125; );(注意有on)</div><div class="line"><span class="built_in">window</span>.onlaod = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; &#125;;		<span class="built_in">window</span>.addEventListener(<span class="string">"load"</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; &#125; );</div><div class="line">ele.ondragstart = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; &#125;;	ele.addEventListener(<span class="string">"dragstart"</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; &#125; );</div></pre></td></tr></table></figure>
<p><strong>注意</strong>: 触摸事件只能通过addEventListener来绑定,过渡结束事件(自定义事件)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ele.addEventListener(<span class="string">"touchstart"</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; &#125; );</div></pre></td></tr></table></figure>
<ul>
<li>JS移除事件(该事件通过什么方式绑定的就要通过什么方式移除)</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 1注册事件</span></div><div class="line">	my$(<span class="string">"btn1"</span>).onclick = fn;<span class="comment">//(onclick指向一个函数体)</span></div><div class="line"><span class="comment">//1移除事件</span></div><div class="line">	my$(<span class="string">"btn1"</span>).onclick = <span class="literal">null</span>;<span class="comment">//(将指向设置为null,则可以清除事件)</span></div><div class="line"><span class="comment">// 2 注册事件</span></div><div class="line">my$(<span class="string">"btn1"</span>).addEventListener(<span class="string">"click"</span>,fn,<span class="literal">false</span>);</div><div class="line"><span class="comment">// 2 移除事件</span></div><div class="line">my$(<span class="string">"btn1"</span>).removeEventListener(<span class="string">"click"</span>,fn,<span class="literal">false</span>);</div><div class="line"><span class="comment">// 3 注册事件  谷歌和火狐不支持</span></div><div class="line"> my$(<span class="string">"btn1"</span>).attachEvent(<span class="string">"onclick"</span>,fn);</div><div class="line"><span class="comment">// 3 移除事件</span></div><div class="line"> my$(<span class="string">"btn1"</span>).detachEvent(<span class="string">"onclick"</span>,fn);</div></pre></td></tr></table></figure>
<ul>
<li>jQuery绑定事件和移除事件</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">--ready(fn):当DOM元素载入就绪就可以执行的一个函数</div><div class="line">data 是传递给jQuery事件对象参数event.data的数据，fn是绑定在该事件上的处理程序，events和type是要绑定的事件类型</div><div class="line"></div><div class="line">--$(<span class="string">"selector"</span>).on(events,data,fn)   可以一次绑定多个事件  </div><div class="line">  $(<span class="string">"selector"</span>).off(events,data,fn)  移除on绑定的事件 如果不写任何参数，则移除匹配元素的所有事件</div><div class="line">  $(<span class="string">"selector"</span>).bind(type,data,fn)   可以一次绑定多个事件，可以绑定自定义事件;</div><div class="line">  $(<span class="string">"selector"</span>).unbind(type,data,fn) 移除bind绑定的事件 如果不写任何参数，则移除匹配元素的所有事件</div><div class="line"></div><div class="line">--$(<span class="string">"selector"</span>).mouseover(), $(<span class="string">"selector"</span>).mouseover(fn)  如果不写参数，将触发选定元素的该事件，如果写   了函数体，则将为选定的元素绑定事件  </div><div class="line">  mouseout  mousemove  mouseenter mouseleave mouseup mousedown  click keyup keydown change blur</div><div class="line">    都是一样的特性，如果不传函数体，就是触发该事件;如果传了函数体，就是绑定该事件的处理程序.</div><div class="line">--$(<span class="string">"selector"</span>).hover(fn(<span class="keyword">in</span>)/fn(oout)  可以给选中的元素绑定hover事件，鼠标悬浮在上面的时候，执行			fn(<span class="keyword">in</span>),鼠标离开元素的时候执行fn(out);</div><div class="line"></div><div class="line"><span class="comment">//事件委派 使用 delegate() 方法的事件处理程序适用于当前或未来的元素（比如由脚本创建的新元素）。</span></div><div class="line"></div><div class="line">--$(<span class="string">"selector1"</span>).delegate(<span class="string">"selector2"</span>,<span class="string">"type"</span>,fn)  selector1必须是selector2的父元素，事件的执行程序绑定在selector2(子元素选择器)上 。</div></pre></td></tr></table></figure>
<h3 id="三-js-和-jQuery-绑定事件的区别"><a href="#三-js-和-jQuery-绑定事件的区别" class="headerlink" title="三   js  和  jQuery 绑定事件的区别"></a>三   js  和  jQuery 绑定事件的区别</h3><ul>
<li>两者绑定的事件符合事件的传播过程，比如冒泡，捕获</li>
<li>两者的事件对象参数基本一致，不同点在于jQuery绑定的事件，事件对象参数多了两个参数，一个是event.originalEvent  一个是event.data </li>
</ul>
<h3 id="四-自定义事件底层实现原理"><a href="#四-自定义事件底层实现原理" class="headerlink" title="四 自定义事件底层实现原理"></a>四 自定义事件底层实现原理</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 绑定事件</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">addEvent</span>(<span class="params">obj,type,fn</span>)</span>&#123;</div><div class="line">  obj.listener = obj.listener || &#123;&#125;;</div><div class="line">  obj.listener[type] = obj.listener[type] || [];</div><div class="line">  obj.listener[type].push(fn);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 触发事件</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">fireEvent</span>(<span class="params">obj,type</span>)</span>&#123;</div><div class="line">  <span class="keyword">var</span> arr = obj.listener[type];</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</div><div class="line">    arr[i]();</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/10/22/146NodeJsBuffer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/22/146NodeJsBuffer/" itemprop="url">
                  NodeJs Buffer
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-22T12:36:00+08:00">
                2016-10-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/nodejs/" itemprop="url" rel="index">
                    <span itemprop="name">nodejs</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>1 Buffer类的定义:本质上是创建了一块专门存放二进制数据的缓存区</p>
<p>JavaScript 语言自身只有字符串数据类型，没有二进制数据类型。</p>
<p>但在处理像TCP流或文件流时，必须使用到二进制数据。因此在 Node.js中，定义了一个 Buffer 类，该类用来创建一个专门存放二进制数据的缓存区。</p>
<p>在 Node.js 中，Buffer 类是随 Node 内核一起发布的核心库。Buffer 库为 Node.js 带来了一种存储原始数据的方法，可以让 Node.js 处理二进制数据，每当需要在 Node.js 中处理I/O操作中移动的数据时，就有可能使用 Buffer 库。原始数据存储在 Buffer 类的实例中。一个 Buffer 类似于一个整数数组，但它对应于 V8 堆内存之外的一块原始内存。</p>
<p>2 如何创建Buffer实例 </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> buf = <span class="keyword">new</span> Buffer(arg) <span class="comment">//1 必须传入参数 2  传入的参数类型 string, Buffer, ArrayBuffer, Array, or array-like object.</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> buf1 = <span class="keyword">new</span> Buffer(<span class="number">10</span>);<span class="comment">//这个是指定Buffer实例的长度，区分 var buf1 = new Buffer('10');</span></div><div class="line"><span class="built_in">console</span>.log(buf1);</div><div class="line"><span class="built_in">console</span>.log(buf1.length);</div><div class="line"><span class="built_in">console</span>.log(buf1.toString());</div><div class="line"></div><div class="line"><span class="keyword">var</span> buf2 = <span class="keyword">new</span> Buffer([<span class="number">10</span>, <span class="number">40</span>, <span class="number">30</span>]);<span class="comment">//数组的长度 作为Buffer实例的长度</span></div><div class="line"><span class="built_in">console</span>.log(buf2);</div><div class="line"><span class="built_in">console</span>.log(buf2.length);</div><div class="line"><span class="comment">//buf2.write('hahhahahahhah')</span></div><div class="line"><span class="built_in">console</span>.log(buf2.toString());</div><div class="line"></div><div class="line"><span class="keyword">var</span> buf3 = <span class="keyword">new</span> Buffer(&#123;<span class="attr">length</span>:<span class="number">12</span>&#125;);<span class="comment">//类数组对象 的长度作为Buffer的长度</span></div><div class="line"><span class="built_in">console</span>.log(buf3);</div><div class="line"><span class="built_in">console</span>.log(buf3.length);</div><div class="line"><span class="built_in">console</span>.log(buf3.toString());</div><div class="line"></div><div class="line"><span class="keyword">var</span> buf4 = <span class="keyword">new</span> Buffer(<span class="string">'this is it yeah'</span>); <span class="comment">//直接将字符串写入Buffer实例，长度等于字符串的长度</span></div><div class="line"><span class="built_in">console</span>.log(buf4);</div><div class="line"><span class="built_in">console</span>.log(buf4.length);</div><div class="line"><span class="built_in">console</span>.log(buf4.toString());</div><div class="line"></div><div class="line"><span class="keyword">var</span> buf5 = <span class="keyword">new</span> Buffer(buf4);<span class="comment">//将Buffer实例直接作为参数传入</span></div><div class="line"><span class="built_in">console</span>.log(buf5);</div><div class="line"><span class="built_in">console</span>.log(buf5.length);</div><div class="line"><span class="built_in">console</span>.log(buf5.toString());</div></pre></td></tr></table></figure>
<p>3 向缓冲区写入数据以及读取数据</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">buf.write(string[, offset[, length]][, encoding])</div><div class="line">参数描述如下：</div><div class="line">    string - 写入缓冲区的字符串。</div><div class="line">    offset - 缓冲区开始写入的索引值，默认为 <span class="number">0</span> 。</div><div class="line">    length - 写入的字节数，默认为 buffer.length</div><div class="line">    encoding - 使用的编码。默认为 <span class="string">'utf8'</span> 。</div><div class="line">返回值</div><div class="line">	返回实际写入的大小。如果 buffer 空间不足， 则只会写入部分字符串。</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">buf.toString([encoding[, start[, end]]])</div><div class="line">参数描述如下：</div><div class="line">    encoding - 使用的编码。默认为 <span class="string">'utf8'</span> 。</div><div class="line">    start - 指定开始读取的索引位置，默认为 <span class="number">0</span>。</div><div class="line">    end - 结束位置，默认为缓冲区的末尾。</div><div class="line">返回值</div><div class="line">	解码缓冲区数据并使用指定的编码返回字符串。</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">buf.length;  返回Buffer实例实际所占据的内存的长度</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">buf.toJSON();将Buffer实例转化为<span class="built_in">JSON</span>对象</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">buf.slice(start,end);默认start <span class="number">0</span> end 为buf.length </div><div class="line">返回一个新的缓冲区，它和旧缓冲区指向同一块内存，但是从索引 start 到 end 的位置剪切。</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Buffer.concat(list[, totalLength]) 返回一个多个成员合并的新 Buffer 对象。</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//console.log(Buffer) 可以尝试着输入下Buffer类，看下其属性和方法</span></div><div class="line"><span class="keyword">var</span> buf = <span class="keyword">new</span> Buffer(<span class="string">'this is it yeah'</span>);</div><div class="line"><span class="built_in">console</span>.log(buf);</div><div class="line"><span class="built_in">console</span>.log(buf.length);<span class="comment">//15</span></div><div class="line"><span class="built_in">console</span>.log(buf.toString());</div><div class="line"></div><div class="line"><span class="keyword">var</span> wLen = buf.write(<span class="string">'changed?'</span>);</div><div class="line"><span class="built_in">console</span>.log(buf.toString());<span class="comment">//changed?it yeah</span></div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(wLen);<span class="comment">//8</span></div><div class="line"><span class="built_in">console</span>.log(buf.toJSON());</div><div class="line"><span class="comment">/*&#123;</span></div><div class="line">	type: 'Buffer',</div><div class="line"> 	data: [ 99, 104, 97, 110, 103, 101, 100, 63, 105, 116, 32, 121, 101, 97, 104 ] </div><div class="line"> &#125;</div><div class="line"> */</div><div class="line"><span class="keyword">var</span> sliceBuf = buf.slice(<span class="number">2</span>,<span class="number">5</span>);</div><div class="line"><span class="built_in">console</span>.log(sliceBuf);</div><div class="line"><span class="built_in">console</span>.log(sliceBuf.length);<span class="comment">//3</span></div><div class="line"><span class="built_in">console</span>.log(sliceBuf.toString());<span class="comment">//ang</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> con = Buffer.concat ([buf,sliceBuf]);</div><div class="line"><span class="built_in">console</span>.log(con);</div><div class="line"><span class="built_in">console</span>.log(con.length);<span class="comment">//18</span></div><div class="line"><span class="built_in">console</span>.log(con.toString());<span class="comment">//changed?it yeahang</span></div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/10/22/23-拖拉事件/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/22/23-拖拉事件/" itemprop="url">
                  drag Event
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-22T12:36:00+08:00">
                2016-10-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/html/" itemprop="url" rel="index">
                    <span itemprop="name">html</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="拖拉事件"><a href="#拖拉事件" class="headerlink" title="拖拉事件"></a>拖拉事件</h2><p>拖拉指的是，用户在某个对象上按下鼠标键不放，拖动它到另一个位置，然后释放鼠标键，将该对象放在那里。</p>
<p>拖拉的对象有好几种，包括Element节点、图片、链接、选中的文字等等。在HTML网页中，除了Element节点默认不可以拖拉，其他（图片、链接、选中的文字）都是可以直接拖拉的。为了让Element节点可拖拉，可以将该节点的draggable属性设为true。<strong>注意draggable 是元素的属性，并不是元素的样式属性，设置在CSS样式表或者<style>标签中是没有用的</strong>  </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">draggable</span>=<span class="string">"true"</span>&gt;</span></div><div class="line">  此区域可拖拉</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>draggable属性可用于任何Element节点，但是图片（img元素）和链接（a元素）不加这个属性，就可以拖拉。对于它们，用到这个属性的时候，往往是将其设为false，防止拖拉。</p>
<p>注意，一旦某个Element节点的draggable属性设为true，就无法再用鼠标选中该节点内部的文字或子节点了。</p>
<h3 id="事件种类"><a href="#事件种类" class="headerlink" title="事件种类"></a>事件种类</h3><p>当Element节点或选中的文本被拖拉时，就会持续触发拖拉事件，包括以下一些事件。</p>
<ul>
<li><strong>drag事件</strong>：拖拉过程中，在被拖拉的节点上持续触发。</li>
<li><strong>dragstart事件</strong>：拖拉开始时在被拖拉的节点上触发，该事件的target属性是被拖拉的节点。通常应该在这个事件的监听函数中，指定拖拉的数据。</li>
<li><strong>dragend事件</strong>：拖拉结束时（释放鼠标键或按下escape键）在被拖拉的节点上触发，该事件的target属性是被拖拉的节点。它与dragStart事件，在同一个节点上触发。不管拖拉是否跨窗口，或者中途被取消，dragend事件总是会触发的。</li>
<li><strong>dragenter事件</strong>：拖拉进入当前节点时，在当前节点上触发，该事件的target属性是当前节点。通常应该在这个事件的监听函数中，指定是否允许在当前节点放下（drop）拖拉的数据。如果当前节点没有该事件的监听函数，或者监听函数不执行任何操作，就意味着不允许在当前节点放下数据。在视觉上显示拖拉进入当前节点，也是在这个事件的监听函数中设置。</li>
<li><strong>dragover事件</strong>：拖拉到当前节点上方时，在当前节点上<strong>持续</strong>触发，该事件的target属性是当前节点。该事件与dragenter事件基本类似，默认会重置当前的拖拉事件的效果（DataTransfer对象的dropEffect属性）为none，即不允许放下被拖拉的节点，所以如果允许在当前节点drop数据，通常会使用preventDefault方法，取消重置拖拉效果为none。</li>
<li><strong>dragleave事件</strong>：拖拉离开当前节点范围时，在当前节点上触发，该事件的target属性是当前节点。在视觉上显示拖拉离开当前节点，就在这个事件的监听函数中设置。</li>
<li><strong>drop事件</strong>：被拖拉的节点或选中的文本，释放到目标节点时，在目标节点上触发。注意，如果当前节点不允许drop，即使在该节点上方松开鼠标键，也不会触发该事件。如果用户按下Escape键，取消这个操作，也不会触发该事件。该事件的监听函数负责取出拖拉数据，并进行相关处理。</li>
</ul>
<p>关于拖拉事件，有以下几点注意事项。</p>
<ul>
<li>拖拉过程只触发以上这些拖拉事件，尽管鼠标在移动，但是鼠标事件不会触发。</li>
<li>将文件从操作系统拖拉进浏览器，不会触发dragStart和dragend事件。</li>
<li>dragenter和dragover事件的监听函数，用来指定可以放下（drop）拖拉的数据。由于网页的大部分区域不适合作为drop的目标节点，所以这两个事件的默认设置为当前节点不允许drop。如果想要在目标节点上drop拖拉的数据，首先必须阻止这两个事件的默认行为，或者取消这两个事件。</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ondragover</span>=<span class="string">"return false"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ondragover</span>=<span class="string">"event.preventDefault()"</span>&gt;</span></div></pre></td></tr></table></figure>
<p>上面代码中，如果不取消拖拉事件或者阻止默认行为，就不可能在div节点上drop被拖拉的节点。</p>
<p>拖拉事件用一个DragEvent对象表示，该对象继承MouseEvent对象，因此也就继承了UIEvent和Event对象。DragEvent对象只有一个独有的属性DataTransfer，其他都是继承的属性。DataTransfer属性用来读写拖拉事件中传输的数据，详见下文《DataTransfer对象》的部分。</p>
<p>下面的例子展示，如何动态改变被拖动节点的背景色。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">div.addEventListener(<span class="string">"dragstart"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</div><div class="line">  <span class="keyword">this</span>.style.backgroundColor = <span class="string">"red"</span>;</div><div class="line">&#125;, <span class="literal">false</span>);</div><div class="line">div.addEventListener(<span class="string">"dragend"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</div><div class="line">  <span class="keyword">this</span>.style.backgroundColor = <span class="string">"green"</span>;</div><div class="line">&#125;, <span class="literal">false</span>);</div></pre></td></tr></table></figure>
<p>上面代码中，div节点被拖动时，背景色会变为红色，拖动结束，又变回绿色。</p>
<p>下面是一个例子，显示如何实现将一个节点从当前父节点，拖拉到另一个父节点中。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// HTML代码为</span></div><div class="line"><span class="comment">// &lt;div class="dropzone"&gt;</span></div><div class="line"><span class="comment">//    &lt;div id="draggable" draggable="true"&gt;</span></div><div class="line"><span class="comment">//       该节点可拖拉</span></div><div class="line"><span class="comment">//    &lt;/div&gt;</span></div><div class="line"><span class="comment">// &lt;/div&gt;</span></div><div class="line"><span class="comment">// &lt;div class="dropzone"&gt;&lt;/div&gt;</span></div><div class="line"><span class="comment">// &lt;div class="dropzone"&gt;&lt;/div&gt;</span></div><div class="line"><span class="comment">// &lt;div class="dropzone"&gt;&lt;/div&gt;</span></div><div class="line"></div><div class="line"><span class="comment">// 被拖拉节点</span></div><div class="line"><span class="keyword">var</span> dragged;</div><div class="line"></div><div class="line"><span class="built_in">document</span>.addEventListener(<span class="string">"dragstart"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> event </span>) </span>&#123;</div><div class="line">  <span class="comment">// 保存被拖拉节点</span></div><div class="line">  dragged = event.target;</div><div class="line">  <span class="comment">// 被拖拉节点的背景色变透明</span></div><div class="line">  event.target.style.opacity = <span class="number">0.5</span>;</div><div class="line">  <span class="comment">// 兼容Firefox</span></div><div class="line">  event.dataTransfer.setData(<span class="string">'text/plain'</span>, <span class="string">'anything'</span>);</div><div class="line">&#125;, <span class="literal">false</span>);</div><div class="line"></div><div class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'dragend'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> event </span>) </span>&#123;</div><div class="line">  <span class="comment">// 被拖拉节点的背景色恢复正常</span></div><div class="line">  event.target.style.opacity = <span class="string">''</span>;</div><div class="line">&#125;, <span class="literal">false</span>);</div><div class="line"></div><div class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'dragover'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> event </span>) </span>&#123;</div><div class="line">  <span class="comment">// 防止拖拉效果被重置，允许被拖拉的节点放入目标节点</span></div><div class="line">  event.preventDefault();</div><div class="line">&#125;, <span class="literal">false</span>);</div><div class="line"></div><div class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'dragenter'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> event </span>) </span>&#123;</div><div class="line">  <span class="comment">// 目标节点的背景色变紫色</span></div><div class="line">  <span class="comment">// 由于该事件会冒泡，所以要过滤节点</span></div><div class="line">  <span class="keyword">if</span> ( event.target.className == <span class="string">'dropzone'</span> ) &#123;</div><div class="line">    event.target.style.background = <span class="string">'purple'</span>;</div><div class="line">  &#125;</div><div class="line">&#125;, <span class="literal">false</span>);</div><div class="line"></div><div class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'dragleave'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> event </span>) </span>&#123;</div><div class="line">  <span class="comment">// 目标节点的背景色恢复原样</span></div><div class="line">  <span class="keyword">if</span> ( event.target.className == <span class="string">'dropzone'</span> ) &#123;</div><div class="line">    event.target.style.background = <span class="string">""</span>;</div><div class="line">  &#125;</div><div class="line">&#125;, <span class="literal">false</span>);</div><div class="line"></div><div class="line"><span class="built_in">document</span>.addEventListener(<span class="string">'drop'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> event </span>) </span>&#123;</div><div class="line">  <span class="comment">// 防止事件默认行为（比如某些Elment节点上可以打开链接）</span></div><div class="line">  event.preventDefault();</div><div class="line">  <span class="keyword">if</span> ( event.target.className === <span class="string">'dropzone'</span> ) &#123;</div><div class="line">    <span class="comment">// 恢复目标节点背景色</span></div><div class="line">    event.target.style.background = <span class="string">''</span>;</div><div class="line">    <span class="comment">// 将被拖拉节点插入目标节点</span></div><div class="line">    dragged.parentNode.removeChild( dragged );</div><div class="line">    event.target.appendChild( dragged );</div><div class="line">  &#125;</div><div class="line">&#125;, <span class="literal">false</span>);</div></pre></td></tr></table></figure>
<h3 id="DataTransfer对象概述"><a href="#DataTransfer对象概述" class="headerlink" title="DataTransfer对象概述"></a>DataTransfer对象概述</h3><p>所有的拖拉事件都有一个dataTransfer属性，用来保存需要传递的数据。这个属性的值是一个DataTransfer对象。</p>
<p>拖拉的数据保存两方面的数据：数据的种类（又称格式）和数据的值。数据的种类是一个MIME字符串，比如 text/plain或者image/jpeg，数据的值是一个字符串。一般来说，如果拖拉一段文本，则数据默认就是那段文本；如果拖拉一个链接，则数据默认就是链接的URL。</p>
<p>当拖拉事件开始的时候，可以提供数据类型和数据值；在拖拉过程中，通过dragenter和dragover事件的监听函数，检查数据类型，以确定是否允许放下（drop）被拖拉的对象。比如，在只允许放下链接的区域，检查拖拉的数据类型是否为text/uri-list。</p>
<p>发生drop事件时，监听函数取出拖拉的数据，对其进行处理。</p>
<h3 id="DataTransfer对象的属性"><a href="#DataTransfer对象的属性" class="headerlink" title="DataTransfer对象的属性"></a>DataTransfer对象的属性</h3><p>DataTransfer对象有以下属性。</p>
<p><strong>（1）dropEffect</strong></p>
<p>dropEffect属性设置放下（drop）被拖拉节点时的效果，可能的值包括copy（复制被拖拉的节点）、move（移动被拖拉的节点）、link（创建指向被拖拉的节点的链接）、none（无法放下被拖拉的节点）。设置除此以外的值，都是无效的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">target.addEventListener(<span class="string">'dragover'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</div><div class="line">  e.preventDefault();</div><div class="line">  e.stopPropagation();</div><div class="line">  e.dataTransfer.dropEffect = <span class="string">'copy'</span>;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>dropEffect属性一般在dragenter和dragover事件的监听函数中设置，对于dragstart、drag、dragleave这三个事件，该属性不起作用。进入目标节点后，拖拉行为会初始化成用户设定的效果，用户可以通过按下Shift键和Control键，改变初始设置，在copy、move、link三种效果中切换。</p>
<p>鼠标箭头会根据dropEffect属性改变形状，提示目前正处于哪一种效果。这意味着，通过鼠标就能判断是否可以在当前节点drop被拖拉的节点。</p>
<p><strong>（2）effectAllowed</strong></p>
<p>effectAllowed属性设置本次拖拉中允许的效果，可能的值包括copy（复制被拖拉的节点）、move（移动被拖拉的节点）、link（创建指向被拖拉节点的链接）、copyLink（允许copy或link）、copyMove（允许copy或move）、linkMove（允许link或move）、all（允许所有效果）、none（无法放下被拖拉的节点）、uninitialized（默认值，等同于all）。如果某种效果是不允许的，用户就无法在目标节点中达成这种效果。</p>
<p>dragstart事件的监听函数，可以设置被拖拉节点允许的效果；dragenter和dragover事件的监听函数，可以设置目标节点允许的效果。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">event.dataTransfer.effectAllowed = <span class="string">"copy"</span>;</div></pre></td></tr></table></figure>
<p>dropEffect属性和effectAllowed属性，往往配合使用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">event.dataTransfer.effectAllowed = <span class="string">"copyMove"</span>;</div><div class="line">event.dataTransfer.dropEffect = <span class="string">"copy"</span>;</div></pre></td></tr></table></figure>
<p>上面代码中，copy是指定的效果，但是可以通过Shift或Ctrl键（根据平台而定），将效果切换成move。</p>
<p>只要dropEffect属性和effectAllowed属性之中，有一个为none，就无法在目标节点上完成drop操作。</p>
<p><strong>（3）files</strong></p>
<p>files属性是一个FileList对象，包含一组本地文件，可以用来在拖拉操作中传送。如果本次拖拉不涉及文件，则属性为空的FileList对象。</p>
<p>下面就是一个接收拖拉文件的例子。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// HTML代码为</span></div><div class="line"><span class="comment">// &lt;div id="output" style="min-height: 200px;border: 1px solid black;"&gt;</span></div><div class="line"><span class="comment">//   文件拖拉到这里</span></div><div class="line"><span class="comment">// &lt;/div&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> div = <span class="built_in">document</span>.getElementById(<span class="string">'output'</span>);</div><div class="line"></div><div class="line">div.addEventListener(<span class="string">"dragenter"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> event </span>) </span>&#123;</div><div class="line">  div.textContent = <span class="string">''</span>;</div><div class="line">  event.stopPropagation();</div><div class="line">  event.preventDefault();</div><div class="line">&#125;, <span class="literal">false</span>);</div><div class="line"></div><div class="line">div.addEventListener(<span class="string">"dragover"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> event </span>) </span>&#123;</div><div class="line">  event.stopPropagation();</div><div class="line">  event.preventDefault();</div><div class="line">&#125;, <span class="literal">false</span>);</div><div class="line"></div><div class="line">div.addEventListener(<span class="string">"drop"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> event </span>) </span>&#123;</div><div class="line">  event.stopPropagation();</div><div class="line">  event.preventDefault();</div><div class="line">  <span class="keyword">var</span> files = event.dataTransfer.files;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; files.length; i++) &#123;</div><div class="line">    div.textContent += files[i].name + <span class="string">' '</span> + files[i].size + <span class="string">'字节\n'</span>;</div><div class="line">  &#125;</div><div class="line">&#125;, <span class="literal">false</span>);</div></pre></td></tr></table></figure>
<p>上面代码中，通过files属性读取拖拉文件的信息。如果想要读取文件内容，就要使用FileReader对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">div.addEventListener(<span class="string">'drop'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</div><div class="line">  e.preventDefault();</div><div class="line">  e.stopPropagation();</div><div class="line"></div><div class="line">  <span class="keyword">var</span> fileList = e.dataTransfer.files;</div><div class="line">  <span class="keyword">if</span> (fileList.length &gt; <span class="number">0</span>) &#123;</div><div class="line">    <span class="keyword">var</span> file = fileList[<span class="number">0</span>];</div><div class="line">    <span class="keyword">var</span> reader = <span class="keyword">new</span> FileReader();</div><div class="line">    reader.onloadend = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</div><div class="line">      <span class="keyword">if</span> (e.target.readyState == FileReader.DONE) &#123;</div><div class="line">        <span class="keyword">var</span> content = reader.result;</div><div class="line">        contentDiv.innerHTML = <span class="string">"File: "</span> + file.name + <span class="string">"\n\n"</span> + content;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    reader.readAsBinaryString(file);</div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p><strong>（4）types</strong></p>
<p>types属性是一个数组，保存每一次拖拉的数据格式，比如拖拉文件，则格式信息就为File。</p>
<p>下面是一个例子，通过检查dataTransfer属性的类型，决定是否允许在当前节点执行drop操作。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">contains</span>(<span class="params">list, value</span>)</span>&#123;</div><div class="line">  <span class="keyword">for</span>( <span class="keyword">var</span> i = <span class="number">0</span>; i &lt; list.length; ++i )&#123;</div><div class="line">    <span class="keyword">if</span>(list[i] === value) <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">doDragOver</span>(<span class="params">event</span>)</span>&#123;</div><div class="line">  <span class="keyword">var</span> isLink = contains( event.dataTransfer.types, <span class="string">"text/uri-list"</span>);</div><div class="line">  <span class="keyword">if</span> (isLink) event.preventDefault();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面代码中，只有当被拖拉的节点是一个链接时，才允许在当前节点放下。</p>
<h3 id="DataTransfer对象的方法"><a href="#DataTransfer对象的方法" class="headerlink" title="DataTransfer对象的方法"></a>DataTransfer对象的方法</h3><p>DataTransfer对象有以下方法。</p>
<p><strong>（1）setData()</strong></p>
<p>setData方法用来设置事件所带有的指定类型的数据。它接受两个参数，第一个是数据类型，第二个是具体数据。如果指定的类型在现有数据中不存在，则该类型将写入types属性；如果已经存在，在该类型的现有数据将被替换。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">event.dataTransfer.setData(<span class="string">"text/plain"</span>, <span class="string">"Text to drag"</span>);</div></pre></td></tr></table></figure>
<p>上面代码为事件加入纯文本格式的数据。</p>
<p>如果拖拉文本框或者拖拉选中的文本，会默认将文本数据添加到dataTransfer属性，不用手动指定。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">draggable</span>=<span class="string">"true"</span> <span class="attr">ondragstart</span>=<span class="string">"</div><div class="line">  event.dataTransfer.setData('text/plain', 'bbb')"</span>&gt;</span></div><div class="line">  aaa</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>上面代码中，拖拉数据实际上是bbb，而不是aaa。</p>
<p>下面是添加其他类型的数据。由于text/plain是最普遍支持的格式，为了保证兼容性，建议最后总是将数据保存一份纯文本的格式。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> dt = event.dataTransfer;</div><div class="line"></div><div class="line"><span class="comment">// 添加链接</span></div><div class="line">dt.setData(<span class="string">"text/uri-list"</span>, <span class="string">"http://www.example.com"</span>);</div><div class="line">dt.setData(<span class="string">"text/plain"</span>, <span class="string">"http://www.example.com"</span>);</div><div class="line"><span class="comment">// 添加HTML代码</span></div><div class="line">dt.setData(<span class="string">"text/html"</span>, <span class="string">"Hello there, &lt;strong&gt;stranger&lt;/strong&gt;"</span>);</div><div class="line">dt.setData(<span class="string">"text/plain"</span>, <span class="string">"Hello there, &lt;strong&gt;stranger&lt;/strong&gt;"</span>);</div><div class="line"><span class="comment">// 添加图像的URL</span></div><div class="line">dt.setData(<span class="string">"text/uri-list"</span>, imageurl);</div><div class="line">dt.setData(<span class="string">"text/plain"</span>, imageurl);</div></pre></td></tr></table></figure>
<p>可以一次提供多种格式的数据。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> dt = event.dataTransfer;</div><div class="line">dt.setData(<span class="string">"application/x-bookmark"</span>, bookmarkString);</div><div class="line">dt.setData(<span class="string">"text/uri-list"</span>, <span class="string">"http://www.example.com"</span>);</div><div class="line">dt.setData(<span class="string">"text/plain"</span>, <span class="string">"http://www.example.com"</span>);</div></pre></td></tr></table></figure>
<p>上面代码中，通过在同一个事件上面，存放三种类型的数据，使得拖拉事件可以在不同的对象上面，drop不同的值。注意，第一种格式是一个自定义格式，浏览器默认无法读取，这意味着，只有某个部署了特定代码的节点，才可能drop（读取到）这个数据。</p>
<p><strong>（2）getData()</strong></p>
<p>getData方法接受一个字符串（表示数据类型）作为参数，返回事件所带的指定类型的数据（通常是用setData方法添加的数据）。如果指定类型的数据不存在，则返回空字符串。通常只有drop事件触发后，才能取出数据。如果取出另一个域名存放的数据，将会报错。</p>
<p>下面是一个drop事件的监听函数，用来取出指定类型的数据。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">onDrop</span>(<span class="params">event</span>)</span>&#123;</div><div class="line">  <span class="keyword">var</span> data = event.dataTransfer.getData(<span class="string">"text/plain"</span>);</div><div class="line">  event.target.textContent = data;</div><div class="line">  event.preventDefault();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面代码取出拖拉事件的文本数据，将其替换成当前节点的文本内容。注意，这时还必须取消浏览器的默认行为，因为假如用户拖拉的是一个链接，浏览器默认会在当前窗口打开这个链接。</p>
<p>getData方法返回的是一个字符串，如果其中包含多项数据，就必须手动解析。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">doDrop</span>(<span class="params">event</span>)</span>&#123;</div><div class="line">  <span class="keyword">var</span> lines = event.dataTransfer.getData(<span class="string">"text/uri-list"</span>).split(<span class="string">"\n"</span>);</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> line <span class="keyword">of</span> lines) &#123;</div><div class="line">    <span class="keyword">let</span> link = <span class="built_in">document</span>.createElement(<span class="string">"a"</span>);</div><div class="line">    link.href = line;</div><div class="line">    link.textContent = line;</div><div class="line">    event.target.appendChild(link);</div><div class="line">  &#125;</div><div class="line">  event.preventDefault();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面代码中，getData方法返回的是一组链接，就必须自行解析。</p>
<p>类型值指定为URL，可以取出第一个有效链接。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> link = event.dataTransfer.getData(<span class="string">"URL"</span>);</div></pre></td></tr></table></figure>
<p>下面是一次性取出多种类型的数据。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">doDrop</span>(<span class="params">event</span>)</span>&#123;</div><div class="line">  <span class="keyword">var</span> types = event.dataTransfer.types;</div><div class="line">  <span class="keyword">var</span> supportedTypes = [<span class="string">"text/uri-list"</span>, <span class="string">"text/plain"</span>];</div><div class="line">  types = supportedTypes.filter(<span class="function"><span class="keyword">function</span> (<span class="params">value</span>) <span class="title">types</span>.<span class="title">includes</span>(<span class="params">value</span>));</div><div class="line">  <span class="title">if</span> (<span class="params">types.length</span>)</div><div class="line">    <span class="title">var</span> <span class="title">data</span> = <span class="title">event</span>.<span class="title">dataTransfer</span>.<span class="title">getData</span>(<span class="params">types[<span class="number">0</span>]</span>);</div><div class="line">  <span class="title">event</span>.<span class="title">preventDefault</span>(<span class="params"></span>);</div><div class="line">&#125;</span></div></pre></td></tr></table></figure>
<p><strong>（3）clearData()</strong></p>
<p>clearData方法接受一个字符串（表示数据类型）作为参数，删除事件所带的指定类型的数据。如果没有指定类型，则删除所有数据。如果指定类型不存在，则原数据不受影响。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">event.dataTransfer.clearData(<span class="string">"text/uri-list"</span>);</div></pre></td></tr></table></figure>
<p>上面代码清除事件所带的URL数据。</p>
<p><strong>（4）setDragImage()</strong></p>
<p>拖动过程中（dragstart事件触发后），浏览器会显示一张图片跟随鼠标一起移动，表示被拖动的节点。这张图片是自动创造的，通常显示为被拖动节点的外观，不需要自己动手设置。setDragImage方法可以用来自定义这张图片，它接受三个参数，第一个是img图片元素或者canvas元素，如果省略或为null则使用被拖动的节点的外观，第二个和第三个参数为鼠标相对于该图片左上角的横坐标和右坐标。</p>
<p>下面是一个例子。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// HTML代码为</span></div><div class="line"><span class="comment">// &lt;div id="drag-with-image" class="dragdemo" draggable="true"&gt;</span></div><div class="line">     drag me</div><div class="line"><span class="comment">// &lt;/div&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> div = <span class="built_in">document</span>.getElementById(<span class="string">"drag-with-image"</span>);</div><div class="line">div.addEventListener(<span class="string">"dragstart"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> img = <span class="built_in">document</span>.createElement(<span class="string">"img"</span>);</div><div class="line">  img.src = <span class="string">"http://path/to/img"</span>;</div><div class="line">  e.dataTransfer.setDragImage(img, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">&#125;, <span class="literal">false</span>);</div></pre></td></tr></table></figure></style></strong></p>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/10/21/175Angular-Js-directive/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/21/175Angular-Js-directive/" itemprop="url">
                  Angular Js directive
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-21T00:00:00+08:00">
                2016-10-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javascript/" itemprop="url" rel="index">
                    <span itemprop="name">javascript</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-自定义指令中的scope属性详解"><a href="#1-自定义指令中的scope属性详解" class="headerlink" title="1 自定义指令中的scope属性详解"></a>1 自定义指令中的scope属性详解</h3>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/10/19/178几种缓存的总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/19/178几种缓存的总结/" itemprop="url">
                  几种缓存的总结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-19T12:36:00+08:00">
                2016-10-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javascript/" itemprop="url" rel="index">
                    <span itemprop="name">javascript</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>几种缓存的总结</p>
<h3 id="1-DNS缓存"><a href="#1-DNS缓存" class="headerlink" title="1 DNS缓存"></a>1 DNS缓存</h3><ul>
<li>为了增加访问效率，计算机有域名缓存机制，当访问过某个网站并得到其IP后，会将其域名和IP缓存下来，下一次访问的时候，就不需要再请求域名服务器获取IP，直接使用缓存中的IP，提高了响应的速度。当然缓存是有有效时间的，当过了有效时间后，再次请求网站，还是需要先请求域名解析。</li>
<li>但是域名缓存机制也可能会带来麻烦。例如IP已变化了，仍然使用缓存中的IP来访问，将会访问失败。再如 同一个域名在内网和外网访问时所对应的IP是不同的，如在外网访问时通过外网IP映射到内网的IP。同一台电脑在外网环境下访问了此域名，再换到内网来访问此域名，在DNS缓存的作用下，也会去访问外网的IP，导致访问失败。根据情况，可以手动清除DNS缓存或者禁止DNS缓存机制。</li>
</ul>
<h3 id="2-CDN缓存"><a href="#2-CDN缓存" class="headerlink" title="2 CDN缓存"></a>2 CDN缓存</h3><ul>
<li>用户在浏览网站的时候，浏览器能够在本地保存网站中的图片或者其他文件的副本，这样用户再次访问该网站的时候，浏览器就不用再下载全部的文件，减少了下载量意味着提高了页面加载的速度。</li>
<li>如果中间加上一层CDN，客户端浏览器先检查是否有本地缓存是否过期，如果过期，则向CDN边缘节点发起请求，CDN边缘节点会检测用户请求数据的缓存是否过期，如果没有过期，则直接响应用户请求，此时一个完成http请求结束；如果数据已经过期，那么CDN还需要向源站发出回源请求（back to the source request）,来拉取最新的数据</li>
</ul>
<h3 id="3-浏览器端缓存"><a href="#3-浏览器端缓存" class="headerlink" title="3 浏览器端缓存"></a>3 浏览器端缓存</h3><p>http缓存  localStorage缓存 sessionStorage缓存 cookies缓存  application cache缓存</p>
<h3 id="4-服务器缓存"><a href="#4-服务器缓存" class="headerlink" title="4 服务器缓存"></a>4 服务器缓存</h3>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/16/">16</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right"></i></a>
  </nav>


          
          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar.jpg"
               alt="JiM-W" />
          <p class="site-author-name" itemprop="name">JiM-W</p>
           
              <p class="site-description motion-element" itemprop="description">keep fighting！</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">152</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">46</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">69</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">JiM-W</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  



  
  

  

  

  

  


  

</body>
</html>
