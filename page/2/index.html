<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="keep fighting！">
<meta property="og:type" content="website">
<meta property="og:title" content="JiM-W">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="JiM-W">
<meta property="og:description" content="keep fighting！">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="JiM-W">
<meta name="twitter:description" content="keep fighting！">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/"/>





  <title> JiM-W </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">JiM-W</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">keep Moving</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/11/218React-redux Demo案例/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/11/218React-redux Demo案例/" itemprop="url">
                  从react到react-redux到react-redux-react-redux
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-11T12:36:00+08:00">
                2017-05-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/redux/" itemprop="url" rel="index">
                    <span itemprop="name">redux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>前言,对于初学者来说,这个demo理解起来相对简单,只需要create-react-app  ,然后 npm install react-redux  npm install redux 即可.(react官方文档和redux官方文档)</p>
<p>本文主要理解redux在react中期的作用,以及react-redux如何将react和redux连接起来</p>
<p><a href="https://jimwmg.github.io/2017/05/11/215Redux-Provider-Connect/" target="_blank" rel="external">Provider connect 源码解读</a></p>
<p><a href="https://jimwmg.github.io/2017/05/05/205Redux-createStore%E6%BA%90%E7%A0%81/" target="_blank" rel="external">createStore源码</a></p>
<p><a href="http://www.cnblogs.com/hhhyaaon/p/5863408.html" target="_blank" rel="external">Provider connect2 源码解读</a></p>
<p><a href="https://github.com/bailicangdu/react-pxq" target="_blank" rel="external">一个比较好的案例</a></p>
<h3 id="1-react"><a href="#1-react" class="headerlink" title="1 react"></a>1 react</h3><p>通过setState改变state状态,触发ReactDOM.render函数,重新刷新UI组件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React ,&#123;Component,PropTypes&#125; <span class="keyword">from</span> <span class="string">'react'</span></div><div class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Toggle</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  <span class="keyword">constructor</span>(props) &#123;</div><div class="line">    <span class="keyword">super</span>(props);</div><div class="line">    <span class="keyword">this</span>.state = &#123;<span class="attr">count</span>: <span class="number">1</span>&#125;;</div><div class="line"></div><div class="line">    <span class="comment">// This binding is necessary to make `this` work in the callback</span></div><div class="line">    <span class="keyword">this</span>.handleClick = <span class="keyword">this</span>.handleClick.bind(<span class="keyword">this</span>);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  handleClick() &#123;</div><div class="line">    <span class="keyword">this</span>.setState(<span class="function"><span class="params">prevState</span> =&gt;</span> (&#123;</div><div class="line">      <span class="attr">count</span>: prevState.count+<span class="number">1</span></div><div class="line">    &#125;));</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleClick&#125;</span>&gt;</span></span></div><div class="line">        &#123;this.state.count&#125;</div><div class="line">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="built_in">console</span>.dir(Toggle);</div><div class="line"></div><div class="line">ReactDOM.render(</div><div class="line">  <span class="xml"><span class="tag">&lt;<span class="name">Toggle</span> /&gt;</span>,</span></div><div class="line">  document.getElementById('root')</div><div class="line">);</div></pre></td></tr></table></figure>
<h3 id="2-react-redux"><a href="#2-react-redux" class="headerlink" title="2 react-redux"></a>2 react-redux</h3><p>通过给store注册render函数,每次dispatch的时候,都会触发render函数(dispatch函数执行的时候,会执行传入的reducer和绑定的所有的监听函数 )</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React ,&#123;Component,PropTypes&#125; <span class="keyword">from</span> <span class="string">'react'</span></div><div class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span></div><div class="line"><span class="keyword">import</span> &#123;createStore&#125; <span class="keyword">from</span> <span class="string">'redux'</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> increaseAction = &#123;<span class="attr">type</span> :<span class="string">'INCREASE'</span>&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params">state = &#123;count: <span class="number">0</span>&#125;,action</span>)</span>&#123;</div><div class="line">  <span class="keyword">switch</span>(action.type)&#123;</div><div class="line">    <span class="keyword">case</span> <span class="string">'INCREASE'</span> :</div><div class="line">      <span class="keyword">return</span> &#123;<span class="attr">count</span> : state.count+<span class="number">1</span>&#125;</div><div class="line">    <span class="keyword">default</span> : </div><div class="line">      <span class="keyword">return</span> state </div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">const</span> store = createStore(reducer)</div><div class="line"><span class="built_in">console</span>.log(store);</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(store.getState());</div><div class="line"><span class="comment">//=========================如果没有这段代码,视图将不会更新,但是state状态确实是改变了的</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    ReactDOM.render(</div><div class="line">    <span class="xml"><span class="tag">&lt;<span class="name">Toggle</span> /&gt;</span>,</span></div><div class="line">    document.getElementById('root')</div><div class="line">    );</div><div class="line">&#125;</div><div class="line"></div><div class="line">store.subscribe(render)</div><div class="line">//============================================</div><div class="line">class Toggle extends React.Component &#123;</div><div class="line"></div><div class="line">  render() &#123;</div><div class="line">    return (</div><div class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span>=&gt;</span>&#123;store.dispatch(increaseAction);console.log(store.getState().count);</div><div class="line">      &#125;&#125;&gt;</div><div class="line">        &#123;store.getState().count&#125;</div><div class="line">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">console.dir(Toggle);</div><div class="line"></div><div class="line">ReactDOM.render(</div><div class="line">  <span class="tag">&lt;<span class="name">Toggle</span> /&gt;</span>,</div><div class="line">  document.getElementById('root')</div><div class="line">);</div></pre></td></tr></table></figure>
<h3 id="3-react-redux-react-redux"><a href="#3-react-redux-react-redux" class="headerlink" title="3 react    redux     react-redux"></a>3 react    redux     react-redux</h3><p>通过第二部分代码我们可以看出来,redux确实可以帮助我们管理代码,但是有一点不好的地方就是每次state的状态改变的时候,都需要重新手动刷新视图.</p>
<p>react-redux 提供两个函数,一个是Provider,该组件函数定义的时候,大概实现如下:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Provider</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">  getChildContext() &#123;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">      <span class="attr">store</span> : <span class="keyword">this</span>.props.store</div><div class="line">    &#125;;</div><div class="line">  &#125;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.props.children;</div><div class="line">    <span class="comment">//表示渲染Privider组件的子元素</span></div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">Provider.childContextTypes = &#123;</div><div class="line">  <span class="attr">store</span>: React.PropTypes.object</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>一个是connect函数 const WrapToggle = connect(mapStateToProps,mapDispatchToProps)(Toggle),高阶组件</p>
<p>该函数的作用是通过mapStateToProps和mapDispatchToProps函数,将将一些属性添加到Toggle组件的props上</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React ,&#123;Component,PropTypes&#125; <span class="keyword">from</span> <span class="string">'react'</span></div><div class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span></div><div class="line"><span class="keyword">import</span> &#123;createStore&#125; <span class="keyword">from</span> <span class="string">'redux'</span></div><div class="line"><span class="keyword">import</span> &#123;Provider,connect&#125; <span class="keyword">from</span> <span class="string">'react-redux'</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> increaseAction = &#123;<span class="attr">type</span> :<span class="string">'INCREASE'</span>&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params">state = &#123;count: <span class="number">0</span>&#125;,action</span>)</span>&#123;</div><div class="line">  <span class="keyword">switch</span>(action.type)&#123;</div><div class="line">    <span class="keyword">case</span> <span class="string">'INCREASE'</span> :</div><div class="line">      <span class="keyword">return</span> &#123;<span class="attr">count</span> : state.count+<span class="number">1</span>&#125;</div><div class="line">    <span class="keyword">default</span> : </div><div class="line">      <span class="keyword">return</span> state </div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">const</span> store = createStore(reducer)</div><div class="line"><span class="built_in">console</span>.log(store);</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(store.getState());</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Toggle</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  </div><div class="line">  render() &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.props);<span class="comment">//connect函数中stateProps dispatchProps ownProps 三者融合后的结果传递给UI组件props对象</span></div><div class="line">    <span class="comment">//对象的解构赋值</span></div><div class="line">    <span class="keyword">const</span> &#123;value,onIncreaseClick&#125; = <span class="keyword">this</span>.props </div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>= <span class="string">&#123;onIncreaseClick&#125;</span>&gt;</span></span></div><div class="line">        &#123;value&#125;</div><div class="line">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">const</span> mapStateToProps = <span class="function">(<span class="params">state, ownProps</span>) =&gt;</span> &#123;</div><div class="line">  <span class="built_in">console</span>.log(state);</div><div class="line">  <span class="built_in">console</span>.log(ownProps);</div><div class="line">  <span class="comment">//state就是通过Provider传递进来的store.getState()的结果</span></div><div class="line">  <span class="comment">//ownProps就是connect返回的新组件,这里是WrapToggle组件上的Props属性对象</span></div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">value</span>: state.count</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">const</span>  mapDispatchToProps = <span class="function">(<span class="params">dispatch, ownProps</span>) =&gt;</span> &#123;</div><div class="line">  <span class="built_in">console</span>.log(dispatch);</div><div class="line">  <span class="built_in">console</span>.log(ownProps);</div><div class="line">  <span class="comment">//dispatch就是 通过Provider传递进来的store.dispatch函数</span></div><div class="line">  <span class="comment">//ownProps就是connect返回的新组件,这里是WrapToggle组件上的Props属性对象</span></div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">onIncreaseClick</span>: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">      dispatch(increaseAction)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">const</span> WrapToggle = connect(mapStateToProps,mapDispatchToProps)(Toggle)</div><div class="line"></div><div class="line"><span class="built_in">console</span>.dir(Toggle);</div><div class="line"><span class="built_in">console</span>.dir(WrapToggle);</div><div class="line"><span class="comment">//注意 WrapToggle组件添加了一个属性,方便一会输出对比,这些属性就是ownProps对象</span></div><div class="line">ReactDOM.render(</div><div class="line">  <span class="xml"><span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span>&gt;</span></span></div><div class="line">  </div><div class="line">    <span class="tag">&lt;<span class="name">WrapToggle</span> <span class="attr">wrapProps</span>=<span class="string">'WarpToggleProps'</span>/&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span>,</div><div class="line">  document.getElementById('root')</div><div class="line">);</div></pre></td></tr></table></figure>
<h3 id="4-react如何响应store的变化-也就是说何时重新渲染页面"><a href="#4-react如何响应store的变化-也就是说何时重新渲染页面" class="headerlink" title="4 react如何响应store的变化,也就是说何时重新渲染页面"></a>4 react如何响应store的变化,也就是说何时重新渲染页面</h3><p>4.1 单纯的react中,通过setState函数,改变state状态树,setState函数每次执行都会重新渲染UI视图</p>
<p>4.2 react搭配redux的时候,通过store链接,react的状态可以通过redux来进行管理,此时redux创建的store中存储了react中的state状态,此时如果想要更新UI视图,需要手动绑定事件,此时唯一改变state的函数是dispatch,通过该函数改变state,从createStore源码中可以看出来</p>
<ul>
<li>先执行reducer,改变state状态</li>
<li>然后会执行通过subscribe注册的所有的监听事件</li>
</ul>
<p>4.3 react搭配redux的时候, 通过react-redux进行react和redux的连接 ;</p>
<ul>
<li>Provider函数作用:  <ul>
<li>1)在原应用组件上包裹一层，使原来整个应用成为Provider的子组件,而Provider组件定义的时候,render函数返回的是子组件,所以渲染的还是子组件 </li>
<li>2) 接收Redux的store作为props，通过context对象传递给子孙组件上的connect</li>
</ul>
</li>
<li>在connect内部,当state树发生变化的时候,最终会触发setState函数,所以会直接触发UI视图的重新渲染<ul>
<li>1)将store对象上的整个state状态树上的<strong>某个属性</strong>传递给被包裹的组件,这里组件是Toggle,传递的属性是value</li>
<li>2)将store对象上的触发dispatch函数的onIncreaseClick传递给被包裹组件,这里是Toggle,传递的属性是onIncreaseClick</li>
<li>3)connect函数会将这些属性一起合并到Toggle组件的属性props上</li>
</ul>
</li>
</ul>
<ol>
<li><p>4 connect函数参数解析 connect(mapStateToProps, mapDispatchToProps, mergeProps, options)(component)</p>
<p>1)<strong>mapStateToProps(state, [ownProps])：</strong>函数: 每次state状态更新的时候都会调用该函数</p>
<ul>
<li>该函数在每次store中的state状态树更新的时候都会<strong>调用该函数,</strong>通过本案例点击按钮看到控制台输出可以深化理解</li>
<li>该函数返回的对象必须是plain object</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">function mapStateToProps(state) &#123;</div><div class="line">   return &#123; todos: state.todos &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>2)<strong>mapDispatchToProps(dispatch, [ownProps])：</strong>函数:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">mapDispatchToProps</span>(<span class="params">dispatch</span>) </span>&#123;</div><div class="line">   <span class="keyword">return</span> &#123;</div><div class="line">      <span class="attr">todoActions</span>: bindActionCreators(todoActionCreators, dispatch),</div><div class="line">      <span class="attr">counterActions</span>: bindActionCreators(counterActionCreators, dispatch)</div><div class="line">   &#125;;</div><div class="line">&#125;</div><div class="line"><span class="comment">//这里面mapDispatchToProps函数接受的参数其实就是store.dispatch函数,bindActionCreators函数接受两个参数,一个是actionCreator,一个是dispatch函数</span></div></pre></td></tr></table></figure>
<p>3)<strong>mergeProps(stateProps, dispatchProps, ownProps)：</strong></p>
<p>将mapStateToProps() 与 mapDispatchToProps()返回的对象和<strong>容器组件</strong>自身的props(本案例就是WrapToggle组件的props:  wrapProps=’WarpToggleProps)合并成新的props并传入被包裹的组件(Toggle)。默认返回 Object.assign({}, ownProps, stateProps, dispatchProps) 的结果。</p>
<p><strong>这里也就解释了为什么Toggle组件中props属性中有</strong>stateProps, dispatchProps, ownProps 这些对象的组合结果了.</p>
</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/11/214webpack模块路径解析规则/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/11/214webpack模块路径解析规则/" itemprop="url">
                  webpack模块路径解析规则
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-11T12:36:00+08:00">
                2017-05-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javascript/" itemprop="url" rel="index">
                    <span itemprop="name">javascript</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="模块解析"><a href="#模块解析" class="headerlink" title="模块解析"></a>模块解析</h1><p>##1 首先来看下webpack支持的模块类型</p>
<p>###模块(Modules)</p>
<p><a href="https://github.com/webpack/webpack.js.org/edit/master/content/concepts/modules.md" target="_blank" rel="external">EDIT DOCUMENT**</a></p>
<p>在<a href="https://en.wikipedia.org/wiki/Modular_programming" target="_blank" rel="external">模块化编程</a>中，开发者将程序分解成离散功能块(discrete chunks of functionality)，并称之为<em>模块</em>。</p>
<p>每个模块具有比完整程序更小的接触面，使得校验、调试、测试轻而易举。 精心编写的<em>模块</em>提供了可靠的抽象和封装界限，使得应用程序中每个模块都具有条理清楚的设计和明确的目的。</p>
<p>Node.js 从最一开始就支持模块化编程。然而，在 web，<em>模块化</em>的支持正缓慢到来。在 web 存在多种支持 JavaScript 模块化的工具，这些工具各有优势和限制。webpack 基于从这些系统获得的经验教训，并将<em>模块</em>的概念应用于项目中的任何文件。</p>
<p>###什么是 webpack 模块</p>
<p>对比 <a href="https://nodejs.org/api/modules.html" target="_blank" rel="external">Node.js 模块</a>，webpack <em>模块</em>能够以各种方式表达它们的依赖关系，几个例子如下：</p>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import" target="_blank" rel="external">ES2015 <code>import</code></a> 语句</li>
<li><a href="http://www.commonjs.org/specs/modules/1.0/" target="_blank" rel="external">CommonJS</a> <code>require()</code> 语句</li>
<li><a href="https://github.com/amdjs/amdjs-api/blob/master/AMD.md" target="_blank" rel="external">AMD</a> <code>define</code> 和 <code>require</code> 语句</li>
<li>css/sass/less 文件中的 <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/@import" target="_blank" rel="external"><code>@import</code> 语句</a>。</li>
<li>样式(<code>url(...)</code>)或 HTML 文件(<code>&lt;img src=...&gt;</code>)中的图片链接(image url)</li>
</ul>
<blockquote>
<p> webpack 1 需要特定的 loader 来转换 ES 2015 <code>import</code>，然而通过 webpack 2 可以开箱即用。</p>
</blockquote>
<h3 id="支持的模块类型"><a href="#支持的模块类型" class="headerlink" title="支持的模块类型"></a>支持的模块类型</h3><p>webpack 通过 <em>loader</em> 可以支持各种语言和预处理器编写模块。<em>loader</em> 描述了 webpack <strong>如何</strong>处理 非 JavaScript(non-JavaScript) <em>模块</em>，并且在<em>bundle</em>中引入这些<em>依赖</em>。 webpack 社区已经为各种流行语言和语言处理器构建了 <em>loader</em>，包括：</p>
<ul>
<li><a href="http://coffeescript.org/" target="_blank" rel="external">CoffeeScript</a></li>
<li><a href="https://www.typescriptlang.org/" target="_blank" rel="external">TypeScript</a></li>
<li><a href="https://babeljs.io/" target="_blank" rel="external">ESNext (Babel)</a></li>
<li><a href="http://sass-lang.com/" target="_blank" rel="external">Sass</a></li>
<li><a href="http://lesscss.org/" target="_blank" rel="external">Less</a></li>
<li><a href="http://stylus-lang.com/" target="_blank" rel="external">Stylus</a></li>
</ul>
<p>总的来说，webpack 提供了可定制的、强大和丰富的 API，允许<strong>任何技术栈</strong>使用 webpack，保持了在你的开发、测试和生成流程中<strong>无侵入性(non-opinionated)</strong>。</p>
<h2 id="2-webpack可以解析的文件路径"><a href="#2-webpack可以解析的文件路径" class="headerlink" title="2 webpack可以解析的文件路径"></a>2 webpack可以解析的文件路径</h2><p><code>(import</code>语句会执行所加载的模块，可以有下面的写法)</p>
<h3 id="绝对路径"><a href="#绝对路径" class="headerlink" title="绝对路径"></a>绝对路径</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> <span class="string">"/home/me/file"</span>;</div><div class="line"><span class="keyword">import</span> <span class="string">"C:\\Users\\me\\file"</span>;</div></pre></td></tr></table></figure>
<p>由于我们已经取得文件的绝对路径，因此不需要进一步再做解析。</p>
<p><strong>也就是说不需要webpack进行路径的解析.</strong></p>
<h3 id="相对路径"><a href="#相对路径" class="headerlink" title="相对路径"></a>相对路径</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> <span class="string">"../src/file1"</span>;</div><div class="line"><span class="keyword">import</span> <span class="string">"./file2"</span>;</div></pre></td></tr></table></figure>
<p>在这种情况下，使用 <code>import</code> 或 <code>require</code> 的资源文件(resource file)所在的目录被认为是上下文目录(context directory)。在 <code>import/require</code> 中给定的相对路径，会添加此上下文路径(context path)，以产生模块的绝对路径(absolute path)。</p>
<p><strong>也就是说webpack解析该文件的时候,会以资源文件所在目录为基准进行解析;</strong></p>
<h3 id="模块路径"><a href="#模块路径" class="headerlink" title="模块路径"></a>模块路径</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> <span class="string">"module"</span>;</div><div class="line"><span class="keyword">import</span> <span class="string">"module/lib/file"</span>;</div></pre></td></tr></table></figure>
<ul>
<li>模块将在 <a href="https://doc.webpack-china.org/configuration/resolve/#resolve-modules" target="_blank" rel="external"><code>resolve.modules</code></a> 中指定的所有目录内搜索。 <strong>也就是说对于模块路径,解析的时候会在node_modules目录下进行解析</strong></li>
</ul>
<p>告诉 webpack 解析模块时应该搜索的目录。</p>
<p>绝对路径和相对路径都能使用，但是要知道它们之间有一点差异。</p>
<p>通过查看当前目录以及祖先路径（即 <code>./node_modules</code>, <code>../node_modules</code> 等等），相对路径将类似于 Node 查找 ‘node_modules’ 的方式进行查找。</p>
<p>使用绝对路径，将只在给定目录中搜索。</p>
<p><code>resolve.modules</code> defaults to:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">modules: [&quot;node_modules&quot;]</div></pre></td></tr></table></figure>
<p>如果你想要添加一个目录到模块搜索目录，此目录优先于 <code>node_modules/</code> 搜索：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">modules: [path.resolve(__dirname, &quot;src&quot;), &quot;node_modules&quot;]</div></pre></td></tr></table></figure>
<ul>
<li>你可以替换初始模块路径，此替换路径通过使用 <a href="https://doc.webpack-china.org/configuration/resolve/#resolve-alias" target="_blank" rel="external"><code>resolve.alias</code></a> 配置选项来创建一个别名。 <strong>此时在解析模块路径的时候,就不会再去node_modules里面查找对应的模块,而是通过我们配置的路径进行查找</strong></li>
</ul>
<p>比如App.js中 </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> store, &#123; history &#125; <span class="keyword">from</span> <span class="string">'STORE'</span></div><div class="line"><span class="keyword">import</span> routes <span class="keyword">from</span> <span class="string">'ROUTE'</span></div></pre></td></tr></table></figure>
<p><strong>from后面就是要解析的路径,此处的路径是模块路径;</strong></p>
<p>webpack.config.js中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>),</div><div class="line">  webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>),</div><div class="line">  NyanProgressPlugin = <span class="built_in">require</span>(<span class="string">'nyan-progress-webpack-plugin'</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> rootPath = path.resolve(__dirname, <span class="string">'..'</span>), <span class="comment">// 项目根目录,__diename永远获取的是当前文件相对于磁盘根目录  react-demo/  目录下</span></div><div class="line">  src = path.join(rootPath, <span class="string">'src'</span>), <span class="comment">// 开发源码目录</span></div><div class="line">  env = process.env.NODE_ENV.trim(); <span class="comment">// 当前环境</span></div><div class="line"><span class="keyword">var</span> commonPath = &#123;</div><div class="line">  <span class="attr">rootPath</span>: rootPath,</div><div class="line">  <span class="attr">dist</span>: path.join(rootPath, <span class="string">'dist'</span>), <span class="comment">// build 后输出目录</span></div><div class="line">  indexHTML: path.join(src, <span class="string">'index.html'</span>), <span class="comment">// 入口基页</span></div><div class="line">  staticDir: path.join(rootPath, <span class="string">'static'</span>) <span class="comment">// 无需处理的静态资源目录</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  <span class="attr">commonPath</span>: commonPath,</div><div class="line">  <span class="attr">entry</span>: &#123;</div><div class="line">    <span class="attr">app</span>: path.join(src, <span class="string">'app.js'</span>),</div><div class="line"></div><div class="line">    <span class="comment">// ================================</span></div><div class="line">    <span class="comment">// 框架 / 类库 分离打包</span></div><div class="line">    <span class="comment">// ================================</span></div><div class="line">    vendor: [</div><div class="line">      <span class="string">'history'</span>,</div><div class="line">      <span class="string">'lodash'</span>,</div><div class="line">      <span class="string">'react'</span>,</div><div class="line">      <span class="string">'react-dom'</span>,</div><div class="line">      <span class="string">'react-redux'</span>,</div><div class="line">      <span class="string">'react-router'</span>,</div><div class="line">      <span class="string">'react-router-redux'</span>,</div><div class="line">      <span class="string">'redux'</span>,</div><div class="line">      <span class="string">'redux-thunk'</span></div><div class="line">    ]</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">output</span>: &#123;</div><div class="line">    <span class="attr">path</span>: path.join(commonPath.dist, <span class="string">'static'</span>),</div><div class="line">    <span class="attr">publicPath</span>: <span class="string">'/static/'</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">resolve</span>: &#123;</div><div class="line">    <span class="attr">extensions</span>: [<span class="string">''</span>, <span class="string">'.js'</span>, <span class="string">'.jsx'</span>],</div><div class="line">    <span class="attr">alias</span>: &#123;</div><div class="line">      <span class="comment">// ================================</span></div><div class="line">      <span class="comment">// 自定义路径别名</span></div><div class="line">      <span class="comment">// ================================</span></div><div class="line">      STORE: path.join(src, <span class="string">'redux/store'</span>),</div><div class="line">      <span class="attr">ROUTE</span>: path.join(src, <span class="string">'routes'</span>),<span class="comment">//对应src/routers文件夹  </span></div><div class="line">    &#125;</div><div class="line">  &#125;, </div><div class="line">&#125;;</div><div class="line"></div><div class="line"> resolveLoader: &#123;</div><div class="line">    <span class="attr">root</span>: path.join(rootPath, <span class="string">'node_modules'</span>)</div><div class="line">  &#125;,</div></pre></td></tr></table></figure>
<h2 id="3一旦根据上述规则解析路径之后-解析器将检查路径是否指向文件或者目录"><a href="#3一旦根据上述规则解析路径之后-解析器将检查路径是否指向文件或者目录" class="headerlink" title="3一旦根据上述规则解析路径之后,解析器将检查路径是否指向文件或者目录"></a>3一旦根据上述规则解析路径之后,解析器将检查路径是否指向文件或者目录</h2><ul>
<li><p>文件 : 如果以上提到的路径(相对路径,模块路径,绝对路径),指向的是一个文件 </p>
<ul>
<li>如果文件具有文件扩展名,则将文件直接打包</li>
<li>否则将使用[resolve.extensions]作为文件扩展名来解析,此选项告诉解析器在解析的时候能够接受那些扩展名</li>
</ul>
</li>
<li><p>文件夹 : 如果路径指向的是一个文件夹</p>
<ul>
<li><p>如果文件夹中包含 <code>package.json</code> 文件，则按照顺序查找 <a href="https://doc.webpack-china.org/configuration/resolve/#resolve-mainfields" target="_blank" rel="external"><code>resolve.mainFields</code></a> 配置选项中指定的字段。并且 <code>package.json</code> 中的第一个这样的字段确定文件路径。</p>
</li>
<li><p>If there is no <code>package.json</code> or if the main fields do not return a valid path, file names specified in the <a href="https://doc.webpack-china.org/configuration/resolve/#resolve-mainfiles" target="_blank" rel="external"><code>resolve.mainFiles</code></a> configuration option are looked for in order, to see if a matching filename exists in the imported/required directory .</p>
<p>如果目录中没有package.json文件,那么将会根据reslove(解析对象)中的默认配置resolve.mainFiles中的配置文件名去该目录中解析配置的文件名,默认配置如下 .</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mainFiles: [&quot;index&quot;]</div></pre></td></tr></table></figure>
<p>也就是说会import  index文件,该文件的导出的对象.</p>
</li>
<li><p>The file extension is then resolved in a similar way using the <code>resolve.extensions</code> option.</p>
</li>
</ul>
</li>
</ul>
<h3 id="4-loaders的解析规则"><a href="#4-loaders的解析规则" class="headerlink" title="4 loaders的解析规则"></a>4 loaders的解析规则</h3><p>loader解析遵循与文件解析器指定的规则相同.</p>
<p><strong>但是resolveloader配置选项可以用来为Loader提供独立的解析规则</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">resolveloader : &#123;</div><div class="line">    <span class="attr">modules</span>: [<span class="string">"node_modules"</span>],</div><div class="line">    <span class="attr">extensions</span>: [<span class="string">".js"</span>, <span class="string">".json"</span>],</div><div class="line">    <span class="attr">mainFields</span>: [<span class="string">"loader"</span>, <span class="string">"main"</span>]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="5-从缓存中解析模块"><a href="#5-从缓存中解析模块" class="headerlink" title="5 从缓存中解析模块"></a>5 从缓存中解析模块</h3><p>Every filesystem access is cached, so that multiple parallel or serial requests to the same file occur faster. In <a href="https://webpack.js.org/configuration/watch/#watch" target="_blank" rel="external">watch mode</a>, only modified files are evicted from the cache. If watch mode is off, then the cache gets purged before every compilation.</p>
<p>每一个文件都会被缓存,所以对于同一文件的并行的请求将可以更快的请求到模块,在观察者模式下,只用改变了的文件将会从缓存中抽出,如果观察者模式关闭,那么每次编译之前都会清理缓存.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/09/212React创建组件的三种方式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/09/212React创建组件的三种方式/" itemprop="url">
                  React创建组件的三种方式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-09T12:36:00+08:00">
                2017-05-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javascript/" itemprop="url" rel="index">
                    <span itemprop="name">javascript</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-React-createClass"><a href="#1-React-createClass" class="headerlink" title="1 React.createClass( )"></a>1 React.createClass( )</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"root"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">'text/babel'</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="keyword">var</span> HelloWorld = React.createClass(&#123; <span class="attr">render</span> : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">return</span></div><div class="line">    <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>hello &#123;this.props.name1&#125;</span></div><div class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>hello &#123;this.props.name2&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">    &#125; &#125;) ;</div><div class="line">    ReactDOM.render(</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">HelloWorld</span> <span class="attr">name1</span>=<span class="string">'Jhon'</span> <span class="attr">name2</span>=<span class="string">"JiM"</span> /&gt;</span>, </span></div><div class="line">      document.getElementById('root') </div><div class="line">    )</div><div class="line"></div><div class="line"></div><div class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="2-React-Component"><a href="#2-React-Component" class="headerlink" title="2 React.Component"></a>2 React.Component</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"root"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">'text/babel'</span>&gt;</span><span class="javascript"></span></div><div class="line">     <span class="class"><span class="keyword">class</span> <span class="title">Welcome</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">         render()&#123;</div><div class="line">             <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>hello &#123;this.props.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></div><div class="line">         &#125;</div><div class="line">     &#125;</div><div class="line"></div><div class="line">     <span class="keyword">const</span> element = <span class="xml"><span class="tag">&lt;<span class="name">Welcome</span> <span class="attr">name</span> = <span class="string">'JiM'</span>/&gt;</span></span></div><div class="line">     ReactDOM.render(</div><div class="line">         element,</div><div class="line">         document.getElementById('root')</div><div class="line">     )</div><div class="line"></div><div class="line">   <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="3-function"><a href="#3-function" class="headerlink" title="3 function"></a>3 function</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">import React from 'react'</div><div class="line">import &#123;</div><div class="line">  BrowserRouter as Router,</div><div class="line">  Route,</div><div class="line">  Link</div><div class="line">&#125; from 'react-router-dom'</div><div class="line">const Repo = ()=&gt;(<span class="tag">&lt;<span class="name">div</span>&gt;</span>this is Repo<span class="tag">&lt;/<span class="name">div</span>&gt;</span>)</div><div class="line">const Category = (props)=&gt;&#123;</div><div class="line">  console.log(props);</div><div class="line">  return (<span class="tag">&lt;<span class="name">div</span>&gt;</span>this is category<span class="tag">&lt;/<span class="name">div</span>&gt;</span>)</div><div class="line">&#125;</div><div class="line">const MyTest =()=&gt;(</div><div class="line">  <span class="tag">&lt;<span class="name">Router</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">'/about'</span>&gt;</span>About<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">'./repo'</span>&gt;</span>Repo<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">      </div><div class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">'./category'</span>&gt;</span>Category<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">Route</span> <span class="attr">exact</span> <span class="attr">path</span>=<span class="string">'/about'</span> <span class="attr">render</span>=<span class="string">&#123;(props)</span>=&gt;</span>&#123;console.log(props);return (<span class="tag">&lt;<span class="name">div</span>&gt;</span>this is aabout<span class="tag">&lt;/<span class="name">div</span>&gt;</span>)</div><div class="line">      &#125;&#125;&gt;<span class="tag">&lt;/<span class="name">Route</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">Route</span> <span class="attr">exact</span> <span class="attr">path</span>=<span class="string">'/repo'</span> <span class="attr">component</span>=<span class="string">&#123;Repo&#125;</span>&gt;</span> <span class="tag">&lt;/<span class="name">Route</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">Route</span> <span class="attr">exact</span> <span class="attr">path</span>=<span class="string">'/category'</span> <span class="attr">component</span>=<span class="string">&#123;Category&#125;</span>&gt;</span> <span class="tag">&lt;/<span class="name">Route</span>&gt;</span></div><div class="line">    </div><div class="line">      <span class="tag">&lt;<span class="name">Route</span> <span class="attr">children</span>=<span class="string">&#123;(props)</span>=&gt;</span>&#123;console.log(props);return (<span class="tag">&lt;<span class="name">div</span>&gt;</span>this is a component build througth children<span class="tag">&lt;/<span class="name">div</span>&gt;</span>)</div><div class="line">      &#125;&#125;&gt;<span class="tag">&lt;/<span class="name">Route</span>&gt;</span></div><div class="line">    </div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">  </div><div class="line">  </div><div class="line">  <span class="tag">&lt;/<span class="name">Router</span>&gt;</span></div><div class="line">)</div><div class="line">export default MyTest</div></pre></td></tr></table></figure>
<p>ES6一般写法</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> BasicExample = <span class="function"><span class="params">()</span> =&gt;</span> (</div><div class="line">  &lt;Router&gt;</div><div class="line">    &lt;div&gt;</div><div class="line">      &lt;ul&gt;</div><div class="line">        &lt;li&gt;&lt;Link to="/"&gt;Home&lt;/Link&gt;&lt;/li&gt;</div><div class="line">        &lt;li&gt;&lt;Link to="/about"&gt;About&lt;/Link&gt;&lt;/li&gt;</div><div class="line">        &lt;li&gt;&lt;Link to="/topics"&gt;Topics&lt;/Link&gt;&lt;/li&gt;</div><div class="line">      &lt;/ul&gt;</div><div class="line"></div><div class="line">      &lt;hr/&gt;</div><div class="line"></div><div class="line">      &lt;Route exact path="/" component=&#123;Home&#125;/&gt;</div><div class="line">      &lt;Route path="/about" component=&#123;About&#125;/&gt;</div><div class="line">      &lt;Route path="/topics" component=&#123;Topics&#125;/&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">  &lt;/Router&gt;</div><div class="line">)</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/09/211React概览/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/09/211React概览/" itemprop="url">
                  React概览
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-09T12:36:00+08:00">
                2017-05-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javascript/" itemprop="url" rel="index">
                    <span itemprop="name">javascript</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-React中有什么顶层API"><a href="#1-React中有什么顶层API" class="headerlink" title="1 React中有什么顶层API"></a>1 React中有什么顶层API</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">'../build/react-0.13.4.js'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">        <span class="built_in">console</span>.log(React);    </div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div></pre></td></tr></table></figure>
<p>控制台输出就是如下React对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> React = &#123;</div><div class="line">  <span class="attr">Children</span>: &#123;</div><div class="line">    <span class="attr">map</span>: ReactChildren.map,</div><div class="line">    <span class="attr">forEach</span>: ReactChildren.forEach,</div><div class="line">    <span class="attr">count</span>: ReactChildren.count,</div><div class="line">    <span class="attr">only</span>: onlyChild</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">Component</span>: ReactComponent,</div><div class="line">  <span class="attr">DOM</span>: ReactDOM,</div><div class="line">  <span class="attr">PropTypes</span>: ReactPropTypes,</div><div class="line">  <span class="attr">initializeTouchEvents</span>: <span class="function"><span class="keyword">function</span>(<span class="params">shouldUseTouch</span>) </span>&#123;</div><div class="line">    EventPluginUtils.useTouchEvents = shouldUseTouch;</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">createClass</span>: ReactClass.createClass,</div><div class="line">  <span class="attr">createElement</span>: createElement,</div><div class="line">  <span class="attr">cloneElement</span>: cloneElement,</div><div class="line">  <span class="attr">createFactory</span>: createFactory,</div><div class="line">  <span class="attr">createMixin</span>: <span class="function"><span class="keyword">function</span>(<span class="params">mixin</span>) </span>&#123;</div><div class="line">    <span class="comment">// Currently a noop. Will be used to validate and trace mixins.</span></div><div class="line">    <span class="keyword">return</span> mixin;</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">constructAndRenderComponent</span>: ReactMount.constructAndRenderComponent,</div><div class="line">  <span class="attr">constructAndRenderComponentByID</span>: ReactMount.constructAndRenderComponentByID,</div><div class="line">  <span class="attr">findDOMNode</span>: findDOMNode,</div><div class="line">  <span class="attr">render</span>: render,</div><div class="line">  <span class="attr">renderToString</span>: ReactServerRendering.renderToString,</div><div class="line">  <span class="attr">renderToStaticMarkup</span>: ReactServerRendering.renderToStaticMarkup,</div><div class="line">  <span class="attr">unmountComponentAtNode</span>: ReactMount.unmountComponentAtNode,</div><div class="line">  <span class="attr">isValidElement</span>: ReactElement.isValidElement,</div><div class="line">  <span class="attr">withContext</span>: ReactContext.withContext,</div><div class="line"></div><div class="line">  <span class="comment">// Hook for JSX spread, don't use this for anything else.</span></div><div class="line">  __spread: assign</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h3 id="顶层API的一般用法"><a href="#顶层API的一般用法" class="headerlink" title="顶层API的一般用法"></a>顶层API的一般用法</h3><h4 id="createElement"><a href="#createElement" class="headerlink" title="createElement( )"></a>createElement( )</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">React.createElement(</div><div class="line">  type,</div><div class="line">  [props],</div><div class="line">  [...children]</div><div class="line">)</div></pre></td></tr></table></figure>
<p>平常我们用 jsx 写的<code>&lt;Hello /&gt;</code> 其实就是对CreateElement函数的封装</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hello</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Hello &#123;this.props.toWhat&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">ReactDOM.render(</div><div class="line">  <span class="xml"><span class="tag">&lt;<span class="name">Hello</span> <span class="attr">toWhat</span>=<span class="string">"World"</span> /&gt;</span>,</span></div><div class="line">  document.getElementById('root')</div><div class="line">);</div></pre></td></tr></table></figure>
<p>等价于</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hello</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> React.createElement(<span class="string">'div'</span>, <span class="literal">null</span>, <span class="string">`Hello <span class="subst">$&#123;<span class="keyword">this</span>.props.toWhat&#125;</span>`</span>);</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">ReactDOM.render(</div><div class="line">  React.createElement(Hello, &#123;<span class="attr">toWhat</span>: <span class="string">'World'</span>&#125;, <span class="literal">null</span>),</div><div class="line">  <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>)</div><div class="line">);</div></pre></td></tr></table></figure>
<h4 id="React-Component"><a href="#React-Component" class="headerlink" title="React.Component( )"></a>React.Component( )</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Greeting</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, &#123;this.props.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="2-ReactDOM"><a href="#2-ReactDOM" class="headerlink" title="2 ReactDOM"></a>2 ReactDOM</h3><h4 id="ReactDOM-render"><a href="#ReactDOM-render" class="headerlink" title="ReactDOM.render()"></a>ReactDOM.render()</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">ReactDOM.render(</div><div class="line">  element,</div><div class="line">  container,</div><div class="line">  [callback]</div><div class="line">)</div></pre></td></tr></table></figure>
<ul>
<li>该方法将在我们提供的container中渲染一个React元素</li>
<li>如果可选择的callback被提供了,那么在组件渲染完毕之后,就可以执行callback函数</li>
<li>React将会替换我们提供的container中的所有元素为ReactElement(如果原来的容器有子元素的话)</li>
</ul>
<h4 id="unmountComponentAtNode"><a href="#unmountComponentAtNode" class="headerlink" title="unmountComponentAtNode( )"></a>unmountComponentAtNode( )</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ReactDOM.unmountComponentAtNode(container)</div></pre></td></tr></table></figure>
<p>Remove a mounted React component from the DOM and clean up its event handlers and state. If no component was mounted in the container, calling this function does nothing. Returns <code>true</code> if a component was unmounted and <code>false</code> if there was no component to unmount.</p>
<h4 id="findDOMNode"><a href="#findDOMNode" class="headerlink" title="findDOMNode( )"></a>findDOMNode( )</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ReactDOM.findDOMNode(component)</div></pre></td></tr></table></figure>
<p>If this component has been mounted into the DOM, this returns the corresponding native browser DOM element. This method is useful for reading values out of the DOM, such as form field values and performing DOM measurements. <strong>In most cases, you can attach a ref to the DOM node and avoid using findDOMNode at all.</strong> When <code>render</code> returns <code>null</code> or <code>false</code>, <code>findDOMNode</code> returns <code>null</code>.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/09/213React-router-Foundation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/09/213React-router-Foundation/" itemprop="url">
                  React-router Foundation
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-09T12:36:00+08:00">
                2017-05-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javascript/" itemprop="url" rel="index">
                    <span itemprop="name">javascript</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>参考此文章,具体的demo以及相关配置都有,大家可以直接看这个即可,我写的只是为了让自己理解深刻</p>
<p><a href="https://github.com/reactjs/react-router-tutorial/tree/master/lessons" target="_blank" rel="external">react-router-tutorial</a></p>
<h3 id="1-React-Router用来配合React来使用-对于不同的组件-根据不同的url地址进行不同的组件的渲染"><a href="#1-React-Router用来配合React来使用-对于不同的组件-根据不同的url地址进行不同的组件的渲染" class="headerlink" title="1 React-Router用来配合React来使用,对于不同的组件,根据不同的url地址进行不同的组件的渲染"></a>1 React-Router用来配合React来使用,对于不同的组件,根据不同的url地址进行不同的组件的渲染</h3><p>还是从本质上先大概了解下Router和Route分别是什么 </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; Router, Route, hashHistory &#125; <span class="keyword">from</span> <span class="string">'react-router'</span></div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(<span class="string">'Router'</span>,Router);</div><div class="line"><span class="built_in">console</span>.log(<span class="string">'Route'</span>,Route);</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">Router function (props, context, updater) &#123;</div><div class="line">	      // This constructor is overridden by mocks. The argument is used</div><div class="line">	      // by mocks to assert on what gets mounted.</div><div class="line"></div><div class="line">	      if (process.env.NODE_ENV !== &apos;production…</div><div class="line">Route function (props, context, updater) &#123;</div><div class="line">	      // This constructor is overridden by mocks. The argument is used</div><div class="line">	      // by mocks to assert on what gets mounted.</div><div class="line"></div><div class="line">	      if (process.env.NODE_ENV !== &apos;production…</div></pre></td></tr></table></figure>
<p>可以看出,它们也是一般的组件创建函数,然后通过类似于下面的方法进行调用即可</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Router</span> <span class="attr">history</span>=<span class="string">&#123;hashHistory&#125;</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">"/"</span> <span class="attr">component</span>=<span class="string">&#123;App&#125;/</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">'/about'</span> <span class="attr">component</span>=<span class="string">&#123;About&#125;/</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">'/repo'</span> <span class="attr">component</span>=<span class="string">&#123;Repo&#125;/</span>&gt;</span></div><div class="line"> <span class="tag">&lt;/<span class="name">Router</span>&gt;</span></div></pre></td></tr></table></figure>
<p>最终实现的功能就会根据不同的路由渲染不同的组件</p>
<h3 id="2-如上实现根据不同的url地址的实现方案-需要我们在地址栏手动输入相关地址-才可以访问-这个时候Link组件"><a href="#2-如上实现根据不同的url地址的实现方案-需要我们在地址栏手动输入相关地址-才可以访问-这个时候Link组件" class="headerlink" title="2 如上实现根据不同的url地址的实现方案,需要我们在地址栏手动输入相关地址,才可以访问,这个时候Link组件"></a>2 如上实现根据不同的url地址的实现方案,需要我们在地址栏手动输入相关地址,才可以访问,这个时候Link组件</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">import &#123;Link&#125; from 'react-router'</div><div class="line">console.log('Link',Link);</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Link function (props, context, updater) &#123;</div><div class="line">	      // This constructor is overridden by mocks. The argument is used</div><div class="line">	      // by mocks to assert on what gets mounted.</div><div class="line"></div><div class="line">	      if (process.env.NODE_ENV !== &apos;production…</div></pre></td></tr></table></figure>
<p>其实我们发现 Router  Route   Link等也都是一些组件而已,实现的功能就是根据不同的url地址进行不同组件的渲染.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> &#123;Link&#125; <span class="keyword">from</span> <span class="string">'react-router'</span></div><div class="line"><span class="built_in">console</span>.log(<span class="string">'Link'</span>,Link);</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> React.createClass(&#123;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></div><div class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>React Router Tutorial<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">role</span> = <span class="string">'nav'</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">'/about'</span>&gt;</span>About<span class="tag">&lt;/<span class="name">Link</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">'/repo'</span>&gt;</span>Repo<span class="tag">&lt;/<span class="name">Link</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>Link组件的作用和我们平常用的<code>&lt;a&gt;</code>标签的作用大同小异 .</p>
<p>同样我们也可以封装一个Link ,该link可以有一些样式,以后在这个组件就可以被复用.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">// modules/NavLink.js</div><div class="line">import React from &apos;react&apos;</div><div class="line">import &#123; Link &#125; from &apos;react-router&apos;</div><div class="line"></div><div class="line">export default React.createClass(&#123;</div><div class="line">  render() &#123;</div><div class="line">    return &lt;Link &#123;...this.props&#125; activeClassName=&quot;active&quot;/&gt;</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="3-React-router的工作-原理其实-就是根据url地址栏不同的地址-然后可以渲染不同的组件"><a href="#3-React-router的工作-原理其实-就是根据url地址栏不同的地址-然后可以渲染不同的组件" class="headerlink" title="3 React-router的工作 原理其实 就是根据url地址栏不同的地址,然后可以渲染不同的组件"></a>3 React-router的工作 原理其实 就是根据url地址栏不同的地址,然后可以渲染不同的组件</h3><p>在路由中 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">this.props.children</div></pre></td></tr></table></figure>
<p>至关重要,理解它就算基本上理解了路由的基本原理</p>
<p>先贴上参考链接吧 <a href="https://github.com/xianyulaodi/React-router" target="_blank" rel="external">xianyulaodi</a></p>
<p>App组件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">const App=React.createClass(&#123;</div><div class="line">  render() &#123;</div><div class="line">    return (</div><div class="line"></div><div class="line">    	&lt;div className=&quot;mp_wrap bui_wrap&quot;&gt;</div><div class="line">			&#123;/**主屏幕**/&#125;</div><div class="line">			&lt;div className=&quot;mp_pagebox_home&quot;&gt;</div><div class="line">				</div><div class="line">				&#123;/**这里面的内容会被子路由给代替**/&#125;</div><div class="line">				&#123;this.props.children&#125;</div><div class="line">				&#123;/**注意这个this.props.children**/&#125;</div><div class="line">				&#123;/**公共页脚**/&#125;</div><div class="line">				&lt;div className=&quot;mp_page_footer&quot;&gt;</div><div class="line">					 &lt;Footer  /&gt;</div><div class="line">				&lt;/div&gt;</div><div class="line">				&#123;/**公共页脚**/&#125;</div><div class="line">			&lt;/div&gt;</div><div class="line">			&#123;/**主屏幕**/&#125;</div><div class="line">		&lt;/div&gt;</div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>路由的配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">render((</div><div class="line">  &lt;Router&gt;</div><div class="line">    &lt;Route path=&quot;/&quot; component=&#123;App&#125;&gt;</div><div class="line">      &lt;IndexRoute component=&#123;Index&#125; /&gt;</div><div class="line"></div><div class="line">      &lt;Route path=&quot;/type/:typeName&quot; component=&#123;Type&#125; /&gt;</div><div class="line"></div><div class="line">      &lt;Route path=&quot;/mall&quot; component=&#123;Mall&#125;&gt;</div><div class="line">          &lt;Route path=&quot;type/:typeName&quot; component=&#123;Type&#125; /&gt;</div><div class="line">      &lt;/Route&gt;</div><div class="line"></div><div class="line">      &lt;Route path=&quot;/my&quot; component=&#123;My&#125;&gt;</div><div class="line">           &lt;IndexRoute component=&#123;MyNav&#125; /&gt;</div><div class="line">           &lt;Route path=&quot;userCenter&quot; component=&#123;MyUserCenter&#125; /&gt;</div><div class="line">           &lt;Route path=&quot;memberClub&quot; component=&#123;MemberClub&#125; /&gt;</div><div class="line">      &lt;/Route&gt;</div><div class="line"></div><div class="line">      &lt;Route path=&quot;/circle&quot; component=&#123;Circle&#125;&gt;</div><div class="line">          &lt;IndexRoute component=&#123;CircleType&#125; /&gt;</div><div class="line">          &lt;Route path=&quot;tip/:tipName&quot; component=&#123;CircleTip&#125; /&gt;</div><div class="line">          &lt;Route path=&quot;say&quot; component=&#123;CircleSay&#125; /&gt;</div><div class="line">      &lt;/Route&gt;</div><div class="line"></div><div class="line">    &lt;/Route&gt;</div><div class="line">  &lt;/Router&gt;</div><div class="line">), document.getElementById(&apos;index&apos;))</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;/**这里面的内容会被子路由给代替**/&#125;</div><div class="line">&#123;this.props.children&#125;</div><div class="line">&#123;/**注意这个this.props.children**/&#125;</div></pre></td></tr></table></figure>
<p>在这里面 this.props.children会更具不同的url地址加载不同的组件</p>
<ul>
<li><p>默认加载的组件是Index</p>
</li>
<li><p>如果url  是  /my   ,那么就会加载  My组件</p>
</li>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">这里是my.js文件,也就是my组件</div><div class="line">var Content= React.createClass(&#123;</div><div class="line"></div><div class="line">	render()&#123;</div><div class="line">		</div><div class="line">		return (</div><div class="line">				&lt;div className = &apos;myWrap&apos;&gt;	</div><div class="line">					&#123;this.props.children&#125;</div><div class="line">				&lt;/div&gt;</div><div class="line">		)</div><div class="line">	&#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
</li>
<li><p>my组件在渲染的时候,默认渲染的是MyNav组件,</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;Route path=&quot;/my&quot; component=&#123;My&#125;&gt;</div><div class="line">  &lt;IndexRoute component=&#123;MyNav&#125; /&gt;</div><div class="line">  &lt;Route path=&quot;userCenter&quot; component=&#123;MyUserCenter&#125; /&gt;</div><div class="line">  &lt;Route path=&quot;memberClub&quot; component=&#123;MemberClub&#125; /&gt;</div><div class="line">&lt;/Route&gt;</div></pre></td></tr></table></figure>
<p>如果url地址栏是/my/userCenter,则会加载MyUserCenter组件</p>
<p><strong>所以要理解路由的匹配原理</strong></p>
<p>嵌套关系:</p>
<p>中文网的解释：React Router 使用路由嵌套的概念来让你定义 view 的嵌套集合，当一个给定的 URL 被调用时，整个集合中（命中的部分）都会被渲染。</p>
<p>嵌套路由被描述成一种树形结构。React Router 会深度优先遍历整个<a href="http://react-guide.github.io/react-router-cn/docs/guides/basics/docs/Glossary.md#routeconfig" target="_blank" rel="external">路由配置</a>来寻找一个与给定的 URL 相匹配的路由。</p>
<p>什么意思呢。上面的入口文件中，可以看到，其他路由都是最外层那个app（也就是这个 <code>&lt;Route path=&quot;/&quot; component={App}&gt;</code>）的子路由，其他路由都是嵌套在这里面。</p>
<p>当url变化是，它里面的{this.props.children}都会替换，也就是所谓的整个集合的命中部分都会被渲染。</p>
<p>路径语法:</p>
<p>路由路径是匹配一个（或一部分）URL 的 <a href="http://react-guide.github.io/react-router-cn/docs/guides/basics/docs/Glossary.md#routepattern" target="_blank" rel="external">一个字符串模式</a>。大部分的路由路径都可以直接按照字面量理解，除了以下几个特殊的符号：</p>
</li>
</ul>
<ul>
<li><p><code>:paramName</code> – 匹配一段位于 <code>/</code>、<code>?</code> 或 <code>#</code> 之后的 URL。 命中的部分将被作为一个<a href="http://react-guide.github.io/react-router-cn/docs/guides/basics/docs/Glossary.md#params" target="_blank" rel="external">参数</a></p>
<ul>
<li><code>()</code> – 在它内部的内容被认为是可选的</li>
<li><code>*</code> – 匹配任意字符（非贪婪的）直到命中下一个字符或者整个 URL 的末尾，并创建一个 <code>splat</code> <a href="http://react-guide.github.io/react-router-cn/docs/guides/basics/docs/Glossary.md#params" target="_blank" rel="external">参数</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;Route path=&quot;/hello/:name&quot;&gt;         // 匹配 /hello/michael 和 /hello/ryan</div><div class="line">&lt;Route path=&quot;/hello(/:name)&quot;&gt;       // 匹配 /hello, /hello/michael 和 /hello/ryan</div><div class="line">&lt;Route path=&quot;/files/*.*&quot;&gt;           // 匹配 /files/hello.jpg 和 /files/path/to/hello.jpg</div></pre></td></tr></table></figure>
<p>如果一个路由使用了相对<code>路径</code>，那么完整的路径将由它的所有祖先节点的<code>路径</code>和自身指定的相对<code>路径</code>拼接而成。<a href="http://react-guide.github.io/react-router-cn/docs/guides/basics/RouteConfiguration.html#decoupling-the-ui-from-the-url" target="_blank" rel="external">使用绝对<code>路径</code></a>可以使路由匹配行为忽略嵌套关系。</p>
</li>
</ul>
<h3 id="4-路由中的参数传递"><a href="#4-路由中的参数传递" class="headerlink" title="4 路由中的参数传递"></a>4 路由中的参数传递</h3><p>render/app.js中</p>
<p>注意此时的 : 冒号后面的变量就可 以通过 this.props.params</p>
<p>1 通过如下这种方式定义变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;Route path=&quot;/type/:typeName&quot; component=&#123;Type&#125; /&gt;</div></pre></td></tr></table></figure>
<p>上面这行route配置 , : typeName是一个变量 , 对于不同的变量值 , 在Type中该变量值可以通过</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">this.props.params</div></pre></td></tr></table></figure>
<p>来获取.</p>
<p>Type组件中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">const &#123; typeName &#125; = this.props.params</div><div class="line">&lt;h2&gt;&#123;typeName&#125;&lt;/h2&gt;</div><div class="line">&lt;Link to=&quot;/type/饼干&quot;&gt;</div><div class="line">    &lt;p className=&quot;icon icon1&quot;&gt;&lt;/p&gt;</div><div class="line">    &lt;p className=&quot;bui_ta_c bui_tc_gray&quot;&gt;饼干&lt;/p&gt;</div><div class="line">&lt;/Link&gt;</div></pre></td></tr></table></figure>
<p>当我们点击Link标签的时候,h2中既可以获取到此时</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/09/210React-Component/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/09/210React-Component/" itemprop="url">
                  React-Component
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-09T12:36:00+08:00">
                2017-05-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javascript/" itemprop="url" rel="index">
                    <span itemprop="name">javascript</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/08/209return小结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/08/209return小结/" itemprop="url">
                  return小结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-08T12:36:00+08:00">
                2017-05-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javascript/" itemprop="url" rel="index">
                    <span itemprop="name">javascript</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>1 函数执行的时候,如果遇到return,则终止当前函数的执行,直接返回return后面的结果</p>
<p>2 for(var k in  obj ) {   }  循环,只有在obj被定义的情况下,才会执行for后面的代码块</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">        <span class="keyword">var</span> obj = &#123;<span class="attr">name</span>:<span class="string">'Jhon'</span>,<span class="attr">age</span>:<span class="number">13</span>&#125;;</div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params">obj</span>)</span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'2'</span>);</div><div class="line">            </div><div class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> k <span class="keyword">in</span> obj )&#123;</div><div class="line">              <span class="comment">//如果obj为定义,则for语句后面的代码块不会执行</span></div><div class="line">                <span class="keyword">return</span> <span class="literal">false</span> ;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">//如果obj是一个对象,下面的代码不会执行,函数在执行的时候,遇到return就会直接退出当前函数执行,返回return的值</span></div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'11'</span>);</div><div class="line">            </div><div class="line">            <span class="keyword">return</span> <span class="literal">true</span> ;</div><div class="line"></div><div class="line">            cconsole.log(<span class="string">'1'</span>);</div><div class="line">            </div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">var</span> a = f1(obj);<span class="comment">//传入obj</span></div><div class="line">        <span class="keyword">var</span> b = f1();<span class="comment">//不传值,默认undefined</span></div><div class="line">        <span class="built_in">console</span>.log(a);<span class="comment">//false</span></div><div class="line">        <span class="built_in">console</span>.log(b);<span class="comment">//true</span></div><div class="line">        </div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">isEmptyObject</span>(<span class="params">obj</span>) </span>&#123;</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> k <span class="keyword">in</span> obj) &#123;</div><div class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">            &#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/05/208Redux-applyMiddleware源码/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/05/208Redux-applyMiddleware源码/" itemprop="url">
                  Redux applyMiddleware源码
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-05T12:36:00+08:00">
                2017-05-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/redux/" itemprop="url" rel="index">
                    <span itemprop="name">redux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>今天是周日,昨天玩了一天,嗯,该放松还是得放松嘛,今天来学习下.</p>
<h3 id="1-还是先贴上源码"><a href="#1-还是先贴上源码" class="headerlink" title="1 还是先贴上源码"></a>1 还是先贴上源码</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> compose <span class="keyword">from</span> <span class="string">'./compose'</span></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Creates a store enhancer that applies middleware to the dispatch method</div><div class="line"> * of the Redux store. This is handy for a variety of tasks, such as expressing</div><div class="line"> * asynchronous actions in a concise manner, or logging every action payload.</div><div class="line"> *</div><div class="line"> * See `redux-thunk` package as an example of the Redux middleware.</div><div class="line"> *</div><div class="line"> * Because middleware is potentially asynchronous, this should be the first</div><div class="line"> * store enhancer in the composition chain.</div><div class="line"> *</div><div class="line"> * Note that each middleware will be given the `dispatch` and `getState` functions</div><div class="line"> * as named arguments.</div><div class="line"> *</div><div class="line"> * @param &#123;...Function&#125; middlewares The middleware chain to be applied.</div><div class="line"> * @returns &#123;Function&#125; A store enhancer applying the middleware.</div><div class="line"> */</div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">applyMiddleware</span>(<span class="params">...middlewares</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">createStore</span>) =&gt;</span> (reducer, preloadedState, enhancer) =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> store = createStore(reducer, preloadedState, enhancer)</div><div class="line">    <span class="keyword">let</span> dispatch = store.dispatch</div><div class="line">    <span class="keyword">let</span> chain = []</div><div class="line"></div><div class="line">    <span class="keyword">const</span> middlewareAPI = &#123;</div><div class="line">      <span class="attr">getState</span>: store.getState,</div><div class="line">      <span class="attr">dispatch</span>: <span class="function">(<span class="params">action</span>) =&gt;</span> dispatch(action)</div><div class="line">    &#125;</div><div class="line">    chain = middlewares.map(<span class="function"><span class="params">middleware</span> =&gt;</span> middleware(middlewareAPI))</div><div class="line">    dispatch = compose(...chain)(store.dispatch)</div><div class="line"><span class="comment">/*</span></div><div class="line"> // 例如，chain 为 [M3, M2, M1]，而 compose 是从右到左进行“包裹”的</div><div class="line">      // 那么，M1 的 dispatch 参数为 store.dispatch（见【降低逼格写法】的【锚点-2】）</div><div class="line">      // 往后，M2 的 dispatch 参数为 M1 的中间件处理逻辑哥（见【降低逼格写法】的【锚点-3】）</div><div class="line">      // 同样，M3 的 dispatch 参数为 M2 的中间件处理逻辑哥</div><div class="line">      // 最后，我们得到串联后的中间件链：M3(M2(M1(store.dispatch)))</div><div class="line">      */</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">      ...store,</div><div class="line">      dispatch</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>由于目前对这个源码理解还是不够透彻,索性拿别人的作为记录得了,后期自己深入研究在自己写demo.</p>
<p>下面这个就是一个简单的中间件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">const</span> printStateMiddleware = <span class="function">(<span class="params">&#123; getState &#125;</span>) =&gt;</span> next =&gt; <span class="function"><span class="params">action</span> =&gt;</span> &#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'state before dispatch'</span>, getState())</div><div class="line">  </div><div class="line">  <span class="keyword">let</span> returnValue = next(action)</div><div class="line"></div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'state after dispatch'</span>, getState())</div><div class="line"></div><div class="line">  <span class="keyword">return</span> returnValue</div><div class="line">&#125;</div><div class="line"></div><div class="line">-------------------------------------------------</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">printStateMiddleware</span>(<span class="params">middlewareAPI</span>) </span>&#123; <span class="comment">// 记为【锚点-1】，中间件内可用的 API</span></div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">dispatch</span>) </span>&#123;                 <span class="comment">// 记为【锚点-2】，传入上级中间件处理逻辑（若无则为原 store.dispatch）</span></div><div class="line"></div><div class="line">    <span class="comment">// 下面记为【锚点-3】，整个函数将会被传到下级中间件（如果有的话）作为它的 dispatch 参数</span></div><div class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">action</span>) </span>&#123; <span class="comment">// &lt;---------------------------------------------- 这货就叫做【中间件处理逻辑哥】吧</span></div><div class="line">      <span class="built_in">console</span>.log(<span class="string">'state before dispatch'</span>, middlewareAPI.getState())</div><div class="line">  </div><div class="line">      <span class="keyword">var</span> returnValue = dispatch(action) <span class="comment">// 还记得吗，dispatch 的返回值其实还是 action</span></div><div class="line">  </div><div class="line">      <span class="built_in">console</span>.log(<span class="string">'state after dispatch'</span>, middlewareAPI.getState())</div><div class="line"></div><div class="line">      <span class="keyword">return</span> returnValue <span class="comment">// 继续传给下一个中间件作为参数 action</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果觉得代码有点晦涩难懂,可以进行下babel转化为ES5 如下:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">Object</span>.defineProperty(exports, <span class="string">"__esModule"</span>, &#123;</div><div class="line">  <span class="attr">value</span>: <span class="literal">true</span></div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="keyword">var</span> _extends = <span class="built_in">Object</span>.assign || <span class="function"><span class="keyword">function</span> (<span class="params">target</span>) </span>&#123; <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>; i &lt; <span class="built_in">arguments</span>.length; i++) &#123; <span class="keyword">var</span> source = <span class="built_in">arguments</span>[i]; <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> source) &#123; <span class="keyword">if</span> (<span class="built_in">Object</span>.prototype.hasOwnProperty.call(source, key)) &#123; target[key] = source[key]; &#125; &#125; &#125; <span class="keyword">return</span> target; &#125;;</div><div class="line"></div><div class="line">exports.default = applyMiddleware;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">_toConsumableArray</span>(<span class="params">arr</span>) </span>&#123; <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(arr)) &#123; <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, arr2 = <span class="built_in">Array</span>(arr.length); i &lt; arr.length; i++) &#123; arr2[i] = arr[i]; &#125; <span class="keyword">return</span> arr2; &#125; <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="built_in">Array</span>.from(arr); &#125; &#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">applyMiddleware</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> _len = <span class="built_in">arguments</span>.length, middlewares = <span class="built_in">Array</span>(_len), _key = <span class="number">0</span>; _key &lt; _len; _key++) &#123;</div><div class="line">    middlewares[_key] = <span class="built_in">arguments</span>[_key];</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">createStore</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">reducer, preloadedState, enhancer</span>) </span>&#123;</div><div class="line">      <span class="keyword">var</span> store = createStore(reducer, preloadedState, enhancer);</div><div class="line">      <span class="keyword">var</span> _dispatch = store.dispatch;</div><div class="line">      <span class="keyword">var</span> chain = [];</div><div class="line"></div><div class="line">      <span class="keyword">var</span> middlewareAPI = &#123;</div><div class="line">        <span class="attr">getState</span>: store.getState,</div><div class="line">        <span class="attr">dispatch</span>: <span class="function"><span class="keyword">function</span> <span class="title">dispatch</span>(<span class="params">action</span>) </span>&#123;</div><div class="line">          <span class="keyword">return</span> _dispatch(action);</div><div class="line">        &#125;</div><div class="line">      &#125;;</div><div class="line">      chain = middlewares.map(<span class="function"><span class="keyword">function</span> (<span class="params">middleware</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> middleware(middlewareAPI);</div><div class="line">      &#125;);</div><div class="line">      _dispatch = compose.apply(<span class="literal">undefined</span>, _toConsumableArray(chain))(store.dispatch);</div><div class="line"></div><div class="line">      <span class="keyword">return</span> _extends(&#123;&#125;, store, &#123;</div><div class="line">        <span class="attr">dispatch</span>: _dispatch</div><div class="line">      &#125;);</div><div class="line">    &#125;;</div><div class="line">  &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>先从整体上把控下Redux所谓的API都有什么 : </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">Redux 有五个 API，分别是：</div><div class="line"></div><div class="line">      createStore(reducer, [initialState])</div><div class="line">      combineReducers(reducers)</div><div class="line">      applyMiddleware(...middlewares)</div><div class="line">      bindActionCreators(actionCreators, dispatch)</div><div class="line">      compose(...functions)</div><div class="line"></div><div class="line">createStore 生成的 store 有四个 API，分别是：</div><div class="line"></div><div class="line">    getState()</div><div class="line">    dispatch(action)</div><div class="line">    subscribe(listener)</div><div class="line">    replaceReducer(nextReducer)</div></pre></td></tr></table></figure>
<h3 id="2-通过源码分析下applyMiddleware这个函数做了什么工作"><a href="#2-通过源码分析下applyMiddleware这个函数做了什么工作" class="headerlink" title="2 通过源码分析下applyMiddleware这个函数做了什么工作:"></a>2 通过源码分析下applyMiddleware这个函数做了什么工作:</h3><p>2.1 返回一个新的store创建器</p>
<p>首先返回一个函数,该函数接受Redux.createStore这个API作为参数,也就是说</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">applyMiddleware(...middleWares) = <span class="function"><span class="keyword">function</span> (<span class="params">createStore</span>)</span>&#123; &#125;</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> enhancedCreateStore = Redux.applyMiddleware(...Middlewares)(Redux.createStore);</div></pre></td></tr></table></figure>
<p>上面这行代码返回的结果也是一个函数,而这个函数被赋值给enhancedCreateStore</p>
<p>正常的创建store的函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> store = Redux.createStore(reducer, preloadedState, enhancer);</div></pre></td></tr></table></figure>
<p>增强createStore之后的创建store函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> store = enhancedCreateStore(reducer, preloadedState, enhancer);</div></pre></td></tr></table></figure>
<p>2.2 新的store创建器返回的结果增加了原来的dispatch函数功能,从源码中可以看出返回的值和最基础的createStore一样返回的是一个下面的对象:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">return</span> &#123;</div><div class="line">  dispatch,</div><div class="line">  subscribe,</div><div class="line">  getState,</div><div class="line">  replaceReducer,</div><div class="line">  [$$observable]: observable</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>只不过dispatch函数增加了一些功能而已.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">return</span> &#123;</div><div class="line">  ...store,</div><div class="line">  dispatch</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>以上分析就是applyMiddleware函数所做的一些工作.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">原 createStore ————</div><div class="line">                  │</div><div class="line">                  ↓</div><div class="line">return enhancer1(createStore)(reducer, preloadedState, enhancer2)</div><div class="line">   |</div><div class="line">   ├———————→ createStore 增强版 1</div><div class="line">                    │</div><div class="line">                    ↓</div><div class="line">return enhancer2(createStore1)(reducer, preloadedState, enhancer3)</div><div class="line">   |</div><div class="line">   ├———————————→ createStore 增强版 1+2</div><div class="line">                        │</div><div class="line">                        ↓</div><div class="line">return enhancer3(createStore1+2)(reducer, preloadedState, applyMiddleware(m1,m2,m3))</div><div class="line">   |</div><div class="line">   ├————————————————————→ createStore 增强版 1+2+3</div><div class="line">                                     │</div><div class="line">                                     ↓</div><div class="line">return appleMiddleware(m1,m2,m3)(createStore1+2+3)(reducer, preloadedState)</div><div class="line">   |</div><div class="line">   ├——————————————————————————————————→ 生成最终增强版 store</div></pre></td></tr></table></figure>
<h3 id="3-走一个小的功能看下具体的效果"><a href="#3-走一个小的功能看下具体的效果" class="headerlink" title="3 走一个小的功能看下具体的效果"></a>3 走一个小的功能看下具体的效果</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./redux.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line"><span class="comment">/** Action Creators */</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">inc</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123; <span class="attr">type</span>: <span class="string">'INCREMENT'</span> &#125;;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">dec</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123; <span class="attr">type</span>: <span class="string">'DECREMENT'</span> &#125;;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params">state, action</span>) </span>&#123;</div><div class="line">  state = state || &#123; <span class="attr">counter</span>: <span class="number">0</span> &#125;;</div><div class="line"></div><div class="line">  <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">    <span class="keyword">case</span> <span class="string">'INCREMENT'</span>:</div><div class="line">      <span class="keyword">return</span> &#123; <span class="attr">counter</span>: state.counter + <span class="number">1</span> &#125;;</div><div class="line">    <span class="keyword">case</span> <span class="string">'DECREMENT'</span>:</div><div class="line">      <span class="keyword">return</span> &#123; <span class="attr">counter</span>: state.counter - <span class="number">1</span> &#125;;</div><div class="line">    <span class="keyword">default</span>:</div><div class="line">      <span class="keyword">return</span> state;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">printStateMiddleware</span>(<span class="params">middlewareAPI</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">dispatch</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">action</span>) </span>&#123;</div><div class="line">      <span class="built_in">console</span>.log(<span class="string">'dispatch 前：'</span>, middlewareAPI.getState());</div><div class="line">      <span class="keyword">var</span> returnValue = dispatch(action);</div><div class="line">      <span class="built_in">console</span>.log(<span class="string">'dispatch 后：'</span>, middlewareAPI.getState(), <span class="string">'\n'</span>);</div><div class="line">      <span class="keyword">return</span> returnValue;</div><div class="line">    &#125;;</div><div class="line">  &#125;;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> enhancedCreateStore = Redux.applyMiddleware(printStateMiddleware)(Redux.createStore);</div><div class="line"><span class="keyword">var</span> store = enhancedCreateStore(reducer);</div><div class="line"></div><div class="line">store.dispatch(inc());</div><div class="line">store.dispatch(inc());</div><div class="line">store.dispatch(dec());</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div><div class="line">控制台输出：</div><div class="line"></div><div class="line">dispatch 前：&#123; counter: 0 &#125;</div><div class="line">dispatch 后：&#123; counter: 1 &#125;</div><div class="line"></div><div class="line">dispatch 前：&#123; counter: 1 &#125;</div><div class="line">dispatch 后：&#123; counter: 2 &#125;</div><div class="line"></div><div class="line">dispatch 前：&#123; counter: 2 &#125;</div><div class="line">dispatch 后：&#123; counter: 1 &#125;</div></pre></td></tr></table></figure>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a><a href="https://github.com/kenberkeley/redux-simple-tutorial/blob/master/redux-advanced-tutorial.md" target="_blank" rel="external">参考</a></h3><p>非常感谢作者能从源码的角度剖析文章.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/05/205Redux-createStore源码/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/05/205Redux-createStore源码/" itemprop="url">
                  Redux createStore源码
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-05T12:36:00+08:00">
                2017-05-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/redux/" itemprop="url" rel="index">
                    <span itemprop="name">redux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>###1 先贴上createStore源码</p>
<p>看了源码我对redux的认识才开始清晰,现在终于明白,不看源码学框架就是没事儿找刺激啊,不知道底层如何实现,学起来就是举步维艰;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> isPlainObject <span class="keyword">from</span> <span class="string">'lodash/isPlainObject'</span></div><div class="line"><span class="keyword">import</span> $$observable <span class="keyword">from</span> <span class="string">'symbol-observable'</span></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * These are private action types reserved by Redux.</div><div class="line"> * For any unknown actions, you must return the current state.</div><div class="line"> * If the current state is undefined, you must return the initial state.</div><div class="line"> * Do not reference these action types directly in your code.</div><div class="line"> */</div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> ActionTypes = &#123;</div><div class="line">  <span class="attr">INIT</span>: <span class="string">'@@redux/INIT'</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Creates a Redux store that holds the state tree.</div><div class="line"> * The only way to change the data in the store is to call `dispatch()` on it.</div><div class="line"> *</div><div class="line"> * There should only be a single store in your app. To specify how different</div><div class="line"> * parts of the state tree respond to actions, you may combine several reducers</div><div class="line"> * into a single reducer function by using `combineReducers`.</div><div class="line"> *</div><div class="line"> * @param &#123;Function&#125; reducer A function that returns the next state tree, given</div><div class="line"> * the current state tree and the action to handle.</div><div class="line"> *</div><div class="line"> * @param &#123;any&#125; [preloadedState] The initial state. You may optionally specify it</div><div class="line"> * to hydrate the state from the server in universal apps, or to restore a</div><div class="line"> * previously serialized user session.</div><div class="line"> * If you use `combineReducers` to produce the root reducer function, this must be</div><div class="line"> * an object with the same shape as `combineReducers` keys.</div><div class="line"> *</div><div class="line"> * @param &#123;Function&#125; [enhancer] The store enhancer. You may optionally specify it</div><div class="line"> * to enhance the store with third-party capabilities such as middleware,</div><div class="line"> * time travel, persistence, etc. The only store enhancer that ships with Redux</div><div class="line"> * is `applyMiddleware()`.</div><div class="line"> *</div><div class="line"> * @returns &#123;Store&#125; A Redux store that lets you read the state, dispatch actions</div><div class="line"> * and subscribe to changes.</div><div class="line"> */</div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">createStore</span>(<span class="params">reducer, preloadedState, enhancer</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> preloadedState === <span class="string">'function'</span> &amp;&amp; <span class="keyword">typeof</span> enhancer === <span class="string">'undefined'</span>) &#123;</div><div class="line">    enhancer = preloadedState</div><div class="line">    preloadedState = <span class="literal">undefined</span></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> enhancer !== <span class="string">'undefined'</span>) &#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> enhancer !== <span class="string">'function'</span>) &#123;</div><div class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Expected the enhancer to be a function.'</span>)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> enhancer(createStore)(reducer, preloadedState)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> reducer !== <span class="string">'function'</span>) &#123;</div><div class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Expected the reducer to be a function.'</span>)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">let</span> currentReducer = reducer</div><div class="line">  <span class="keyword">let</span> currentState = preloadedState</div><div class="line">  <span class="keyword">let</span> currentListeners = []</div><div class="line">  <span class="keyword">let</span> nextListeners = currentListeners</div><div class="line">  <span class="keyword">let</span> isDispatching = <span class="literal">false</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">ensureCanMutateNextListeners</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (nextListeners === currentListeners) &#123;</div><div class="line">      nextListeners = currentListeners.slice()</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">/**</span></div><div class="line">   * Reads the state tree managed by the store.</div><div class="line">   *</div><div class="line">   * @returns &#123;any&#125; The current state tree of your application.</div><div class="line">   */</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getState</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> currentState</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">/**</span></div><div class="line">   * Adds a change listener. It will be called any time an action is dispatched,</div><div class="line">   * and some part of the state tree may potentially have changed. You may then</div><div class="line">   * call `getState()` to read the current state tree inside the callback.</div><div class="line">   *</div><div class="line">   * You may call `dispatch()` from a change listener, with the following</div><div class="line">   * caveats:</div><div class="line">   *</div><div class="line">   * 1. The subscriptions are snapshotted just before every `dispatch()` call.</div><div class="line">   * If you subscribe or unsubscribe while the listeners are being invoked, this</div><div class="line">   * will not have any effect on the `dispatch()` that is currently in progress.</div><div class="line">   * However, the next `dispatch()` call, whether nested or not, will use a more</div><div class="line">   * recent snapshot of the subscription list.</div><div class="line">   *</div><div class="line">   * 2. The listener should not expect to see all state changes, as the state</div><div class="line">   * might have been updated multiple times during a nested `dispatch()` before</div><div class="line">   * the listener is called. It is, however, guaranteed that all subscribers</div><div class="line">   * registered before the `dispatch()` started will be called with the latest</div><div class="line">   * state by the time it exits.</div><div class="line">   *</div><div class="line">   * @param &#123;Function&#125; listener A callback to be invoked on every dispatch.</div><div class="line">   * @returns &#123;Function&#125; A function to remove this change listener.</div><div class="line">   */</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">subscribe</span>(<span class="params">listener</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> listener !== <span class="string">'function'</span>) &#123;</div><div class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Expected listener to be a function.'</span>)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">let</span> isSubscribed = <span class="literal">true</span></div><div class="line"></div><div class="line">    ensureCanMutateNextListeners()</div><div class="line">    nextListeners.push(listener)</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">unsubscribe</span>(<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="keyword">if</span> (!isSubscribed) &#123;</div><div class="line">        <span class="keyword">return</span></div><div class="line">      &#125;</div><div class="line"></div><div class="line">      isSubscribed = <span class="literal">false</span></div><div class="line"></div><div class="line">      ensureCanMutateNextListeners()</div><div class="line">      <span class="keyword">const</span> index = nextListeners.indexOf(listener)</div><div class="line">      nextListeners.splice(index, <span class="number">1</span>)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">/**</span></div><div class="line">   * Dispatches an action. It is the only way to trigger a state change.</div><div class="line">   *</div><div class="line">   * The `reducer` function, used to create the store, will be called with the</div><div class="line">   * current state tree and the given `action`. Its return value will</div><div class="line">   * be considered the **next** state of the tree, and the change listeners</div><div class="line">   * will be notified.</div><div class="line">   *</div><div class="line">   * The base implementation only supports plain object actions. If you want to</div><div class="line">   * dispatch a Promise, an Observable, a thunk, or something else, you need to</div><div class="line">   * wrap your store creating function into the corresponding middleware. For</div><div class="line">   * example, see the documentation for the `redux-thunk` package. Even the</div><div class="line">   * middleware will eventually dispatch plain object actions using this method.</div><div class="line">   *</div><div class="line">   * @param &#123;Object&#125; action A plain object representing “what changed”. It is</div><div class="line">   * a good idea to keep actions serializable so you can record and replay user</div><div class="line">   * sessions, or use the time travelling `redux-devtools`. An action must have</div><div class="line">   * a `type` property which may not be `undefined`. It is a good idea to use</div><div class="line">   * string constants for action types.</div><div class="line">   *</div><div class="line">   * @returns &#123;Object&#125; For convenience, the same action object you dispatched.</div><div class="line">   *</div><div class="line">   * Note that, if you use a custom middleware, it may wrap `dispatch()` to</div><div class="line">   * return something else (for example, a Promise you can await).</div><div class="line">   */</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">dispatch</span>(<span class="params">action</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (!isPlainObject(action)) &#123;</div><div class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</div><div class="line">        <span class="string">'Actions must be plain objects. '</span> +</div><div class="line">        <span class="string">'Use custom middleware for async actions.'</span></div><div class="line">      )</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> action.type === <span class="string">'undefined'</span>) &#123;</div><div class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</div><div class="line">        <span class="string">'Actions may not have an undefined "type" property. '</span> +</div><div class="line">        <span class="string">'Have you misspelled a constant?'</span></div><div class="line">      )</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (isDispatching) &#123;</div><div class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Reducers may not dispatch actions.'</span>)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">      <span class="comment">//最初始的值是false</span></div><div class="line">      isDispatching = <span class="literal">true</span></div><div class="line">      currentState = currentReducer(currentState, action)</div><div class="line">    &#125; <span class="keyword">finally</span> &#123;</div><div class="line">      <span class="comment">//执行完try之后,还是将该值重置为false</span></div><div class="line">      isDispatching = <span class="literal">false</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">const</span> listeners = currentListeners = nextListeners</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; listeners.length; i++) &#123;</div><div class="line">      <span class="keyword">const</span> listener = listeners[i]</div><div class="line">      listener()</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> action</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">/**</span></div><div class="line">   * Replaces the reducer currently used by the store to calculate the state.</div><div class="line">   *</div><div class="line">   * You might need this if your app implements code splitting and you want to</div><div class="line">   * load some of the reducers dynamically. You might also need this if you</div><div class="line">   * implement a hot reloading mechanism for Redux.</div><div class="line">   *</div><div class="line">   * @param &#123;Function&#125; nextReducer The reducer for the store to use instead.</div><div class="line">   * @returns &#123;void&#125;</div><div class="line">   */</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">replaceReducer</span>(<span class="params">nextReducer</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> nextReducer !== <span class="string">'function'</span>) &#123;</div><div class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Expected the nextReducer to be a function.'</span>)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    currentReducer = nextReducer</div><div class="line">    dispatch(&#123; <span class="attr">type</span>: ActionTypes.INIT &#125;)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">/**</span></div><div class="line">   * Interoperability point for observable/reactive libraries.</div><div class="line">   * @returns &#123;observable&#125; A minimal observable of state changes.</div><div class="line">   * For more information, see the observable proposal:</div><div class="line">   * https://github.com/tc39/proposal-observable</div><div class="line">   */</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">observable</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">const</span> outerSubscribe = subscribe</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">      <span class="comment">/**</span></div><div class="line">       * The minimal observable subscription method.</div><div class="line">       * @param &#123;Object&#125; observer Any object that can be used as an observer.</div><div class="line">       * The observer object should have a `next` method.</div><div class="line">       * @returns &#123;subscription&#125; An object with an `unsubscribe` method that can</div><div class="line">       * be used to unsubscribe the observable from the store, and prevent further</div><div class="line">       * emission of values from the observable.</div><div class="line">       */</div><div class="line">      subscribe(observer) &#123;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> observer !== <span class="string">'object'</span>) &#123;</div><div class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'Expected the observer to be an object.'</span>)</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">observeState</span>(<span class="params"></span>) </span>&#123;</div><div class="line">          <span class="keyword">if</span> (observer.next) &#123;</div><div class="line">            observer.next(getState())</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        observeState()</div><div class="line">        <span class="keyword">const</span> unsubscribe = outerSubscribe(observeState)</div><div class="line">        <span class="keyword">return</span> &#123; unsubscribe &#125;</div><div class="line">      &#125;,</div><div class="line"></div><div class="line">      [$$observable]() &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span></div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// When a store is created, an "INIT" action is dispatched so that every</span></div><div class="line">  <span class="comment">// reducer returns their initial state. This effectively populates</span></div><div class="line">  <span class="comment">// the initial state tree.</span></div><div class="line">  dispatch(&#123; <span class="attr">type</span>: ActionTypes.INIT &#125;)</div><div class="line"></div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    dispatch,</div><div class="line">    subscribe,</div><div class="line">    getState,</div><div class="line">    replaceReducer,</div><div class="line">    [$$observable]: observable</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>var store = createStore(reducer , preLoadState , enhancer) 定义一个store的时候可以传递reducer函数,state初始状态<ul>
<li>注意createStore之后,会先默认执行dispatch函数一次,看源码注意下这一点.通过这次默认执行dispatch函数,reducer函数就会执行,可以初始化state状态</li>
<li>dispatch函数执行的时候,由于刚创建store并没有通过subscribe绑定listeners,所以listeners在createStore的时候不会执行.</li>
</ul>
</li>
<li>getState( )函数用来获取state下一个状态</li>
<li>dispatch(action)函数,<ul>
<li>用来根据不同的action,调用reducer函数改变state状态</li>
<li>依次执行所有通过subscribe订阅到listeners数组中的函数;</li>
<li>返回一个传入的action对象</li>
</ul>
</li>
<li>subscribe( listener ) 用来向listeners数组中添加监听器</li>
<li>replaceReducer( nextReducer ) 替换 reducer 为 nextReducer</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">dispatch不同的action,然后触发reducer函数</div><div class="line">定义reducer函数的时候,reducer函数接受两个参数,一个是state,一个是action,</div><div class="line">因为reducer函数在执行的时候,是在dispatch函数内部执行,所以reducer函数的action来自于dispatch的参数action,reducer函数的state可以来自于自己,也可以来自于定义store的时候</div></pre></td></tr></table></figure>
<h3 id="2-我们来结合一个小栗子看下createStore在状态管理过程中所扮演的角色"><a href="#2-我们来结合一个小栗子看下createStore在状态管理过程中所扮演的角色" class="headerlink" title="2 我们来结合一个小栗子看下createStore在状态管理过程中所扮演的角色"></a>2 我们来结合一个小栗子看下createStore在状态管理过程中所扮演的角色</h3><p>2.1 还是老惯例,看下引入redux之后,文件中对象有什么</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">'./redux.min.js'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">        <span class="built_in">console</span>.log(Redux);</div><div class="line">        <span class="built_in">console</span>.log(Redux.createStore);</div><div class="line">        </div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">Object &#123;__esModule: true,</div><div class="line">createStore: function, </div><div class="line">combineReducers: function, </div><div class="line">bindActionCreators: function, </div><div class="line">applyMiddleware: function…&#125;</div><div class="line">applyMiddleware:function o()</div><div class="line">bindActionCreators:function u(t,e)</div><div class="line">combineReducers:function i(t)</div><div class="line">compose:function n()</div><div class="line">createStore:function o(t,e)</div><div class="line">__esModule:true</div></pre></td></tr></table></figure>
<p>2.2 reducer函数的定义为什么总是第一个参数是state,第二个参数是action?</p>
<p>我们定义的reducer函数要返回一个reducer处理之后的state,赋值给currentState,然后通过getState就可以获取当前状态;</p>
<p>源码中有如下两行代码,可以看出</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> currentReducer = reducer; </div><div class="line">currentState = currentReducer(currentState, action);</div></pre></td></tr></table></figure>
<ul>
<li>当我们创建一个store的时候,createStore接受两个参数,一个是reducer函数,一个是initialState初始状态,</li>
<li>然后 var currentReducer = reducer ;  var currentState = initialState;</li>
<li>当我们调用dispatch的时候,dispatch执行的过程中,会调用reducer函数,reducer函数就是我们处理state的方法</li>
<li>dispatch函数中在调用reducer的时候,会向其中传递两个参数,一个是initialState对象,一个是action对象;dispatch函数执行后返回的是传入的action</li>
<li>注意定义reducer的时候,必须要返回一个state状态,防治state状态的丢失.</li>
</ul>
<p>2.3 初始化state的两种方式,</p>
<ul>
<li>通过createStore(reducer , initialState)</li>
<li>通过reducer(state = initialState , action )</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">'./redux.min.js'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">   </div><div class="line">        <span class="comment">//action 创建器</span></div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">createActionOne</span> (<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="keyword">return</span> &#123;</div><div class="line">                <span class="attr">type</span> : <span class="string">'INCREAMENT'</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">createActionTwo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="keyword">return</span> &#123;</div><div class="line">                <span class="attr">type</span> : <span class="string">'DECREASE'</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//reducer处理函数</span></div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">reducer</span> (<span class="params">state = &#123;count : <span class="number">0</span> &#125;,action</span>)</span>&#123;</div><div class="line">            <span class="comment">// state = state || &#123;count : 0 &#125;</span></div><div class="line">            <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">                <span class="keyword">case</span> <span class="string">"INCREAMENT"</span> :</div><div class="line">                    <span class="keyword">return</span> &#123;<span class="attr">conut</span> : state.count+<span class="number">1</span>&#125;;</div><div class="line">                <span class="keyword">case</span> <span class="string">"DECREASE"</span> :</div><div class="line">                    <span class="keyword">return</span> &#123;<span class="attr">count</span> : state.count<span class="number">-1</span>&#125;;</div><div class="line">                <span class="keyword">default</span> :</div><div class="line">                    <span class="keyword">return</span> state ;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">//store状态管理器的创建</span></div><div class="line">        </div><div class="line">        <span class="keyword">var</span> store = Redux.createStore(reducer);</div><div class="line">        <span class="built_in">console</span>.log( store.getState() );</div><div class="line">        store.dispatch(createActionOne());</div><div class="line">        <span class="built_in">console</span>.log( store.getState() );</div><div class="line"></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">'./redux.min.js'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">     </div><div class="line">        <span class="comment">//action 创建器</span></div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">createActionOne</span> (<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="keyword">return</span> &#123;</div><div class="line">                <span class="attr">type</span> : <span class="string">'INCREAMENT'</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">createActionTwo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="keyword">return</span> &#123;</div><div class="line">                <span class="attr">type</span> : <span class="string">'DECREASE'</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//reducer处理函数</span></div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">reducer</span> (<span class="params">state ,action</span>)</span>&#123;</div><div class="line">            <span class="comment">// state = state || &#123;count : 0 &#125;</span></div><div class="line">            <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">                <span class="keyword">case</span> <span class="string">"INCREAMENT"</span> :</div><div class="line">                    <span class="keyword">return</span> &#123;<span class="attr">conut</span> : state.count+<span class="number">1</span>&#125;;</div><div class="line">                <span class="keyword">case</span> <span class="string">"DECREASE"</span> :</div><div class="line">                    <span class="keyword">return</span> &#123;<span class="attr">count</span> : state.count<span class="number">-1</span>&#125;;</div><div class="line">                <span class="keyword">default</span> :</div><div class="line">                    <span class="keyword">return</span> state ;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">//store状态管理器的创建</span></div><div class="line">        <span class="keyword">var</span> initialState = &#123;<span class="attr">count</span> : <span class="number">10</span> &#125;</div><div class="line">        <span class="keyword">var</span> store = Redux.createStore(reducer,initialState);</div><div class="line">        <span class="built_in">console</span>.log( store.getState() );</div><div class="line">        store.dispatch(createActionOne());</div><div class="line">        <span class="built_in">console</span>.log( store.getState() );</div><div class="line">        </div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="3-ES6语法新特性-bable在线编译工具"><a href="#3-ES6语法新特性-bable在线编译工具" class="headerlink" title="3 ES6语法新特性                   bable在线编译工具"></a>3 ES6语法新特性                   <a href="http://babeljs.io/learn-es2015/" target="_blank" rel="external">bable在线编译工具</a></h3><p>ES6</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">reducer</span> (<span class="params">state = &#123;count : <span class="number">0</span> &#125;,action</span>)</span>&#123;</div><div class="line">            <span class="comment">// state = state || &#123;count : 0 &#125;</span></div><div class="line">            <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">                <span class="keyword">case</span> <span class="string">"INCREAMENT"</span> :</div><div class="line">                    <span class="keyword">return</span> &#123;<span class="attr">conut</span> : state.count+<span class="number">1</span>&#125;;</div><div class="line">                <span class="keyword">case</span> <span class="string">"DECREASE"</span> :</div><div class="line">                    <span class="keyword">return</span> &#123;<span class="attr">count</span> : state.count<span class="number">-1</span>&#125;;</div><div class="line">                <span class="keyword">default</span> :</div><div class="line">                    <span class="keyword">return</span> state ;</div><div class="line">            &#125;</div><div class="line">        &#125;</div></pre></td></tr></table></figure>
<p>经过转化为ES5</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">"use strict"</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> state = <span class="built_in">arguments</span>.length &gt; <span class="number">0</span> &amp;&amp; <span class="built_in">arguments</span>[<span class="number">0</span>] !== <span class="literal">undefined</span> ? <span class="built_in">arguments</span>[<span class="number">0</span>] : &#123; <span class="attr">count</span>: <span class="number">0</span> &#125;;</div><div class="line">    <span class="keyword">var</span> action = <span class="built_in">arguments</span>[<span class="number">1</span>];</div><div class="line"></div><div class="line">    <span class="comment">// state = state || &#123;count : 0 &#125;</span></div><div class="line">    <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">        <span class="keyword">case</span> <span class="string">"INCREAMENT"</span>:</div><div class="line">            <span class="keyword">return</span> &#123; <span class="attr">conut</span>: state.count + <span class="number">1</span> &#125;;</div><div class="line">        <span class="keyword">case</span> <span class="string">"DECREASE"</span>:</div><div class="line">            <span class="keyword">return</span> &#123; <span class="attr">count</span>: state.count - <span class="number">1</span> &#125;;</div><div class="line">        <span class="keyword">default</span>:</div><div class="line">            <span class="keyword">return</span> state;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="4-参考"><a href="#4-参考" class="headerlink" title="4 参考"></a>4 参考</h3><p><a href="https://github.com/kenberkeley/redux-simple-tutorial/blob/master/redux-advanced-tutorial.md" target="_blank" rel="external">源码解读</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/05/204ES6-import/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/05/204ES6-import/" itemprop="url">
                  ES6 import
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-05T12:36:00+08:00">
                2017-05-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ES6/" itemprop="url" rel="index">
                    <span itemprop="name">ES6</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-了解ES6-模块加载和Common-js模块加载的区别"><a href="#1-了解ES6-模块加载和Common-js模块加载的区别" class="headerlink" title="1 了解ES6 模块加载和Common.js模块加载的区别"></a>1 了解ES6 模块加载和Common.js模块加载的区别</h3><p>1.1 Common.js语法中的模块加载加载得是引用的模块暴露出来的module.exports 整体</p>
<p>1.2 ES6的模块加载可以’静态加载,也就是说加载部分接口,而不是加载整个对象’</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// CommonJS模块</span></div><div class="line"><span class="keyword">let</span> &#123; stat, exists, readFile &#125; = <span class="built_in">require</span>(<span class="string">'fs'</span>);</div><div class="line"></div><div class="line"><span class="comment">// 等同于</span></div><div class="line"><span class="keyword">let</span> _fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</div><div class="line"><span class="keyword">let</span> stat = _fs.stat;</div><div class="line"><span class="keyword">let</span> exists = _fs.exists;</div><div class="line"><span class="keyword">let</span> readfile = _fs.readfile;</div></pre></td></tr></table></figure>
<p>上面代码的实质是整体加载<code>fs</code>模块（即加载<code>fs</code>的所有方法），生成一个对象（<code>_fs</code>），然后再从这个对象上面读取3个方法。这种加载称为“运行时加载”，因为只有运行时才能得到这个对象，导致完全没办法在编译时做“静态优化”。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ES6模块</span></div><div class="line"><span class="keyword">import</span> &#123; stat, exists, readFile &#125; <span class="keyword">from</span> <span class="string">'fs'</span>;</div></pre></td></tr></table></figure>
<p>ES6 模块不是对象，而是通过<code>export</code>命令显式指定输出的代码，再通过<code>import</code>命令输入。</p>
<p>上面代码的实质是从<code>fs</code>模块加载3个方法，其他方法不加载。这种加载称为“编译时加载”或者静态加载，即 ES6 可以在编译时就完成模块加载，效率要比 CommonJS 模块的加载方式高。当然，这也导致了没法引用 ES6 模块本身，因为它不是对象。</p>
<p>注意: ES6 模块之中，顶层的<code>this</code>指向<code>undefined</code>，即不应该在顶层代码使用<code>this</code>。</p>
<h3 id="2-ES6模块的命令组成"><a href="#2-ES6模块的命令组成" class="headerlink" title="2 ES6模块的命令组成"></a>2 ES6模块的命令组成</h3><p>主要有export和import两个命令组成;export用于规定模块对外的接口;import用于输入其他模块提供的功能接口</p>
<p>2.1 export</p>
<p>profile.js文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//第一种写法</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">var</span> name = <span class="string">'JiM'</span>;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'this is a func'</span>);</div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//-----------------------------------------------</span></div><div class="line"><span class="comment">//第二种写法</span></div><div class="line"><span class="keyword">var</span> name1 = <span class="string">'Jhon'</span> ;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">f1</span> (<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'this is a func1'</span>);</div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> &#123; name1,f1 &#125; ;<span class="comment">//注意暴露出去的写法必须用&#123;&#125;包起来</span></div></pre></td></tr></table></figure>
<p>main.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;name ,name1 ,f,f1&#125; <span class="keyword">from</span> <span class="string">'./profile.js'</span>;</div></pre></td></tr></table></figure>
<p>最后，<code>export</code>命令可以出现在模块的任何位置，只要处于模块顶层就可以。如果处于块级作用域内，就会报错，下一节的<code>import</code>命令也是如此。这是因为处于条件代码块之中，就没法做静态优化了，违背了ES6模块的设计初衷。</p>
<p><strong>export default </strong> 用来指定模块默认输出的接口,此时<strong>import该模块的就不需要<code>{ }</code></strong> 括起来了,如下:</p>
<p><strong>但是一定要注意,如果不是export default接口,那么导入该接口的时候,必须通过import <code>{ }</code>的方式</strong>(这个小坑踩了好几次)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 第一组</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">crc32</span>(<span class="params"></span>) </span>&#123; <span class="comment">// 输出</span></div><div class="line">  <span class="comment">// ...</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">import</span> crc32 <span class="keyword">from</span> <span class="string">'crc32'</span>; <span class="comment">// 输入</span></div><div class="line"></div><div class="line"><span class="comment">// 第二组</span></div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">crc32</span>(<span class="params"></span>) </span>&#123; <span class="comment">// 输出</span></div><div class="line">  <span class="comment">// ...</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">import</span> &#123;crc32&#125; <span class="keyword">from</span> <span class="string">'crc32'</span>; <span class="comment">// 输入</span></div></pre></td></tr></table></figure>
<p><strong>export default </strong> 也可以默认导出任何数据类型</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;<span class="attr">userData</span> : <span class="literal">null</span> , <span class="attr">msg</span> : <span class="string">"login"</span>&#125;</div></pre></td></tr></table></figure>
<p><code>export default</code>命令用于指定模块的默认输出。显然，一个模块只能有一个默认输出，因此<code>export default</code>命令只能使用一次。所以，<code>import</code>命令后面才不用加大括号，因为只可能对应一个方法。</p>
<p>正是因为<code>export default</code>命令其实只是输出一个叫做<code>default</code>的变量，所以它后面不能跟变量声明语句。</p>
<p>2.2 import </p>
<p>import命令接受一堆大括号,用于引出模块中的接口,from后面接的是模块的路径,可以是相对路径,也可以是绝对路径,如果是模块标识,需要进行配置,告诉浏览器引擎如何加载该模块中的接口;</p>
<ul>
<li>import命令具有声明提升功能,会提升到整个模块的头部</li>
<li>import命令是静态执行的,不能使用变量和表达式</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">foo();</div><div class="line"></div><div class="line"><span class="keyword">import</span> &#123; foo &#125; <span class="keyword">from</span> <span class="string">'my_module'</span>;</div></pre></td></tr></table></figure>
<p>上面的代码不会报错，因为<code>import</code>的执行早于<code>foo</code>的调用。这种行为的本质是，<code>import</code>命令是编译阶段执行的，在代码运行之前。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 报错</span></div><div class="line"><span class="keyword">import</span> &#123; <span class="string">'f'</span> + <span class="string">'oo'</span> &#125; <span class="keyword">from</span> <span class="string">'my_module'</span>;</div><div class="line"></div><div class="line"><span class="comment">// 报错</span></div><div class="line"><span class="keyword">let</span> <span class="built_in">module</span> = <span class="string">'my_module'</span>;</div><div class="line"><span class="keyword">import</span> &#123; foo &#125; <span class="keyword">from</span> <span class="built_in">module</span>;</div><div class="line"></div><div class="line"><span class="comment">// 报错</span></div><div class="line"><span class="keyword">if</span> (x === <span class="number">1</span>) &#123;</div><div class="line">  <span class="keyword">import</span> &#123; foo &#125; <span class="keyword">from</span> <span class="string">'module1'</span>;</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">  <span class="keyword">import</span> &#123; foo &#125; <span class="keyword">from</span> <span class="string">'module2'</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>由于<code>import</code>是静态执行，所以不能使用表达式和变量，这些只有在运行时才能得到结果的语法结构。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/19/">19</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>


          
          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar.jpg"
               alt="JiM-W" />
          <p class="site-author-name" itemprop="name">JiM-W</p>
           
              <p class="site-description motion-element" itemprop="description">keep fighting！</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">190</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">52</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">86</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">JiM-W</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  



  
  

  

  

  

  


  

</body>
</html>
