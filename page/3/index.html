<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="keep fighting！">
<meta property="og:type" content="website">
<meta property="og:title" content="JiM-W">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="JiM-W">
<meta property="og:description" content="keep fighting！">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="JiM-W">
<meta name="twitter:description" content="keep fighting！">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/3/"/>





  <title> JiM-W </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">JiM-W</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">keep Moving</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/08/209return小结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/08/209return小结/" itemprop="url">
                  return小结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-08T12:36:00+08:00">
                2017-05-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/javascript/" itemprop="url" rel="index">
                    <span itemprop="name">javascript</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>1 函数执行的时候,如果遇到return,则终止当前函数的执行,直接返回return后面的结果</p>
<p>2 for(var k in  obj ) {   }  循环,只有在obj被定义的情况下,才会执行for后面的代码块</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">        <span class="keyword">var</span> obj = &#123;<span class="attr">name</span>:<span class="string">'Jhon'</span>,<span class="attr">age</span>:<span class="number">13</span>&#125;;</div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params">obj</span>)</span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'2'</span>);</div><div class="line">            </div><div class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> k <span class="keyword">in</span> obj )&#123;</div><div class="line">              <span class="comment">//如果obj为定义,则for语句后面的代码块不会执行</span></div><div class="line">                <span class="keyword">return</span> <span class="literal">false</span> ;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">//如果obj是一个对象,下面的代码不会执行,函数在执行的时候,遇到return就会直接退出当前函数执行,返回return的值</span></div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'11'</span>);</div><div class="line">            </div><div class="line">            <span class="keyword">return</span> <span class="literal">true</span> ;</div><div class="line"></div><div class="line">            cconsole.log(<span class="string">'1'</span>);</div><div class="line">            </div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">var</span> a = f1(obj);<span class="comment">//传入obj</span></div><div class="line">        <span class="keyword">var</span> b = f1();<span class="comment">//不传值,默认undefined</span></div><div class="line">        <span class="built_in">console</span>.log(a);<span class="comment">//false</span></div><div class="line">        <span class="built_in">console</span>.log(b);<span class="comment">//true</span></div><div class="line">        </div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">isEmptyObject</span>(<span class="params">obj</span>) </span>&#123;</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> k <span class="keyword">in</span> obj) &#123;</div><div class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">            &#125;</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/05/207Redux-combineReducers源码bindCreateAction/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/05/207Redux-combineReducers源码bindCreateAction/" itemprop="url">
                  Redux combineReducers和bindActionCreators源码
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-05T12:36:00+08:00">
                2017-05-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/redux/" itemprop="url" rel="index">
                    <span itemprop="name">redux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-combineReducers源码如下-核心"><a href="#1-combineReducers源码如下-核心" class="headerlink" title="1 combineReducers源码如下(核心)"></a>1 combineReducers源码如下(核心)</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">combineReducers</span>(<span class="params">reducers</span>) </span>&#123; <span class="comment">//传入combineReducers函数的是一个对象,包括不同的reducer的key -value键值对</span></div><div class="line">  <span class="keyword">var</span> reducerKeys = <span class="built_in">Object</span>.keys(reducers);<span class="comment">//reducerKeys是一个数组,是我们传入的reducers的keys组成的数组</span></div><div class="line">  <span class="keyword">var</span> finalReducers = &#123;&#125;<span class="comment">//创建一个空对象,用来存放我们传入的reducers的value的值组成的数组</span></div><div class="line">  </div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; reducerKeys.length; i++) &#123;</div><div class="line">    <span class="keyword">var</span> key = reducerKeys[i]</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> reducers[key] === <span class="string">'function'</span>) &#123;</div><div class="line">      finalReducers[key] = reducers[key]</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"><span class="comment">//以上循环用于过滤传入的reducers,确保最后每个reducer都是一个函数</span></div><div class="line">  <span class="keyword">var</span> finalReducerKeys = <span class="built_in">Object</span>.keys(finalReducers)<span class="comment">//我们传入的reducers数组确认是一个key -value(function)的对象</span></div><div class="line"></div><div class="line">  <span class="comment">// 返回合成后的 reducer  返回的这个函数就是combineReducers函数的返回值.</span></div><div class="line">  <span class="comment">//这个函数负责处理根据不同的action来进行state状态改变</span></div><div class="line">  <span class="comment">//每次dispatch不同的action的时候,这个函数会被执行,执行的时候,所有的reducer树上的reducer都会执行,如果action对上了,则会执行响应的操作</span></div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">combination</span>(<span class="params">state = &#123;&#125;, action</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> hasChanged = <span class="literal">false</span></div><div class="line">    <span class="keyword">var</span> nextState = &#123;&#125;</div><div class="line">    <span class="comment">//以下循环通过不同的reducer对应的不同的key,处理state状态树上的对应的key值所对应的的子state,然后返回一个新的nextState对应的key-value组成的对象;</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; finalReducerKeys.length; i++) &#123;</div><div class="line">      <span class="keyword">var</span> key = finalReducerKeys[i]</div><div class="line">      <span class="keyword">var</span> reducer = finalReducers[key]</div><div class="line">      <span class="keyword">var</span> previousStateForKey = state[key]                       <span class="comment">// 获取当前子 state</span></div><div class="line">      <span class="keyword">var</span> nextStateForKey = reducer(previousStateForKey, action) <span class="comment">// 执行各子 reducer 中获取子 nextState,每一个子reducer都会返回一个新的state</span></div><div class="line">      nextState[key] = nextStateForKey                           <span class="comment">// 将子 nextState 挂载到对应的键名</span></div><div class="line">      hasChanged = hasChanged || nextStateForKey !== previousStateForKey</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> hasChanged ? nextState : state</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>通过源码我们可以看出,当将一个合并后的reducers函数传入createStore的时候</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">const reducers = combineReducers(&#123;</div><div class="line">  todos,</div><div class="line">  visibilityFilter</div><div class="line">&#125;)</div><div class="line"></div><div class="line">const store = createStore(reducers)</div></pre></td></tr></table></figure>
<p><strong>因为当我们执行createStore函数的时候,会默认执行dispatch函数,而dispatch函数会执行reducers函数,在执行该函数的的过程中,我们可以看到,reducers函数的返回值会赋值给currentState,`</strong></p>
<h3 id="2-state和action运行的流程"><a href="#2-state和action运行的流程" class="headerlink" title="2 state和action运行的流程"></a>2 state和action运行的流程</h3><p><strong>无论是 <code>dispatch</code> 哪个 <code>action</code>，都会流通所有的 <code>reducer</code></strong>, 看来，这样子很浪费性能，但 JavaScript 对于这种<strong>纯函数</strong>的调用是很高效率的，因此请尽管放心这也是为何 <code>reducer</code> 必须返回其对应的 <code>state</code> 的原因。否则整合状态树时，该 <code>reducer</code> 对应的键值就是 <code>undefine</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">           counterReducer(counter, action) -------------------- counter</div><div class="line">                              ↗                                                           ↘</div><div class="line">rootReducer(state, action) —→∑  ↗ optTimeReducer(optTime, action) ------ optTime ↘      nextState</div><div class="line">                              ↘—→∑                                                 todo  ↗</div><div class="line">                                   ↘ todoListReducer(todoList,action) ----- todoList ↗</div></pre></td></tr></table></figure>
<h3 id="3-bindActionCreators源码核心如下"><a href="#3-bindActionCreators源码核心如下" class="headerlink" title="3 bindActionCreators源码核心如下"></a>3 bindActionCreators源码核心如下</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* 为 Action Creator 加装上自动 dispatch 技能 */</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">bindActionCreator</span>(<span class="params">actionCreator, dispatch</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">...args</span>) =&gt;</span> dispatch(actionCreator(...args))</div><div class="line">&#125;</div><div class="line"><span class="comment">/*</span></div><div class="line">转为ES5如下</div><div class="line">"use strict";</div><div class="line">function bindActionCreator(actionCreator, dispatch) &#123;</div><div class="line">  return function () &#123;</div><div class="line">    return dispatch(actionCreator.apply(undefined, arguments));</div><div class="line">  &#125;;</div><div class="line">&#125;</div><div class="line">*/</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">bindActionCreators</span>(<span class="params">actionCreators, dispatch</span>) </span>&#123;</div><div class="line">  <span class="comment">// 省去一大坨类型判断</span></div><div class="line">  <span class="keyword">var</span> keys = <span class="built_in">Object</span>.keys(actionCreators) <span class="comment">//将对象中所有的key值集合到一个数组当中,返回一个数组</span></div><div class="line">  <span class="keyword">var</span> boundActionCreators = &#123;&#125;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; keys.length; i++) &#123;</div><div class="line">    <span class="keyword">var</span> key = keys[i]</div><div class="line">    <span class="keyword">var</span> actionCreator = actionCreators[key] <span class="comment">//actionCreator[key]对应的是一个组件函数</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> actionCreator === <span class="string">'function'</span>) &#123;</div><div class="line">      <span class="comment">// 逐个装上自动 dispatch 技能</span></div><div class="line">      boundActionCreators[key] = bindActionCreator(actionCreator, dispatch) <span class="comment">//该函数返回结果也是一个函数,如果返回的函数再次执行的话,那么返回的将是dispatch函数,进行action分发了</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> boundActionCreators</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"todoInput"</span> <span class="attr">type</span>=<span class="string">"text"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"btn"</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">$(<span class="string">'#btn'</span>).on(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> content = $(<span class="string">'#todoInput'</span>).val() <span class="comment">// 获取输入框的值</span></div><div class="line">  <span class="keyword">var</span> action = addTodo(content)       <span class="comment">// 执行 Action Creator 获得 action</span></div><div class="line">  store.dispatch(action)              <span class="comment">// 手动显式 dispatch 一个 action</span></div><div class="line">&#125;)</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"todoInput"</span> <span class="attr">type</span>=<span class="string">"text"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"btn"</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line"><span class="comment">// 全局引入 Redux、jQuery，同时 store 是全局变量</span></div><div class="line"><span class="keyword">var</span> actionsCreators = Redux.bindActionCreators( <span class="comment">//bindActionCreators函数会返回一个boundActionCreators对象,该对象中</span></div><div class="line">  &#123; <span class="attr">addTodo</span>: addTodo &#125;,</div><div class="line">  store.dispatch <span class="comment">// 传入 dispatch 函数</span></div><div class="line">)</div><div class="line"></div><div class="line">$(<span class="string">'#btn'</span>).on(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> content = $(<span class="string">'#todoInput'</span>).val()</div><div class="line">  actionCreators.addTodo(content) <span class="comment">// 它会自动 dispatch</span></div><div class="line">&#125;)</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/05/204ES6-import/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/05/204ES6-import/" itemprop="url">
                  ES6 import
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-05T12:36:00+08:00">
                2017-05-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ES6/" itemprop="url" rel="index">
                    <span itemprop="name">ES6</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-了解ES6-模块加载和Common-js模块加载的区别"><a href="#1-了解ES6-模块加载和Common-js模块加载的区别" class="headerlink" title="1 了解ES6 模块加载和Common.js模块加载的区别"></a>1 了解ES6 模块加载和Common.js模块加载的区别</h3><p>1.1 Common.js语法中的模块加载加载得是引用的模块暴露出来的module.exports 整体</p>
<p>1.2 ES6的模块加载可以’静态加载,也就是说加载部分接口,而不是加载整个对象’</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// CommonJS模块</span></div><div class="line"><span class="keyword">let</span> &#123; stat, exists, readFile &#125; = <span class="built_in">require</span>(<span class="string">'fs'</span>);</div><div class="line"></div><div class="line"><span class="comment">// 等同于</span></div><div class="line"><span class="keyword">let</span> _fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</div><div class="line"><span class="keyword">let</span> stat = _fs.stat;</div><div class="line"><span class="keyword">let</span> exists = _fs.exists;</div><div class="line"><span class="keyword">let</span> readfile = _fs.readfile;</div></pre></td></tr></table></figure>
<p>上面代码的实质是整体加载<code>fs</code>模块（即加载<code>fs</code>的所有方法），生成一个对象（<code>_fs</code>），然后再从这个对象上面读取3个方法。这种加载称为“运行时加载”，因为只有运行时才能得到这个对象，导致完全没办法在编译时做“静态优化”。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ES6模块</span></div><div class="line"><span class="keyword">import</span> &#123; stat, exists, readFile &#125; <span class="keyword">from</span> <span class="string">'fs'</span>;</div></pre></td></tr></table></figure>
<p>ES6 模块不是对象，而是通过<code>export</code>命令显式指定输出的代码，再通过<code>import</code>命令输入。</p>
<p>上面代码的实质是从<code>fs</code>模块加载3个方法，其他方法不加载。这种加载称为“编译时加载”或者静态加载，即 ES6 可以在编译时就完成模块加载，效率要比 CommonJS 模块的加载方式高。当然，这也导致了没法引用 ES6 模块本身，因为它不是对象。</p>
<p>注意: ES6 模块之中，顶层的<code>this</code>指向<code>undefined</code>，即不应该在顶层代码使用<code>this</code>。</p>
<h3 id="2-ES6模块的命令组成"><a href="#2-ES6模块的命令组成" class="headerlink" title="2 ES6模块的命令组成"></a>2 ES6模块的命令组成</h3><p>主要有export和import两个命令组成;export用于规定模块对外的接口;import用于输入其他模块提供的功能接口</p>
<p>2.1 export</p>
<p>profile.js文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//第一种写法</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">var</span> name = <span class="string">'JiM'</span>;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'this is a func'</span>);</div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//-----------------------------------------------</span></div><div class="line"><span class="comment">//第二种写法</span></div><div class="line"><span class="keyword">var</span> name1 = <span class="string">'Jhon'</span> ;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">f1</span> (<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'this is a func1'</span>);</div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">export</span> &#123; name1,f1 &#125; ;<span class="comment">//注意暴露出去的写法必须用&#123;&#125;包起来</span></div></pre></td></tr></table></figure>
<p>main.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;name ,name1 ,f,f1&#125; <span class="keyword">from</span> <span class="string">'./profile.js'</span>;</div></pre></td></tr></table></figure>
<p>最后，<code>export</code>命令可以出现在模块的任何位置，只要处于模块顶层就可以。如果处于块级作用域内，就会报错，下一节的<code>import</code>命令也是如此。这是因为处于条件代码块之中，就没法做静态优化了，违背了ES6模块的设计初衷。</p>
<p><strong>export default </strong> 用来指定模块默认输出的接口,此时<strong>import该模块的就不需要<code>{ }</code></strong> 括起来了,如下:</p>
<p><strong>但是一定要注意,如果不是export default接口,那么导入该接口的时候,必须通过import <code>{ }</code>的方式</strong>(这个小坑踩了好几次)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 第一组</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">crc32</span>(<span class="params"></span>) </span>&#123; <span class="comment">// 输出</span></div><div class="line">  <span class="comment">// ...</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">import</span> crc32 <span class="keyword">from</span> <span class="string">'crc32'</span>; <span class="comment">// 输入</span></div><div class="line"></div><div class="line"><span class="comment">// 第二组</span></div><div class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">crc32</span>(<span class="params"></span>) </span>&#123; <span class="comment">// 输出</span></div><div class="line">  <span class="comment">// ...</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">import</span> &#123;crc32&#125; <span class="keyword">from</span> <span class="string">'crc32'</span>; <span class="comment">// 输入</span></div></pre></td></tr></table></figure>
<p><strong>export default </strong> 也可以默认导出任何数据类型</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;<span class="attr">userData</span> : <span class="literal">null</span> , <span class="attr">msg</span> : <span class="string">"login"</span>&#125;</div></pre></td></tr></table></figure>
<p><code>export default</code>命令用于指定模块的默认输出。显然，一个模块只能有一个默认输出，因此<code>export default</code>命令只能使用一次。所以，<code>import</code>命令后面才不用加大括号，因为只可能对应一个方法。</p>
<p>正是因为<code>export default</code>命令其实只是输出一个叫做<code>default</code>的变量，所以它后面不能跟变量声明语句。</p>
<p>2.2 import </p>
<p>import命令接受一堆大括号,用于引出模块中的接口,from后面接的是模块的路径,可以是相对路径,也可以是绝对路径,如果是模块标识,需要进行配置,告诉浏览器引擎如何加载该模块中的接口;</p>
<ul>
<li>import命令具有声明提升功能,会提升到整个模块的头部</li>
<li>import命令是静态执行的,不能使用变量和表达式</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">foo();</div><div class="line"></div><div class="line"><span class="keyword">import</span> &#123; foo &#125; <span class="keyword">from</span> <span class="string">'my_module'</span>;</div></pre></td></tr></table></figure>
<p>上面的代码不会报错，因为<code>import</code>的执行早于<code>foo</code>的调用。这种行为的本质是，<code>import</code>命令是编译阶段执行的，在代码运行之前。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 报错</span></div><div class="line"><span class="keyword">import</span> &#123; <span class="string">'f'</span> + <span class="string">'oo'</span> &#125; <span class="keyword">from</span> <span class="string">'my_module'</span>;</div><div class="line"></div><div class="line"><span class="comment">// 报错</span></div><div class="line"><span class="keyword">let</span> <span class="built_in">module</span> = <span class="string">'my_module'</span>;</div><div class="line"><span class="keyword">import</span> &#123; foo &#125; <span class="keyword">from</span> <span class="built_in">module</span>;</div><div class="line"></div><div class="line"><span class="comment">// 报错</span></div><div class="line"><span class="keyword">if</span> (x === <span class="number">1</span>) &#123;</div><div class="line">  <span class="keyword">import</span> &#123; foo &#125; <span class="keyword">from</span> <span class="string">'module1'</span>;</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">  <span class="keyword">import</span> &#123; foo &#125; <span class="keyword">from</span> <span class="string">'module2'</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>由于<code>import</code>是静态执行，所以不能使用表达式和变量，这些只有在运行时才能得到结果的语法结构。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/05/208Redux-applyMiddleware源码/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/05/208Redux-applyMiddleware源码/" itemprop="url">
                  Redux applyMiddleware源码
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-05T12:36:00+08:00">
                2017-05-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/redux/" itemprop="url" rel="index">
                    <span itemprop="name">redux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>今天是周日,昨天玩了一天,嗯,该放松还是得放松嘛,今天来学习下.</p>
<h3 id="1-还是先贴上源码"><a href="#1-还是先贴上源码" class="headerlink" title="1 还是先贴上源码"></a>1 还是先贴上源码</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> compose <span class="keyword">from</span> <span class="string">'./compose'</span></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Creates a store enhancer that applies middleware to the dispatch method</div><div class="line"> * of the Redux store. This is handy for a variety of tasks, such as expressing</div><div class="line"> * asynchronous actions in a concise manner, or logging every action payload.</div><div class="line"> *</div><div class="line"> * See `redux-thunk` package as an example of the Redux middleware.</div><div class="line"> *</div><div class="line"> * Because middleware is potentially asynchronous, this should be the first</div><div class="line"> * store enhancer in the composition chain.</div><div class="line"> *</div><div class="line"> * Note that each middleware will be given the `dispatch` and `getState` functions</div><div class="line"> * as named arguments.</div><div class="line"> *</div><div class="line"> * @param &#123;...Function&#125; middlewares The middleware chain to be applied.</div><div class="line"> * @returns &#123;Function&#125; A store enhancer applying the middleware.</div><div class="line"> */</div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">applyMiddleware</span>(<span class="params">...middlewares</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">createStore</span>) =&gt;</span> (reducer, preloadedState, enhancer) =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> store = createStore(reducer, preloadedState, enhancer)</div><div class="line">    <span class="keyword">let</span> dispatch = store.dispatch</div><div class="line">    <span class="keyword">let</span> chain = []</div><div class="line"></div><div class="line">    <span class="keyword">const</span> middlewareAPI = &#123;</div><div class="line">      <span class="attr">getState</span>: store.getState,</div><div class="line">      <span class="attr">dispatch</span>: <span class="function">(<span class="params">action</span>) =&gt;</span> dispatch(action)</div><div class="line">    &#125;</div><div class="line">    chain = middlewares.map(<span class="function"><span class="params">middleware</span> =&gt;</span> middleware(middlewareAPI))</div><div class="line">    dispatch = compose(...chain)(store.dispatch)</div><div class="line"><span class="comment">/*</span></div><div class="line"> // 例如，chain 为 [M3, M2, M1]，而 compose 是从右到左进行“包裹”的</div><div class="line">      // 那么，M1 的 dispatch 参数为 store.dispatch（见【降低逼格写法】的【锚点-2】）</div><div class="line">      // 往后，M2 的 dispatch 参数为 M1 的中间件处理逻辑哥（见【降低逼格写法】的【锚点-3】）</div><div class="line">      // 同样，M3 的 dispatch 参数为 M2 的中间件处理逻辑哥</div><div class="line">      // 最后，我们得到串联后的中间件链：M3(M2(M1(store.dispatch)))</div><div class="line">      */</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">      ...store,</div><div class="line">      dispatch</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>由于目前对这个源码理解还是不够透彻,索性拿别人的作为记录得了,后期自己深入研究在自己写demo.</p>
<p>下面这个就是一个简单的中间件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">const</span> printStateMiddleware = <span class="function">(<span class="params">&#123; getState &#125;</span>) =&gt;</span> next =&gt; <span class="function"><span class="params">action</span> =&gt;</span> &#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'state before dispatch'</span>, getState())</div><div class="line">  </div><div class="line">  <span class="keyword">let</span> returnValue = next(action)</div><div class="line"></div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'state after dispatch'</span>, getState())</div><div class="line"></div><div class="line">  <span class="keyword">return</span> returnValue</div><div class="line">&#125;</div><div class="line"></div><div class="line">-------------------------------------------------</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">printStateMiddleware</span>(<span class="params">middlewareAPI</span>) </span>&#123; <span class="comment">// 记为【锚点-1】，中间件内可用的 API</span></div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">dispatch</span>) </span>&#123;                 <span class="comment">// 记为【锚点-2】，传入上级中间件处理逻辑（若无则为原 store.dispatch）</span></div><div class="line"></div><div class="line">    <span class="comment">// 下面记为【锚点-3】，整个函数将会被传到下级中间件（如果有的话）作为它的 dispatch 参数</span></div><div class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">action</span>) </span>&#123; <span class="comment">// &lt;---------------------------------------------- 这货就叫做【中间件处理逻辑哥】吧</span></div><div class="line">      <span class="built_in">console</span>.log(<span class="string">'state before dispatch'</span>, middlewareAPI.getState())</div><div class="line">  </div><div class="line">      <span class="keyword">var</span> returnValue = dispatch(action) <span class="comment">// 还记得吗，dispatch 的返回值其实还是 action</span></div><div class="line">  </div><div class="line">      <span class="built_in">console</span>.log(<span class="string">'state after dispatch'</span>, middlewareAPI.getState())</div><div class="line"></div><div class="line">      <span class="keyword">return</span> returnValue <span class="comment">// 继续传给下一个中间件作为参数 action</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果觉得代码有点晦涩难懂,可以进行下babel转化为ES5 如下:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">Object</span>.defineProperty(exports, <span class="string">"__esModule"</span>, &#123;</div><div class="line">  <span class="attr">value</span>: <span class="literal">true</span></div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="keyword">var</span> _extends = <span class="built_in">Object</span>.assign || <span class="function"><span class="keyword">function</span> (<span class="params">target</span>) </span>&#123; <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>; i &lt; <span class="built_in">arguments</span>.length; i++) &#123; <span class="keyword">var</span> source = <span class="built_in">arguments</span>[i]; <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> source) &#123; <span class="keyword">if</span> (<span class="built_in">Object</span>.prototype.hasOwnProperty.call(source, key)) &#123; target[key] = source[key]; &#125; &#125; &#125; <span class="keyword">return</span> target; &#125;;</div><div class="line"></div><div class="line">exports.default = applyMiddleware;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">_toConsumableArray</span>(<span class="params">arr</span>) </span>&#123; <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(arr)) &#123; <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, arr2 = <span class="built_in">Array</span>(arr.length); i &lt; arr.length; i++) &#123; arr2[i] = arr[i]; &#125; <span class="keyword">return</span> arr2; &#125; <span class="keyword">else</span> &#123; <span class="keyword">return</span> <span class="built_in">Array</span>.from(arr); &#125; &#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">applyMiddleware</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> _len = <span class="built_in">arguments</span>.length, middlewares = <span class="built_in">Array</span>(_len), _key = <span class="number">0</span>; _key &lt; _len; _key++) &#123;</div><div class="line">    middlewares[_key] = <span class="built_in">arguments</span>[_key];</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">createStore</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">reducer, preloadedState, enhancer</span>) </span>&#123;</div><div class="line">      <span class="keyword">var</span> store = createStore(reducer, preloadedState, enhancer);</div><div class="line">      <span class="keyword">var</span> _dispatch = store.dispatch;</div><div class="line">      <span class="keyword">var</span> chain = [];</div><div class="line"></div><div class="line">      <span class="keyword">var</span> middlewareAPI = &#123;</div><div class="line">        <span class="attr">getState</span>: store.getState,</div><div class="line">        <span class="attr">dispatch</span>: <span class="function"><span class="keyword">function</span> <span class="title">dispatch</span>(<span class="params">action</span>) </span>&#123;</div><div class="line">          <span class="keyword">return</span> _dispatch(action);</div><div class="line">        &#125;</div><div class="line">      &#125;;</div><div class="line">      chain = middlewares.map(<span class="function"><span class="keyword">function</span> (<span class="params">middleware</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> middleware(middlewareAPI);</div><div class="line">      &#125;);</div><div class="line">      _dispatch = compose.apply(<span class="literal">undefined</span>, _toConsumableArray(chain))(store.dispatch);</div><div class="line"></div><div class="line">      <span class="keyword">return</span> _extends(&#123;&#125;, store, &#123;</div><div class="line">        <span class="attr">dispatch</span>: _dispatch</div><div class="line">      &#125;);</div><div class="line">    &#125;;</div><div class="line">  &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>先从整体上把控下Redux所谓的API都有什么 : </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">Redux 有五个 API，分别是：</div><div class="line"></div><div class="line">      createStore(reducer, [initialState])</div><div class="line">      combineReducers(reducers)</div><div class="line">      applyMiddleware(...middlewares)</div><div class="line">      bindActionCreators(actionCreators, dispatch)</div><div class="line">      compose(...functions)</div><div class="line"></div><div class="line">createStore 生成的 store 有四个 API，分别是：</div><div class="line"></div><div class="line">    getState()</div><div class="line">    dispatch(action)</div><div class="line">    subscribe(listener)</div><div class="line">    replaceReducer(nextReducer)</div></pre></td></tr></table></figure>
<h3 id="2-通过源码分析下applyMiddleware这个函数做了什么工作"><a href="#2-通过源码分析下applyMiddleware这个函数做了什么工作" class="headerlink" title="2 通过源码分析下applyMiddleware这个函数做了什么工作:"></a>2 通过源码分析下applyMiddleware这个函数做了什么工作:</h3><p><strong>其实就是在dispatch一个action和执行reducer之前,增加了一些异步的操作</strong></p>
<p>2.1 返回一个新的store创建器</p>
<p>首先返回一个函数,该函数接受Redux.createStore这个API作为参数,也就是说</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">applyMiddleware(...middleWares) = <span class="function"><span class="keyword">function</span> (<span class="params">createStore</span>)</span>&#123; &#125;</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> enhancedCreateStore = Redux.applyMiddleware(...Middlewares)(Redux.createStore);</div></pre></td></tr></table></figure>
<p>上面这行代码返回的结果也是一个函数,而这个函数被赋值给enhancedCreateStore</p>
<p>正常的创建store的函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> store = Redux.createStore(reducer, preloadedState, enhancer);</div></pre></td></tr></table></figure>
<p>增强createStore之后的创建store函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> store = enhancedCreateStore(reducer, preloadedState, enhancer);</div></pre></td></tr></table></figure>
<p>2.2 新的store创建器返回的结果增加了原来的dispatch函数功能,从源码中可以看出返回的值和最基础的createStore一样返回的是一个下面的对象:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">return</span> &#123;</div><div class="line">  dispatch,</div><div class="line">  subscribe,</div><div class="line">  getState,</div><div class="line">  replaceReducer,</div><div class="line">  [$$observable]: observable</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>只不过dispatch函数增加了一些功能而已.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">return</span> &#123;</div><div class="line">  ...store,</div><div class="line">  dispatch</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>以上分析就是applyMiddleware函数所做的一些工作.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">原 createStore ————</div><div class="line">                  │</div><div class="line">                  ↓</div><div class="line">return enhancer1(createStore)(reducer, preloadedState, enhancer2)</div><div class="line">   |</div><div class="line">   ├———————→ createStore 增强版 1</div><div class="line">                    │</div><div class="line">                    ↓</div><div class="line">return enhancer2(createStore1)(reducer, preloadedState, enhancer3)</div><div class="line">   |</div><div class="line">   ├———————————→ createStore 增强版 1+2</div><div class="line">                        │</div><div class="line">                        ↓</div><div class="line">return enhancer3(createStore1+2)(reducer, preloadedState, applyMiddleware(m1,m2,m3))</div><div class="line">   |</div><div class="line">   ├————————————————————→ createStore 增强版 1+2+3</div><div class="line">                                     │</div><div class="line">                                     ↓</div><div class="line">return appleMiddleware(m1,m2,m3)(createStore1+2+3)(reducer, preloadedState)</div><div class="line">   |</div><div class="line">   ├——————————————————————————————————→ 生成最终增强版 store</div></pre></td></tr></table></figure>
<h3 id="3-走一个小的功能看下具体的效果"><a href="#3-走一个小的功能看下具体的效果" class="headerlink" title="3 走一个小的功能看下具体的效果"></a>3 走一个小的功能看下具体的效果</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./redux.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line"><span class="comment">/** Action Creators */</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">inc</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123; <span class="attr">type</span>: <span class="string">'INCREMENT'</span> &#125;;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">dec</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123; <span class="attr">type</span>: <span class="string">'DECREMENT'</span> &#125;;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params">state, action</span>) </span>&#123;</div><div class="line">  state = state || &#123; <span class="attr">counter</span>: <span class="number">0</span> &#125;;</div><div class="line"></div><div class="line">  <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">    <span class="keyword">case</span> <span class="string">'INCREMENT'</span>:</div><div class="line">      <span class="keyword">return</span> &#123; <span class="attr">counter</span>: state.counter + <span class="number">1</span> &#125;;</div><div class="line">    <span class="keyword">case</span> <span class="string">'DECREMENT'</span>:</div><div class="line">      <span class="keyword">return</span> &#123; <span class="attr">counter</span>: state.counter - <span class="number">1</span> &#125;;</div><div class="line">    <span class="keyword">default</span>:</div><div class="line">      <span class="keyword">return</span> state;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">printStateMiddleware</span>(<span class="params">middlewareAPI</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">dispatch</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">action</span>) </span>&#123;</div><div class="line">      <span class="built_in">console</span>.log(<span class="string">'dispatch 前：'</span>, middlewareAPI.getState());</div><div class="line">      <span class="keyword">var</span> returnValue = dispatch(action);</div><div class="line">      <span class="built_in">console</span>.log(<span class="string">'dispatch 后：'</span>, middlewareAPI.getState(), <span class="string">'\n'</span>);</div><div class="line">      <span class="keyword">return</span> returnValue;</div><div class="line">    &#125;;</div><div class="line">  &#125;;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> enhancedCreateStore = Redux.applyMiddleware(printStateMiddleware)(Redux.createStore);</div><div class="line"><span class="keyword">var</span> store = enhancedCreateStore(reducer);</div><div class="line"></div><div class="line">store.dispatch(inc());</div><div class="line">store.dispatch(inc());</div><div class="line">store.dispatch(dec());</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div><div class="line">控制台输出：</div><div class="line"></div><div class="line">dispatch 前：&#123; counter: 0 &#125;</div><div class="line">dispatch 后：&#123; counter: 1 &#125;</div><div class="line"></div><div class="line">dispatch 前：&#123; counter: 1 &#125;</div><div class="line">dispatch 后：&#123; counter: 2 &#125;</div><div class="line"></div><div class="line">dispatch 前：&#123; counter: 2 &#125;</div><div class="line">dispatch 后：&#123; counter: 1 &#125;</div></pre></td></tr></table></figure>
<h3 id="4-自己实现一个最简单的中间件"><a href="#4-自己实现一个最简单的中间件" class="headerlink" title="4 自己实现一个最简单的中间件"></a>4 自己实现一个最简单的中间件</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">dispatchAndLog</span>(<span class="params">store, action</span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'dispatching'</span>, action)</div><div class="line">  store.dispatch(action)</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'next state'</span>, store.getState())</div><div class="line">&#125;</div><div class="line"><span class="comment">//</span></div><div class="line">dispatchAndLog(store, addTodo(<span class="string">'Use Redux'</span>))</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">logger</span>(<span class="params">store</span>) </span>&#123;</div><div class="line">  <span class="keyword">let</span> next = store.dispatch</div><div class="line"></div><div class="line">  <span class="comment">// 我们之前的做法:</span></div><div class="line">  <span class="comment">// store.dispatch = function dispatchAndLog(action) &#123;</span></div><div class="line"></div><div class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">dispatchAndLog</span>(<span class="params">action</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'dispatching'</span>, action)</div><div class="line">    <span class="keyword">let</span> result = next(action)</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'next state'</span>, store.getState())</div><div class="line">    <span class="keyword">return</span> result</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a><a href="https://github.com/kenberkeley/redux-simple-tutorial/blob/master/redux-advanced-tutorial.md" target="_blank" rel="external">参考</a></h3><p>非常感谢作者能从源码的角度剖析文章.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/05/206Redux-compose源码/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/05/206Redux-compose源码/" itemprop="url">
                  Redux compose源码
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-05T12:36:00+08:00">
                2017-05-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/redux/" itemprop="url" rel="index">
                    <span itemprop="name">redux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-先贴上源码"><a href="#1-先贴上源码" class="headerlink" title="1 先贴上源码"></a>1 先贴上源码</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Composes single-argument functions from right to left. The rightmost</div><div class="line"> * function can take multiple arguments as it provides the signature for</div><div class="line"> * the resulting composite function.</div><div class="line"> *</div><div class="line"> * @param &#123;...Function&#125; funcs The functions to compose.</div><div class="line"> * @returns &#123;Function&#125; A function obtained by composing the argument functions</div><div class="line"> * from right to left. For example, compose(f, g, h) is identical to doing</div><div class="line"> * (...args) =&gt; f(g(h(...args))).</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">compose</span>(<span class="params">...funcs</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (funcs.length === <span class="number">0</span>) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="function"><span class="params">arg</span> =&gt;</span> arg</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (funcs.length === <span class="number">1</span>) &#123;</div><div class="line">    <span class="keyword">return</span> funcs[<span class="number">0</span>]</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> funcs.reduce(<span class="function">(<span class="params">a, b</span>) =&gt;</span> (...args) =&gt; a(b(...args)))</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>经过bable编译器编译之后</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="meta">"use strict"</span>;</div><div class="line"></div><div class="line"><span class="built_in">Object</span>.defineProperty(exports, <span class="string">"__esModule"</span>, &#123;</div><div class="line">  <span class="attr">value</span>: <span class="literal">true</span></div><div class="line">&#125;);</div><div class="line">exports.default = compose;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">compose</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> _len = <span class="built_in">arguments</span>.length, funcs = <span class="built_in">Array</span>(_len), _key = <span class="number">0</span>; _key &lt; _len; _key++) &#123;</div><div class="line">    funcs[_key] = <span class="built_in">arguments</span>[_key];</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (funcs.length === <span class="number">0</span>) &#123;</div><div class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">arg</span>) </span>&#123;</div><div class="line">      <span class="keyword">return</span> arg;</div><div class="line">    &#125;;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (funcs.length === <span class="number">1</span>) &#123;</div><div class="line">    <span class="keyword">return</span> funcs[<span class="number">0</span>];</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> funcs.reduce(<span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="keyword">return</span> a(b.apply(<span class="literal">undefined</span>, <span class="built_in">arguments</span>));</div><div class="line">    &#125;;</div><div class="line">  &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="2-简化应用过程"><a href="#2-简化应用过程" class="headerlink" title="2 简化应用过程"></a>2 简化应用过程</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 由于 reduce / reduceRight 仅仅是方向的不同，因此下面用 reduce 说明即可</span></div><div class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</div><div class="line"><span class="comment">//封装的compose函数用的是这种reduce函数,没有传入初始值</span></div><div class="line"><span class="keyword">var</span> re1 = arr.reduce(<span class="function"><span class="keyword">function</span>(<span class="params">total, i</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> total + i</div><div class="line">&#125;)</div><div class="line"><span class="built_in">console</span>.log(re1) <span class="comment">// 15</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> re2 = arr.reduce(<span class="function"><span class="keyword">function</span>(<span class="params">total, i</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> total + i</div><div class="line">&#125;, <span class="number">100</span>) <span class="comment">// &lt;---------------传入一个初始值</span></div><div class="line"><span class="built_in">console</span>.log(re2) <span class="comment">// 115</span></div></pre></td></tr></table></figure>
<h3 id="3-reduce函数"><a href="#3-reduce函数" class="headerlink" title="3 reduce函数"></a>3 reduce函数</h3><p>Array.prototype.reduce(callback ,[initialValue]) (reduceRight函数和reduce函数类似，只不是从数组的最后反向开始迭代);数组的reduce方法向callback函数传递四个参数，分别是</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">Parameters</div><div class="line"></div><div class="line">callback</div><div class="line"><span class="built_in">Function</span> to execute on each value <span class="keyword">in</span> the array, taking four <span class="built_in">arguments</span>:</div><div class="line"><span class="number">1</span> accumulator</div><div class="line">The accumulated value previously returned <span class="keyword">in</span> the last invocation <span class="keyword">of</span> the callback, or initialValue, <span class="keyword">if</span> supplied. (See below.)(如果initialValue提供了，那么第一次运行的时候，accumular值为initialValue，如果没有提供initialValue，那么accumular的值为数组中的第一个元素，currentValue为数组中的第二个元素，跳过第一个索引值)</div><div class="line"><span class="number">2</span> currentValue</div><div class="line">The current element being processed <span class="keyword">in</span> the array.</div><div class="line"><span class="number">3</span> currentIndex</div><div class="line">The index <span class="keyword">of</span> the current element being processed <span class="keyword">in</span> the array. Starts at index <span class="number">0</span>, <span class="keyword">if</span> an initialValue is provided, and at index <span class="number">1</span> otherwise.</div><div class="line"><span class="number">4</span> array</div><div class="line">The array reduce was called upon.</div><div class="line"><span class="number">5</span> initialValue</div><div class="line">Optional. Value to use <span class="keyword">as</span> the first argument to the first call <span class="keyword">of</span> the callback.</div><div class="line">Return value</div><div class="line">The value that results <span class="keyword">from</span> the reduction.</div></pre></td></tr></table></figure>
<p>callback函数每次执行之后的结果作为第一个参数再次传递给callback函数</p>
<h3 id="4-compose函数执行之后返回值是什么"><a href="#4-compose函数执行之后返回值是什么" class="headerlink" title="4 compose函数执行之后返回值是什么"></a>4 compose函数执行之后返回值是什么</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">return</span> funcs.reduce(<span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</div><div class="line">   <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">     <span class="keyword">return</span> a(b.apply(<span class="literal">undefined</span>, <span class="built_in">arguments</span>));</div><div class="line">   &#125;;</div><div class="line"> &#125;);</div></pre></td></tr></table></figure>
<p>如上代码返回值是reduce函数执行后的结果</p>
<ul>
<li>如果是一个简单的数组进行reduce函数的运算,那么结果就很简单</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> ret = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].reduce(<span class="function"><span class="keyword">function</span>(<span class="params">a,b</span>)</span>&#123;</div><div class="line">  <span class="keyword">return</span> a+b ;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(ret);<span class="comment">//6</span></div></pre></td></tr></table></figure>
<ul>
<li>如果是一个由函数组成的数组进行reduce函数的运算,那么返回的结果就是一个函数的链式调用</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">'./redux.min.js'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">func1</span>(<span class="params">num</span>)</span>&#123;</div><div class="line">      <span class="built_in">console</span>.log(<span class="string">'func1获取参数'</span>,num);</div><div class="line">      <span class="keyword">return</span> num + <span class="number">1</span> ;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">func2</span>(<span class="params">num</span>)</span>&#123;</div><div class="line">      <span class="built_in">console</span>.log(<span class="string">'func2获取参数'</span>,num);</div><div class="line">      <span class="keyword">return</span> num + <span class="number">1</span> ;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">func3</span>(<span class="params">num</span>)</span>&#123;</div><div class="line">      <span class="built_in">console</span>.log(<span class="string">'func1获取参数'</span>,num);</div><div class="line">      <span class="keyword">return</span> num + <span class="number">3</span> ;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> ret = Redux.compose(func1,func2,func3);</div><div class="line">    <span class="built_in">console</span>.dir(ret);<span class="comment">//可以看出结果是一个函数  function anonymous(t)</span></div><div class="line">    </div><div class="line">    </div><div class="line"></div><div class="line">    <span class="keyword">var</span> ret1 = Redux.compose(func1,func2,func3)(<span class="number">3</span>) ;</div><div class="line">    <span class="built_in">console</span>.log(ret1);</div><div class="line"></div><div class="line">    <span class="keyword">var</span> ret2 = func1(func2(func3(<span class="number">3</span>))); <span class="comment">//这个就是compose函数最终返回的最简单的函数形态</span></div><div class="line">    <span class="built_in">console</span>.log(ret2)</div><div class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/05/205Redux-createStore源码/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/05/205Redux-createStore源码/" itemprop="url">
                  Redux createStore源码
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-05T12:36:00+08:00">
                2017-05-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/redux/" itemprop="url" rel="index">
                    <span itemprop="name">redux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>###1 先贴上createStore源码</p>
<p>看了源码我对redux的认识才开始清晰,现在终于明白,不看源码学框架就是没事儿找刺激啊,不知道底层如何实现,学起来就是举步维艰;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> isPlainObject <span class="keyword">from</span> <span class="string">'lodash/isPlainObject'</span></div><div class="line"><span class="keyword">import</span> $$observable <span class="keyword">from</span> <span class="string">'symbol-observable'</span></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * These are private action types reserved by Redux.</div><div class="line"> * For any unknown actions, you must return the current state.</div><div class="line"> * If the current state is undefined, you must return the initial state.</div><div class="line"> * Do not reference these action types directly in your code.</div><div class="line"> */</div><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> ActionTypes = &#123;</div><div class="line">  <span class="attr">INIT</span>: <span class="string">'@@redux/INIT'</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Creates a Redux store that holds the state tree.</div><div class="line"> * The only way to change the data in the store is to call `dispatch()` on it.</div><div class="line"> *</div><div class="line"> * There should only be a single store in your app. To specify how different</div><div class="line"> * parts of the state tree respond to actions, you may combine several reducers</div><div class="line"> * into a single reducer function by using `combineReducers`.</div><div class="line"> *</div><div class="line"> * @param &#123;Function&#125; reducer A function that returns the next state tree, given</div><div class="line"> * the current state tree and the action to handle.</div><div class="line"> *</div><div class="line"> * @param &#123;any&#125; [preloadedState] The initial state. You may optionally specify it</div><div class="line"> * to hydrate the state from the server in universal apps, or to restore a</div><div class="line"> * previously serialized user session.</div><div class="line"> * If you use `combineReducers` to produce the root reducer function, this must be</div><div class="line"> * an object with the same shape as `combineReducers` keys.</div><div class="line"> *</div><div class="line"> * @param &#123;Function&#125; [enhancer] The store enhancer. You may optionally specify it</div><div class="line"> * to enhance the store with third-party capabilities such as middleware,</div><div class="line"> * time travel, persistence, etc. The only store enhancer that ships with Redux</div><div class="line"> * is `applyMiddleware()`.</div><div class="line"> *</div><div class="line"> * @returns &#123;Store&#125; A Redux store that lets you read the state, dispatch actions</div><div class="line"> * and subscribe to changes.</div><div class="line"> */</div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">createStore</span>(<span class="params">reducer, preloadedState, enhancer</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> preloadedState === <span class="string">'function'</span> &amp;&amp; <span class="keyword">typeof</span> enhancer === <span class="string">'undefined'</span>) &#123;</div><div class="line">    enhancer = preloadedState</div><div class="line">    preloadedState = <span class="literal">undefined</span></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> enhancer !== <span class="string">'undefined'</span>) &#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> enhancer !== <span class="string">'function'</span>) &#123;</div><div class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Expected the enhancer to be a function.'</span>)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> enhancer(createStore)(reducer, preloadedState)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> reducer !== <span class="string">'function'</span>) &#123;</div><div class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Expected the reducer to be a function.'</span>)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">let</span> currentReducer = reducer</div><div class="line">  <span class="keyword">let</span> currentState = preloadedState</div><div class="line">  <span class="keyword">let</span> currentListeners = []</div><div class="line">  <span class="keyword">let</span> nextListeners = currentListeners</div><div class="line">  <span class="keyword">let</span> isDispatching = <span class="literal">false</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">ensureCanMutateNextListeners</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (nextListeners === currentListeners) &#123;</div><div class="line">      nextListeners = currentListeners.slice()</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">/**</span></div><div class="line">   * Reads the state tree managed by the store.</div><div class="line">   *</div><div class="line">   * @returns &#123;any&#125; The current state tree of your application.</div><div class="line">   */</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getState</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> currentState</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">/**</span></div><div class="line">   * Adds a change listener. It will be called any time an action is dispatched,</div><div class="line">   * and some part of the state tree may potentially have changed. You may then</div><div class="line">   * call `getState()` to read the current state tree inside the callback.</div><div class="line">   *</div><div class="line">   * You may call `dispatch()` from a change listener, with the following</div><div class="line">   * caveats:</div><div class="line">   *</div><div class="line">   * 1. The subscriptions are snapshotted just before every `dispatch()` call.</div><div class="line">   * If you subscribe or unsubscribe while the listeners are being invoked, this</div><div class="line">   * will not have any effect on the `dispatch()` that is currently in progress.</div><div class="line">   * However, the next `dispatch()` call, whether nested or not, will use a more</div><div class="line">   * recent snapshot of the subscription list.</div><div class="line">   *</div><div class="line">   * 2. The listener should not expect to see all state changes, as the state</div><div class="line">   * might have been updated multiple times during a nested `dispatch()` before</div><div class="line">   * the listener is called. It is, however, guaranteed that all subscribers</div><div class="line">   * registered before the `dispatch()` started will be called with the latest</div><div class="line">   * state by the time it exits.</div><div class="line">   *</div><div class="line">   * @param &#123;Function&#125; listener A callback to be invoked on every dispatch.</div><div class="line">   * @returns &#123;Function&#125; A function to remove this change listener.</div><div class="line">   */</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">subscribe</span>(<span class="params">listener</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> listener !== <span class="string">'function'</span>) &#123;</div><div class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Expected listener to be a function.'</span>)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">let</span> isSubscribed = <span class="literal">true</span></div><div class="line"></div><div class="line">    ensureCanMutateNextListeners()</div><div class="line">    nextListeners.push(listener)</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">unsubscribe</span>(<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="keyword">if</span> (!isSubscribed) &#123;</div><div class="line">        <span class="keyword">return</span></div><div class="line">      &#125;</div><div class="line"></div><div class="line">      isSubscribed = <span class="literal">false</span></div><div class="line"></div><div class="line">      ensureCanMutateNextListeners()</div><div class="line">      <span class="keyword">const</span> index = nextListeners.indexOf(listener)</div><div class="line">      nextListeners.splice(index, <span class="number">1</span>)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">/**</span></div><div class="line">   * Dispatches an action. It is the only way to trigger a state change.</div><div class="line">   *</div><div class="line">   * The `reducer` function, used to create the store, will be called with the</div><div class="line">   * current state tree and the given `action`. Its return value will</div><div class="line">   * be considered the **next** state of the tree, and the change listeners</div><div class="line">   * will be notified.</div><div class="line">   *</div><div class="line">   * The base implementation only supports plain object actions. If you want to</div><div class="line">   * dispatch a Promise, an Observable, a thunk, or something else, you need to</div><div class="line">   * wrap your store creating function into the corresponding middleware. For</div><div class="line">   * example, see the documentation for the `redux-thunk` package. Even the</div><div class="line">   * middleware will eventually dispatch plain object actions using this method.</div><div class="line">   *</div><div class="line">   * @param &#123;Object&#125; action A plain object representing “what changed”. It is</div><div class="line">   * a good idea to keep actions serializable so you can record and replay user</div><div class="line">   * sessions, or use the time travelling `redux-devtools`. An action must have</div><div class="line">   * a `type` property which may not be `undefined`. It is a good idea to use</div><div class="line">   * string constants for action types.</div><div class="line">   *</div><div class="line">   * @returns &#123;Object&#125; For convenience, the same action object you dispatched.</div><div class="line">   *</div><div class="line">   * Note that, if you use a custom middleware, it may wrap `dispatch()` to</div><div class="line">   * return something else (for example, a Promise you can await).</div><div class="line">   */</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">dispatch</span>(<span class="params">action</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (!isPlainObject(action)) &#123;</div><div class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</div><div class="line">        <span class="string">'Actions must be plain objects. '</span> +</div><div class="line">        <span class="string">'Use custom middleware for async actions.'</span></div><div class="line">      )</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> action.type === <span class="string">'undefined'</span>) &#123;</div><div class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</div><div class="line">        <span class="string">'Actions may not have an undefined "type" property. '</span> +</div><div class="line">        <span class="string">'Have you misspelled a constant?'</span></div><div class="line">      )</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (isDispatching) &#123;</div><div class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Reducers may not dispatch actions.'</span>)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">      <span class="comment">//最初始的值是false</span></div><div class="line">      isDispatching = <span class="literal">true</span></div><div class="line">      currentState = currentReducer(currentState, action)</div><div class="line">    &#125; <span class="keyword">finally</span> &#123;</div><div class="line">      <span class="comment">//执行完try之后,还是将该值重置为false</span></div><div class="line">      isDispatching = <span class="literal">false</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">const</span> listeners = currentListeners = nextListeners</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; listeners.length; i++) &#123;</div><div class="line">      <span class="keyword">const</span> listener = listeners[i]</div><div class="line">      listener()</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> action</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">/**</span></div><div class="line">   * Replaces the reducer currently used by the store to calculate the state.</div><div class="line">   *</div><div class="line">   * You might need this if your app implements code splitting and you want to</div><div class="line">   * load some of the reducers dynamically. You might also need this if you</div><div class="line">   * implement a hot reloading mechanism for Redux.</div><div class="line">   *</div><div class="line">   * @param &#123;Function&#125; nextReducer The reducer for the store to use instead.</div><div class="line">   * @returns &#123;void&#125;</div><div class="line">   */</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">replaceReducer</span>(<span class="params">nextReducer</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> nextReducer !== <span class="string">'function'</span>) &#123;</div><div class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Expected the nextReducer to be a function.'</span>)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    currentReducer = nextReducer</div><div class="line">    dispatch(&#123; <span class="attr">type</span>: ActionTypes.INIT &#125;)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">/**</span></div><div class="line">   * Interoperability point for observable/reactive libraries.</div><div class="line">   * @returns &#123;observable&#125; A minimal observable of state changes.</div><div class="line">   * For more information, see the observable proposal:</div><div class="line">   * https://github.com/tc39/proposal-observable</div><div class="line">   */</div><div class="line">  <span class="function"><span class="keyword">function</span> <span class="title">observable</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">const</span> outerSubscribe = subscribe</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">      <span class="comment">/**</span></div><div class="line">       * The minimal observable subscription method.</div><div class="line">       * @param &#123;Object&#125; observer Any object that can be used as an observer.</div><div class="line">       * The observer object should have a `next` method.</div><div class="line">       * @returns &#123;subscription&#125; An object with an `unsubscribe` method that can</div><div class="line">       * be used to unsubscribe the observable from the store, and prevent further</div><div class="line">       * emission of values from the observable.</div><div class="line">       */</div><div class="line">      subscribe(observer) &#123;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> observer !== <span class="string">'object'</span>) &#123;</div><div class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'Expected the observer to be an object.'</span>)</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">observeState</span>(<span class="params"></span>) </span>&#123;</div><div class="line">          <span class="keyword">if</span> (observer.next) &#123;</div><div class="line">            observer.next(getState())</div><div class="line">          &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        observeState()</div><div class="line">        <span class="keyword">const</span> unsubscribe = outerSubscribe(observeState)</div><div class="line">        <span class="keyword">return</span> &#123; unsubscribe &#125;</div><div class="line">      &#125;,</div><div class="line"></div><div class="line">      [$$observable]() &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span></div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// When a store is created, an "INIT" action is dispatched so that every</span></div><div class="line">  <span class="comment">// reducer returns their initial state. This effectively populates</span></div><div class="line">  <span class="comment">// the initial state tree.</span></div><div class="line">  dispatch(&#123; <span class="attr">type</span>: ActionTypes.INIT &#125;)</div><div class="line"></div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    dispatch,</div><div class="line">    subscribe,</div><div class="line">    getState,</div><div class="line">    replaceReducer,</div><div class="line">    [$$observable]: observable</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>var store = createStore(reducer , preLoadState , enhancer) 定义一个store的时候可以传递reducer函数,state初始状态<ul>
<li>注意createStore之后,会先默认执行dispatch函数一次,看源码注意下这一点.通过这次默认执行dispatch函数,reducer函数就会执行,可以初始化state状态</li>
<li>dispatch函数执行的时候,由于刚创建store并没有通过subscribe绑定listeners,所以listeners在createStore的时候不会执行.</li>
</ul>
</li>
<li>getState( )函数用来获取state下一个状态</li>
<li>dispatch(action)函数,<ul>
<li>用来根据不同的action,调用reducer函数改变state状态</li>
<li>依次执行所有通过subscribe订阅到listeners数组中的函数;</li>
<li>返回一个传入的action对象</li>
</ul>
</li>
<li>subscribe( listener ) 用来向listeners数组中添加监听器</li>
<li>replaceReducer( nextReducer ) 替换 reducer 为 nextReducer</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">dispatch不同的action,然后触发reducer函数</div><div class="line">定义reducer函数的时候,reducer函数接受两个参数,一个是state,一个是action,</div><div class="line">因为reducer函数在执行的时候,是在dispatch函数内部执行,所以reducer函数的action来自于dispatch的参数action,reducer函数的state可以来自于自己,也可以来自于定义store的时候</div></pre></td></tr></table></figure>
<h3 id="2-我们来结合一个小栗子看下createStore在状态管理过程中所扮演的角色"><a href="#2-我们来结合一个小栗子看下createStore在状态管理过程中所扮演的角色" class="headerlink" title="2 我们来结合一个小栗子看下createStore在状态管理过程中所扮演的角色"></a>2 我们来结合一个小栗子看下createStore在状态管理过程中所扮演的角色</h3><p>2.1 还是老惯例,看下引入redux之后,文件中对象有什么</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">'./redux.min.js'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">        <span class="built_in">console</span>.log(Redux);</div><div class="line">        <span class="built_in">console</span>.log(Redux.createStore);</div><div class="line">        </div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">Object &#123;__esModule: true,</div><div class="line">createStore: function, </div><div class="line">combineReducers: function, </div><div class="line">bindActionCreators: function, </div><div class="line">applyMiddleware: function…&#125;</div><div class="line">applyMiddleware:function o()</div><div class="line">bindActionCreators:function u(t,e)</div><div class="line">combineReducers:function i(t)</div><div class="line">compose:function n()</div><div class="line">createStore:function o(t,e)</div><div class="line">__esModule:true</div></pre></td></tr></table></figure>
<p>2.2 reducer函数的定义为什么总是第一个参数是state,第二个参数是action?</p>
<p>我们定义的reducer函数要返回一个reducer处理之后的state,赋值给currentState,然后通过getState就可以获取当前状态;</p>
<p>源码中有如下两行代码,可以看出</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> currentReducer = reducer; </div><div class="line">currentState = currentReducer(currentState, action);</div></pre></td></tr></table></figure>
<ul>
<li>当我们创建一个store的时候,createStore接受两个参数,一个是reducer函数,一个是initialState初始状态,</li>
<li>然后 var currentReducer = reducer ;  var currentState = initialState;</li>
<li>当我们调用dispatch的时候,dispatch执行的过程中,会调用reducer函数,reducer函数就是我们处理state的方法</li>
<li>dispatch函数中在调用reducer的时候,会向其中传递两个参数,一个是initialState对象,一个是action对象;dispatch函数执行后返回的是传入的action</li>
<li>注意定义reducer的时候,必须要返回一个state状态,防治state状态的丢失.</li>
</ul>
<p>2.3 初始化state的两种方式,</p>
<ul>
<li>通过createStore(reducer , initialState)</li>
<li>通过reducer(state = initialState , action )</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">'./redux.min.js'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">   </div><div class="line">        <span class="comment">//action 创建器</span></div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">createActionOne</span> (<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="keyword">return</span> &#123;</div><div class="line">                <span class="attr">type</span> : <span class="string">'INCREAMENT'</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">createActionTwo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="keyword">return</span> &#123;</div><div class="line">                <span class="attr">type</span> : <span class="string">'DECREASE'</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//reducer处理函数</span></div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">reducer</span> (<span class="params">state = &#123;count : <span class="number">0</span> &#125;,action</span>)</span>&#123;</div><div class="line">            <span class="comment">// state = state || &#123;count : 0 &#125;</span></div><div class="line">            <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">                <span class="keyword">case</span> <span class="string">"INCREAMENT"</span> :</div><div class="line">                    <span class="keyword">return</span> &#123;<span class="attr">conut</span> : state.count+<span class="number">1</span>&#125;;</div><div class="line">                <span class="keyword">case</span> <span class="string">"DECREASE"</span> :</div><div class="line">                    <span class="keyword">return</span> &#123;<span class="attr">count</span> : state.count<span class="number">-1</span>&#125;;</div><div class="line">                <span class="keyword">default</span> :</div><div class="line">                    <span class="keyword">return</span> state ;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">//store状态管理器的创建</span></div><div class="line">        </div><div class="line">        <span class="keyword">var</span> store = Redux.createStore(reducer);</div><div class="line">        <span class="built_in">console</span>.log( store.getState() );</div><div class="line">        store.dispatch(createActionOne());</div><div class="line">        <span class="built_in">console</span>.log( store.getState() );</div><div class="line"></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">'./redux.min.js'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">     </div><div class="line">        <span class="comment">//action 创建器</span></div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">createActionOne</span> (<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="keyword">return</span> &#123;</div><div class="line">                <span class="attr">type</span> : <span class="string">'INCREAMENT'</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">createActionTwo</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="keyword">return</span> &#123;</div><div class="line">                <span class="attr">type</span> : <span class="string">'DECREASE'</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//reducer处理函数</span></div><div class="line">        <span class="function"><span class="keyword">function</span> <span class="title">reducer</span> (<span class="params">state ,action</span>)</span>&#123;</div><div class="line">            <span class="comment">// state = state || &#123;count : 0 &#125;</span></div><div class="line">            <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">                <span class="keyword">case</span> <span class="string">"INCREAMENT"</span> :</div><div class="line">                    <span class="keyword">return</span> &#123;<span class="attr">conut</span> : state.count+<span class="number">1</span>&#125;;</div><div class="line">                <span class="keyword">case</span> <span class="string">"DECREASE"</span> :</div><div class="line">                    <span class="keyword">return</span> &#123;<span class="attr">count</span> : state.count<span class="number">-1</span>&#125;;</div><div class="line">                <span class="keyword">default</span> :</div><div class="line">                    <span class="keyword">return</span> state ;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">//store状态管理器的创建</span></div><div class="line">        <span class="keyword">var</span> initialState = &#123;<span class="attr">count</span> : <span class="number">10</span> &#125;</div><div class="line">        <span class="keyword">var</span> store = Redux.createStore(reducer,initialState);</div><div class="line">        <span class="built_in">console</span>.log( store.getState() );</div><div class="line">        store.dispatch(createActionOne());</div><div class="line">        <span class="built_in">console</span>.log( store.getState() );</div><div class="line">        </div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="3-ES6语法新特性-bable在线编译工具"><a href="#3-ES6语法新特性-bable在线编译工具" class="headerlink" title="3 ES6语法新特性                   bable在线编译工具"></a>3 ES6语法新特性                   <a href="http://babeljs.io/learn-es2015/" target="_blank" rel="external">bable在线编译工具</a></h3><p>ES6</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">reducer</span> (<span class="params">state = &#123;count : <span class="number">0</span> &#125;,action</span>)</span>&#123;</div><div class="line">            <span class="comment">// state = state || &#123;count : 0 &#125;</span></div><div class="line">            <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">                <span class="keyword">case</span> <span class="string">"INCREAMENT"</span> :</div><div class="line">                    <span class="keyword">return</span> &#123;<span class="attr">conut</span> : state.count+<span class="number">1</span>&#125;;</div><div class="line">                <span class="keyword">case</span> <span class="string">"DECREASE"</span> :</div><div class="line">                    <span class="keyword">return</span> &#123;<span class="attr">count</span> : state.count<span class="number">-1</span>&#125;;</div><div class="line">                <span class="keyword">default</span> :</div><div class="line">                    <span class="keyword">return</span> state ;</div><div class="line">            &#125;</div><div class="line">        &#125;</div></pre></td></tr></table></figure>
<p>经过转化为ES5</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">"use strict"</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> state = <span class="built_in">arguments</span>.length &gt; <span class="number">0</span> &amp;&amp; <span class="built_in">arguments</span>[<span class="number">0</span>] !== <span class="literal">undefined</span> ? <span class="built_in">arguments</span>[<span class="number">0</span>] : &#123; <span class="attr">count</span>: <span class="number">0</span> &#125;;</div><div class="line">    <span class="keyword">var</span> action = <span class="built_in">arguments</span>[<span class="number">1</span>];</div><div class="line"></div><div class="line">    <span class="comment">// state = state || &#123;count : 0 &#125;</span></div><div class="line">    <span class="keyword">switch</span> (action.type) &#123;</div><div class="line">        <span class="keyword">case</span> <span class="string">"INCREAMENT"</span>:</div><div class="line">            <span class="keyword">return</span> &#123; <span class="attr">conut</span>: state.count + <span class="number">1</span> &#125;;</div><div class="line">        <span class="keyword">case</span> <span class="string">"DECREASE"</span>:</div><div class="line">            <span class="keyword">return</span> &#123; <span class="attr">count</span>: state.count - <span class="number">1</span> &#125;;</div><div class="line">        <span class="keyword">default</span>:</div><div class="line">            <span class="keyword">return</span> state;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="4-参考"><a href="#4-参考" class="headerlink" title="4 参考"></a>4 参考</h3><p><a href="https://github.com/kenberkeley/redux-simple-tutorial/blob/master/redux-advanced-tutorial.md" target="_blank" rel="external">源码解读</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/03/203DHTMLX框架浅析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/03/203DHTMLX框架浅析/" itemprop="url">
                  DHTMLX框架浅析
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-03T12:36:00+08:00">
                2017-05-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/dhtmlx/" itemprop="url" rel="index">
                    <span itemprop="name">dhtmlx</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>###1 </p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/02/202seajsuse实例应用与理解/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/02/202seajsuse实例应用与理解/" itemprop="url">
                  seajsuse实例应用与理解
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-02T12:36:00+08:00">
                2017-05-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/seajs/" itemprop="url" rel="index">
                    <span itemprop="name">seajs</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>五一小长假已经过完,心里很愧疚,因为没有学习,没有学习就没有进步,没有进步就没有薪水,没有薪水我就无法生活,没有生活我就无法生存,没有生存我还能怎样拯救世界呢?为了世界和平,继续学习;嗯,开始节后第一博;回顾原理,夯实基础.</p>
<p><strong>seajs.use</strong></p>
<p>首先看下在没有这些工具的时候我们如何加载一个js文件的</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</div><div class="line">script.setAttribute(<span class="string">'src'</span>, <span class="string">'example.js'</span>);</div><div class="line">script.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"script loaded!"</span>);</div><div class="line">&#125;;</div><div class="line"><span class="built_in">document</span>.body.appendChild(script);</div></pre></td></tr></table></figure>
<h3 id="1-seajs-use语法"><a href="#1-seajs-use语法" class="headerlink" title="1 seajs.use语法"></a>1 seajs.use语法</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">seajs.use(id, callback?)</div><div class="line"><span class="comment">// 加载一个模块</span></div><div class="line">seajs.use(<span class="string">'./a'</span>);</div><div class="line"></div><div class="line"><span class="comment">// 加载一个模块，在加载完成时，执行回调</span></div><div class="line">seajs.use(<span class="string">'./a'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123;</div><div class="line">  a.doSomething();</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 加载多个模块，在加载完成时，执行回调</span></div><div class="line">seajs.use([<span class="string">'./a'</span>, <span class="string">'./b'</span>], <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</div><div class="line">  a.doSomething();</div><div class="line">  b.doSomething();</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="2-seajs-use模块加载在所在文件的用途-通过seajs-use引入的文件在当前页面都是可用的-相当于引入的js文件在当前页面执行-src引入js文件的原理一样"><a href="#2-seajs-use模块加载在所在文件的用途-通过seajs-use引入的文件在当前页面都是可用的-相当于引入的js文件在当前页面执行-src引入js文件的原理一样" class="headerlink" title="2 seajs.use模块加载在所在文件的用途:通过seajs.use引入的文件在当前页面都是可用的,相当于引入的js文件在当前页面执行(src引入js文件的原理一样)"></a>2 seajs.use模块加载在所在文件的用途:通过seajs.use引入的文件在当前页面都是可用的,相当于引入的js文件在当前页面执行(src引入js文件的原理一样)</h3><p>考虑如下文件目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">F:</div><div class="line">	workspace</div><div class="line">		-sea.js</div><div class="line">		-jquery-1.12.4.js</div><div class="line">		-seajsTest</div><div class="line">			-module.js</div><div class="line">			-js</div><div class="line">				module1.js</div><div class="line">				module2.js</div><div class="line">			-css</div><div class="line">				common.css</div><div class="line">			-page</div><div class="line">				index.html</div></pre></td></tr></table></figure>
<p>index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">'test'</span>&gt;</span>this is a test for seajsuse<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    seajs.use([<span class="string">'../../jquery-1.12.4'</span>],<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log($)</div><div class="line">        <span class="comment">// seajs.use('../module');</span></div><div class="line">    &#125;)</div><div class="line"></div><div class="line"></div><div class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'1'</span>);</div><div class="line">        </div><div class="line">         <span class="built_in">console</span>.log($);</div><div class="line">    &#125;,<span class="number">200</span>)</div><div class="line"></div><div class="line">    <span class="built_in">console</span>.log($);</div><div class="line"></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div></pre></td></tr></table></figure>
<p>输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Uncaught ReferenceError: $ is not defined   // 最后一行代码输出</div><div class="line">function ( selector, context ) &#123;&#125;  //回调函数输出</div><div class="line">function ( selector, context ) &#123;&#125;	//定时器输出</div></pre></td></tr></table></figure>
<p>这个时候要对函数的同步执行,异步执行以及回调函数有着清晰的认识:简单来说就是   <strong>同步 <em> 异步 </em> 回调</strong></p>
<p>seajs.use的回调函数在依赖模块<strong>加载完毕</strong>之后触发执行.因为模块的加载时同步加载的,加载完成之后才会执行回调函数common.css也可以通过seajs.use引入当前页面</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">p</span> &#123;</div><div class="line">    <span class="attribute">font-size </span>: <span class="number">50px</span> ;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>index.html加上如下代码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    seajs.use(<span class="string">'../css/common.css'</span>)</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p>可以发现字体被加上了css样式，字体变大了。</p>
<p><strong>注意引入css文件的时候,一定要加上css后缀名,因为seajs不会为我们加上后缀,默认是  .js</strong></p>
<p>a.加载css的时候一定要加后缀的</p>
<p>b.路径中有”？“的时候javascript文件的后缀不能省略</p>
<p>c.路径中是以”#”号结尾的文件也不可以省去后缀</p>
<h3 id="3-seajs-use如果嵌套seajs-use-还是从原理层面去考虑-seajs-use依赖的模块也是可以直接调用外部seajs-use引用的模块数据-可以理解嵌套的使用script-src加载js文件"><a href="#3-seajs-use如果嵌套seajs-use-还是从原理层面去考虑-seajs-use依赖的模块也是可以直接调用外部seajs-use引用的模块数据-可以理解嵌套的使用script-src加载js文件" class="headerlink" title="3 seajs.use如果嵌套seajs.use,还是从原理层面去考虑,seajs.use依赖的模块也是可以直接调用外部seajs.use引用的模块数据(可以理解嵌套的使用script -src加载js文件)"></a>3 seajs.use如果嵌套seajs.use,还是从原理层面去考虑,seajs.use依赖的模块也是可以直接调用外部seajs.use引用的模块数据(可以理解嵌套的使用script -src加载js文件)</h3><p>module.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$(<span class="string">'#test'</span>).css(<span class="string">'backgroundColor'</span>,<span class="string">'red'</span>)</div></pre></td></tr></table></figure>
<p>然后再浏览器中打开index.html文件,可以发现字体变红了,module.js可以使用$这样的jquery封装的代码</p>
<p><strong>一个文件就是一个模块</strong>,通过seajs.use加载一个模块本质上就是通过script标签src属性引入一个文件而已,但是需要注意命名空间的问题</p>
<p>3.1 当这个模块使用define定义的时候,那么就不会污染全局,define定义的变量<strong>必须通过exports对象</strong>提供接口才能被外部访问</p>
<p>3.2 当这个模块不是通过define函数定义的时候,那么就会容易产生全局的变量污染,因为通过script标签引入的js文件会在全局执行;</p>
<p>module1.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> foo = <span class="string">'bar'</span>;</div></pre></td></tr></table></figure>
<p>module2.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params">require,exports,</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> foo1 = <span class="string">'bar1'</span>;</div><div class="line">    exports.foo1 = foo1 ;</div><div class="line">  <span class="comment">//通过模块可以直接操作DOM元素</span></div><div class="line">    <span class="built_in">document</span>.getElementById(<span class="string">'test'</span>).style.color = <span class="string">'green'</span>;<span class="comment">//字体会变成绿色</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>module.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$(<span class="string">'#test'</span>).css(<span class="string">'backgroundColor'</span>,<span class="string">'red'</span>);</div><div class="line"><span class="built_in">console</span>.log(<span class="string">'module.js'</span>,foo);</div><div class="line"><span class="built_in">console</span>.log(<span class="string">'module.js'</span>,foo1);</div></pre></td></tr></table></figure>
<p>index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">'test'</span>&gt;</span>this is a test for seajsuse<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">        seajs.use(<span class="string">'../css/common.css'</span>)</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">    seajs.use([<span class="string">'../../jquery-1.12.4'</span>,<span class="string">'../js/module1'</span>,<span class="string">'../js/module2'</span>],<span class="function"><span class="keyword">function</span>(<span class="params">a,b,c</span>)</span>&#123;</div><div class="line">        <span class="comment">// console.log($);</span></div><div class="line">        <span class="built_in">console</span>.log(<span class="built_in">arguments</span>);<span class="comment">//null  null  Object</span></div><div class="line">        </div><div class="line">        seajs.use(<span class="string">'../module'</span>);</div><div class="line"></div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'seajs'</span>,foo);</div><div class="line">        </div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'seajs'</span>,c.foo1);</div><div class="line">        </div><div class="line">    &#125;)</div><div class="line"></div><div class="line">   setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'setTimeout'</span>,foo);</div><div class="line">    </div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'setTimeout'</span>,c.foo1);</div><div class="line">   &#125;,<span class="number">2000</span>)</div><div class="line"></div><div class="line"><span class="comment">//define定义的变量不会污染全局      直接引入的js文件会污染全局</span></div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div></pre></td></tr></table></figure>
<p>输出如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">-(3) [null, null, Object, callee: function, Symbol(Symbol.iterator): function]</div><div class="line">-seajs bar</div><div class="line">-seajs bar1</div><div class="line">-module.js bar</div><div class="line">-Uncaught ReferenceError: foo1 is not defined</div><div class="line">-setTimeout bar</div><div class="line">-Uncaught ReferenceError: c is not defined</div></pre></td></tr></table></figure>
<h3 id="4-module-模块的生命周期"><a href="#4-module-模块的生命周期" class="headerlink" title="4 module  模块的生命周期"></a>4 module  模块的生命周期</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> STATUS = Module.STATUS = &#123;</div><div class="line">  <span class="comment">// 1 - The `module.uri` is being fetched</span></div><div class="line">  FETCHING: <span class="number">1</span>,</div><div class="line">  <span class="comment">// 2 - The meta data has been saved to cachedMods</span></div><div class="line">  SAVED: <span class="number">2</span>,</div><div class="line">  <span class="comment">// 3 - The `module.dependencies` are being loaded</span></div><div class="line">  LOADING: <span class="number">3</span>,</div><div class="line">  <span class="comment">// 4 - The module are ready to execute</span></div><div class="line">  LOADED: <span class="number">4</span>,</div><div class="line">  <span class="comment">// 5 - The module is being executed</span></div><div class="line">  EXECUTING: <span class="number">5</span>,</div><div class="line">  <span class="comment">// 6 - The `module.exports` is available</span></div><div class="line">  EXECUTED: <span class="number">6</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="5-详细源码可以查看-通过npm-install-seajs下载的资源包里面也会有响应的代码-有兴趣的可以看下里面的源码-以下是我参考的文章"><a href="#5-详细源码可以查看-通过npm-install-seajs下载的资源包里面也会有响应的代码-有兴趣的可以看下里面的源码-以下是我参考的文章" class="headerlink" title="5 详细源码可以查看(通过npm install seajs下载的资源包里面也会有响应的代码,有兴趣的可以看下里面的源码,以下是我参考的文章)"></a>5 详细源码可以查看(通过npm install seajs下载的资源包里面也会有响应的代码,有兴趣的可以看下里面的源码,以下是我参考的文章)</h3><p><a href="https://segmentfault.com/a/1190000000471722" target="_blank" rel="external">seajs源码解析1</a></p>
<p><a href="http://www.codeceo.com/article/javascript-seajs.html" target="_blank" rel="external">seajs源码解析2</a></p>
<p><a href="https://segmentfault.com/a/1190000000354302" target="_blank" rel="external">seajs</a></p>
<p><a href="http://www.cnblogs.com/jfmblog/p/5650979.html" target="_blank" rel="external">这篇总结的比较好</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/28/201seajs源码实现/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/28/201seajs源码实现/" itemprop="url">
                  seajs源码实现
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-28T12:36:00+08:00">
                2017-04-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/seajs/" itemprop="url" rel="index">
                    <span itemprop="name">seajs</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1-seajs核心实现包括以下几个函数"><a href="#1-seajs核心实现包括以下几个函数" class="headerlink" title="1 seajs核心实现包括以下几个函数"></a>1 seajs核心实现包括以下几个函数</h3><p>use(id,callback)  入口函数</p>
<p>define(id?dep?factory)  模块定义函数</p>
<p>require(id)  模块加载函数</p>
<p>getModuleExports(module)  取得模块接口函数 </p>
<h3 id="2-代码实现"><a href="#2-代码实现" class="headerlink" title="2 代码实现"></a>2 代码实现</h3><p><strong>2.1. use(ids, callback)</strong><br>use为程序启动的入口，主要干两件事：加载指定的模块待模块加载完成后，调用回调函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">use</span>(<span class="params">ids, callback</span>) </span>&#123;</div><div class="line"></div><div class="line">     <span class="keyword">if</span> (!<span class="built_in">Array</span>.isArray(ids)) ids = [ids];</div><div class="line"></div><div class="line">     <span class="built_in">Promise</span>.all(ids.map(<span class="function"><span class="keyword">function</span> (<span class="params">id</span>) </span>&#123;</div><div class="line"></div><div class="line">         <span class="keyword">return</span> load(myLoader.config.root + id);</div><div class="line"></div><div class="line">     &#125;)).then(<span class="function"><span class="keyword">function</span> (<span class="params">list</span>) </span>&#123;</div><div class="line"></div><div class="line">         callback.apply(global, list);<span class="comment">// 加载完成， 调用回调函数</span></div><div class="line"></div><div class="line">     &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</div><div class="line"></div><div class="line">         <span class="keyword">throw</span> error;</div><div class="line"></div><div class="line">     &#125;);</div><div class="line"></div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<p>use会调用load函数，这个函数的作用是根据模块的id，加载模块，并返回一个Promise对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">load</span>(<span class="params">id</span>) </span>&#123;</div><div class="line"></div><div class="line">       <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</div><div class="line"></div><div class="line">           <span class="keyword">var</span> <span class="built_in">module</span> = myLoader.modules[id] || Module.create(id); <span class="comment">// 取得模块或者新建模块 此时模块正在加载或者已经加载完成</span></div><div class="line"></div><div class="line">           <span class="built_in">module</span>.on(<span class="string">"complete"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">               <span class="keyword">var</span> exports = getModuleExports(<span class="built_in">module</span>);</div><div class="line"></div><div class="line">               resolve(exports);<span class="comment">// 加载完成-&gt; 通知调用者</span></div><div class="line"></div><div class="line">           &#125;)</div><div class="line"></div><div class="line">           <span class="built_in">module</span>.on(<span class="string">"error"</span>, reject);</div><div class="line"></div><div class="line">       &#125;)</div><div class="line"></div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p><strong>2.2 define函数的实现</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> factory = <span class="function"><span class="keyword">function</span>(<span class="params">require, exports, module</span>)</span>&#123;</div><div class="line">    <span class="comment">// some code</span></div><div class="line">&#125;</div><div class="line">define(factory);</div></pre></td></tr></table></figure>
<p> 一个模块文件被浏览器下载下来后，并不会直接运行我们的模块定义代码，而是会首先执行一个<code>define</code>函数，这个函数会取得模块定义的源代码（通过函数的<code>toString()</code>函数来取得源代码），然后利用正则匹配找到依赖的模块（匹配<code>require(&quot;dep.js&quot;)</code>这样的字符串)，然后加载依赖的模块，最后发射一个自定义事件<code>complete</code>，通知<strong>当前模块</strong>， 模块已经加载完成，此时，<strong>当前模块</strong>的就会调用与<code>complete</code>事件绑定的回调函数，完成与这个模块相关的任务，比如<code>resolve</code>与这个模块加载绑定的<code>Promise</code>。<br>具体实现为：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">define</span>(<span class="params">factory</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> id = getCurrentScript();</div><div class="line">  id = id.replace(location.origin, <span class="string">""</span>);</div><div class="line">  <span class="keyword">var</span> <span class="built_in">module</span> = myLoader.modules[id];</div><div class="line">  <span class="built_in">module</span>.factory = factory;</div><div class="line">  <span class="keyword">var</span> dependences = getDependcencs(factory);</div><div class="line">  <span class="keyword">if</span> (dependences) &#123;</div><div class="line">      <span class="built_in">Promise</span>.all(dependences.map(<span class="function"><span class="keyword">function</span> (<span class="params">dep</span>) </span>&#123;</div><div class="line">          <span class="keyword">return</span> load(myLoader.config.root + dep);</div><div class="line">      &#125;)).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">          <span class="built_in">module</span>.fire(<span class="string">"complete"</span>); <span class="comment">// 依赖加载完成，通知模块。</span></div><div class="line">      &#125;, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">          <span class="built_in">module</span>.fire(<span class="string">"error"</span>);</div><div class="line">      &#125;);</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">      <span class="built_in">module</span>.fire(<span class="string">"complete"</span>);<span class="comment">//没有依赖，通知模块加载完成</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>2.3 require函数的实现</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">require</span>(<span class="params">id</span>) </span>&#123;</div><div class="line">       <span class="keyword">var</span> <span class="built_in">module</span> = myLoader.modules[myLoader.config.root + id];</div><div class="line">       <span class="keyword">if</span> (!<span class="built_in">module</span>) <span class="keyword">throw</span> <span class="string">"can not load find module by id:"</span> + id;</div><div class="line">       <span class="keyword">else</span> &#123;</div><div class="line">           <span class="keyword">return</span> getModuleExports(<span class="built_in">module</span>); <span class="comment">// 返回模块的对外接口。</span></div><div class="line">       &#125;</div><div class="line">   &#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getModuleExports</span>(<span class="params">module</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (!<span class="built_in">module</span>.exports) &#123;</div><div class="line">        <span class="built_in">module</span>.exports = &#123;&#125;;</div><div class="line">        <span class="built_in">module</span>.factory(<span class="built_in">require</span>, <span class="built_in">module</span>.exports, <span class="built_in">module</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="built_in">module</span>.exports;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><a href="http://natumsol.github.io/2015/12/21/a-mirco-cmd-loader/#模块定义函数-define-factory" target="_blank" rel="external">参考</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/27/201seajs核心/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="JiM-W">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JiM-W">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/27/201seajs核心/" itemprop="url">
                  seajs核心
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-27T12:36:00+08:00">
                2017-04-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/seajs/" itemprop="url" rel="index">
                    <span itemprop="name">seajs</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>研究下seajs到底是什么</strong></p>
<p>seajs模块化的理念就是,每一个js文件都是一个单独的模块,模块中的变量,方法不能被外部访问,有效的防治了全局变量的污染;如果想要被外部文件访问,需要通过exports导出;(基本的原理还是立即执行函数的封装以及闭包的使用)</p>
<p>文件目录结构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">F:</div><div class="line">	workspace</div><div class="line">		sea.js</div><div class="line">		seajsTest</div><div class="line">			index.html</div><div class="line">			main.js</div><div class="line">			module.js</div></pre></td></tr></table></figure>
<p>###1 seajs全局函数</p>
<p>index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">'../sea.js'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>;</div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></div><div class="line">        console.log(seajs);</div><div class="line">      	console.log(define);//define是一个全局函数</div><div class="line">      	//consolelog(require);//报错,require不是全局函数,这点记住       </div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div></pre></td></tr></table></figure>
<p>控制台输出如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">// console.log(seajs);</div><div class="line">Object</div><div class="line">Module:function t(a,b)</div><div class="line">cache:Object</div><div class="line">config:function (a)</div><div class="line">data:Object</div><div class="line">emit:function (a,b)</div><div class="line">off:function (a,b)</div><div class="line">on:function (a,b)</div><div class="line">request:function o(a,b,c,d)</div><div class="line">require:function (a)</div><div class="line">resolve:function m(a,b)</div><div class="line">use:function (a,b)</div><div class="line">version:&quot;2.2.3&quot;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">console.log(define)</div><div class="line">function (a,c,d)&#123;var e=arguments.length;1===e?(d=a,a=b):2===e&amp;&amp;(d=c,y(a)?(c=a,a=b):c=b),!y(c)&amp;&amp;z(d)&amp;&amp;(c=s(&quot;&quot;+d));var f=&#123;id:a,uri:t.resolve(a),deps:c,factory:d&#125;;if(!f.uri&amp;&amp;M.attachEvent)&#123;var g=r();g&amp;&amp;(f.uri=g.…</div></pre></td></tr></table></figure>
<h3 id="2-seajs-use"><a href="#2-seajs-use" class="headerlink" title="2 seajs.use()"></a>2 seajs.use()</h3><p>index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">'../sea.js'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>;</div><div class="line">   <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></div><div class="line">       // seajs.use('./main.js');</div><div class="line">       // console.log(foo);//报错,这就是模块化的理念</div><div class="line">       </div><div class="line"></div><div class="line">       seajs.use(['./main.js','./module'],function()&#123;</div><div class="line">           console.log('callback is exec');</div><div class="line">           console.log(arguments);</div><div class="line">             </div><div class="line">       &#125;);</div><div class="line">       // console.log(seajs);</div><div class="line">       // console.log(define);</div><div class="line">       </div><div class="line">   <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p>main.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params">require,exports,module</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="built_in">arguments</span>);</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'main.js was loaded'</span>);</div><div class="line">    </div><div class="line">    <span class="keyword">var</span> foo = <span class="string">'Jhon'</span></div><div class="line"></div><div class="line">    exports.foo = <span class="string">'bar'</span>;</div><div class="line">    exports.myFunc = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'this is a func from main.js'</span>);</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>module.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params">require,exports,module</span>)</span>&#123;</div><div class="line">    exports.mod = <span class="string">'baz'</span>;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'module.js is exec'</span>);</div><div class="line">    </div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>seajs.use会按顺序加载模块,先加载main.js,那么main.js就会被执行,然后加载module.js,module.js就会被执行,等两者加载完毕之后,就会执行回调函数;回调函数中接受参数,参数是每个模块导出的exports对象;如果没有导出exports对象,那么回调函数中对应的参数是null</p>
<p>seajs如何判断模块的加载是否完成的呢?其实底层也是封装了script标签的onload事件,加载完毕之后触发该事件,然后执行回调函数;</p>
<p>针对上面的代码分析下控制台的输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">//main.js输出</div><div class="line">[function, Object, t, callee: function, Symbol(Symbol.iterator): function]</div><div class="line">0: function a(b)</div><div class="line">	async: function (b,c)</div><div class="line">	resolve:function (a)</div><div class="line">1:Object</div><div class="line">	foo : &apos;bar&apos;,</div><div class="line">	myFunc : function()&#123;&#125;</div><div class="line">2: t </div><div class="line">	dependencies:Array(0)</div><div class="line">	exports:Object</div><div class="line">	id : </div><div class="line">	uri : </div><div class="line">	status :</div><div class="line">    </div><div class="line">//以上是define(factory)中factory的三个参数解析</div><div class="line">main.js was loaded</div><div class="line">//module.js输出</div><div class="line">module.js is exec</div><div class="line">//index.html 中seajs.use回调函数输出</div><div class="line">callback is exec</div><div class="line">//以下是seajs.use回调函数中传入的参数,可以看出来是每个模块导出的对象 exports </div><div class="line">[Object, Object, callee: function, Symbol(Symbol.iterator): function]0: Object1: Objectcallee: function ()length: 2Symbol(Symbol.iterator): function values()__proto__: Object</div></pre></td></tr></table></figure>
<h3 id="3-接下来解释下factory中三个参数"><a href="#3-接下来解释下factory中三个参数" class="headerlink" title="3 接下来解释下factory中三个参数"></a>3 接下来解释下factory中三个参数</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params">require,exports,module</span>)</span>&#123;</div><div class="line">  </div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[function, Object, t, callee: function, Symbol(Symbol.iterator): function]</div><div class="line">0: function a(b)</div><div class="line">	async: function (b,c)</div><div class="line">	resolve:function (a)</div><div class="line">1:Object</div><div class="line">	foo : &apos;bar&apos;,</div><div class="line">	myFunc : function()&#123;&#125;</div><div class="line">2: t </div><div class="line">	dependencies:Array(0)</div><div class="line">	exports:Object</div><div class="line">	id : </div><div class="line">	uri : </div><div class="line">	status :</div></pre></td></tr></table></figure>
<p>3.1 require方法解析</p>
<ul>
<li>require(a) 是一个方法 ,接受模块标识作为  <strong>唯一的参数</strong>,<ul>
<li>如果require的模块有exports对象返回,返回的是a模块的exports对象;</li>
<li>如果require的模块没有返回exports对象返回,那么默认返回null</li>
<li>引入的模块定义的方法可以使用,比如引入jquery等类库</li>
</ul>
</li>
<li>require.sync(a,callback) 是一个方法,接受<strong>两个参数</strong>,一个是模块标识,一个是回调函数,异步执行;</li>
<li>require.resolve(a)  该函数不会加载模块，只返回解析后的绝对路径。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params">require,exports,module</span>)</span>&#123;</div><div class="line">    exports.mod = <span class="string">'baz'</span>;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'module.js is exec'</span>);</div><div class="line">    <span class="built_in">require</span>(<span class="string">'./jquery-1.12.4.js'</span>);</div><div class="line">    <span class="built_in">console</span>.log($);  </div><div class="line">  <span class="comment">/*</span></div><div class="line">  function ( selector, context ) &#123; &#125;</div><div class="line">  */</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>3.1.1 当模块标识为顶级标识的时候:(不以  .  开头  或者不以    /  开头);require(a)路径的解析是以seajs文件所在目录为基准</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//main.js</span></div><div class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params">require,exports,module</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="built_in">arguments</span>);</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'main.js was loaded'</span>);</div><div class="line">    </div><div class="line">    <span class="keyword">var</span> foo = <span class="string">'Jhon'</span></div><div class="line">    <span class="keyword">var</span> retMain = <span class="built_in">require</span>(<span class="string">'module.js'</span>);</div><div class="line">    <span class="built_in">console</span>.log(<span class="built_in">require</span>.resolve(<span class="string">'module'</span>));</div><div class="line">    <span class="comment">//file:///F:/workspace/module.js</span></div><div class="line">    <span class="comment">//可以看出顶级模块标识是以seajs文件所在目录为基准进行解析的</span></div><div class="line">   </div><div class="line">    exports.foo = <span class="string">'bar'</span>;</div><div class="line">    exports.myFunc = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'this is a func from main.js'</span>);</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>3.1.2 当模块标识为相对标识的时候(以  .  开头,则该模块标识就是相对标识),  <strong>相对标识路径解析的时候,永远是相对于当前模块而言</strong> ;出现在define的factory函数中require函数的参数中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params">require,exports,module</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="built_in">arguments</span>);</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'main.js was loaded'</span>);</div><div class="line">    </div><div class="line">    <span class="keyword">var</span> foo = <span class="string">'Jhon'</span></div><div class="line">     <span class="keyword">var</span> retMain = <span class="built_in">require</span>(<span class="string">'./module.js'</span>);</div><div class="line">     <span class="built_in">console</span>.log(retMain);<span class="comment">//Object &#123;mod: "baz"&#125;</span></div><div class="line">     </div><div class="line">    <span class="built_in">console</span>.log(<span class="built_in">require</span>.resolve(<span class="string">'./module'</span>));</div><div class="line">    <span class="comment">//file:///F:/workspace//seajsTest/module.js</span></div><div class="line">    exports.foo = <span class="string">'bar'</span>;</div><div class="line">    exports.myFunc = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'this is a func from main.js'</span>);</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>3.2 exports对象解析   <strong>exports对象是module.exports对象的引用,而模块真正导出的是module.exports</strong></p>
<p>当我们在定义模块的时候</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params">require, exports</span>) </span>&#123;</div><div class="line"></div><div class="line">  <span class="comment">// 错误用法！！!</span></div><div class="line">  exports = &#123;</div><div class="line">    <span class="attr">foo</span>: <span class="string">'bar'</span>,</div><div class="line">    <span class="attr">doSomething</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</div><div class="line">  &#125;;</div><div class="line"></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>对象并不会被导出,因为改变了exports的引用,所以导出的module.exports 是没有数据的</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params">require, exports, module</span>) </span>&#123;</div><div class="line"></div><div class="line">  <span class="comment">// 正确写法</span></div><div class="line">  <span class="built_in">module</span>.exports = &#123;</div><div class="line">    <span class="attr">foo</span>: <span class="string">'bar'</span>,</div><div class="line">    <span class="attr">doSomething</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</div><div class="line">  &#125;;</div><div class="line"></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>3.3 module 对象</p>
<ul>
<li>module.id  </li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">define(<span class="string">'id'</span>, [], <span class="function"><span class="keyword">function</span>(<span class="params">require, exports, module</span>) </span>&#123;</div><div class="line"></div><div class="line">  <span class="comment">// 模块代码</span></div><div class="line"></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<ul>
<li><p>module.uri   根据模块系统的路径解析规则得到的模块绝对路径。</p>
<p>一般情况下在没有写define中的id参数的时候,两者完全一样;</p>
</li>
<li><p>module.dependencies Array 是一个数组,表示当前模块的依赖</p>
</li>
<li><p>module.exports</p>
<p>当前模块对外提供的接口。</p>
<p>传给 <code>factory</code> 构造方法的 <code>exports</code> 参数是 <code>module.exports</code> 对象的一个引用。只通过 <code>exports</code> 参数来提供接口，有时无法满足开发者的所有需求。 比如当模块的接口是某个类的实例时，需要通过 <code>module.exports</code>来实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">define(function(require, exports, module) &#123;</div><div class="line"></div><div class="line">  // exports 是 module.exports 的一个引用</div><div class="line">  console.log(module.exports === exports); // true</div><div class="line"></div><div class="line">  // 重新给 module.exports 赋值</div><div class="line">  module.exports = new SomeClass();</div><div class="line"></div><div class="line">  // exports 不再等于 module.exports</div><div class="line">  console.log(module.exports === exports); // false</div><div class="line"></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="4-seajs-use-require-二者引用模块规则"><a href="#4-seajs-use-require-二者引用模块规则" class="headerlink" title="4 seajs.use   require    二者引用模块规则"></a>4 seajs.use   require    二者引用模块规则</h3><ul>
<li>当引用的模块是顶级标识的时候,那么就是相对于seajs文件所在目录为基准</li>
<li>当引用模块是相对标识的时候,那么就是相对于seajs.use   requre所在文件目录为基准;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">F:</div><div class="line">	workspace</div><div class="line">		sea.js</div><div class="line">		seajsTest</div><div class="line">			index.html</div><div class="line">			main.js</div><div class="line">			module.js</div><div class="line">			module2.js</div><div class="line">             seajsConfig.js</div></pre></td></tr></table></figure>
<p>seajsConfig.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">seajs.config(&#123;</div><div class="line">    <span class="attr">alias</span> : &#123;</div><div class="line">        <span class="comment">// mod2 : 'seajsTest/module2' //这是顶级标识,引用文件的时候会相对于seajs文件所在目录</span></div><div class="line">        mod2 : <span class="string">'./module2'</span>  <span class="comment">//这是相对路径,引用文件的时候会相对于当前文件或者当前模块所在目录</span></div><div class="line">    &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>index.html</p>
<p>此时在index.html中通过别名引用模块module2.js 可以通过别名 mod2来引用</p>
<p><strong>注意如果引用模块有exports对象内容,那么回调函数传入的参数就是exports对象,如果没有,那么传入的是null</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">'../sea.js'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>;</div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">'./seajsconfig.js'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>;</div><div class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">        seajs.use([<span class="string">'./main.js'</span>,<span class="string">'./module'</span>,<span class="string">'mod2'</span>],<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(<span class="string">'callback is exec'</span>);</div><div class="line">            <span class="built_in">console</span>.log(<span class="built_in">arguments</span>);</div><div class="line">              </div><div class="line">        &#125;);</div><div class="line">        <span class="built_in">console</span>.log(seajs);</div><div class="line">        <span class="comment">// console.log(define);</span></div><div class="line">        </div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="5-模块路径"><a href="#5-模块路径" class="headerlink" title="5 模块路径"></a>5 模块路径</h3><ul>
<li>相对标识：以 . 开头（包括.和..），相对标识永远相对当前模块的 URI 来解析。</li>
<li>顶级标识：不以点（.）或斜线（/）开始， 会相对模块系统的基础路径（即 SeaJS配置 的 base 路径）来解析</li>
<li>普通路径：除了相对和顶级标识之外的标识都是普通路径，相对当前页面解析。<ul>
<li>绝对路径是普通路径。绝对路径比较容易理解。</li>
<li>根路径是以“/”开头的，取当前页面的域名+根路径;</li>
<li>相对路径以 ../   开头或者以   ./  开头的都是相对路径</li>
</ul>
</li>
</ul>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>


          
          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar.jpg"
               alt="JiM-W" />
          <p class="site-author-name" itemprop="name">JiM-W</p>
           
              <p class="site-description motion-element" itemprop="description">keep fighting！</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">194</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">52</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">89</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">JiM-W</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  



  
  

  

  

  

  


  

</body>
</html>
